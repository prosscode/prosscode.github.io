<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>PROSS</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://pross.space/"/>
  <updated>2019-07-10T16:52:54.393Z</updated>
  <id>https://pross.space/</id>
  
  <author>
    <name>RukiapR0ss</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Apache-Thrift-Thrift-Thrift</title>
    <link href="https://pross.space/archives/2019/07/09/"/>
    <id>https://pross.space/archives/2019/07/09/</id>
    <published>2019-07-09T15:10:18.000Z</published>
    <updated>2019-07-10T16:52:54.393Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:08 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>æ¥ç€ä¸Šç¯‡æ–‡ç« è¯´ã€‚</p><p>æˆ‘ä»¬çŸ¥é“äº†Apache Thriftä¸»è¦ç”¨äºå„ä¸ªæœåŠ¡ä¹‹é—´çš„RPCé€šä¿¡ï¼Œå¹¶ä¸”æ”¯æŒè·¨è¯­è¨€ï¼›åŒ…æ‹¬C++ï¼ŒJavaï¼ŒPythonï¼ŒPHPï¼ŒRubyï¼ŒGoï¼ŒNode.jsç­‰ç­‰ï¼Œè¿˜æœ‰ä¸€äº›éƒ½æ²¡å¬è¯´è¿‡çš„è¯­è¨€ï¼›è€Œä¸”ä»ä¸Šç¯‡æ–‡ç« çš„RPCä¾‹å­ä¸­å¯ä»¥å‘ç°ï¼ŒThriftæ˜¯ä¸€ä¸ªå…¸å‹çš„CSï¼ˆå®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼‰æ¶æ„ï¼›åŠ ä¸Šè·¨è¯­è¨€çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­ä¸€ä¸‹ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€å¼€å‘çš„ã€‚</p><p>å¦‚æœCSç«¯å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥å¼€å‘ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯æœ‰ä¸€ç§ä¸­é—´è¯­è¨€æ¥å…³è”å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼ˆç›¸åŒè¯­è¨€ä¹Ÿéœ€è¦å…³è”å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼‰ã€‚å…¶å®è¿™ä¸ªç­”æ¡ˆéƒ½çŸ¥é“ï¼Œé‚£å°±æ˜¯æ¥å£å®šä¹‰è¯­è¨€ï¼šIDLï¼ˆInterface Description Languageï¼‰ï¼›ä¸‹é¢æˆ‘ä»¬ä»IDLè¿›è¡Œå¼€åœºè¡¨æ¼”ï¼Œè¿›è¡Œä¸€æ¬¡Thrift RPCçš„å®Œæ•´æ¼”å‡ºã€‚</p><a id="more"></a><h3 id="æ¥å£æè¿°è¯­è¨€IDL"><a href="#æ¥å£æè¿°è¯­è¨€IDL" class="headerlink" title="æ¥å£æè¿°è¯­è¨€IDL"></a>æ¥å£æè¿°è¯­è¨€IDL</h3><p>ä¾æ—§ç…§ä¾‹ï¼Œæ¬æ¥wikiçš„è§£é‡Šï¼š</p><blockquote><p>æ¥å£æè¿°è¯­è¨€ï¼ˆInterface Description Languageï¼Œç¼©å†™IDLï¼‰ï¼Œæ˜¯ç”¨æ¥æè¿°è½¯ä»¶ç»„ä»¶ç•Œé¢çš„ä¸€ç§è®¡ç®—æœºè¯­è¨€ã€‚IDLé€šè¿‡ä¸€ç§ä¸­ç«‹çš„æ–¹å¼æ¥æè¿°æ¥å£ï¼Œä½¿å¾—åœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œçš„å¯¹è±¡å’Œç”¨ä¸åŒè¯­è¨€ç¼–å†™çš„ç¨‹åºå¯ä»¥ç›¸äº’é€šä¿¡äº¤æµï¼›æ¯”å¦‚ï¼Œä¸€ä¸ªç»„ä»¶ç”¨C++å†™æˆï¼Œå¦ä¸€ä¸ªç»„ä»¶ç”¨Javaå†™æˆã€‚</p><p>IDLé€šå¸¸ç”¨äºè¿œç¨‹è°ƒç”¨è½¯ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€èˆ¬æ˜¯ç”±è¿œç¨‹å®¢æˆ·ç»ˆç«¯è°ƒç”¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„å¯¹è±¡ç»„ä»¶ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡ç»„ä»¶å¯èƒ½æ˜¯ç”±ä¸åŒè®¡ç®—æœºè¯­è¨€ç¼–å†™çš„ã€‚IDLå»ºç«‹èµ·äº†ä¸¤ä¸ªä¸åŒæ“ä½œç³»ç»Ÿé—´é€šä¿¡çš„æ¡¥æ¢ã€‚</p></blockquote><p>å…³äºIDLæ•°æ®ç±»å‹å’Œè¯­æ³•ä»‹ç»ï¼Œè¿™é‡Œç®€å•åˆ—ä¸¾ï¼š</p><p><strong>åŸºæœ¬ç±»å‹</strong></p><ul><li>byteï¼š8ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆbyteï¼‰</li><li>i16ï¼š16ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆshortï¼‰</li><li>i32ï¼š32ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆintï¼‰</li><li>i64ï¼š64ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆlongï¼‰</li><li>doubleï¼š64ä½æµ®ç‚¹æ•°ï¼ˆdoubleï¼‰</li><li>stringï¼šå­—ç¬¦ä¸²ï¼ˆstringï¼‰</li><li>boolï¼šå¸ƒå°”å˜é‡ï¼ˆbooleanï¼‰</li></ul><blockquote><p>Thriftä¸æ”¯æŒæ— ç¬¦å·æ•´æ•°ï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„è¯­è¨€éƒ½æ”¯æŒæ— ç¬¦å·æ•´æ•°ã€‚</p></blockquote><p><strong>å®¹å™¨ç±»å‹</strong></p><ul><li>list<t>ï¼šæœ‰åºåˆ—è¡¨ï¼Œå…ƒç´ å¯ä»¥é‡å¤</t></li><li>set<t>ï¼šæ— åºé›†åˆï¼Œå…ƒç´ ä¸å¯é‡å¤</t></li><li>map<k ,v="">ï¼šå­—å…¸ç»“æ„ï¼Œé”®å€¼å¯¹</k></li></ul><p><strong>ç»“æ„ä½“</strong></p><p>ç±»ä¼¼Cè¯­è¨€çš„ç»“æ„ä½“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// requiredå’Œoptionalï¼Œå¿…é€‰å’Œå¯é€‰</span></div><div class="line">struct Example &#123;</div><div class="line">   <span class="number">1</span>: required string name;      </div><div class="line">   <span class="number">3</span>: optional i32 age;   </div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>æšä¸¾ç±»å‹</strong></p><p>å¯ä»¥åƒC/C++ä¸€æ ·å®šä¹‰æšä¸¾ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> EnumType &#123;</div><div class="line">    NUMBER = <span class="number">2</span></div><div class="line">&#125;        </div><div class="line"></div><div class="line">struct exampleStruct &#123;</div><div class="line">    required i32 id;</div><div class="line">    required string userName;</div><div class="line">    optional EnumType enumType = EnumType.NUMBER;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>å¼‚å¸¸</strong></p><p>å¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸ï¼Œæ‰€å®šä¹‰çš„å¼‚å¸¸ä¼šç»§æ‰¿å¯¹åº”è¯­è¨€çš„å¼‚å¸¸ç±»ï¼Œæ¯”å¦‚Javaï¼Œå°±ä¼šç»§æ‰¿<code>java.lang.Exception</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">exception RequestException &#123;</div><div class="line">   <span class="number">1</span>: required i32 code;</div><div class="line">   <span class="number">2</span>: optional string reason;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>æœåŠ¡</strong></p><p>ç›¸å½“äºJavaä¸­åˆ›å»ºæ¥å£ï¼ˆInterfaceï¼‰ä¸€æ ·ï¼Œåˆ›å»ºçš„serviceç»è¿‡Thriftä»£ç ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ¡†æ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">service exampleService&#123;</div><div class="line">    <span class="function">string <span class="title">hello</span><span class="params">(<span class="number">1</span>:string username)</span></span></div><div class="line"><span class="function">&#125;</span></div></pre></td></tr></table></figure><p><strong>å‘½åç©ºé—´</strong></p><p>å…³é”®å­—<code>namespace</code>ï¼Œç›¸å½“äºJavaä¸­çš„packageï¼Œå¿…é¡»éœ€è¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ä»£ç è·¯å¾„ï¼šservice.study.thrift</span></div><div class="line">namespace java service.study.thrift</div></pre></td></tr></table></figure><p><strong>å¸¸é‡</strong></p><p>å®šä¹‰å¸¸é‡ï¼Œå¤æ‚çš„ç±»å‹å’Œç»“æ„ä½“å¯ä»¥ä½¿ç”¨JSONæ¥è¡¨ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> i32 INT_CONST = <span class="number">20</span>;</div><div class="line"><span class="keyword">const</span> map&lt;i32,string&gt; MAP_CONST = &#123;<span class="number">1</span>:<span class="string">"hello"</span>,<span class="number">2</span>:<span class="string">"world"</span>&#125;;</div></pre></td></tr></table></figure><p><strong>æ³¨é‡Š</strong></p><p>æ”¯æŒ<code>#</code>å’Œ<code>//</code>å•è¡Œæ³¨é‡Šï¼Œå’Œ<code>/***/</code>å¤šè¡Œæ³¨é‡Šã€‚</p><p>æˆ‘ä»¬ç”¨ä»¥ä¸Šçš„çš„æ•°æ®ç±»å‹å’Œè¯­æ³•è§„åˆ™ï¼Œè‡ªå®šä¹‰ç”Ÿæˆä¸€ä¸ªThriftæ–‡ä»¶ï¼Œå–åå«<code>hello.thrift</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">namespace java org.pross.thrift</div><div class="line"></div><div class="line"><span class="keyword">enum</span> RequestType &#123;</div><div class="line">   SAY_HELLO,   <span class="comment">//é—®å¥½</span></div><div class="line">   QUERY_TIME,  <span class="comment">//è¯¢é—®æ—¶é—´</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">struct Request &#123;</div><div class="line">   <span class="number">1</span>: required RequestType type;  <span class="comment">// è¯·æ±‚çš„ç±»å‹ï¼Œå¿…é€‰</span></div><div class="line">   <span class="number">2</span>: required string name;       <span class="comment">// å‘èµ·è¯·æ±‚çš„äººçš„åå­—ï¼Œå¿…é€‰</span></div><div class="line">   <span class="number">3</span>: optional i32 age;           <span class="comment">// å‘èµ·è¯·æ±‚çš„äººçš„å¹´é¾„ï¼Œå¯é€‰</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// å¼‚å¸¸</span></div><div class="line">exception RequestException &#123;</div><div class="line">   <span class="number">1</span>: required i32 code;</div><div class="line">   <span class="number">2</span>: optional string reason;</div><div class="line">&#125;</div><div class="line"><span class="comment">// æœåŠ¡åï¼Œæ¥å£ï¼šaddition()å’ŒsayHello()ï¼Œå°†ä¼šä½¿ç”¨åˆ°</span></div><div class="line">service HelloMethod&#123;</div><div class="line">    <span class="function">i32 <span class="title">division</span><span class="params">(<span class="number">1</span>:i32 param1,<span class="number">2</span>:i32 param2)</span> <span class="title">throws</span> <span class="params">(<span class="number">1</span>:RequestException re)</span> <span class="comment">//å¯èƒ½æŠ›å‡ºå¼‚å¸¸</span></span></div><div class="line"><span class="function">    string <span class="title">sayHello</span><span class="params">(<span class="number">1</span>:string username)</span></span></div><div class="line"><span class="function">&#125;</span></div></pre></td></tr></table></figure><p>å®‰è£…å¥½thriftï¼Œåœ¨ç»ˆç«¯è¿è¡Œï¼š<code>thrift --gen java hello.thrift</code>ï¼Œåˆ™åœ¨å½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª<code>gen-java</code>ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹ä¼šæŒ‰ç…§<code>namespace</code>å®šä¹‰è·¯å¾„åï¼Œç”Ÿæˆæ–‡ä»¶å¤¹ï¼›æœ€ç»ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†4ä¸ªJavaç±»ï¼š<code>HelloMethod</code>ï¼Œ<code>Ruquest</code>ï¼Œ<code>RequestException</code>å’Œ<code>RequestType</code>ã€‚<code>hello.thrift</code>æ–‡ä»¶ä¸­å®šä¹‰çš„enumï¼Œstructï¼Œexceptionï¼Œserviceéƒ½ç›¸åº”åœ°ç”Ÿæˆäº†ä¸€ä¸ªJavaç±»ï¼Œè¿™å°±æ˜¯èƒ½æ”¯æŒJavaè¯­è¨€é€šä¿¡çš„åŸºæœ¬æ¡†æ¶ä»£ç ã€‚</p><blockquote><p><code>thrift --gen java hello.thrift</code>ï¼ŒæŒ‡å®šJavaè¯­è¨€ç”Ÿæˆæ¡†æ¶ä»£ç ã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥ç¼–å†™ï¼Œåªéœ€è¦å¯¹é€‰æ‹©ä¸åŒè¯­è¨€çš„ç”Ÿæˆæ¡†æ¶ä»£ç å³å¯ã€‚</p></blockquote><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ç”Ÿæˆçš„<code>HelloMethod</code>ç±»çš„å…·ä½“ç»“æ„ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</p><p><img src="/archives/2019/07/09/dir.png" alt=""></p><p>å¯¹äºå¼€å‘äººå‘˜è€Œè¨€ï¼Œéœ€è¦å…³æ³¨å‡ ä¸ªæ ¸å¿ƒå†…éƒ¨æ¥å£/æ–¹æ³•ï¼š</p><ul><li><p>Ifaceï¼šæœåŠ¡ç«¯é€šè¿‡å®ç°<code>HelloMethod.Iface</code>æ¥å£ï¼Œå‘å®¢æˆ·ç«¯æä¾›åŒæ­¥è°ƒç”¨ä¸šåŠ¡é€»è¾‘çš„æ¥å£ã€‚</p></li><li><p>AsyncIfaceï¼šæœåŠ¡ç«¯é€šè¿‡å®ç°<code>HelloMethod.Iface</code>æ¥å£ï¼Œå‘å®¢æˆ·ç«¯æä¾›å¼‚æ­¥è°ƒç”¨ï¼Œå¼‚æ­¥è°ƒç”¨æ¥å£å¤šäº†ä¸€ä¸ªå›è°ƒå‚æ•°<code>AsyncMethodCallback&lt;String&gt;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åŒæ­¥è°ƒç”¨æ¥å£  </span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iface</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">division</span><span class="params">(<span class="keyword">int</span> param1, <span class="keyword">int</span> param2)</span> <span class="keyword">throws</span> RequestException, org.apache.thrift.TException</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String username)</span> <span class="keyword">throws</span> org.apache.thrift.TException</span>;</div><div class="line"></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">//å¼‚æ­¥è°ƒç”¨æ¥å£</span></div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AsyncIface</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">division</span><span class="params">(<span class="keyword">int</span> param1, <span class="keyword">int</span> param2, org.apache.thrift.async.AsyncMethodCallback&lt;Integer&gt; resultHandler)</span> <span class="keyword">throws</span> org.apache.thrift.TException</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(String username, org.apache.thrift.async.AsyncMethodCallback&lt;String&gt; resultHandler)</span> <span class="keyword">throws</span> org.apache.thrift.TException</span>;</div><div class="line"></div><div class="line">  &#125;</div></pre></td></tr></table></figure></li><li><p>Client/AsyncClientï¼šå®¢æˆ·ç«¯å®ä¾‹åŒ–<code>HelloMethod.Client</code>å¯¹è±¡ï¼Œä»¥åŒæ­¥/å¼‚æ­¥çš„æ–¹å¼è®¿é—®æœåŠ¡ç«¯æä¾›çš„æœåŠ¡æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">    <span class="comment">// æä¾›å·¥å‚æ–¹æ³•åˆ›å»ºclientå¯¹è±¡</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> <span class="keyword">implements</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">thrift</span>.<span class="title">TServiceClientFactory</span>&lt;<span class="title">Client</span>&gt; </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Factory</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Client <span class="title">getClient</span><span class="params">(org.apache.thrift.protocol.TProtocol prot)</span> </span>&#123;</div><div class="line">          <span class="keyword">return</span> <span class="keyword">new</span> Client(prot);</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Client <span class="title">getClient</span><span class="params">(org.apache.thrift.protocol.TProtocol iprot, org.apache.thrift.protocol.TProtocol oprot)</span> </span>&#123;</div><div class="line">          <span class="keyword">return</span> <span class="keyword">new</span> Client(iprot, oprot);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">// æ¥å£æ–¹æ³•çš„å®¢æˆ·ç«¯ä»£ç†</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">division</span><span class="params">(<span class="keyword">int</span> param1, <span class="keyword">int</span> param2)</span> <span class="keyword">throws</span> RequestException, org.apache.thrift.TException</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="comment">// å‘é€æ–¹æ³•è°ƒç”¨è¯·æ±‚</span></div><div class="line">      send_division(param1, param2);</div><div class="line">      <span class="comment">// æ¥æ”¶è¿”å›å€¼</span></div><div class="line">      <span class="keyword">return</span> recv_division();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send_division</span><span class="params">(<span class="keyword">int</span> param1, <span class="keyword">int</span> param2)</span> <span class="keyword">throws</span> org.apache.thrift.TException</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="comment">// åˆ›å»ºæ–¹æ³•å‚æ•°å¯¹è±¡ï¼Œå°è£…æ–¹æ³•å‚æ•°</span></div><div class="line">      division_args args = <span class="keyword">new</span> division_args();</div><div class="line">      args.setParam1(param1);</div><div class="line">      args.setParam2(param2);</div><div class="line">      <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•å‘é€æ¶ˆæ¯</span></div><div class="line">      sendBase(<span class="string">"division"</span>, args);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">...</div><div class="line">  <span class="comment">// org.apache.thrift.TServiceClient.sendBase</span></div><div class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendBase</span><span class="params">(String methodName, TBase&lt;?, ?&gt; args, <span class="keyword">byte</span> type)</span> <span class="keyword">throws</span> TException </span>&#123;</div><div class="line">  <span class="comment">// å‘é€æ¶ˆæ¯å¤´ï¼ˆTProtocolï¼‰</span></div><div class="line">        <span class="keyword">this</span>.oprot_.writeMessageBegin(<span class="keyword">new</span> TMessage(methodName, type, ++<span class="keyword">this</span>.seqid_));</div><div class="line">  <span class="comment">// å‘é€æ¶ˆæ¯ä½“ï¼Œç”±æ–¹æ³•å‚æ•°å¯¹è±¡è‡ªå·±å¤„ç†ç¼–ç ï¼Œ write(TProtocol)</span></div><div class="line">        args.write(<span class="keyword">this</span>.oprot_);</div><div class="line">        <span class="keyword">this</span>.oprot_.writeMessageEnd();</div><div class="line">        <span class="keyword">this</span>.oprot_.getTransport().flush();</div><div class="line">    &#125;</div></pre></td></tr></table></figure></li><li><p>Processorï¼šç”¨æ¥æ”¯æŒæ–¹æ³•è°ƒç”¨ï¼Œæ¯ä¸ªæœåŠ¡å®ç°ç±»éœ€è¦ä½¿ç”¨Processoræ¥æ³¨å†Œï¼Œè¿™æ ·æœåŠ¡å™¨è°ƒç”¨æ¥å£å®ç°æ—¶èƒ½å®šä½åˆ°å…·ä½“çš„å®ç°ç±»ã€‚</p></li><li><p>æ–¹æ³•å‚æ•°çš„å°è£…ç±»ï¼šä»¥æ–¹æ³•å_argså‘½å</p></li><li><p>æ–¹æ³•è¿”å›å€¼çš„å°è£…ç±»ï¼šä»¥æ–¹æ³•å_resultå‘½å</p></li></ul><p>ä»¥ä¸Šå°±æ˜¯é€šè¿‡IDLè¯­æ³•è§„åˆ™ï¼Œç”Ÿæˆçš„ä¸­é—´è¯­è¨€ï¼Œç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡äº¤æµã€‚</p><h3 id="Thriftåè®®æ ˆæ•´ä½“çš„æ¶æ„"><a href="#Thriftåè®®æ ˆæ•´ä½“çš„æ¶æ„" class="headerlink" title="Thriftåè®®æ ˆæ•´ä½“çš„æ¶æ„"></a>Thriftåè®®æ ˆæ•´ä½“çš„æ¶æ„</h3><p>OKï¼Œæˆ‘ä»¬å·²ç»æ­å»ºå¥½äº†<code>Client</code>å’Œ<code>Server</code>ç«¯ç›¸äº’äº¤æµçš„æ¡¥æ¢äº†ã€‚æ¥ä¸‹æ¥çœ‹çœ‹Thriftï¼Œäº†è§£ä¸‹æ•´ä½“æ¶æ„ï¼Œåœ¨ç¼–å†™ä»£ç å®ç°é€»è¾‘äº¤äº’æ—¶ï¼Œæ‰èƒ½çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚æ¶æ„å¦‚ä¸‹å›¾ï¼š</p><p><img src="/archives/2019/07/09/thrift.png" alt="thriftæ¶æ„"></p><p>åœ¨Clientå’ŒServerçš„æœ€é¡¶å±‚éƒ½æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„å¤„ç†é€»è¾‘ã€‚</p><p>Processorï¼ˆTProcessorçš„å­ç±»ï¼‰æ˜¯æœåŠ¡å™¨ç«¯ä»Thriftæ¡†æ¶è½¬å…¥ç”¨æˆ·é€»è¾‘çš„å…³é”®æµç¨‹ï¼Œè´Ÿè´£å¯¹Clientçš„è¯·æ±‚åšå‡ºå“åº”ï¼ŒåŒ…æ‹¬RPCè¯·æ±‚è½¬å‘ã€è°ƒç”¨å‚æ•°è§£æã€ç”¨æˆ·é€»è¾‘è°ƒç”¨ï¼Œè¿”å›å€¼å†™å›ç­‰ï¼›ä¹Ÿå¯¹TServerä¸­è¯·æ±‚çš„InputProtocolå’ŒOutputTProtocolè¿›è¡Œæ“ä½œï¼Œä»InputProtocolä¸­è¯»å‡ºClientçš„è¯·æ±‚æ•°æ®ï¼Œå‘OutputProtcolä¸­å†™å…¥ç”¨æˆ·é€»è¾‘çš„è¿”å›å€¼ã€‚</p><p>TServerä¸»è¦ä»»åŠ¡å°±æ˜¯é«˜æ•ˆçš„æ¥å—Clientçš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°Processorè¿›è¡Œå¤„ç†ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å®ç°ï¼š</p><ul><li>TSimpleServerï¼šç®€å•çš„å•çº¿ç¨‹ç½‘ç»œé˜»å¡æ¨¡å‹ï¼ŒåŒæ—¶åªèƒ½æœåŠ¡ä¸€ä¸ªclientè¿æ¥ï¼Œå…¶ä»–æ‰€æœ‰å®¢æˆ·ç«¯åœ¨è¢«æœåŠ¡å™¨ç«¯æ¥å—ä¹‹å‰éƒ½åªèƒ½ç­‰å¾…ï¼Œä¸»è¦ç”¨äºæµ‹è¯•ã€‚</li><li>TNonblockingServerï¼šå¤šçº¿ç¨‹æœåŠ¡æ¨¡å‹ï¼Œä½¿ç”¨äº†NIOä¸­çš„<code>Selector</code>é€‰æ‹©å™¨ï¼Œé€šè¿‡è°ƒç”¨<code>select()</code>ï¼Œä½¿å¾—å®¢æˆ·ç«¯çš„è¯·æ±‚é˜»å¡åœ¨å¤šä¸ªè¿æ¥ä¸Šï¼Œè€Œä¸æ˜¯åœ¨å•ä¸€çš„è¿æ¥ï¼›å¯ä»¥æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯ã€‚</li><li>THsHaServerï¼šä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œI/Oï¼Œä¸€ä¸ªç‹¬ç«‹çš„workerçº¿ç¨‹æ± æ¥å¤„ç†æ¶ˆæ¯ï¼Œåªè¦æœ‰ç©ºé—²çš„workerçº¿ç¨‹å°±ä¼šè¢«ç«‹å³å¤„ç†ã€‚</li><li>TThreadedSelectorServerï¼šç»´æŠ¤äº†ä¸¤ä¸ªçº¿ç¨‹æ± ï¼Œä¸€ä¸ªç”¨æ¥å¤„ç†ç½‘ç»œI/Oï¼Œå¦ä¸€ä¸ªç”¨æ¥è¿›è¡Œè¯·æ±‚çš„å¤„ç†ã€‚å½“ç½‘ç»œI/Oæ˜¯ç“¶é¢ˆçš„æ—¶å€™ï¼ŒTThreadedSelectorServeræ¯”THsHaServerçš„è¡¨ç°è¦å¥½ã€‚</li><li>TThreadPoolServerï¼šçº¿ç¨‹æ± ç½‘ç»œæ¨¡å‹ï¼Œæ˜¯å°†æ¯ä¸€ä¸ªè¯·æ±‚éƒ½åŠ å…¥åˆ°<code>ThreadPoolExecutor</code>çº¿ç¨‹æ± ä¸­ï¼Œå¹¶ç»‘å®šå…¶ä¸­ä¸€ä¸ªworkerçº¿ç¨‹å»å¤„ç†ï¼Œç›´åˆ°å…³é—­ã€‚</li></ul><p>TProtocol æ˜¯ä¼ è¾“åè®®å±‚ï¼Œä¸»è¦è´Ÿè´£ç»“æ„åŒ–æ•°æ®ï¼Œå¹¶ç»„è£…æˆMessageï¼Œæˆ–è€…ä»Messageç»“æ„ä¸­è¯»å‡ºç»“æ„åŒ–æ•°æ®ã€‚å°†ä¸€ä¸ªæœ‰ç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºå­—èŠ‚æµä»¥äº¤ç»™TTransportè¿›è¡Œä¼ è¾“ï¼Œæˆ–è€…ä»TTransportä¸­è¯»å–ä¸€å®šé•¿åº¦çš„å­—èŠ‚æ•°æ®è½¬åŒ–ä¸ºç‰¹å®šç±»å‹çš„æ•°æ®ã€‚å¦‚int32ä¼šè¢«TBinaryProtocol Encodeä¸ºä¸€ä¸ªå››å­—èŠ‚çš„å­—èŠ‚æ•°æ®ï¼Œæˆ–è€…TBinaryProtocolä»TTransportä¸­å–å‡ºå››ä¸ªå­—èŠ‚çš„æ•°æ®Decodeä¸ºint32ã€‚</p><blockquote><p>ä¼ è¾“åè®®åŒ…æ‹¬ï¼šTBinaryProtocolï¼ˆåŸºäºäºŒè¿›åˆ¶ç¼–ç ä¼ è¾“çš„åè®®ï¼‰ï¼ŒTCompactProtocolï¼ˆç´§å‡‘ï¼Œé«˜æ•ˆçš„äºŒè¿›åˆ¶ä¼ è¾“åè®®ï¼Œä½¿ç”¨Variable-Length Quantity (VLQ) ç¼–ç å¯¹æ•°æ®ç¼–ç å‹ç¼©ï¼Œä¸»è¦æ˜¯å¯¹æ•´æ•°é‡‡ç”¨å¯å˜é•¿åº¦ï¼‰ï¼ŒTJSONProtocolï¼ˆä½¿ç”¨JSONæ ¼å¼ç¼–ç çš„ä¼ è¾“åè®®ï¼‰ï¼ŒTDebugProtocolï¼ˆæ–‡æœ¬æ ¼å¼ï¼Œæ–¹ä¾¿æŠ“åŒ…Debugï¼‰ã€‚</p></blockquote><p>TTransport ä¼ è¾“å±‚è´Ÿè´£ä»¥å­—èŠ‚æµæ–¹å¼å‘é€å’Œæ¥æ”¶Messageï¼Œæ˜¯åº•å±‚IOæ¨¡å—åœ¨Thriftæ¡†æ¶ä¸­çš„å®ç°ï¼Œæ¯ä¸€ä¸ªåº•å±‚IOæ¨¡å—éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”TTransportæ¥è´Ÿè´£Byte Streamï¼ˆå­—èŠ‚æµï¼‰æ•°æ®åœ¨è¯¥IOæ¨¡å—ä¸Šçš„ä¼ è¾“ï¼Œæœ‰ä»¥ä¸‹TTransportçš„å®ç°ï¼š</p><ul><li>TSocketï¼šé˜»å¡å‹ socketï¼Œæ˜¯æœ€å¸¸è§çš„æ¨¡å¼ï¼Œç”¨äºå®¢æˆ·ç«¯ï¼Œé‡‡ç”¨ç³»ç»Ÿå‡½æ•° read å’Œ write è¿›è¡Œè¯»å†™æ•°æ®</li><li>TServerSocketï¼šéé˜»å¡å‹ socketï¼Œç”¨äºæœåŠ¡å™¨ç«¯ï¼Œaccecpt åˆ°çš„ socket ç±»å‹éƒ½æ˜¯ TSocket</li><li>THttpTransportï¼šé‡‡ç”¨HTTPä¼ è¾“åè®®è¿›è¡Œä¼ è¾“ï¼Œéé˜»å¡å¼ä¸­ä½¿ç”¨</li><li>TFramedTransportï¼šæŒ‰å—çš„å¤§å°è¿›è¡Œä¼ è¾“ï¼Œæ”¯æŒå®šé•¿æ•°æ®å‘é€å’Œæ¥æ”¶</li><li>TFileTransportï¼šç”¨äºå†™æ•°æ®åˆ°æ–‡ä»¶ï¼Œä»¥æ–‡ä»¶å½¢å¼è¿›è¡Œä¼ è¾“</li><li>TMemoryBufferï¼šä»ä¸€ä¸ªç¼“å†²åŒºä¸­è¯»å†™æ•°æ®ï¼ŒJavaå®ç°ä½¿ç”¨çš„æ˜¯<code>ByteArrayOutputStream</code></li><li>TZlibTransportï¼šJavaä¸­é‡‡ç”¨<code>java.util.zip</code>åŒ…ï¼Œæ¥è¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©</li></ul><p>åº•å±‚IOæ¨¡å—ï¼Œè´Ÿè´£å®é™…çš„æ•°æ®ä¼ è¾“ï¼ŒåŒ…æ‹¬Socketï¼Œæ–‡ä»¶ï¼Œæˆ–è€…å‹ç¼©æ•°æ®æµç­‰ã€‚</p><h3 id="Show-me-your-code"><a href="#Show-me-your-code" class="headerlink" title="Show me your code"></a>Show me your code</h3><p>é¡¹ç›®éœ€è¦å¼•å…¥<code>libthrift</code>ä¾èµ–ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.apache.thrift&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;libthrift&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;0.12.0&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure><p>åˆ›å»ºæ¥å£å®ç°ç±»å®ç°<code>HelloMethod.Iface</code>æ¥å£ï¼Œå¹¶å®ç°ç›¸åº”æ–¹æ³•çš„å¤„ç†é€»è¾‘å’Œè¿”å›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloThriftImpl</span> <span class="keyword">implements</span> <span class="title">HelloMethod</span>.<span class="title">Iface</span> </span>&#123;</div><div class="line">    <span class="comment">// é™¤æ³•ï¼Œæ•´é™¤</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">division</span><span class="params">(<span class="keyword">int</span> param1, <span class="keyword">int</span> param2)</span> <span class="keyword">throws</span> RequestException </span>&#123;</div><div class="line">        <span class="keyword">int</span> value = param1 / param2;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// say + username</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String username)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"hello "</span>+username;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>åˆ›å»º <code>ThriftServer.java</code> å®ç°æœåŠ¡ç«¯ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThriftServer</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initServer</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// è®¾ç½®å¤šçº¿ç¨‹æœåŠ¡æ¨¡å‹</span></div><div class="line">            TNonblockingServerSocket socket = <span class="keyword">new</span> TNonblockingServerSocket(<span class="number">9090</span>);</div><div class="line">            <span class="comment">// å…³è”ä¸šåŠ¡å¤„ç†å™¨TProcessor</span></div><div class="line">            TProcessor processor = <span class="keyword">new</span> HelloMethod.Processor(<span class="keyword">new</span> HelloThriftImpl());</div><div class="line">            <span class="comment">// è®¾ç½®äºŒè¿›åˆ¶ä¼ è¾“åè®®ï¼ŒTFramedTransportä¼ è¾“æ–¹å¼å’Œå…³è”ä¸šåŠ¡å¤„ç†</span></div><div class="line">            TNonblockingServer.Args arg = <span class="keyword">new</span> TNonblockingServer.Args(socket);</div><div class="line">            arg.protocolFactory(<span class="keyword">new</span> TBinaryProtocol.Factory());</div><div class="line">            arg.transportFactory(<span class="keyword">new</span> TFramedTransport.Factory());</div><div class="line">            arg.processorFactory(<span class="keyword">new</span> TProcessorFactory(processor));</div><div class="line"></div><div class="line">            <span class="comment">// å¼€å¯æœåŠ¡</span></div><div class="line">            TServer server = <span class="keyword">new</span> TNonblockingServer (arg);</div><div class="line">            System.out.println(<span class="string">"start server port 9090 ..."</span>);</div><div class="line">            server.serve();</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (TTransportException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        initServer();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>åˆ›å»º<code>ThriftClient.java</code>å®ç°å®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThriftClient</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendServerRequest</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥ï¼Œurlï¼Œportï¼Œtimeout</span></div><div class="line">            TSocket socket = <span class="keyword">new</span> TSocket(<span class="string">"localhost"</span>, <span class="number">9090</span>, <span class="number">3000</span>);</div><div class="line">            <span class="comment">// è®¾ç½®TFramedTransportä¼ è¾“æ–¹å¼ï¼ŒäºŒè¿›åˆ¶ä¼ è¾“åè®®</span></div><div class="line">            TTransport transport = <span class="keyword">new</span> TFramedTransport(socket);</div><div class="line">            TProtocol protocol = <span class="keyword">new</span> TBinaryProtocol(transport);</div><div class="line">            <span class="comment">// open client</span></div><div class="line">            socket.open();</div><div class="line"></div><div class="line">            <span class="comment">// å®ä¾‹å®¢æˆ·ç«¯ä¸šåŠ¡å¤„ç†ï¼Œè°ƒç”¨æ–¹æ³•,è¿”å›ç»“æœ</span></div><div class="line">            HelloMethod.Client client = <span class="keyword">new</span> HelloMethod.Client(protocol);</div><div class="line">            <span class="comment">// hello + pross</span></div><div class="line">            String hello = client.sayHello(<span class="string">"pross"</span>);</div><div class="line">          <span class="comment">// 3/1 =3</span></div><div class="line">            <span class="keyword">int</span> value = client.division(<span class="number">3</span>, <span class="number">1</span>);</div><div class="line">            System.out.println(hello);</div><div class="line">            System.out.println(<span class="string">"division value:"</span>+value);</div><div class="line">          </div><div class="line">          socket.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (TTransportException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (RequestException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (TException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        sendServerRequest();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å…ˆè¿è¡ŒæœåŠ¡ç«¯ï¼Œå‡ºç°æç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">start server port 9090 ...</div></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œå®¢æˆ·ç«¯ï¼Œæ§åˆ¶å°æ‰“å°å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hello pross</div><div class="line">division value:3</div></pre></td></tr></table></figure><p>çœ‹åˆ°äº†é¢„æ–™ä¹‹ä¸­çš„ç»“æœï¼ŒThriftæ¼”å‡ºæ¯•ã€‚</p><h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h3><p><a href="http://zheming.wang/blog/2014/08/28/94D1F945-40EC-45E4-ABAF-3B32DFFE4043/" target="_blank" rel="external">Thrift RPCè¯¦è§£</a></p><p><a href="[http://diwakergupta.github.io/thrift-missing-guide/thrift.pdf](http://diwakergupta.github.io/thrift-missing-guide/thrift.pdf">Thrift: The Missing Guide</a>)</p><p><a href="https://thrift.apache.org/" target="_blank" rel="external">Apache Thrift</a></p><p>å®Œã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:08 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;æ¥ç€ä¸Šç¯‡æ–‡ç« è¯´ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬çŸ¥é“äº†Apache Thriftä¸»è¦ç”¨äºå„ä¸ªæœåŠ¡ä¹‹é—´çš„RPCé€šä¿¡ï¼Œå¹¶ä¸”æ”¯æŒè·¨è¯­è¨€ï¼›åŒ…æ‹¬C++ï¼ŒJavaï¼ŒPythonï¼ŒPHPï¼ŒRubyï¼ŒGoï¼ŒNode.jsç­‰ç­‰ï¼Œè¿˜æœ‰ä¸€äº›éƒ½æ²¡å¬è¯´è¿‡çš„è¯­è¨€ï¼›è€Œä¸”ä»ä¸Šç¯‡æ–‡ç« çš„RPCä¾‹å­ä¸­å¯ä»¥å‘ç°ï¼ŒThriftæ˜¯ä¸€ä¸ªå…¸å‹çš„CSï¼ˆå®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼‰æ¶æ„ï¼›åŠ ä¸Šè·¨è¯­è¨€çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­ä¸€ä¸‹ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€å¼€å‘çš„ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœCSç«¯å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥å¼€å‘ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯æœ‰ä¸€ç§ä¸­é—´è¯­è¨€æ¥å…³è”å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼ˆç›¸åŒè¯­è¨€ä¹Ÿéœ€è¦å…³è”å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼‰ã€‚å…¶å®è¿™ä¸ªç­”æ¡ˆéƒ½çŸ¥é“ï¼Œé‚£å°±æ˜¯æ¥å£å®šä¹‰è¯­è¨€ï¼šIDLï¼ˆInterface Description Languageï¼‰ï¼›ä¸‹é¢æˆ‘ä»¬ä»IDLè¿›è¡Œå¼€åœºè¡¨æ¼”ï¼Œè¿›è¡Œä¸€æ¬¡Thrift RPCçš„å®Œæ•´æ¼”å‡ºã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Thrift" scheme="https://pross.space/tags/Thrift/"/>
    
  </entry>
  
  <entry>
    <title>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</title>
    <link href="https://pross.space/archives/2019/06/17/"/>
    <id>https://pross.space/archives/2019/06/17/</id>
    <published>2019-06-16T16:13:44.000Z</published>
    <updated>2019-07-10T16:27:05.522Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>å•Šï¼ŒåŸæœ¬æ˜¯å†™ä¸€ç¯‡Apache Thrift in HiveServerï¼Œæ”¹å†™JDBCè¿æ¥Hiveç›¸å…³åº”ç”¨çš„æ¨æ–‡ï¼Œå› ä¸ºHiveServeræ˜¯ä½¿ç”¨Thriftæä¾›æœåŠ¡åˆ›å»ºç½‘ç»œRPCçš„å¤šç§è¯­è¨€å®¢æˆ·ç«¯ï¼›å•ç‹¬æ‹¿å‡ºæ¥è¯´ï¼Œä½¿ç”¨Thriftä¹Ÿå¯ä»¥è½»æ¾æ„å»ºRPCæœåŠ¡å™¨ï¼Œæ˜¯è½»é‡çº§çš„è·¨è¯­è¨€çš„è¿œç¨‹æœåŠ¡è°ƒç”¨æ¡†æ¶ã€‚è¯´åˆ°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ„Ÿè§‰åˆè¦è§£é‡Šå¾ˆå¤šï¼Œæ‰€ä»¥å°±å…ˆä¸Šä¸ªå‰èœï¼Œè¯´ä¸€è¯´è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰ï¼›å¹¶åŠ äº†ä¸€ä»½ä½æ–™ï¼šå…³äºJDBCè¿æ¥Hiveçš„å®ç°ã€‚</p><a id="more"></a><h4 id="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰"><a href="#è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰" class="headerlink" title="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰"></a>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰</h4><p>ç…§ä¾‹æ¬äº†wikiçš„è§£é‡Šï¼š</p><blockquote><p>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ˜¯åˆ†å¸ƒå¼è®¡ç®—çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆClient/Serverï¼‰çš„ä¾‹å­ï¼Œå®ƒç®€å•è€Œåˆå¹¿å—æ¬¢è¿ã€‚è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ€»æ˜¯ç”±å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨å‘å‡ºä¸€ä¸ªæ‰§è¡Œè‹¥å¹²è¿‡ç¨‹è¯·æ±‚ï¼Œå¹¶ç”¨å®¢æˆ·ç«¯æä¾›çš„å‚æ•°ã€‚æ‰§è¡Œç»“æœå°†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>ä¸ºäº†å…è®¸ä¸åŒçš„å®¢æˆ·ç«¯å‡èƒ½è®¿é—®æœåŠ¡å™¨ï¼Œè®¸å¤šæ ‡å‡†åŒ–çš„RPCæ¡†æ¶åº”è¿è€Œç”Ÿã€‚å…¶ä¸­å¤§éƒ¨åˆ†é‡‡ç”¨æ¥å£æè¿°è¯­è¨€ï¼ˆInterface Description Languageï¼ŒIDLï¼‰ï¼Œæ–¹ä¾¿è·¨å¹³å°çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚</p></blockquote><p>ä¸¾ä¸€ä¸ªæ —å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">()</span></span>&#123;</div><div class="line">       String param1 = <span class="string">"hello"</span>;</div><div class="line">       String param2 = <span class="string">"world"</span>;</div><div class="line">       String result = appendStr(param1, param2);</div><div class="line">       System.out.println(<span class="string">"result:"</span> + result);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">appendStr</span><span class="params">(String param1,String param2)</span></span>&#123;</div><div class="line">       <span class="keyword">return</span> param1+<span class="string">" "</span>+param2;</div><div class="line">   &#125;</div></pre></td></tr></table></figure><p>è¿™æ˜¯æœ¬åœ°å‡½æ•°è°ƒç”¨ä»£ç ï¼Œè°ƒç”¨æ–¹æ³•å’Œè¢«è°ƒç”¨çš„æ–¹æ³•éƒ½åœ¨ä¸€ä¸ªç¨‹åºå†…éƒ¨ï¼Œæ˜¯å±äºè¿›ç¨‹å†…çš„è°ƒç”¨ã€‚CPUåœ¨æ‰§è¡Œ<code>invoke</code>æ–¹æ³•çš„æ—¶å€™ï¼ˆç§°ä¸º<code>è°ƒç”¨æ–¹æ³•</code>ï¼‰ï¼Œä¼šå»æ‰§è¡Œè¢«è°ƒç”¨çš„<code>appendStr</code>è¿™ä¸ªæ–¹æ³•ï¼ˆç§°ä¸º<code>è¢«è°ƒç”¨æ–¹æ³•</code>ï¼‰ï¼Œæ‰§è¡Œå®Œæˆåï¼Œåˆ‡æ¢å›æ¥ç»§ç»­æ‰§è¡Œåç»­çš„ä»£ç ã€‚å¯¹äºè°ƒç”¨æ–¹æ³•è€Œè¨€ï¼Œæ‰§è¡Œè¢«è°ƒç”¨æ–¹æ³•æ—¶ä¼šé˜»å¡ï¼Œç›´åˆ°è¢«è°ƒç”¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€‚ç”»ä¸€ä¸ªç®€å•çš„è¿‡ç¨‹è°ƒç”¨å›¾å¦‚ä¸‹ï¼š</p><p><img src="/archives/2019/06/17/local.jpg" alt=""></p><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹RPCè°ƒç”¨ï¼ˆThriftï¼‰çš„æ —å­ğŸŒ°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">()</span> <span class="keyword">throws</span> TTransportException </span>&#123;</div><div class="line">        TCLIService.Client client = getClient(<span class="string">"127.0.0.1"</span>, <span class="number">8088</span>);</div><div class="line">        String param1 = <span class="string">"hello"</span>;</div><div class="line">        String param2 = <span class="string">"world"</span>;</div><div class="line">        String result = client.appendStr(param1, param2);</div><div class="line">        System.out.println(<span class="string">"result:"</span> + result);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">// get thrift client</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TCLIService.<span class="function">Client <span class="title">getClient</span><span class="params">(String host,<span class="keyword">int</span> port)</span> <span class="keyword">throws</span> TTransportException </span>&#123;</div><div class="line">        <span class="comment">// host port timeout</span></div><div class="line">        TSocket tSocket = <span class="keyword">new</span> TSocket(host, port,<span class="number">10000</span>);</div><div class="line">        TTransport transport = <span class="keyword">new</span> TFramedTransport(tSocket);</div><div class="line">        transport.open();</div><div class="line">        TProtocol protocol = <span class="keyword">new</span> TBinaryProtocol(transport);</div><div class="line">        TCLIService.Client client = <span class="keyword">new</span> TCLIService.Client(protocol);</div><div class="line">        <span class="keyword">return</span>  client;</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªè¿›ç¨‹é—´çš„è°ƒç”¨ï¼Œè°ƒç”¨æ–¹æ³•å’Œè¢«è°ƒç”¨æ–¹æ³•ä¸åœ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œç”šè‡³ä¸æ˜¯ç›¸åŒçš„æœåŠ¡ï¼Œæˆ–è€…ä¸åŒçš„æœåŠ¡å™¨ã€‚è¿›ç¨‹ä¹‹é—´çš„è°ƒç”¨éœ€è¦é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•åœ¨æ‰§è¡ŒRPCè°ƒç”¨æ—¶ä¼šé˜»å¡çŸ¥é“è°ƒç”¨ç»“æœè¿”å›ç»“æœèœç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚è¿‡ç¨‹è°ƒç”¨å›¾å¦‚ä¸‹ï¼š</p><p><img src="/archives/2019/06/17/rpc.jpg" alt=""></p><p>æ€»ç»“ï¼šRPCæ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡çš„æ–¹æ³•ã€‚</p><h4 id="å»¶ä¼¸ï¼šApache-Thriftåœ¨JDBCçš„åº”ç”¨"><a href="#å»¶ä¼¸ï¼šApache-Thriftåœ¨JDBCçš„åº”ç”¨" class="headerlink" title="å»¶ä¼¸ï¼šApache Thriftåœ¨JDBCçš„åº”ç”¨"></a>å»¶ä¼¸ï¼šApache Thriftåœ¨JDBCçš„åº”ç”¨</h4><p>ä¸€èˆ¬æ¥è¯´ï¼ŒJDBCè¿æ¥æ•°æ®æºå¼€å‘çš„æ­¥éª¤ï¼šåŠ è½½é©±åŠ¨ç±»-&gt;åˆ›å»ºæ•°æ®åº“è¿æ¥-&gt;åˆ›å»ºstatement-&gt;æ‰§è¡ŒSQLè¯­å¥-&gt;å¤„ç†ç»“æœã€‚å‰æ®µæ—¶é—´ç ”ç©¶çš„JDBCè¿æ¥Hiveæ•°æ®æºï¼Œåº•å±‚ä¹Ÿæ˜¯é‡‡ç”¨Thriftï¼ˆæºç åœ¨ï¼šorg.apache.hive.jdbcï¼‰ã€‚å‰é¢åˆå§‹åŒ–çš„è¿æ¥ä¼šå¾—åˆ°<code>TCLIService.Iface client</code>å’Œ <code>TSessionHandle sessionHandle</code>ã€‚å…·ä½“çš„æ‰§è¡Œ<code>execute(String sql)</code>ä»£ç å¦‚ä¸‹ï¼Œæˆ‘åˆ†ä¸ºä¸‰æ­¥ï¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³æ‰§è¡ŒSQLçš„æ¡ä»¶ï¼Œåˆå§‹åŒ–æŸ¥è¯¢æ¡ä»¶å¹¶å¼‚æ­¥æ‰§è¡ŒSQLï¼Œç­‰å¾…æ‰§è¡Œå¾—åˆ°ç»“æœã€‚</p><p><strong>æ£€æŸ¥æ¡ä»¶</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">       <span class="comment">// statementæ˜¯å¦è¢«å…³é—­ï¼Œå¦‚æœå…³é—­æŠ¥SQLExceptionï¼šCan't execute after statement has been closed</span></div><div class="line">    checkConnection(<span class="string">"execute"</span>);</div><div class="line">    <span class="comment">// å¦‚æœstmtHandleä¸ä¸ºç©ºï¼Œåˆ™å…³é—­stmtHandle</span></div><div class="line">    closeClientOperation();</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åˆå§‹è¯æ ‡å¿—çŠ¶æ€</span></div><div class="line"><span class="comment">     * å¦‚æ˜¯å¦å·²ç»å–æ¶ˆæ‰§è¡Œ(isCancelled)=falseï¼Œsqlè¯­å¥æŸ¥è¯¢æ˜¯å¦å…³é—­(isQueryClosed)=false</span></div><div class="line"><span class="comment">     * æ˜¯å¦ç”ŸæˆæŸ¥è¯¢æ—¥å¿—(isLogBeingGenerated)=trueï¼Œsqlæ˜¯å¦å·²ç»æäº¤æ‰§è¡Œ(isExecuteStatementFailed)=false</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    initFlags();</div><div class="line">   </div><div class="line">    ...</div><div class="line">      </div><div class="line">  &#125;</div></pre></td></tr></table></figure><p><strong>åˆå§‹åŒ–æŸ¥è¯¢æ¡ä»¶å¹¶æ‰§è¡ŒSQL</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">    ...</div><div class="line">      </div><div class="line"><span class="comment">// åˆå§‹è¯ statement requestï¼Œå¯ä»¥ç»´æŒsessionhandleï¼Œæ·»åŠ sqlæ‰§è¡Œ</span></div><div class="line">    TExecuteStatementReq execReq = <span class="keyword">new</span> TExecuteStatementReq(sessHandle, sql);</div><div class="line"></div><div class="line">    <span class="comment">// è®¾ç½®å¼‚æ­¥æ‰§è¡Œ</span></div><div class="line">    execReq.setRunAsync(<span class="keyword">true</span>);</div><div class="line">    execReq.setConfOverlay(sessConf);</div><div class="line">    <span class="comment">//è·å–reentrant lockï¼ŒåŒä¸€ä¸ªæ—¶é—´ç‚¹åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”æŒæœ‰ï¼Œç¡®ä¿æäº¤æ‰§è¡Œå”¯ä¸€</span></div><div class="line">    transportLock.lock();</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="comment">// clientæ‰§è¡ŒSQL</span></div><div class="line">      TExecuteStatementResp execResp = client.ExecuteStatement(execReq);</div><div class="line">      <span class="comment">// éªŒè¯æ˜¯å¦æˆåŠŸæäº¤</span></div><div class="line">      Utils.verifySuccessWithInfo(execResp.getStatus());</div><div class="line">      <span class="comment">// execResp è·å–OperationHandle</span></div><div class="line">      stmtHandle = execResp.getOperationHandle();</div><div class="line">      <span class="comment">// æ­£å¸¸æ‰§è¡Œ-&gt;æ”¹å˜sqlæ˜¯å¦å·²ç»æäº¤æ‰§è¡Œçš„çŠ¶æ€ä¸ºfalse </span></div><div class="line">      isExecuteStatementFailed = <span class="keyword">false</span>;</div><div class="line">    &#125; <span class="keyword">catch</span> (SQLException eS) &#123;</div><div class="line">      <span class="comment">// å¼‚å¸¸æ‰§è¡Œï¼šæ”¹å˜sqlæ˜¯å¦å·²ç»æäº¤æ‰§è¡Œçš„çŠ¶æ€ä¸ºtrue</span></div><div class="line">      isExecuteStatementFailed = <span class="keyword">true</span>;</div><div class="line">      <span class="keyword">throw</span> eS;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">      isExecuteStatementFailed = <span class="keyword">true</span>;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(ex.toString(), <span class="string">"08S01"</span>, ex);</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">      <span class="comment">// å¼‚å¸¸é€€å‡ºï¼šé‡Šæ”¾é”åŒºåŸŸä»£ç </span></div><div class="line">      transportLock.unlock();</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">  &#125;</div></pre></td></tr></table></figure><p><strong>ç­‰å¾…æ‰§è¡Œå¾—åˆ°ç»“æœ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">    ...</div><div class="line">      </div><div class="line"><span class="comment">// æ­£å¸¸æ‰§è¡Œ æ‹¿åˆ°çŠ¶æ€handle</span></div><div class="line">    TGetOperationStatusReq statusReq = <span class="keyword">new</span> TGetOperationStatusReq(stmtHandle);</div><div class="line">    <span class="comment">// æ“ä½œæ˜¯å¦å®Œæˆçš„çŠ¶æ€ï¼Œåˆå§‹åŒ–çŠ¶æ€false</span></div><div class="line">    <span class="keyword">boolean</span> operationComplete = <span class="keyword">false</span>;</div><div class="line">    TGetOperationStatusResp statusResp;</div><div class="line"></div><div class="line">    <span class="comment">// whileå¾ªç¯ï¼Œé€šè¿‡æ“ä½œæ˜¯å¦å®Œæˆçš„çŠ¶æ€ï¼Œæ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå¦‚æœæ‰§è¡Œå®Œæˆåˆ™é€€å‡º</span></div><div class="line">    <span class="keyword">while</span> (!operationComplete) &#123;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// è·å–reentrant lockï¼Œç¡®ä¿æ‰§è¡Œè¿‡ç¨‹çŠ¶æ€</span></div><div class="line">        transportLock.lock();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">          <span class="comment">// æ‹¿åˆ°æ‰§è¡ŒçŠ¶æ€</span></div><div class="line">          statusResp = client.GetOperationStatus(statusReq);</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">          <span class="comment">// é‡Šæ”¾é”</span></div><div class="line">          transportLock.unlock();</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        Utils.verifySuccessWithInfo(statusResp.getStatus());</div><div class="line">        <span class="comment">// è·å–çŠ¶æ€ï¼Œåšå‡ºç›¸åº”çš„å›åº”</span></div><div class="line">        <span class="keyword">if</span> (statusResp.isSetOperationState()) &#123;</div><div class="line">          <span class="keyword">switch</span> (statusResp.getOperationState()) &#123;</div><div class="line">          <span class="keyword">case</span> CLOSED_STATE:</div><div class="line">          <span class="comment">// æ‰§è¡Œå®Œæˆï¼Œæ”¹å˜çŠ¶æ€ï¼Œé€€å‡ºwhileå¾ªç¯</span></div><div class="line">          <span class="keyword">case</span> FINISHED_STATE:</div><div class="line">            operationComplete = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">          <span class="comment">// æ‰§è¡Œå–æ¶ˆ</span></div><div class="line">          <span class="keyword">case</span> CANCELED_STATE:</div><div class="line">            <span class="comment">// 01000 -&gt; warning</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"Query was cancelled"</span>, <span class="string">"01000"</span>);</div><div class="line">          <span class="comment">// é”™è¯¯çŠ¶æ€</span></div><div class="line">          <span class="keyword">case</span> ERROR_STATE:</div><div class="line">            <span class="comment">// Get the error details from the underlying exception</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(statusResp.getErrorMessage(),</div><div class="line">                statusResp.getSqlState(), statusResp.getErrorCode());</div><div class="line">          <span class="comment">// æœªçŸ¥é”™è¯¯çŠ¶æ€</span></div><div class="line">          <span class="keyword">case</span> UKNOWN_STATE:</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"Unknown query"</span>, <span class="string">"HY000"</span>);</div><div class="line">          <span class="comment">// æ­£åœ¨åˆå§‹åŒ–ï¼Œæ­£åœ¨pendingï¼Œæ­£åœ¨è¿è¡Œï¼ˆé€€å‡ºswitchå¾ªç¯ï¼‰ï¼Œç»§ç»­whileå¾ªç¯</span></div><div class="line">          <span class="keyword">case</span> INITIALIZED_STATE:</div><div class="line">          <span class="keyword">case</span> PENDING_STATE:</div><div class="line">          <span class="keyword">case</span> RUNNING_STATE:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">        <span class="comment">// æ‰§è¡Œè¿‡ç¨‹ä¸­å¼‚å¸¸ï¼Œè·å–æ‰§è¡Œæ—¥å¿—false</span></div><div class="line">        isLogBeingGenerated = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">throw</span> e;</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="comment">// æ‰§è¡Œè¿‡ç¨‹ä¸­å¼‚å¸¸ï¼Œè·å–æ‰§è¡Œæ—¥å¿—false</span></div><div class="line">        isLogBeingGenerated = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(e.toString(), <span class="string">"08S01"</span>, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// æ‰§è¡Œå®Œæˆï¼Œè·å–æ‰§è¡Œæ—¥å¿—false</span></div><div class="line">    isLogBeingGenerated = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="comment">// æµç¨‹åˆ°è¿™é‡Œï¼Œè¯´æ˜å·²ç»æ‰§è¡Œå®Œæˆï¼Œå¯ä»¥æ‹¿åˆ°ç»“æœï¼Œæ²¡æœ‰ç»“æœè¿”å›false</span></div><div class="line">    <span class="keyword">if</span> (!stmtHandle.isHasResultSet()) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// æœ‰ç»“æœï¼Œè·å–ç»“æœï¼Œå¹¶å°è£…æˆResultSetå…¨å±€å˜é‡</span></div><div class="line">    resultSet =  <span class="keyword">new</span> HiveQueryResultSet.Builder(<span class="keyword">this</span>).setClient(client).setSessionHandle(sessHandle)</div><div class="line">        .setStmtHandle(stmtHandle).setMaxRows(maxRows).setFetchSize(fetchSize)</div><div class="line">        .setScrollable(isScrollableResultset).setTransportLock(transportLock)</div><div class="line">        .build();</div><div class="line">    <span class="comment">// æœ‰ç»“æœï¼Œè¿”å›ture</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">  &#125;</div></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯JDBCè¿æ¥Hiveæ•°æ®æºï¼Œå¹¶æ‰§è¡ŒSQLçš„ä»£ç ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³è¦ä¸€ä¸ªä¼šè¯çª—å£ç»´æŒä¸€ä¸ªSessionè®¾ç½®ï¼Œå¦‚è®¾ç½®æ‰§è¡Œé˜Ÿåˆ—ï¼Œè®¾ç½®Job Nameç­‰ï¼Œé‡‡ç”¨JDBCæ–¹å¼æ˜¯ä¸å¯å–çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†Thriftåº•å±‚ä»JDBCå‰¥ç¦»å‡ºæ¥ï¼ŒæŠŠåˆå§‹åŒ–è¿‡ç¨‹ä¸­çš„<code>TSessionHandle sessionHandle</code>æš´éœ²ï¼Œè‡ªå·±æ‰‹åŠ¨ç»´æŠ¤èµ·æ¥å°±å¯ä»¥äº†ã€‚</p><p>å®Œã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;å•Šï¼ŒåŸæœ¬æ˜¯å†™ä¸€ç¯‡Apache Thrift in HiveServerï¼Œæ”¹å†™JDBCè¿æ¥Hiveç›¸å…³åº”ç”¨çš„æ¨æ–‡ï¼Œå› ä¸ºHiveServeræ˜¯ä½¿ç”¨Thriftæä¾›æœåŠ¡åˆ›å»ºç½‘ç»œRPCçš„å¤šç§è¯­è¨€å®¢æˆ·ç«¯ï¼›å•ç‹¬æ‹¿å‡ºæ¥è¯´ï¼Œä½¿ç”¨Thriftä¹Ÿå¯ä»¥è½»æ¾æ„å»ºRPCæœåŠ¡å™¨ï¼Œæ˜¯è½»é‡çº§çš„è·¨è¯­è¨€çš„è¿œç¨‹æœåŠ¡è°ƒç”¨æ¡†æ¶ã€‚è¯´åˆ°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ„Ÿè§‰åˆè¦è§£é‡Šå¾ˆå¤šï¼Œæ‰€ä»¥å°±å…ˆä¸Šä¸ªå‰èœï¼Œè¯´ä¸€è¯´è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰ï¼›å¹¶åŠ äº†ä¸€ä»½ä½æ–™ï¼šå…³äºJDBCè¿æ¥Hiveçš„å®ç°ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="RPC" scheme="https://pross.space/tags/RPC/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Swagger2æ„å»ºRESTful API</title>
    <link href="https://pross.space/archives/2019/02/02/"/>
    <id>https://pross.space/archives/2019/02/02/</id>
    <published>2019-02-01T17:00:44.000Z</published>
    <updated>2019-07-10T16:28:46.406Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>åæ§½äº†ä¸€é˜µå…¬å¸æä¾›çš„è®°å½•æ¥å£æ–‡æ¡£å·¥å…·åï¼ŒæŠ½ä¸ªç©ºæ¡£æ—¶é—´æ­äº†ä¸ªRESTfulé£æ ¼çš„APIæ–‡æ¡£Demoï¼Œæ„Ÿè§‰è¿˜ä¸é”™ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼ŒæŠ€æœ¯æ ˆä½¿ç”¨Spring Boot+Swagger2ã€‚</p><p>Swaggerå¯ä»¥å¾ˆè½»æ¾çš„æ•´åˆåˆ°Spring Bootä¸­ï¼Œåœ¨ä»£ç é‡Œæ ¹æ®swaggerè¯­æ³•æ‰“äº›æ ‡ç­¾ï¼Œç”Ÿæˆå¯é¢„è§ˆçš„Apiæ–‡æ¡£ï¼Œå‡å°‘äº†å¾ˆå¤šæ—¶é—´å†™APIæ¥å£æ–‡æ¡£ä¸Šï¼Œè®©ç»´æŠ¤æ–‡æ¡£å’Œä¿®æ”¹ä»£ç æ•´åˆä¸€ä½“äº†ï¼Œå¹¶ä¸”å¯ä»¥ä¸Spring MVCç¨‹åºé…åˆç»„ç»‡å‡ºå¼ºå¤§RESTful APIæ–‡æ¡£ï¼Œä¹Ÿèƒ½æä¾›äº†å¼ºå¤§çš„é¡µé¢æµ‹è¯•åŠŸèƒ½æ¥è°ƒè¯•æµ‹è¯•æ¯ä¸ªæ¥å£ã€‚</p><a id="more"></a><p><img src="/archives/2019/02/02/ä½¿ç”¨Swagger2æ„å»ºRESTful API.jpg" alt=""></p><p>ä¸‹é¢åˆ†æ­¥éª¤èµ°ä¸€éï¼Œç®€å•è®°å½•ä¸€ä¸‹ã€‚</p><h4 id="åˆ›å»ºSpring-Booté¡¹ç›®ï¼Œæ·»åŠ Swagger2ä¾èµ–"><a href="#åˆ›å»ºSpring-Booté¡¹ç›®ï¼Œæ·»åŠ Swagger2ä¾èµ–" class="headerlink" title="åˆ›å»ºSpring Booté¡¹ç›®ï¼Œæ·»åŠ Swagger2ä¾èµ–"></a>åˆ›å»ºSpring Booté¡¹ç›®ï¼Œæ·»åŠ Swagger2ä¾èµ–</h4><p>åœ¨IDEAä¸­åˆ›å»ºSpring Booté¡¹ç›®ï¼Œè®°å¾—ä¾èµ–å‹¾é€‰<code>web</code>ï¼Œé¡¹ç›®æ˜¯ç”±<code>maven</code>ç®¡ç†ï¼Œåœ¨<code>pom.xml</code>æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼šspringfox-swagger2å’Œspring-swagger-uiï¼Œç‰ˆæœ¬è¿™é‡Œé€‰æ‹©çš„2.5.0ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">&lt;!-- springfox swagger --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- swagger-ui --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure><h4 id="åˆ›å»ºSwagger2é…ç½®ç±»"><a href="#åˆ›å»ºSwagger2é…ç½®ç±»" class="headerlink" title="åˆ›å»ºSwagger2é…ç½®ç±»"></a>åˆ›å»ºSwagger2é…ç½®ç±»</h4><p>åœ¨Application.javaåŒçº§åˆ›å»ºSwagger2çš„é…ç½®ç±»Swagger2Configã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * é€šè¿‡`<span class="doctag">@Configuration</span>`æ³¨è§£ï¼Œè®©Springæ¥åŠ è½½è¯¥ç±»é…ç½®</span></div><div class="line"><span class="comment"> * é€šè¿‡`<span class="doctag">@EnableSwagger</span>2`æ³¨è§£æ¥å¯ç”¨Swagger</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableSwagger</span>2</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * createRestApiå‡½æ•°åˆ›å»ºDocketçš„Bean</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@Bean</span>(<span class="string">"welcome"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</div><div class="line">                .apiInfo(apiInfo())</div><div class="line">                <span class="comment">// æŒ‡å®šæ¨¡å—åŒºåˆ†</span></div><div class="line">                .groupName(<span class="string">"æ¬¢è¿æ¨¡å—"</span>)</div><div class="line">                <span class="comment">// select()å‡½æ•°è¿”å›ä¸€ä¸ªApiSelectorBuilderå®ä¾‹ç”¨æ¥æ§åˆ¶å“ªäº›æ¥å£æš´éœ²ç»™Swagger-uiæ¥å±•ç°</span></div><div class="line">                .select()</div><div class="line">                <span class="comment">// é‡‡ç”¨æŒ‡å®šæ‰«æçš„åŒ…è·¯å¾„æ¥å®šä¹‰ï¼ŒSwagger2ä¼šæ‰«æè¯¥åŒ…ä¸‹æ‰€æœ‰Controllerå®šä¹‰çš„APIï¼Œå¹¶äº§ç”Ÿæ–‡æ¡£å†…å®¹</span></div><div class="line">                <span class="comment">// é™¤äº†è¢«@ApiIgnoreæŒ‡å®šçš„è¯·æ±‚å¤–</span></div><div class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.space.controller"</span>))</div><div class="line">                .paths(PathSelectors.any())</div><div class="line">                .build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * apiInfoåˆ›å»ºè¯¥Apiçš„åŸºæœ¬ä¿¡æ¯ï¼ˆè¿™äº›åŸºæœ¬ä¿¡æ¯ä¼šå±•ç°åœ¨æ–‡æ¡£é¡µé¢ä¸­ï¼‰</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</div><div class="line">                .title(<span class="string">"Spring Bootä¸­ä½¿ç”¨Swagger2æ„å»ºRESTful APIs"</span>)</div><div class="line">                .description(<span class="string">"è¿™æ˜¯ä¸€ä¸ªDemoé¡¹ç›®"</span>)</div><div class="line">                .termsOfServiceUrl(<span class="string">"http://localhost:9999/swagger-ui.html"</span>)</div><div class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">"pross"</span>,<span class="string">"https://pross.space"</span>,<span class="string">""</span>))</div><div class="line">                .version(<span class="string">"1.0"</span>)</div><div class="line">                .build();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="åœ¨ä»£ç ä¸­æ·»åŠ æ–‡æ¡£å†…å®¹"><a href="#åœ¨ä»£ç ä¸­æ·»åŠ æ–‡æ¡£å†…å®¹" class="headerlink" title="åœ¨ä»£ç ä¸­æ·»åŠ æ–‡æ¡£å†…å®¹"></a>åœ¨ä»£ç ä¸­æ·»åŠ æ–‡æ¡£å†…å®¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RestController</span></div><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/welcome"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// é€šè¿‡@ApiOperationæ³¨è§£æ¥ç»™APIå¢åŠ è¯´æ˜</span></div><div class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"ç¬¬ä¸€ä¸ªæ¥å£"</span>,notes = <span class="string">"æ¬¢è¿è¯­"</span>)</div><div class="line">    <span class="comment">// é€šè¿‡@ApiImplicitParamsã€@ApiImplicitParamæ³¨è§£æ¥ç»™å‚æ•°å¢åŠ è¯´æ˜ã€‚</span></div><div class="line">    <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"name"</span>,value = <span class="string">"å§“å"</span>,required = <span class="keyword">true</span>,dataType = <span class="string">"String"</span>, paramType = <span class="string">"query"</span>)</div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/hello"</span>,method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(@RequestParam(name=<span class="string">"name"</span>,defaultValue = <span class="string">"pross"</span>)</span> String name)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"hello "</span>+name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// é€šè¿‡@ApiOperationæ³¨è§£æ¥ç»™APIå¢åŠ è¯´æ˜</span></div><div class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"ç¬¬äºŒä¸ªæ¥å£"</span>,notes = <span class="string">"æ¬¢è¿è¯­2"</span>)</div><div class="line">    <span class="comment">// é€šè¿‡@ApiImplicitParamsæ³¨è§£æ¥ç»™å‚æ•°å¢åŠ è¯´æ˜</span></div><div class="line">    <span class="meta">@ApiImplicitParams</span>(&#123;</div><div class="line">            <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"name1"</span>,value = <span class="string">"å§“å1"</span>,required = <span class="keyword">true</span>,dataType = <span class="string">"String"</span>,paramType = <span class="string">"query"</span>),</div><div class="line">            <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"name2"</span>,value = <span class="string">"å§“å2"</span>,required = <span class="keyword">true</span>,dataType = <span class="string">"String"</span>,paramType = <span class="string">"query"</span>)</div><div class="line">    &#125;)</div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/hello2"</span>,method = RequestMethod.POST)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello2</span><span class="params">(@RequestParam(name=<span class="string">"name1"</span>,defaultValue = <span class="string">"pross1"</span>)</span> String name1,</span></div><div class="line"><span class="function">                         @<span class="title">RequestParam</span><span class="params">(name=<span class="string">"name2"</span>,defaultValue = <span class="string">"pross2"</span>)</span> String name2)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"hello "</span>+name1+<span class="string">" and "</span>+name2;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>è¿™é‡Œè¸©äº†ä¸€ä¸ªå‘ï¼Œå…³äºparamTypeå‚æ•°çš„è®¾ç½®ï¼Œè¿™ä¸ªå±æ€§æ˜¯æŒ‡å®šå‚æ•°æ”¾çš„ä½ç½®çš„ã€‚æ¥å£ä½¿ç”¨<code>@RequestParam</code>è·å–å‚æ•°çš„è¯éœ€è¦æŒ‡å®š<code>paramType = &quot;query&quot;</code>ã€‚æ¥å£ä½¿ç”¨<code>@PathVariable</code>è·å–ï¼Œéœ€æŒ‡å®š<code>paramType=path</code>ã€‚å¦‚æœ<code>POST</code>è¯·æ±‚ï¼Œåˆ™åŒ…è£…çš„å®ä½“ç±»éœ€è¦<code>@ApiModel</code>æ³¨è§£ï¼Œå­—æ®µéœ€è¦<code>@ApiModelProperty</code>æ³¨è§£ã€‚</p><p>å®Œæˆä¸Šè¿°æ­¥éª¤ä¸Šï¼Œå¯åŠ¨Spring Bootç¨‹åºï¼Œè®¿é—®<code>http://localhost:8080/swagger-ui.html</code>ï¼ˆè‡ªåŠ¨æ›¿æ¢ç«¯å£ï¼‰ï¼Œå°±èƒ½çœ‹åˆ°æ–‡ç« å¼€å¤´å±•ç¤ºçš„RESTful APIçš„é¡µé¢ã€‚æˆ‘ä»¬å¯ä»¥å†ç‚¹å¼€å…·ä½“çš„APIè¯·æ±‚ï¼Œçœ‹åˆ°æˆ‘ä»¬å®šä¹‰çš„å„ç§APIä¿¡æ¯ã€‚</p><h4 id="APIæ–‡æ¡£è®¿é—®ä¸è°ƒè¯•"><a href="#APIæ–‡æ¡£è®¿é—®ä¸è°ƒè¯•" class="headerlink" title="APIæ–‡æ¡£è®¿é—®ä¸è°ƒè¯•"></a>APIæ–‡æ¡£è®¿é—®ä¸è°ƒè¯•</h4><p>Swaggeré™¤äº†æŸ¥çœ‹æ¥å£åŠŸèƒ½å¤–ï¼Œè¿˜æä¾›äº†è°ƒè¯•æµ‹è¯•åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šå›¾å®šä¹‰çš„ç™½è‰²ç©ºç™½å‡ºå¡«å†™ä¼ å…¥çš„nameå€¼å³å¯ï¼Œç‚¹å‡»ä¸‹æ–¹<code>Try it outï¼</code>æŒ‰é’®ï¼Œå³å¯å®Œæˆäº†ä¸€æ¬¡è¯·æ±‚è°ƒç”¨ï¼</p><p>å®Œã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;åæ§½äº†ä¸€é˜µå…¬å¸æä¾›çš„è®°å½•æ¥å£æ–‡æ¡£å·¥å…·åï¼ŒæŠ½ä¸ªç©ºæ¡£æ—¶é—´æ­äº†ä¸ªRESTfulé£æ ¼çš„APIæ–‡æ¡£Demoï¼Œæ„Ÿè§‰è¿˜ä¸é”™ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼ŒæŠ€æœ¯æ ˆä½¿ç”¨Spring Boot+Swagger2ã€‚&lt;/p&gt;&lt;p&gt;Swaggerå¯ä»¥å¾ˆè½»æ¾çš„æ•´åˆåˆ°Spring Bootä¸­ï¼Œåœ¨ä»£ç é‡Œæ ¹æ®swaggerè¯­æ³•æ‰“äº›æ ‡ç­¾ï¼Œç”Ÿæˆå¯é¢„è§ˆçš„Apiæ–‡æ¡£ï¼Œå‡å°‘äº†å¾ˆå¤šæ—¶é—´å†™APIæ¥å£æ–‡æ¡£ä¸Šï¼Œè®©ç»´æŠ¤æ–‡æ¡£å’Œä¿®æ”¹ä»£ç æ•´åˆä¸€ä½“äº†ï¼Œå¹¶ä¸”å¯ä»¥ä¸Spring MVCç¨‹åºé…åˆç»„ç»‡å‡ºå¼ºå¤§RESTful APIæ–‡æ¡£ï¼Œä¹Ÿèƒ½æä¾›äº†å¼ºå¤§çš„é¡µé¢æµ‹è¯•åŠŸèƒ½æ¥è°ƒè¯•æµ‹è¯•æ¯ä¸ªæ¥å£ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Swagger" scheme="https://pross.space/tags/Swagger/"/>
    
  </entry>
  
  <entry>
    <title>æ•£åˆ—è¡¨</title>
    <link href="https://pross.space/archives/2019/01/13/"/>
    <id>https://pross.space/archives/2019/01/13/</id>
    <published>2019-01-13T14:55:23.000Z</published>
    <updated>2019-07-10T16:22:09.333Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>å…³äºç®—æ³•ç³»åˆ—ï¼Œåœ¨å‰é¢å·²ç»æ•´ç†è¿‡å¤§Oè¡¨ç¤ºæ³•å’Œæ’åºç®—æ³•ç›¸å…³çš„æ–‡ç« ï¼Œä»Šå¤©æ¥ç€ä¸Šæ¬¡çš„è¯è¯´ä¸€è¯´æ•£åˆ—è¡¨ï¼ˆHash Tableï¼Œä¹Ÿå«å“ˆå¸Œè¡¨ï¼‰ï¼Œé¡ºä¾¿ç©¿æ’å’Œå¦å¤–ä¸¤ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œæ•°ç»„å’Œé“¾è¡¨æ¯”è¾ƒï¼›å¹¶åœ¨æœ€åä»‹ç»è‰¯å¥½çš„æ•£åˆ—å‡½æ•°â€”â€”SHAå‡½æ•°çš„ä½¿ç”¨ã€‚è¿™ä¸‰ç§åŸºæœ¬æ•°æ®ç»“æ„ï¼Œå¯ç®€å¯ç¹ï¼Œåœ¨å†™ä»£ç æ—¶å€™éƒ½æ˜¯æ¯”è¾ƒé¢‘ç¹ä½¿ç”¨çš„ï¼Œé‚£æˆ‘ä»¬å…ˆä»æ•£åˆ—è¡¨å¼€å§‹å…¥æ‰‹ã€‚</p><a id="more"></a><p>æ•£åˆ—è¡¨æ˜¯æ ¹æ®é”®ï¼ˆKeyï¼‰è€Œç›´æ¥è®¿é—®åœ¨å†…å­˜å­˜å‚¨ä½ç½®çš„æ•°æ®ç»“æ„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒé€šè¿‡è®¡ç®—ä¸€ä¸ªå…³äºé”®å€¼çš„å‡½æ•°ï¼Œå°†æ‰€éœ€æŸ¥è¯¢çš„æ•°æ®æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œè¿™åŠ å¿«äº†æŸ¥æ‰¾é€Ÿåº¦ã€‚è¿™ä¸ªæ˜ å°„å‡½æ•°ç§°åš<code>æ•£åˆ—å‡½æ•°</code>ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„ç§°åš<code>æ•£åˆ—è¡¨</code>ã€‚æ•£åˆ—è¡¨æ˜¯æœ€æœ‰ç”¨çš„åŸºæœ¬æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œæˆ‘ä»¬éœ€è¦æ€»ç»“æ•£åˆ—è¡¨ï¼šå®ç°ã€å†²çªå’Œæ•£åˆ—å‡½æ•°ã€‚</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>ä¸¾ä¸ªä¾‹å­ï¼šä¸ºäº†æŸ¥æ‰¾ç”µè¯è–„ä¸­æŸäººçš„å·ç ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‰ç…§äººåé¦–å­—æ¯é¡ºåºæ’åˆ—çš„è¡¨ï¼Œå³å»ºç«‹äººå<code>x</code>åˆ°é¦–å­—æ¯<code>F(x)</code>çš„ä¸€ä¸ªå‡½æ•°å…³ç³»ã€‚åœ¨é¦–å­—æ¯ä¸ºpçš„è¡¨ä¸­æŸ¥æ‰¾å§“â€å½­â€çš„ç”µè¯å·ç ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è°ƒç”¨è¿™æ ·çš„å‡½æ•°å…³ç³»ï¼ŒæŸ¥æ‰¾çš„å°±å¿«å¾ˆå¤šã€‚è¿™é‡Œä½¿ç”¨äººåä½œä¸ºäº†å…³é”®å­—ï¼Œä¹Ÿå°±æ˜¯é”®ï¼ˆKeyï¼‰ï¼›â€å–é¦–å­—æ¯â€æ˜¯è¿™ä¸ªä¾‹å­ä¸­æ•£åˆ—å‡½æ•°çš„å‡½æ•°æ³•åˆ™<code>F()</code>ï¼Œå­˜æ”¾é¦–å­—æ¯çš„è¡¨å¯¹åº”<code>æ•£åˆ—è¡¨</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ä½¿ç”¨dictåˆ›å»ºæ•£åˆ—è¡¨phone_list</span></div><div class="line">In [<span class="number">1</span>]: phone_list = dict()</div><div class="line">In [<span class="number">2</span>]: phone_list[<span class="string">"pross"</span>] = <span class="number">15013637180</span></div><div class="line"><span class="comment"># æ˜ å°„å…³ç³»è¾“å‡º</span></div><div class="line">In [<span class="number">3</span>]: print(phone_list[<span class="string">"pross"</span>])</div><div class="line"><span class="number">15013637180</span></div></pre></td></tr></table></figure><p>åœ¨ä»£ç ä¸­ï¼Œæ•£åˆ—è¡¨æ˜¯ç”±é”®å’Œå€¼ç»„æˆï¼Œåœ¨æ•£åˆ—è¡¨<code>phone_list</code>ä¸­ï¼Œé”®ä¸ºå§“åï¼Œå€¼ä¸ºç”µè¯å·ç ã€‚æ•£åˆ—è¡¨å°†é”®æ˜ å°„åˆ°å€¼ã€‚ä¸ºäº†å¯¹æ¯”æ€§èƒ½ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸‹æ•°ç»„ã€‚</p><h5 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h5><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ<code>æ•°æ®æ•°æ®ç»“æ„(array date structure)</code>ï¼Œç®€ç§°ä¸ºæ•°ç»„ï¼›æ˜¯ç”±ç›¸åŒç±»å‹çš„å…ƒç´ çš„é›†åˆæ‰€ç»„æˆçš„æ•°æ®ç»“æ„ï¼Œåˆ†é…ä¸€å—<code>è¿ç»­çš„å†…å­˜</code>æ¥å­˜å‚¨ï¼Œå¯ä»¥åˆ©ç”¨å…ƒç´ çš„ç´¢å¼•å¯ä»¥è®¡ç®—å‡ºè¯¥å…ƒç´ å¯¹åº”çš„å­˜å‚¨åœ°å€ã€‚</p><p>è¿˜æ˜¯ä¸¾ä¸ªä¾‹å­ï¼šç°åœ¨æœ‰ä¸ªéœ€æ±‚ï¼Œè¦ç¼–å†™ä¸€ä¸ªç®¡ç†å¾…åŠäº‹é¡¹çš„åº”ç”¨ç¨‹åºï¼Œéœ€è¦å°†è¿™äº›å¾…åŠäº‹é¡¹å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœæˆ‘ä»¬é€‰ç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Œé‚£ä¹ˆæ„å‘³ç€æ‰€æœ‰çš„å¾…åŠäº‹é¡¹åœ¨å†…å­˜ä¸­éƒ½æ˜¯ç›¸è¿çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># å®šä¹‰æ•°ç»„</span></div><div class="line">In [<span class="number">7</span>]: do_list_tup = ()</div><div class="line">In [<span class="number">8</span>]: do_list_tup = (<span class="string">'1.doing homework'</span>,<span class="string">'2.have dinner'</span>)</div><div class="line"><span class="comment"># è¾“å‡ºç´¢å¼•ä¸º1çš„å¾…åŠäº‹é¡¹</span></div><div class="line">In [<span class="number">9</span>]: print(do_list_tup[<span class="number">1</span>])</div><div class="line"><span class="number">2.</span>have dinner</div><div class="line"><span class="comment"># è¾“å‡ºæ‰€æœ‰å¾…åŠäº‹é¡¹</span></div><div class="line">In [<span class="number">10</span>]: print(do_list_tup)</div><div class="line">(<span class="string">'1.doing homework'</span>, <span class="string">'2.have dinner'</span>)</div></pre></td></tr></table></figure><p>å¦‚æœç°åœ¨æˆ‘è¦å…ˆç©æ»‘æ¿ï¼Œåœ¨å†™ä½œä¸šå‘¢ï¼Ÿé‚£ä¹ˆå°±éœ€è¦æŠŠåé¢çš„æ¯ä¸€ä¸ªå¾…åŠäº‹é¡¹éƒ½å¾—æŒªä¸€ä¸ªä½ç½®æ‰è¡Œï¼Œå¦‚æœå¾…åŠäº‹é¡¹æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œè¿™ç§æ“ä½œå°±æœ‰ç‚¹éº»çƒ¦äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¾—ç»§ç»­çœ‹çœ‹<code>é“¾è¡¨(Linked list)</code>ã€‚</p><h5 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h5><p>é“¾è¡¨ä¸­çš„å…ƒç´ å¯ä»¥å­˜å‚¨åœ¨ä»»ä½•åœ°æ–¹ï¼Œé“¾è¡¨çš„æ¯ä¸ªå…ƒç´ éƒ½å­˜å‚¨äº†ä¸‹ä¸€ä¸ªå…ƒç´ çš„åœ°å€ï¼Œä»è€Œä½¿ä¸€ç³»åˆ—çš„éšæœºå†…å­˜åœ°å€ä¸²åœ¨äº†ä¸€èµ·ã€‚è¿™å°±å¾ˆæ–¹ä¾¿çš„ä¸Šé¢å‡ºç°çš„é—®é¢˜äº†ï¼šç›´æ¥åœ¨å‰é¢æ’å…¥ç©æ»‘æ¿ï¼Œé“¾è¡¨ä¼šå­˜å‚¨ä¸€ä¸ªæ ‡è®°è¡¨ç¤ºä¸‹ä¸€ä¸ªå¾…åŠäº‹é¡¹æ˜¯å†™ä½œä¸šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># å®šä¹‰åˆ—è¡¨</span></div><div class="line">In [<span class="number">11</span>]: do_list = []</div><div class="line">In [<span class="number">12</span>]: do_list = [<span class="string">'1.doing homework'</span>,<span class="string">'2.have dinner'</span>]</div><div class="line"><span class="comment"># å–å‡ºç´¢å¼•ä¸º1çš„å…ƒç´ </span></div><div class="line">In [<span class="number">13</span>]: print(do_list[<span class="number">1</span>])</div><div class="line"><span class="number">2.</span>have dinner</div><div class="line"><span class="comment"># æ’å…¥æ’å…¥å¾…åŠäº‹é¡¹</span></div><div class="line">In [<span class="number">15</span>]: do_list.insert(<span class="number">0</span>,<span class="string">'3.Skateboarding'</span>)</div><div class="line"><span class="comment"># è¾“å‡º</span></div><div class="line">In [<span class="number">16</span>]: print(do_list)</div><div class="line">[<span class="string">'3.Skateboarding'</span>, <span class="string">'1.doing homework'</span>, <span class="string">'2.have dinner'</span>]</div></pre></td></tr></table></figure><p>é“¾è¡¨çš„ä¼˜åŠ¿åœ¨æ’å…¥å…ƒç´ æ–¹é¢ï¼Œæ•°ç»„çš„ä¼˜åŠ¿åœ¨äºæŸ¥æ‰¾ï¼Œæ•£åˆ—è¡¨çš„ä¼˜åŠ¿åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><h5 id="æ€§èƒ½æ¯”è¾ƒ"><a href="#æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="æ€§èƒ½æ¯”è¾ƒ"></a>æ€§èƒ½æ¯”è¾ƒ</h5><p>åœ¨è¿™é‡Œå¯¹è¿™ä¸‰ç§åŸºæœ¬æ•°æ®ç»“æ„åšä¸€ä¸ªå¯¹æ¯”æ€»ç»“ï¼Œè¿˜è®°å¾—å‰é¢è¯´è¿‡çš„å¤§Oè¡¨ç¤ºæ³•ä¹ˆï¼Ÿ</p><p>åœ¨å¹³å‡æƒ…å†µä¸‹ï¼Œæ•£åˆ—è¡¨æ‰§è¡Œå„ç§æ“ä½œçš„æ—¶é—´éƒ½ä¸ºO(1)ï¼ŒO(1)è¢«ç§°ä¸º<code>å¸¸é‡æ—¶é—´</code>ã€‚ç®€å•çš„æŸ¥æ‰¾çš„è¿è¡Œæ—¶é—´ä¸ºçº¿æ€§æ—¶é—´ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„é€Ÿåº¦æ›´å¿«ï¼Œæ‰€éœ€è¦çš„æ—¶é—´ä¸ºå¯¹æ•°æ—¶é—´ï¼Œåœ¨æ•£åˆ—è¡¨ä¸­æŸ¥æ‰¾æ‰€èŠ±è´¹çš„æ—¶é—´æ˜¯å¸¸é‡æ—¶é—´ã€‚è¿™æ„å‘³ç€æ— è®ºæ•£åˆ—è¡¨åŒ…å«ä¸€ä¸ªå…ƒç´ è¿˜æ˜¯ä¸€äº¿ä¸ªå…ƒç´ ï¼Œä»å…¶ä¸­è·å–æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´éƒ½æ˜¯ç›¸åŒï¼›å…¶å®ä»æ•°ç»„ä¸­è·å–ä¸€ä¸ªå…ƒç´ æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿæ˜¯å›ºå®šçš„ã€‚</p><p>æˆ‘ä»¬æ¥å°†æ•£åˆ—è¡¨åŒæ•°ç»„ï¼Œé“¾è¡¨æ¥æ¯”è¾ƒä¸€ä¸‹ï¼š</p><p><img src="/archives/2019/01/13/pic.jpg" alt=""></p><p>åœ¨å¹³å‡æƒ…å†µä¸‹ï¼Œæ•£åˆ—è¡¨çš„æŸ¥æ‰¾é€Ÿåº¦å’Œæ•°ç»„ä¸€æ ·å¿«ï¼Œè€Œæ’å…¥å’Œåˆ é™¤é€Ÿåº¦ä¸é“¾è¡¨ä¸€æ ·å¿«ï¼Œåœ¨æœ€ç³Ÿçš„æƒ…å†µä¸‹ï¼Œæ•£åˆ—è¡¨çš„å„ç§æ“ä½œçš„é€Ÿåº¦éƒ½å¾ˆæ…¢ã€‚å› æ­¤åœ¨ä½¿ç”¨æ•£åˆ—è¡¨æ—¶ï¼Œéœ€è¦é¿å¼€æœ€ç³Ÿç³•çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯éœ€è¦é¿å¼€å†²çªã€‚</p><h4 id="å†²çª"><a href="#å†²çª" class="headerlink" title="å†²çª"></a>å†²çª</h4><p>æ•£åˆ—è¡¨ä¸­å­˜åœ¨å†²çªï¼Œä»€ä¹ˆå†²çªï¼Ÿå°±æ˜¯æ•£åˆ—å‡½æ•°ä¸å¯èƒ½æ€»æ˜¯å°†ä¸åŒçš„é”®å‡åŒ€çš„æ˜ å°„åˆ°æ•°ç»„çš„ä¸åŒçš„ä½ç½®ã€‚æ‹¿åœ¨å¼€å¤´ä¸¾çš„ä¸€ä¸ªä¾‹å­ï¼Œä¸ºäº†æŸ¥æ‰¾ç”µè¯è–„ä¸­æŸäººçš„å·ç ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŒ‰ç…§äººåé¦–å­—æ¯é¡ºåºæ’åˆ—çš„è¡¨ï¼Œä»¥på¼€å¤´å§“åå­˜å‚¨åˆ°å¯¹åº”çš„æ•£åˆ—è¡¨ä½ç½®ä¸­ï¼Œä½†æ˜¯ä»¥på¼€å¤´çš„å§“åä¹Ÿä¸æ˜¯åªæœ‰ä¸€ä¸ªï¼Œå°±éœ€è¦ç»™å¤šä¸ªé”®åˆ†é…åˆ°äº†åŒä¸€ä¸ªä½ç½®ï¼Œè¿™æ ·å°±ä¼šé€ æˆå†²çªã€‚</p><p>æœ€ç®€å•çš„æ˜¯ï¼šå¦‚æœä¸¤ä¸ªé”®æ˜ å°„åˆ°åŒä¸€ä¸ªä½ç½®ï¼Œå°±åœ¨è¿™ä¸ªä½ç½®å­˜å‚¨ä¸€ä¸ªé“¾è¡¨ã€‚è¿™æ ·<code>pross</code>å’Œ<code>paul</code>éƒ½ä¼šæ˜ å°„åˆ°åŒä¸€ä¸ªä½ç½®ï¼Œåœ¨è®¿é—®ä»¥på¼€å¤´çš„å§“åæ—¶ï¼Œé€Ÿåº¦ä¾ç„¶å¾ˆå¿«ã€‚ä½†éœ€è¦æŸ¥è¯¢prossçš„ç”µè¯å·ç æ—¶ï¼Œé€Ÿåº¦å°±æ…¢ä¸€äº›ï¼›å¦‚æœæ•£åˆ—è¡¨å­˜å‚¨çš„é“¾è¡¨å¾ˆé•¿ï¼Œæ•£åˆ—è¡¨çš„é€Ÿåº¦ä¹Ÿå°†æ€¥å‰§çš„ä¸‹é™ã€‚</p><p>å¤„ç†å†²çªæ¯”è¾ƒå¥½çš„åŠæ³•æœ‰ï¼šè¾ƒä½çš„å¡«å……å› å­å’Œè‰¯å¥½çš„æ•£åˆ—å‡½æ•°ã€‚</p><p><strong>å¡«å……å› å­</strong></p><p>æ•£åˆ—è¡¨çš„å¡«å……å› å­å¾ˆå®¹æ˜“è®¡ç®—ï¼š</p><pre><code>$$å¡«è£…å› å­ = \frac{æ•£åˆ—è¡¨åŒ…å«çš„å…ƒç´ æ•°}{ä½ç½®æ€»æ•°}$$    </code></pre><p>æ•£åˆ—è¡¨ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨æ•°æ®ï¼Œå› æ­¤éœ€è¦è®¡ç®—æ•°ç»„ä¸­è¢«å ç”¨çš„ä½ç½®æ•°ï¼Œå¡«è£…å› å­å¤§äº1ï¼Œæ„å‘³ç€å…ƒç´ è¶…è¿‡äº†ä½ç½®æ€»æ•°ã€‚ä¸€æ—¦å¡«å……å› å­å¼€å§‹å¢å¤§ï¼Œå°±éœ€è¦åœ¨æ•£åˆ—è¡¨ä¸­æ·»åŠ ä½ç½®ï¼Œä¹Ÿå°±æ˜¯<code>è°ƒæ•´é•¿åº¦(resizing)</code>ï¼Œé•¿åº¦å¢åŠ ï¼Œå¡«è£…å› å­å°±å˜ä½ï¼Œå‘ç”Ÿçš„å†²çªçš„å¯èƒ½æ€§è¶Šå°ï¼Œæ•£åˆ—è¡¨çš„æ€§èƒ½ä¹Ÿå°±è¶Šé«˜ã€‚</p><blockquote><p>ä¸€ä¸ªä¸é”™çš„ç»éªŒè§„åˆ™æ˜¯ï¼šä¸€æ—¦å¡«å……å› å­å¤§äº0.7ï¼Œå°±éœ€è¦è°ƒæ•´åˆ—è¡¨çš„é•¿åº¦ã€‚</p><p>è°ƒæ•´é•¿åº¦çš„æ—¶é—´å¼€é”€å¾ˆå¤§ã€‚</p></blockquote><p><strong>è‰¯å¥½çš„æ•£åˆ—å‡½æ•°</strong></p><p>ä¸€ä¸ªç³Ÿç³•çš„æ•£åˆ—å‡½æ•°å°±ä¼šè®©å€¼æ‰å †ï¼Œå¯¼è‡´å¤§é‡çš„å†²çªï¼›é€‰æ‹©ä¸€ä¸ªè‰¯å¥½çš„æ•£åˆ—å‡½æ•°ï¼Œèƒ½å¤Ÿè®©æ•°ç»„ä¸­çš„å€¼å‘ˆå‡åŒ€åˆ†å¸ƒï¼Œè§£å†³å†²çªã€‚è¿™é‡Œä»‹ç»<code>SHAå‡½æ•°</code>ï¼Œè¿™ä¹Ÿæ˜¯æ‰©å±•çŸ¥è¯†ä¸­çš„å¿ƒåŠ¨ä¹‹å¤„ã€‚</p><p><code>å®‰å…¨æ•£åˆ—ç®—æ³•</code>ï¼ˆè‹±è¯­ï¼šSecure Hash Algorithmï¼Œç¼©å†™ä¸ºSHAï¼‰æ˜¯ä¸€ä¸ªå¯†ç æ•£åˆ—å‡½æ•°å®¶æ—ï¼ˆSHA-0ï¼ŒSHA-1ï¼ŒSHA-2ï¼ŒSHA-3ï¼‰ï¼Œèƒ½è®¡ç®—å‡ºä¸€ä¸ªæ•°å­—æ¶ˆæ¯æ‰€å¯¹åº”åˆ°çš„ï¼Œé•¿åº¦å›ºå®šçš„å­—ç¬¦ä¸²çš„ç®—æ³•ï¼ˆåˆç§°æ¶ˆæ¯æ‘˜è¦ï¼‰ã€‚ä¸”è‹¥è¾“å…¥çš„æ¶ˆæ¯ä¸åŒï¼Œå®ƒä»¬å¯¹åº”åˆ°ä¸åŒå­—ç¬¦ä¸²çš„æœºç‡æé«˜ã€‚</p><p>SHAæ˜¯ä¸€ä¸ªæ•£åˆ—å‡½æ•°ï¼Œå®ƒç”Ÿæˆä¸€ä¸ªæ•£åˆ—å€¼ï¼Œç”¨äºåˆ›å»ºæ•£åˆ—è¡¨çš„æ•£åˆ—å‡½æ•°æ ¹æ®å­—ç¬¦ä¸²ç”Ÿæˆæ•°ç»„ç´¢å¼•ï¼Œè€ŒSHAæ ¹æ®å­—ç¬¦ä¸²ç”Ÿæˆå¦å¤–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯¹äºæ¯ä¸ªå­—ç¬¦ä¸²ï¼ŒSHAç”Ÿæˆçš„æ•£åˆ—å€¼æå¤§å¯èƒ½ä¸åŒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">20</span>]: <span class="keyword">import</span> hashlib</div><div class="line"><span class="comment"># ä½¿ç”¨sha256</span></div><div class="line">In [<span class="number">21</span>]: hash = hashlib.sha256()</div><div class="line">In [<span class="number">22</span>]: hash.update(<span class="string">'pross'</span>.encode(<span class="string">'utf-8'</span>))</div><div class="line">In [<span class="number">24</span>]: hash.hexdigest()</div><div class="line">Out[<span class="number">25</span>]: <span class="string">'58f8b4db8a8d80bc485de70a57912ddcf8a2fa93e698e2ce346f9f54d859af5f'</span></div><div class="line">...</div></pre></td></tr></table></figure><p><strong>æ‰©å±•</strong>ï¼šå¯†é’¥å¯¼å‡ºå’Œæ‰©å±•ç®—æ³•æ˜¯ä¸ºå®‰å…¨å¯†ç æ•£åˆ—è®¾è®¡çš„ï¼Œç±»ä¼¼<code>hashlib.sha256()</code>è¿™ç§ç®€å•ç®—æ³•ä¸èƒ½æœ‰æ•ˆæŠµå¾¡æš´åŠ›ç ´è§£ï¼Œä¸€ä¸ªå¥½çš„å¯†ç æ•£åˆ—å‡½æ•°å¿…é¡»æ˜¯å¯è°ƒèŠ‚çš„ï¼Œè€—æ—¶çš„ï¼Œå¹¶åŒ…å«ç›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">26</span>]: <span class="keyword">import</span> hashlib</div><div class="line"><span class="comment"># å¯†é’¥å¯¼å‡ºï¼Œpbkdf2_hmac(hash_name, password, salt, iterations, dklen=None)æä¾›äº†ä½¿ç”¨PKCS#5å¡«å……çš„pbkdf2ç®—æ³•ï¼Œä½¿ç”¨HMACä½œä¸ºä¼ªéšæœºå‡½æ•°</span></div><div class="line">In [<span class="number">27</span>]: dk = hashlib.pbkdf2_hmac(<span class="string">'sha256'</span>,<span class="string">b'pross'</span>,<span class="string">b'salt'</span>,<span class="number">1000</span>)</div><div class="line">In [<span class="number">28</span>]: <span class="keyword">import</span> binascii</div><div class="line">In [<span class="number">29</span>]: binascii.hexlify(dk)</div><div class="line">Out[<span class="number">29</span>]: <span class="string">b'07c8f073bc2484c6163cd7c44d8d35f0b6ffc16e3b907df16bf8d292ccd176f9'</span></div></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²hash_nameæ˜¯HMACçš„å“ˆå¸Œæ‘˜è¦ç®—æ³•çš„æ‰€éœ€åç§°ï¼Œä¾‹å¦‚ï¼šsha1æˆ–sha256ï¼›passwordå’Œsaltä¸ºå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ‰€ä»¥åº”è¯¥å°†passwordé™åˆ¶åœ¨åˆç†çš„é•¿åº¦ï¼ˆ1024ï¼‰ï¼›iterationsçš„æ•°é‡åŸºäºæ•£åˆ—ç®—æ³•å’Œè®¡ç®—èƒ½åŠ›æ¥é€‰æ‹©ã€‚æˆªè‡³2013å¹´ï¼Œå»ºè®®è‡³å°‘100,000æ¬¡è¿­ä»£çš„SHA-256ï¼›dklenæ˜¯å¯¼å‡ºå¯†é’¥çš„é•¿åº¦ï¼Œå¦‚æœdklen=Noneï¼Œåˆ™ä½¿ç”¨æ•£åˆ—ç®—æ³•hash_nameçš„æ‘˜è¦å¤§å°ï¼Œä¾‹å¦‚ï¼Œ64ä¸ºSHA-512çš„æ‘˜è¦å¤§å°ã€‚</p><p>å¿«ä¹çš„æ—¶å…‰æ€»æ˜¯çŸ­æš‚çš„ï¼Œæ•£åˆ—è¡¨åŠå…¶å„ç§å¤©é©¬è¡Œç©ºçš„æ‰©å±•çŸ¥è¯†å°±ä»‹ç»åˆ°è¿™ã€‚</p><p>å®Œã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;å…³äºç®—æ³•ç³»åˆ—ï¼Œåœ¨å‰é¢å·²ç»æ•´ç†è¿‡å¤§Oè¡¨ç¤ºæ³•å’Œæ’åºç®—æ³•ç›¸å…³çš„æ–‡ç« ï¼Œä»Šå¤©æ¥ç€ä¸Šæ¬¡çš„è¯è¯´ä¸€è¯´æ•£åˆ—è¡¨ï¼ˆHash Tableï¼Œä¹Ÿå«å“ˆå¸Œè¡¨ï¼‰ï¼Œé¡ºä¾¿ç©¿æ’å’Œå¦å¤–ä¸¤ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œæ•°ç»„å’Œé“¾è¡¨æ¯”è¾ƒï¼›å¹¶åœ¨æœ€åä»‹ç»è‰¯å¥½çš„æ•£åˆ—å‡½æ•°â€”â€”SHAå‡½æ•°çš„ä½¿ç”¨ã€‚è¿™ä¸‰ç§åŸºæœ¬æ•°æ®ç»“æ„ï¼Œå¯ç®€å¯ç¹ï¼Œåœ¨å†™ä»£ç æ—¶å€™éƒ½æ˜¯æ¯”è¾ƒé¢‘ç¹ä½¿ç”¨çš„ï¼Œé‚£æˆ‘ä»¬å…ˆä»æ•£åˆ—è¡¨å¼€å§‹å…¥æ‰‹ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æ•°æ®ç»“æ„" scheme="https://pross.space/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>å‡ ç§å®šæ—¶è°ƒåº¦çš„ä»‹ç»ä¸å®ç°</title>
    <link href="https://pross.space/archives/2019/01/01/"/>
    <id>https://pross.space/archives/2019/01/01/</id>
    <published>2019-01-01T04:01:53.000Z</published>
    <updated>2019-07-10T16:28:59.561Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>ç”±éœ€æ±‚äº§å‡ºçš„ä¸€ç¯‡æ–‡ç« ï¼Œæ†‹äº†å¾ˆä¹…ã€‚ä»¥ä¸‹å°†ä¼šçœ‹åˆ°ï¼Œä½¿ç”¨Timerè¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œç”¨ScheduledExecutorå’ŒCalendarå®ç°ä»»åŠ¡è°ƒåº¦ï¼ŒSpringä¸­çš„ä»»åŠ¡è°ƒåº¦TaskSchedulerï¼Œå¼€æºå·¥å…·åŒ…Quartzçš„ç®€å•ä»‹ç»ã€‚</p><a id="more"></a><h4 id="ä½¿ç”¨Timerä»»åŠ¡è°ƒåº¦"><a href="#ä½¿ç”¨Timerä»»åŠ¡è°ƒåº¦" class="headerlink" title="ä½¿ç”¨Timerä»»åŠ¡è°ƒåº¦"></a>ä½¿ç”¨Timerä»»åŠ¡è°ƒåº¦</h4><p>Timeræ˜¯<code>java.util.Timer</code>æä¾›çš„æ¯”è¾ƒç®€å•çš„è°ƒåº¦å·¥å…·ï¼Œå®ç°ä»»åŠ¡è°ƒåº¦çš„æ ¸å¿ƒæ˜¯Timerå’ŒTimerTaskã€‚å…¶ä¸­Timerè´Ÿè´£åœ¨<code>schedule</code>æ–¹æ³•ä¸­è®¾å®šTimerTaskä»»åŠ¡ï¼Œä»¥åŠä»»åŠ¡æ‰§è¡Œçš„èµ·å§‹æ—¶é—´<code>delay</code>å’Œé—´éš”æ‰§è¡Œçš„æ—¶é—´<code>period</code>ï¼›TimerTaskè´Ÿè´£åˆ›å»ºéœ€è¦è°ƒåº¦çš„ä»»åŠ¡ï¼Œå¼€å‘è€…éœ€è¦å®ç°<code>run</code>æ–¹æ³•ï¼Œç„¶åå°†å…¶ä¸¢ç»™Timerå»æ‰§è¡Œå³å¯ã€‚</p><p>ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œç”¨ä¸åŒçš„æ–¹æ³•å®ç°äº†ä¸¤ä¸ªä»»åŠ¡è°ƒåº¦ï¼Œå…¶ä¸­ä¸€ä¸ªä»»åŠ¡è¾¾åˆ°æ¡ä»¶åä½¿ç”¨<code>cancel</code>æ–¹æ³•ç»ˆæ­¢äº†è°ƒåº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> java.util.Timer;</div><div class="line"><span class="keyword">import</span> java.util.TimerTask;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@describe</span>: timerè°ƒåº¦</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span>:å½­çˆ½pross</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/12/28</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimerDemo</span> <span class="keyword">extends</span> <span class="title">TimerTask</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> String taskName=<span class="string">""</span>;</div><div class="line"><span class="comment">//æ„é€ æ–¹æ³•</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">TimerDemo</span><span class="params">(String taskName)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>();</div><div class="line"><span class="keyword">this</span>.taskName=taskName;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">System.out.println(<span class="string">"TimerTask "</span>+taskName+<span class="string">","</span>+<span class="keyword">new</span> Date());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">Timer timer = <span class="keyword">new</span> Timer();</div><div class="line"><span class="keyword">long</span> delay1 = <span class="number">1</span> * <span class="number">1000</span>;</div><div class="line"><span class="keyword">long</span> period1 = <span class="number">1000</span>;</div><div class="line">timer.schedule(<span class="keyword">new</span> TimerDemo(<span class="string">"task 1"</span>),delay1,period1);</div><div class="line"></div><div class="line"><span class="keyword">long</span> delay2 = <span class="number">2</span> * <span class="number">1000</span>;</div><div class="line"><span class="keyword">long</span> period2 = <span class="number">1000</span>;</div><div class="line">timer.schedule(<span class="keyword">new</span> TimerTask() &#123;</div><div class="line">String taskName = <span class="string">"task 2"</span>;</div><div class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">i++;</div><div class="line">System.out.println(<span class="string">"TimerTask "</span>+taskName+<span class="string">","</span>+<span class="keyword">new</span> Date());</div><div class="line"><span class="keyword">if</span>(i&gt;<span class="number">2</span>)&#123;</div><div class="line">cancel();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;,delay2,period2);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ§åˆ¶å˜é‡<code>i</code>å¤§äºç­‰äº2åï¼Œä»»åŠ¡è°ƒåº¦è¢«ç»ˆæ­¢ï¼Œåªå‰©ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">TimerTask task <span class="number">1</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">25</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">2</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">26</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">1</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">26</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">2</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">27</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">1</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">27</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">2</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">28</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">1</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">28</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">1</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">29</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">1</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">30</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">1</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">31</span> CST <span class="number">2018</span></div><div class="line">TimerTask task <span class="number">1</span>,Sat Dec <span class="number">29</span> <span class="number">15</span>:<span class="number">03</span>:<span class="number">32</span> CST <span class="number">2018</span></div></pre></td></tr></table></figure><p>å¦‚æœè°ƒæ•´è°ƒåº¦å‘¨æœŸï¼Œä¼šå‘ç°æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ¥è°ƒåº¦çš„ï¼Œå¤šä¸ªä»»åŠ¡æ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œå‰ä¸€ä¸ªä»»åŠ¡çš„å»¶è¿Ÿæˆ–å¼‚å¸¸éƒ½å°†ä¼šå½±å“åˆ°ä¹‹åçš„ä»»åŠ¡ã€‚ä¸‹å›¾æ˜¯Timerç±»çš„ç»“æ„ã€‚</p><p><img src="/archives/2019/01/01/timer.jpg" alt=""></p><p>æˆ‘ä»¬ä»æ‰§è¡Œå¼€å§‹è¿½æº¯æºç ï¼Œå…ˆè¿›å…¥<code>schedule</code>æ–¹æ³•ï¼Œå‘ç°æœ€ç»ˆæ˜¯è°ƒç”¨çš„<code>sched</code>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">schedule</span><span class="params">(TimerTask task, <span class="keyword">long</span> delay, <span class="keyword">long</span> period)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (delay &lt; <span class="number">0</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Negative delay."</span>);</div><div class="line">        <span class="keyword">if</span> (period &lt;= <span class="number">0</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Non-positive period."</span>);</div><div class="line">    <span class="comment">// scheduleæ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨sched()</span></div><div class="line">        sched(task, System.currentTimeMillis()+delay, -period);</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å‘ç°äº†<code>queue</code>å’Œ<code>thread</code>çš„è¸ªå½±ï¼Œç»™<code>queue</code>åŠ ä¸Šæ§åˆ¶çº¿ç¨‹åŒæ­¥<code>synchronized</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> TaskQueue queue = <span class="keyword">new</span> TaskQueue();</div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> TimerThread thread = <span class="keyword">new</span> TimerThread(queue);</div><div class="line">...</div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sched</span><span class="params">(TimerTask task, <span class="keyword">long</span> time, <span class="keyword">long</span> period)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (time &lt; <span class="number">0</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal execution time."</span>);</div><div class="line">        <span class="keyword">if</span> (Math.abs(period) &gt; (Long.MAX_VALUE &gt;&gt; <span class="number">1</span>))</div><div class="line">            period &gt;&gt;= <span class="number">1</span>;</div><div class="line"></div><div class="line">        <span class="keyword">synchronized</span>(queue) &#123;</div><div class="line">            <span class="keyword">if</span> (!thread.newTasksMayBeScheduled)</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Timer already cancelled."</span>);</div><div class="line">            <span class="keyword">synchronized</span>(task.lock) &#123;</div><div class="line">                <span class="keyword">if</span> (task.state != TimerTask.VIRGIN)</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</div><div class="line">                        <span class="string">"Task already scheduled or cancelled"</span>);</div><div class="line">                task.nextExecutionTime = time;</div><div class="line">                task.period = period;</div><div class="line">                task.state = TimerTask.SCHEDULED;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// æ»¡è¶³æ‰§è¡Œæ¡ä»¶ï¼ŒåŠ å…¥queue</span></div><div class="line">            queue.add(task);</div><div class="line">            <span class="keyword">if</span> (queue.getMin() == task)</div><div class="line">                queue.notify();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»§ç»­çœ‹TaskThreadçš„æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">//æ‰§è¡ŒmainLoop()å¼€å§‹è°ƒåº¦ä»»åŠ¡</span></div><div class="line">            mainLoop();</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">synchronized</span>(queue) &#123;</div><div class="line">               <span class="comment">/** </span></div><div class="line"><span class="comment">                * å½“newTasksMayBeScheduledæ˜¯falseæ—¶</span></div><div class="line"><span class="comment">                * åœ¨ä¸Šé¢schedæ–¹æ³•ä¸­ä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸</span></div><div class="line"><span class="comment">                * æ‰€ä»¥åªèƒ½åŒä¸€æ—¶é—´æ‰§è¡Œä¸€ä¸ªä»»åŠ¡</span></div><div class="line"><span class="comment">                */</span></div><div class="line">                newTasksMayBeScheduled = <span class="keyword">false</span>;</div><div class="line">                queue.clear(); </div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p><code>mainLoop</code>æ–¹æ³•å°±ä¸å±•å¼€ï¼Œè¿™é‡Œå±•ç¤ºæ ¸å¿ƒä»£ç æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">synchronized</span>(task.lock) &#123;</div><div class="line">    <span class="comment">// æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€</span></div><div class="line">    <span class="keyword">if</span> (task.state == TimerTask.CANCELLED) &#123;</div><div class="line">        queue.removeMin();</div><div class="line">        <span class="keyword">continue</span>;  <span class="comment">// No action required, poll queue again</span></div><div class="line">    &#125;</div><div class="line">    currentTime = System.currentTimeMillis();</div><div class="line">    executionTime = task.nextExecutionTime;</div><div class="line">    <span class="comment">// æ¯”è¾ƒæ—¶é—´</span></div><div class="line">    <span class="keyword">if</span> (taskFired = (executionTime&lt;=currentTime)) &#123;</div><div class="line">        <span class="comment">// è°ƒåº¦å‘¨æœŸä¸º0ï¼Œremovemin</span></div><div class="line">        <span class="keyword">if</span> (task.period == <span class="number">0</span>) &#123; <span class="comment">// Non-repeating, remove</span></div><div class="line">            queue.removeMin();</div><div class="line">            task.state = TimerTask.EXECUTED;</div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// Repeating task, reschedule</span></div><div class="line">            queue.rescheduleMin(</div><div class="line">                task.period&lt;<span class="number">0</span> ? currentTime - task.period : executionTime + task.period);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>æœ€åæ€»ç»“ä¸‹ï¼ŒTimer çš„è®¾è®¡æ ¸å¿ƒæ˜¯ä¸€ä¸ª<code>TaskQueue</code>å’Œä¸€ä¸ª<code>TaskThread</code>ã€‚Timer å°†æ¥æ”¶åˆ°çš„ä»»åŠ¡ä¸¢åˆ°è‡ªå·±çš„<code>TaskQueue</code>ä¸­ï¼ŒTaskQueueæŒ‰ç…§Taskçš„æœ€åˆæ‰§è¡Œæ—¶é—´è¿›è¡Œæ’åºã€‚TimerThreadåœ¨åˆ›å»ºTimeræ—¶ä¼šå¯åŠ¨æˆä¸ºä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ã€‚è¿™ä¸ªçº¿ç¨‹ä¼šè½®è¯¢æ‰€æœ‰ä»»åŠ¡ï¼Œæ‰¾åˆ°ä¸€ä¸ªæœ€è¿‘è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åä¼‘çœ ï¼Œå½“åˆ°è¾¾æœ€è¿‘è¦æ‰§è¡Œä»»åŠ¡çš„å¼€å§‹æ—¶é—´ç‚¹ï¼ŒTimerThreadè¢«å”¤é†’å¹¶æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚ä¹‹åTimerThreadæ›´æ–°æœ€è¿‘ä¸€ä¸ªè¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç»§ç»­ä¼‘çœ ã€‚</p><p>Timerçš„ä¼˜ç‚¹åœ¨äºç®€å•æ˜“ç”¨ï¼Œç¼ºç‚¹é™¤äº†å•çº¿ç¨‹è°ƒåº¦é—®é¢˜ï¼Œè¿˜æœ‰ä½¿ç”¨çš„åœºæ™¯æ¯”è¾ƒå•ä¸€ã€‚æ¯”å¦‚ï¼Œè®¾ç½®æ¯æ˜ŸæœŸäºŒçš„16:38:10æ‰§è¡Œä»»åŠ¡ï¼ŒTimerå°±ä¸æ˜¯å¤ªé€‚ç”¨ã€‚</p><h4 id="ç”¨ScheduledExecutorå’ŒCalendarå®ç°ä»»åŠ¡è°ƒåº¦"><a href="#ç”¨ScheduledExecutorå’ŒCalendarå®ç°ä»»åŠ¡è°ƒåº¦" class="headerlink" title="ç”¨ScheduledExecutorå’ŒCalendarå®ç°ä»»åŠ¡è°ƒåº¦"></a>ç”¨ScheduledExecutorå’ŒCalendarå®ç°ä»»åŠ¡è°ƒåº¦</h4><p>è¿™æ˜¯ä¸¤ä¸ªä¸œè¥¿ç»„åˆä½¿ç”¨ï¼Œæ‰€ä»¥å…ˆç®€å•ä»‹ç»ä¸‹<code>ScheduledExecutor</code></p><h5 id="ScheduledExecutor"><a href="#ScheduledExecutor" class="headerlink" title="ScheduledExecutor"></a>ScheduledExecutor</h5><p>ä¸Timeræ¯”è¾ƒï¼Œä¼˜åŒ–äº†ä»»åŠ¡æ‰§è¡Œæ–¹å¼ï¼Œé‡‡ç”¨çº¿ç¨‹æ± å¹¶è¡Œæ‰§è¡Œï¼Œè¯´åˆ°çº¿ç¨‹æ± ï¼Œä¸Šç¯‡æ–‡ç« æœ‰è¿‡ä¸€ç‚¹ä»‹ç»äº†ã€‚è¿™é‡Œç›´æ¥ä¸Šä»£ç ä¾‹å­ï¼Œä»‹ç»çœ‹æ³¨é‡Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@describe</span>: ScheduledExecutor ä»»åŠ¡è°ƒåº¦</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span>:å½­çˆ½pross</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/12/28</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledExecutorDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">System.out.println(<span class="string">"task 1"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"><span class="comment">// åˆå§‹åŒ–çº¿ç¨‹æ± </span></div><div class="line">ScheduledExecutorService service = Executors.newScheduledThreadPool(<span class="number">10</span>);</div><div class="line"><span class="comment">// task 1 ï¼ŒscheduleAtFixedRateæ–¹æ³•ï¼Œéœ€è¦æŒ‡æ˜æ—¶é—´å•ä½ï¼Œå®ç°çš„æ˜¯runnable</span></div><div class="line">        <span class="comment">// æ‰€ä»¥æ¯ä¸€ä¸ªä»»åŠ¡éƒ½æ˜¯å•ç‹¬çš„ä¸€ä¸ªçº¿ç¨‹</span></div><div class="line">service.scheduleAtFixedRate(<span class="keyword">new</span> ScheduledExecutorDemo(),<span class="number">1000</span>,<span class="number">1000</span>, TimeUnit.SECONDS);</div><div class="line"><span class="comment">// task 2</span></div><div class="line">service.scheduleAtFixedRate(<span class="keyword">new</span> Runnable() &#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">System.out.println(<span class="string">"task 2"</span>);</div><div class="line">&#125;</div><div class="line">&#125;,<span class="number">1000</span>,<span class="number">1000</span>,TimeUnit.SECONDS);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å…³äºæ—¥å†ç±»<code>Calendar</code>å°±ä¸åšè¯¦ç»†è®²è§£ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆCalendar+ScheduledExecutorè§£å†³è¾ƒä¸ºå¤æ‚çš„è°ƒåº¦ã€‚</p><h5 id="å®ç°æ¯å‘¨äº”12ç‚¹è°ƒåº¦ä»»åŠ¡"><a href="#å®ç°æ¯å‘¨äº”12ç‚¹è°ƒåº¦ä»»åŠ¡" class="headerlink" title="å®ç°æ¯å‘¨äº”12ç‚¹è°ƒåº¦ä»»åŠ¡"></a>å®ç°æ¯å‘¨äº”12ç‚¹è°ƒåº¦ä»»åŠ¡</h5><p>ä»£ç ä¸€ç°ï¼Œå…¶ä¹‰è‡ªè§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Calendar;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span>:å½­çˆ½pross</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/12/27</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledExecuteCalendar</span> </span>&#123;</div><div class="line"><span class="comment">// åˆå§‹åŒ–çº¿ç¨‹æ± </span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> ScheduledExecutorService service = Executors.newScheduledThreadPool(<span class="number">10</span>);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * è®¡ç®—ä»å½“å‰æ—¶é—´currentDateå¼€å§‹ï¼Œ</span></div><div class="line"><span class="comment"> * æ»¡è¶³æ¡ä»¶dayOfWeek, hourOfDay,minuteOfHour, secondOfMiniteçš„æœ€è¿‘æ—¶é—´</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span></span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> Calendar <span class="title">getEarliestDate</span><span class="params">(Calendar currentDate, <span class="keyword">int</span> dayOfWeek,</span></span></div><div class="line"><span class="function"><span class="params">                                <span class="keyword">int</span> hourOfDay, <span class="keyword">int</span> minuteOfHour, <span class="keyword">int</span> secondOfMinite)</span> </span>&#123;</div><div class="line"><span class="comment">//è®¡ç®—å½“å‰æ—¶é—´çš„WEEK_OF_YEAR,DAY_OF_WEEK, HOUR_OF_DAY, MINUTE,SECONDç­‰å„ä¸ªå­—æ®µå€¼</span></div><div class="line"><span class="keyword">int</span> currentWeekOfYear = currentDate.get(Calendar.WEEK_OF_YEAR);</div><div class="line"><span class="keyword">int</span> currentDayOfWeek = currentDate.get(Calendar.DAY_OF_WEEK);</div><div class="line"><span class="keyword">int</span> currentHour = currentDate.get(Calendar.HOUR_OF_DAY);</div><div class="line"><span class="keyword">int</span> currentMinute = currentDate.get(Calendar.MINUTE);</div><div class="line"><span class="keyword">int</span> currentSecond = currentDate.get(Calendar.SECOND);</div><div class="line"></div><div class="line"><span class="comment">//å¦‚æœè¾“å…¥æ¡ä»¶ä¸­çš„dayOfWeekå°äºå½“å‰æ—¥æœŸçš„dayOfWeek,åˆ™WEEK_OF_YEARéœ€è¦æ¨è¿Ÿä¸€å‘¨</span></div><div class="line"><span class="keyword">boolean</span> weekLater = <span class="keyword">false</span>;</div><div class="line"><span class="keyword">if</span> (dayOfWeek &lt; currentDayOfWeek) &#123;</div><div class="line">weekLater = <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//å½“è¾“å…¥æ¡ä»¶ä¸å½“å‰æ—¥æœŸçš„dayOfWeekç›¸ç­‰æ—¶ï¼Œè¾“å…¥æ¡ä»¶ä¸­çš„ hourOfDayå°äºå½“å‰æ—¥æœŸçš„ currentHourï¼Œåˆ™WEEK_OF_YEARéœ€è¦æ¨è¿Ÿä¸€å‘¨</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (dayOfWeek == currentDayOfWeek) &#123;</div><div class="line"><span class="keyword">if</span> (hourOfDay &lt; currentHour) &#123;</div><div class="line">weekLater = <span class="keyword">true</span>;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (hourOfDay == currentHour) &#123;</div><div class="line"><span class="comment">//å½“è¾“å…¥æ¡ä»¶ä¸å½“å‰æ—¥æœŸçš„dayOfWeek, hourOfDayç›¸ç­‰æ—¶ï¼Œè¾“å…¥æ¡ä»¶ä¸­çš„minuteOfHourå°äºå½“å‰æ—¥æœŸcurrentMinuteï¼Œåˆ™WEEK_OF_YEARéœ€è¦æ¨è¿Ÿä¸€å‘¨</span></div><div class="line"><span class="keyword">if</span> (minuteOfHour &lt; currentMinute) &#123;</div><div class="line">weekLater = <span class="keyword">true</span>;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (minuteOfHour == currentSecond) &#123;</div><div class="line"><span class="comment">//å½“è¾“å…¥æ¡ä»¶ä¸å½“å‰æ—¥æœŸçš„dayOfWeek, hourOfDayï¼ŒminuteOfHourç›¸ç­‰æ—¶ï¼Œå¦‚æœè¾“å…¥æ¡ä»¶ä¸­çš„secondOfMiniteå°äºå½“å‰æ—¥æœŸçš„currentSecondï¼Œåˆ™WEEK_OF_YEARéœ€è¦æ¨è¿Ÿä¸€å‘¨</span></div><div class="line"><span class="keyword">if</span> (secondOfMinite &lt; currentSecond) &#123;</div><div class="line">weekLater = <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (weekLater) &#123;</div><div class="line"><span class="comment">//è®¾ç½®å½“å‰æ—¥æœŸä¸­çš„WEEK_OF_YEARä¸ºå½“å‰å‘¨æ¨è¿Ÿä¸€å‘¨</span></div><div class="line">currentDate.set(Calendar.WEEK_OF_YEAR, currentWeekOfYear + <span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// è®¾ç½®å½“å‰æ—¥æœŸä¸­çš„DAY_OF_WEEK,HOUR_OF_DAY,MINUTE,SECONDä¸ºè¾“å…¥æ¡ä»¶ä¸­çš„å€¼ã€‚</span></div><div class="line">currentDate.set(Calendar.DAY_OF_WEEK, dayOfWeek);</div><div class="line">currentDate.set(Calendar.HOUR_OF_DAY, hourOfDay);</div><div class="line">currentDate.set(Calendar.MINUTE, minuteOfHour);</div><div class="line">currentDate.set(Calendar.SECOND, secondOfMinite);</div><div class="line"><span class="keyword">return</span> currentDate;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">ScheduledExecuteCalendar test = <span class="keyword">new</span> ScheduledExecuteCalendar();</div><div class="line"><span class="comment">// è·å–å½“å‰æ—¶é—´</span></div><div class="line">Calendar currentDate = Calendar.getInstance();</div><div class="line"><span class="keyword">long</span> currentDateLong = currentDate.getTime().getTime();</div><div class="line">System.out.println(<span class="string">"å½“å‰æ—¥æœŸï¼š "</span> + currentDate.getTime().toString());</div><div class="line"><span class="comment">// è®¡ç®—æ»¡è¶³æ¡ä»¶çš„æœ€è¿‘ä¸€æ¬¡æ‰§è¡Œæ—¶é—´</span></div><div class="line">Calendar earliestDate = test.getEarliestDate(currentDate, <span class="number">6</span>, <span class="number">12</span>, <span class="number">00</span>, <span class="number">00</span>);</div><div class="line"><span class="comment">//è®¡ç®—ç¬¬ä¸€æ¬¡æ‰§è¡Œå»¶è¿Ÿæ—¶é—´</span></div><div class="line"><span class="keyword">long</span> earliestDateLong = earliestDate.getTime().getTime();</div><div class="line"><span class="keyword">long</span> delay = earliestDateLong - currentDateLong;</div><div class="line">System.out.println(<span class="string">"ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ï¼š"</span>+earliestDate.getTime().toString());</div><div class="line"><span class="comment">//è®¡ç®—æ‰§è¡Œå‘¨æœŸä¸ºä¸€æ˜ŸæœŸ</span></div><div class="line"><span class="keyword">long</span> period = <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>;</div><div class="line">System.out.println(<span class="string">"ç­‰å¾…æ‰§è¡Œ..."</span>);</div><div class="line">service.scheduleAtFixedRate(<span class="keyword">new</span> Runnable() &#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">System.out.println(<span class="string">"Task ScheduledExecute"</span>);</div><div class="line">&#125;</div><div class="line">&#125;, delay, period, TimeUnit.MILLISECONDS); </div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="Springä¸­çš„ä»»åŠ¡è°ƒåº¦TaskScheduler"><a href="#Springä¸­çš„ä»»åŠ¡è°ƒåº¦TaskScheduler" class="headerlink" title="Springä¸­çš„ä»»åŠ¡è°ƒåº¦TaskScheduler"></a>Springä¸­çš„ä»»åŠ¡è°ƒåº¦TaskScheduler</h4><p>TaskSchedulerç”¨äºå¯¹Runnableçš„ä»»åŠ¡è¿›è¡Œè°ƒåº¦ï¼Œå…¶ä¸­åŒ…å«å¤šç§å®ç°ï¼Œå¤šæ•°å¯¹ä»»åŠ¡è¿›è¡Œè°ƒåº¦çš„å®ç°æ˜¯<code>ThreadPoolTaskScheduler</code>ï¼›å¦å¤–éœ€è¦ç”¨åˆ°<code>Trigger</code>æ¥å£è®¡ç®—ä»»åŠ¡çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼›æˆ‘ä»¬å…ˆçœ‹ä¸‹Triggeræ¥å£çš„å®ç°ã€‚</p><h5 id="Trigger"><a href="#Trigger" class="headerlink" title="Trigger"></a>Trigger</h5><p>Triggeræ¥å£å®šä¹‰å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Trigger</span> </span>&#123;</div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Determine the next execution time according to the given trigger context.</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> triggerContext context object encapsulating last execution times</span></div><div class="line"><span class="comment"> * and last completion time</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> the next execution time as defined by the trigger,</span></div><div class="line"><span class="comment"> * or &#123;<span class="doctag">@code</span> null&#125; if the trigger won't fire anymore</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Nullable</span></div><div class="line"><span class="function">Date <span class="title">nextExecutionTime</span><span class="params">(TriggerContext triggerContext)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å…¶ä¸­æä¾›äº†ä¸€ä¸ªæ¥å£ï¼š<code>nextExecutionTime</code>æ¥è·å–ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œæ¥å—çš„å‚æ•°ä¸ºTirggerContxtå¯¹è±¡ï¼Œè¿™ä¸ªå‚æ•°å¯¹è±¡èƒ½è·å–ä¸Šæ¬¡åŸæœ¬çš„è®¡åˆ’æ—¶é—´ / å®é™…çš„æ‰§è¡Œæ—¶é—´ / å®é™…çš„å®Œæˆæ—¶é—´ï¼Œä½ é—®æˆ‘æ˜¯æ€ä¹ˆçŸ¥é“ï¼Ÿç‚¹è¿›å»çœ‹æºç å‘€ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TriggerContext</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Return the last &lt;i&gt;scheduled&lt;/i&gt; execution time of the task,</span></div><div class="line"><span class="comment"> * or &#123;<span class="doctag">@code</span> null&#125; if not scheduled before.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Nullable</span></div><div class="line"><span class="function">Date <span class="title">lastScheduledExecutionTime</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Return the last &lt;i&gt;actual&lt;/i&gt; execution time of the task,</span></div><div class="line"><span class="comment"> * or &#123;<span class="doctag">@code</span> null&#125; if not scheduled before.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Nullable</span></div><div class="line"><span class="function">Date <span class="title">lastActualExecutionTime</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Return the last completion time of the task,</span></div><div class="line"><span class="comment"> * or &#123;<span class="doctag">@code</span> null&#125; if not scheduled before.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Nullable</span></div><div class="line"><span class="function">Date <span class="title">lastCompletionTime</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ç»§ç»­è¿”å›æ¥ï¼Œæ¥çœ‹çœ‹æœ‰å“ªäº›å®ç°ç±»ç»§æ‰¿Triggeræ¥å£ï¼ˆIDEAä¸­å¿«æ·é”®ï¼Œ<code>option + command +B</code> / <code>ctrl + alt + B</code> ï¼‰ï¼›ç¬¬ä¸€ä¸ªæ˜¯<code>CronTrigger</code>ï¼Œé€šè¿‡<code>Crob</code>è¡¨è¾¾å¼æ¥ç”Ÿæˆçš„è°ƒåº¦è®¡åˆ’ï¼Œè¿˜å¯ä»¥é€‰æ‹©æ˜¯å¦åŠ ä¸Šæ—¶åŒºã€‚</p><p>ä¸¾ä¾‹ï¼šå·¥ä½œæ—¥çš„9-17ç‚¹ä¹‹é—´ï¼Œæ¯éš”30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> CronTrigger(<span class="string">"0 0/30 9-17 * * MON-FRI"</span>)</div></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªå®ç°ç±»æ˜¯<code>PeriodicTrigger</code>ï¼Œä¹Ÿç”¨äºå®šæœŸæ‰§è¡Œï¼Œæœ‰ä¸¤ç§æ¨¡å¼å¯ä»¥é€‰æ‹©ï¼š<code>setFixedRate</code>ï¼Œbooleanç±»å‹ï¼Œé»˜è®¤æ˜¯falseã€‚å’Œ <code>setInitialDelay</code>ï¼Œlongç±»å‹ï¼Œè¡¨ç¤ºå¯åŠ¨ä»»åŠ¡åå»¶è¿Ÿå¤šé•¿æ—¶é—´å¼€å§‹æ‰§è¡Œç¬¬ä¸€æ¬¡ä»»åŠ¡ã€‚æœ€åå°±æ˜¯æ„é€ æ–¹æ³•ï¼Œå‚æ•°<code>period</code>ï¼Œlongç±»å‹ï¼Œè¡¨ç¤ºé—´éš”æ—¶é•¿ï¼›å‚æ•°<code>timeUnit</code>ï¼ŒTimeUnitç±»å‹ï¼ŒæŒ‡å®šæ—¶é•¿å•ä½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Specify whether the periodic interval should be measured between the</span></div><div class="line"><span class="comment"> * scheduled start times rather than between actual completion times.</span></div><div class="line"><span class="comment"> * The latter, "fixed delay" behavior, is the default.</span></div><div class="line"><span class="comment"> * ç®€æ˜æ€»ç»“ä¸ºï¼šä¸¤æ¬¡ä»»åŠ¡å¼€å§‹æ—¶é—´çš„é—´éš”ä¸ºæŒ‡å®šçš„æ—¶é•¿(period)ã€‚</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFixedRate</span><span class="params">(<span class="keyword">boolean</span> fixedRate)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.fixedRate = fixedRate;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Specify the delay for the initial execution. It will be evaluated in</span></div><div class="line"><span class="comment"> * terms of this trigger's &#123;<span class="doctag">@link</span> TimeUnit&#125;. If no time unit was explicitly</span></div><div class="line"><span class="comment"> * provided upon instantiation, the default is milliseconds.</span></div><div class="line"><span class="comment"> * ç®€æ˜æ€»ç»“ä¸ºï¼šè®¾ç½®å¯åŠ¨è°ƒåº¦åï¼Œè®¾ç½®æ‰§è¡Œç¬¬ä¸€æ¬¡ä»»åŠ¡çš„å»¶è¿Ÿæ—¶é—´ã€‚</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInitialDelay</span><span class="params">(<span class="keyword">long</span> initialDelay)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.initialDelay = <span class="keyword">this</span>.timeUnit.toMillis(initialDelay);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>TaskScheduler</strong></p><p>TaskScheduleræ¥å£çš„å®ç°ç±»æœ‰ThreadPoolTaskSchedulerï¼Œå…¶ä¸­è¿˜æœ‰ConcurrentTaskSchedulerï¼ŒDefaultManagedTaskSchedulerï¼ŒTimerManagerTaskSchedulerï¼Œè¿™é‡Œé‡è¦è¯´ä¸‹é»˜è®¤çš„å®ç°ç±»ThreadPoolTaskSchedulerã€‚</p><p>åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹éƒ½ä½¿ç”¨å®ƒæ¥è¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œé™¤äº†å®ç°TaskScheduleræ¥å£å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›å¯¹ThreadPoolTaskSchedulerè¿›è¡Œæ“ä½œçš„æ¥å£ï¼š<code>AsyncListenableTaskExecutor</code>å’Œ<code>SchedulingTaskExecutor</code>ã€‚å…¶å¸¸ç”¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è®¾ç½®çº¿ç¨‹æ± å¤§å°ï¼Œé»˜è®¤ä¸ºpoolsize=1ã€‚</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPoolSize</span><span class="params">(<span class="keyword">int</span> poolSize)</span> </span>&#123;</div><div class="line">Assert.isTrue(poolSize &gt; <span class="number">0</span>, <span class="string">"'poolSize' must be 1 or higher"</span>);</div><div class="line"><span class="keyword">this</span>.poolSize = poolSize;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.scheduledExecutor <span class="keyword">instanceof</span> ScheduledThreadPoolExecutor) &#123;</div><div class="line">((ScheduledThreadPoolExecutor) <span class="keyword">this</span>.scheduledExecutor).setCorePoolSize(poolSize);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¼‚å¸¸å¤„ç†èµ·</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setErrorHandler</span><span class="params">(ErrorHandler errorHandler)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.errorHandler = errorHandler;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è·å–å½“å‰æ´»åŠ¨çš„çº¿ç¨‹æ•°</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getActiveCount</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.scheduledExecutor == <span class="keyword">null</span>) &#123;</div><div class="line"><span class="comment">// Not initialized yet: assume no active threads.</span></div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> getScheduledThreadPoolExecutor().getActiveCount();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æäº¤æ‰§è¡Œä»»åŠ¡ï¼Œéœ€ç»§æ‰¿å¿…é¡»é‡å†™çš„æ–¹æ³•</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable task)</span> </span>&#123;</div><div class="line">Executor executor = getScheduledExecutor();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">executor.execute(errorHandlingTask(task, <span class="keyword">false</span>));</div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span> (RejectedExecutionException ex) &#123;</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> TaskRejectedException(<span class="string">"Executor ["</span> + executor + <span class="string">"] did not accept task: "</span> + task, ex);</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æäº¤æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ä¾›åˆ¤æ–­ä»»åŠ¡çŠ¶æ€ä½¿ç”¨</span></div><div class="line"><span class="comment">// submit/submitListenable</span></div><div class="line"><span class="keyword">public</span> Future&lt;?&gt; submit(Runnable task) &#123;</div><div class="line">ExecutorService executor = getScheduledExecutor();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line"><span class="keyword">return</span> executor.submit(errorHandlingTask(task, <span class="keyword">false</span>));</div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span> (RejectedExecutionException ex) &#123;</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> TaskRejectedException(<span class="string">"Executor ["</span> + executor + <span class="string">"] did not accept task: "</span> + task, ex);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Springä¸­æä¾›<code>Scheduled</code>æ³¨è§£æ¥å®ç°å¿«æ·çš„ä»»åŠ¡è°ƒåº¦ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»ä½¿ç”¨<code>@EnableScheduling</code>æ³¨è§£å¯ç”¨å¯¹<code>@Scheduled</code>æ³¨è§£çš„æ”¯æŒï¼Œ@EnableSchedulingå¿…é¡»ä½¿ç”¨åœ¨é¡¹ç›®ä¸­æŸä¸€ä¸ªè¢«<code>@Configuration</code>æ³¨è§£çš„ç±»ä¸Šï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableScheduling</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBConfiguration</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Scheduledæ³¨è§£ç”¨åœ¨æ–¹æ³•ä¸‹ï¼Œç”¨æˆ·è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•å°†ä¼šè¢«è°ƒåº¦ï¼Œæ‰€æ³¨è§£çš„æ–¹æ³•è¿”å›ç±»å‹æœ€å¥½æ˜¯<code>void</code>ç±»å‹ï¼Œå¦åˆ™å®ƒçš„è¿”å›å€¼å°†ä¸ä¼šè¢«TaskScheduleræ‰€ä½¿ç”¨ã€‚åŒæ—¶ï¼Œå¦‚æœéœ€è¦å‚æ•°å¯¹è±¡ï¼Œéœ€è¦é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼å¼•ç”¨ï¼Œå…¶ä¸­åŒ…å«ï¼š</p><ul><li>cronï¼šä½¿ç”¨cronè¯­æ³•æ¥æŒ‡å®šè°ƒåº¦è®¡åˆ’</li><li>zoneï¼šæŒ‡å®šæ—¶åŒºï¼Œé»˜è®¤ä¸ºæœ¬æ—¶åŒº</li><li>fixedDelayï¼šæŒ‡å®šfixedDelayçš„å€¼ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’</li><li>fixedRateï¼šæŒ‡å®šä¸Šä¸€æ¬¡ä»»åŠ¡å¼€å§‹æ—¶é—´åˆ°ä¸‹ä¸€æ¬¡ä»»åŠ¡å¼€å§‹æ—¶é—´çš„é—´éš”æ—¶é—´ï¼Œå•ä½é»˜è®¤æ˜¯æ¯«ç§’</li><li>initialDelayï¼šè®¾ç½®åˆå§‹å»¶è¿Ÿæ—¶é—´</li></ul><p>å…¶ä¸­cron / fixedDelay / fixedRateä¸‰ä¸ªå±æ€§å¿…é¡»ä¸”åªèƒ½å‡ºç°ä¸€ä¸ªï¼Œä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleService</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(ScheduleService.class);</div><div class="line"></div><div class="line">    <span class="meta">@Scheduled</span>(fixedRate = <span class="number">4000</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSchedule</span><span class="params">()</span> </span>&#123;</div><div class="line">        logger.info(<span class="string">"TestSchedule begins to execute!"</span>);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Thread.sleep(<span class="number">1000</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            logger.error(<span class="string">"TestSchedule has been interrupted!"</span>, e);</div><div class="line">            <span class="keyword">return</span>;  </div><div class="line">        &#125;</div><div class="line">        logger.info(<span class="string">"TestSchedule execution was completed!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªç›´æ¥åœ¨Spring Bootä¸­ä½¿ç”¨<code>@Autowired</code>æ³¨è§£çš„æ–¹å¼ï¼Œç›´æ¥å®ç°threadPoolTaskSchedulerï¼Œå®ç°åŠ¨æ€çš„æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤å®šæ—¶ä»»åŠ¡ï¼Œä¹Ÿæ˜¯å®ç°éœ€æ±‚è€ƒè™‘çš„æ–¹æ¡ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledFuture;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</div><div class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;</div><div class="line"><span class="keyword">import</span> org.springframework.scheduling.support.CronTrigger;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span>:å½­çˆ½pross</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/12/28</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@RestController</span></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicTaskController</span> </span>&#123;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> ThreadPoolTaskScheduler threadPoolTaskScheduler;</div><div class="line">   </div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åœ¨ScheduledFutureä¸­cancelå¯ä»¥åœæ­¢å®šæ—¶ä»»åŠ¡ã€‚</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> ScheduledFuture&lt;?&gt; future;</div><div class="line"> </div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * ThreadPoolTaskSchedulerï¼šçº¿ç¨‹æ± ä»»åŠ¡è°ƒåº¦ç±»ï¼Œèƒ½å¤Ÿå¼€å¯çº¿ç¨‹æ± è¿›è¡Œä»»åŠ¡è°ƒåº¦ã€‚</span></div><div class="line"><span class="comment">     * ThreadPoolTaskScheduler.schedule()æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªå®šæ—¶è®¡åˆ’ScheduledFutureï¼Œåœ¨è¿™ä¸ªæ–¹æ³•éœ€è¦æ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼ŒRunnableï¼ˆçº¿ç¨‹æ¥å£ç±»ï¼‰ å’ŒCronTriggerï¼ˆå®šæ—¶ä»»åŠ¡è§¦å‘å™¨ï¼‰</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ThreadPoolTaskScheduler <span class="title">threadPoolTaskScheduler</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolTaskScheduler();</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * å¯åŠ¨ä»»åŠ¡ï¼Œæ¯äº”ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/startTask"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">startCron</span><span class="params">()</span> </span>&#123;</div><div class="line">       future = threadPoolTaskScheduler.schedule(<span class="keyword">new</span> Runnable() &#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">System.out.println(<span class="string">"execute task"</span>);</div><div class="line">&#125;</div><div class="line">&#125;, <span class="keyword">new</span> CronTrigger(<span class="string">"0/5 * * * * *"</span>));</div><div class="line">       System.out.println(<span class="string">"DynamicTaskController.startCron()"</span>);</div><div class="line">       <span class="keyword">return</span> <span class="string">"startTask"</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * å¯æ­¤ä»»åŠ¡</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/stopTask"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">stopCron</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (future != <span class="keyword">null</span>) &#123;</div><div class="line">           future.cancel(<span class="keyword">true</span>);</div><div class="line">       &#125;</div><div class="line">       System.out.println(<span class="string">"DynamicTaskController.stopCron()"</span>);</div><div class="line">       <span class="keyword">return</span> <span class="string">"stopTask"</span>;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * å˜æ›´ä»»åŠ¡é—´éš”ï¼Œå†æ¬¡å¯åŠ¨</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/changeCron"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeCron</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="comment">// å…ˆåœæ­¢ï¼Œåœ¨å¼€å¯</span></div><div class="line">       stopCron();</div><div class="line">       future = threadPoolTaskScheduler.schedule(<span class="keyword">new</span> MyRunnable(), <span class="keyword">new</span> CronTrigger(<span class="string">"*/10 * * * * *"</span>));</div><div class="line">       System.out.println(<span class="string">"DynamicTaskController.changeCron()"</span>);</div><div class="line">       <span class="keyword">return</span> <span class="string">"changeCron"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="ç®€å•ä»‹ç»å¼€æºå·¥å…·åŒ…Quartz"><a href="#ç®€å•ä»‹ç»å¼€æºå·¥å…·åŒ…Quartz" class="headerlink" title="ç®€å•ä»‹ç»å¼€æºå·¥å…·åŒ…Quartz"></a>ç®€å•ä»‹ç»å¼€æºå·¥å…·åŒ…Quartz</h4><p>Quartz å¯ä»¥æ»¡è¶³æ›´å¤šæ›´å¤æ‚çš„è°ƒåº¦éœ€æ±‚ï¼Œè®¾è®¡çš„æ ¸å¿ƒç±»åŒ…æ‹¬ Schedulerï¼ŒJob ä»¥åŠTriggerã€‚å…¶ä¸­Job è´Ÿè´£å®šä¹‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒTrigger è´Ÿè´£è®¾ç½®è°ƒåº¦ç­–ç•¥ï¼ŒScheduler å°†äºŒè€…ç»„è£…åœ¨ä¸€èµ·ï¼Œå¹¶è§¦å‘ä»»åŠ¡å¼€å§‹æ‰§è¡Œï¼Œé™¤äº†Jobå…¶å®ƒçš„æ ¸å¿ƒç±»å¤§å¤šå·²ç»ç®€å•ä»‹ç»è¿‡ï¼Œä¸‹é¢çœ‹çœ‹Jobã€‚</p><p><strong>Job</strong></p><p>ä½¿ç”¨è€…åªéœ€è¦åˆ›å»ºä¸€ä¸ª Job çš„ç»§æ‰¿ç±»ï¼Œå®ç°<code>execute</code>æ–¹æ³•ã€‚<code>JobDetail</code>è´Ÿè´£å°è£… Job ä»¥åŠ Job çš„å±æ€§ï¼Œå¹¶å°†å…¶æä¾›ç»™ Scheduler ä½œä¸ºå‚æ•°ã€‚æ¯æ¬¡ Scheduler æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ª Job çš„å®ä¾‹ï¼Œç„¶åå†è°ƒç”¨ execute æ–¹æ³•æ‰§è¡Œã€‚Quartz æ²¡æœ‰ä¸º Job è®¾è®¡å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå› æ­¤éœ€è¦é€šè¿‡é¢å¤–çš„ JobDataMap æ¥å­˜å‚¨ Job çš„å±æ€§ã€‚JobDataMap å¯ä»¥å­˜å‚¨ä»»æ„æ•°é‡çš„ Keyï¼ŒValueé”®å€¼å¯¹ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.quartz.Job;</div><div class="line"><span class="keyword">import</span> org.quartz.JobDetail;</div><div class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;</div><div class="line"><span class="keyword">import</span> org.quartz.JobExecutionException;</div><div class="line"><span class="keyword">import</span> org.quartz.Scheduler;</div><div class="line"><span class="keyword">import</span> org.quartz.SchedulerFactory;</div><div class="line"><span class="keyword">import</span> org.quartz.Trigger;</div><div class="line"><span class="keyword">import</span> org.quartz.helpers.TriggerUtils;</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@describe</span>: åˆ›å»ºä¸€ä¸ªMyJobç±»ï¼Œå®ç°Jobæ¥å£</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span>:å½­çˆ½pross</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/12/29</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJob</span> <span class="keyword">implements</span> <span class="title">Job</span></span>&#123;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">Scheduler scheduler = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªJobDetailå®ä¾‹</span></div><div class="line">JobBuilder jobBuilder = JobBuilder.newJob(MyJob.class);</div><div class="line">jobBuilder.withDescription(<span class="string">"test read desc."</span>);</div><div class="line">JobDetail jobDetail = jobBuilder.build();</div><div class="line"></div><div class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªè°ƒåº¦è§„åˆ™, æ¯3sè¿è¡Œä¸€æ¬¡</span></div><div class="line">SimpleScheduleBuilder simpleBuilder = SimpleScheduleBuilder.simpleSchedule().withIntervalInSeconds(<span class="number">3</span>).repeatForever();</div><div class="line">Trigger trigger = TriggerBuilder.newTrigger().withSchedule(simpleBuilder).startNow().build();</div><div class="line"></div><div class="line"><span class="comment">// ä»å·¥å‚ä¸­è·å–ä¸€ä¸ªè°ƒåº¦å™¨Scheduler</span></div><div class="line">SchedulerFactory schedulerFactory = <span class="keyword">new</span> StdSchedulerFactory();</div><div class="line">scheduler = schedulerFactory.getScheduler();</div><div class="line"></div><div class="line"><span class="comment">// æ³¨å†ŒjobDetail, triggeråˆ°è°ƒåº¦å™¨Scheduler</span></div><div class="line">scheduler.scheduleJob(jobDetail, trigger);</div><div class="line"></div><div class="line"><span class="comment">// å¼€å§‹æ‰§è¡ŒJob</span></div><div class="line">scheduler.start();</div><div class="line">&#125; <span class="keyword">catch</span> (Exception e1) &#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line"><span class="comment">// å‡ºå¼‚å¸¸äº†, åœæ­¢æ‰§è¡ŒJob</span></div><div class="line">scheduler.shutdown();</div><div class="line">&#125; <span class="keyword">catch</span> (SchedulerException e2) &#123;</div><div class="line">e2.printStackTrace();</div><div class="line">&#125;</div><div class="line">e1.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext jobExecutionContext)</span> <span class="keyword">throws</span> JobExecutionException</span>&#123;</div><div class="line">String description = jobExecutionContext.getJobDetail().getDescription();</div><div class="line">System.out.println(<span class="string">"å®šæ—¶Jobå¼€å§‹è¿è¡Œ: "</span> + description);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Quartzè¿˜å¯ä»¥å’ŒSpringæ•´åˆä½¿ç”¨ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªå…·ä½“çš„ä½œä¸šä»»åŠ¡çš„å®ç°ç±»ï¼Œä½¿ç”¨JobDetailFactoryBeanæ¥ç®¡ç†ä½œä¸šä»»åŠ¡ã€‚å…·ä½“å°±ä¸ç»†è‡´å±•å¼€ï¼Œè¿™ç¯‡æ–‡ç« ç¯‡å¹…å·²ç»å¤Ÿé•¿äº†ï¼Œ</p><p>å‡ ç§å®šæ—¶è°ƒåº¦çš„ä»‹ç»å’Œå®ç°æš‚æ—¶å°±å†™è¿™ä¹ˆå¤šã€‚</p><p>å®Œã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;ç”±éœ€æ±‚äº§å‡ºçš„ä¸€ç¯‡æ–‡ç« ï¼Œæ†‹äº†å¾ˆä¹…ã€‚ä»¥ä¸‹å°†ä¼šçœ‹åˆ°ï¼Œä½¿ç”¨Timerè¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œç”¨ScheduledExecutorå’ŒCalendarå®ç°ä»»åŠ¡è°ƒåº¦ï¼ŒSpringä¸­çš„ä»»åŠ¡è°ƒåº¦TaskSchedulerï¼Œå¼€æºå·¥å…·åŒ…Quartzçš„ç®€å•ä»‹ç»ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Java" scheme="https://pross.space/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Javaçº¿ç¨‹æ± </title>
    <link href="https://pross.space/archives/2018/12/22/"/>
    <id>https://pross.space/archives/2018/12/22/</id>
    <published>2018-12-22T15:59:18.000Z</published>
    <updated>2019-07-10T16:28:53.369Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>è™½ç„¶ä¹‹å‰å­¦ä¹ äº†ä¸å°‘ç›¸å…³çŸ¥è¯†ï¼Œä½†æ˜¯åªæœ‰åœ¨å®è·µä¸­è¸©å‘æ‰èƒ½å°è±¡æ·±åˆ»ã€‚ä»Šå¤©çœ‹äº†åŠå¤©çš„javaå¯¹çº¿ç¨‹æ± çš„å¤„ç†ï¼Œé¢å¤–å…´è‡´æ¥ï¼Œå‘¨äº”æ€»ç»“ä¸€ä»½javaçº¿ç¨‹æ± ç›¸å…³ã€‚</p><a id="more"></a><h4 id="çº¿ç¨‹æ± çš„åæœ"><a href="#çº¿ç¨‹æ± çš„åæœ" class="headerlink" title="çº¿ç¨‹æ± çš„åæœ"></a>çº¿ç¨‹æ± çš„åæœ</h4><h5 id="Javaæä¾›çš„å·¥å…·ç±»-Executors"><a href="#Javaæä¾›çš„å·¥å…·ç±»-Executors" class="headerlink" title="Javaæä¾›çš„å·¥å…·ç±»-Executors"></a>Javaæä¾›çš„å·¥å…·ç±»-Executors</h5><p>Executorsæ˜¯ä¸€ä¸ªJavaä¸­çš„å·¥å…·ç±»ï¼Œæä¾›å·¥å‚æ–¹æ³•æ¥åˆ›å»ºä¸åŒç±»å‹çš„çº¿ç¨‹æ± ã€‚ æä¾›æ–¹æ³•å¦‚ä¸‹ï¼š</p><p><img src="/archives/2018/12/22/Executors.jpg" alt=""></p><p>ç„¶åé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œä¸­è¿™æ ·æåˆ°ï¼š</p><blockquote><ol><li><p>ã€å¼ºåˆ¶ã€‘çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ ThreadPoolExecutor çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚</p><pre><code>è¯´æ˜:Executors è¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹:1ï¼‰FixedThreadPool å’Œ SingleThreadPool: å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ 2)CachedThreadPool å’Œ ScheduledThreadPool: å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ </code></pre></li></ol></blockquote><p>ç¬¬ä¸€ä¸ªå…³é”®è¯ï¼šOOMã€‚æ€ä¹ˆå¯¼è‡´OOMçš„å‘¢ï¼Œé‚£å°±show codesï¼Œä¸€èµ·æ¥çœ‹çœ‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@describe</span>: Executorsçº¿ç¨‹æ± åˆ›å»ºï¼Œè¯æ˜ä½¿ç”¨Executorsä¼šé€ æˆoom</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span>:å½­çˆ½pross</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/12/21</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorsDemo</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> ExecutorService executor = Executors.newFixedThreadPool(<span class="number">10</span>);</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;Integer.MAX_VALUE;i++)&#123;</div><div class="line">executor.execute(<span class="keyword">new</span> subThread());</div><div class="line">            System.out.println(<span class="string">"Thread countï¼š"</span>+i);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">subThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">Thread.sleep(<span class="number">1000</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä»£ç é‡Œåˆ»æ„è°ƒæ•´çº¿ç¨‹æ•°é‡ï¼Œå¯åŠ¨æ—¶æ•…æ„è®¾ç½®å†…å­˜å¤§å°ï¼ˆæ¨¡æ‹Ÿä¸Šé™å†…å­˜ï¼‰ï¼š<code>-Xmx8m -Xms8m</code>ã€‚è¿è¡Œç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: GC overhead limit exceeded</div><div class="line">at java.util.concurrent.LinkedBlockingQueue.offer(LinkedBlockingQueue.java:<span class="number">416</span>)</div><div class="line">at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:<span class="number">1371</span>)</div><div class="line">at org.pross.threadPool.ExecutorsDemo.main(ExecutorsDemo.java:<span class="number">18</span>)</div></pre></td></tr></table></figure><p>é”™è¯¯å°±æ˜¯å¾ˆæ˜æ˜¾çš„ï¼ŒOOMé—®é¢˜ã€‚å†å‡ºç°OOMä¹‹å‰ï¼Œä¼šä¸€ç›´æœ‰æ‰“å°è¾“å‡ºï¼Œä¸€ç›´è¾¾åˆ°å†…å­˜ä¸Šé™ä¸ºæ­¢ã€‚ä¸ºä»€ä¹ˆä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± å°±ä¼šé”™è¯¯ï¼Œé‚£æˆ‘ä»¬å°±æ¥è¿½æº¯Javaåˆ›å»ºçº¿ç¨‹æ± é€ æˆOOMçš„åŸå› ã€‚</p><h5 id="Executorsä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™·"><a href="#Executorsä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™·" class="headerlink" title="Executorsä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™·"></a>Executorsä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™·</h5><p>å¾€ä¸Šé¢ç»“æœçœ‹ä¸€çœ¼ï¼Œæœ€ç»ˆæ‰§è¡Œé”™è¯¯ä»£ç åˆ°äº†è¿™ä¸€è¡Œï¼š<code>java.util.concurrent.LinkedBlockingQueue.offer(LinkedBlockingQueue.java:416)</code>ã€‚æ•²é»‘æ¿åˆ’ä¸€ä¸‹ç¬¬äºŒä¸ªå…³é”®è¯ï¼š<code>LinkedBlockingQueue</code>ï¼Œç‚¹è¿›<code>newFixedThreadPool</code> å¯ä»¥å‘ç°å…³é”®è¯çš„è¸ªå½±ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/*</span></div><div class="line"><span class="comment"> * @param nThreads the number of threads in the pool</span></div><div class="line"><span class="comment"> * @return the newly created thread pool</span></div><div class="line"><span class="comment"> * @throws IllegalArgumentException if &#123;@code nThreads &lt;= 0&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</div><div class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</div><div class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>è¿™é‡Œå°±éœ€è¦ç»§ç»­è¯´ä¸‹Javaçš„å µå¡é˜Ÿåˆ—ã€‚Javaä¸­çš„<code>BlockingQueue</code>ä¸»è¦çš„å®ç°æ–¹å¼æ˜¯<code>ArrayBlockingQueue</code>ï¼Œ<code>LinkedBlockingQueue</code>ã€‚ArrayBlockingQueueæ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œå¿…é¡»è®¾ç½®å®¹é‡ã€‚ä½†æ˜¯æˆ‘ä»¬é»˜è®¤çš„LinkedBlockingQueueæ˜¯ä¸€ä¸ªç”¨é“¾è¡¨å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå®¹é‡å¯ä»¥é€‰æ‹©è¡Œè¿›è¡Œè®¾ç½®ï¼Œä¸è®¾ç½®çš„è¯ï¼Œå°±æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæœ€å¤§é•¿åº¦ä¸º<code>Integer.MAX_VALUE</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Creates a &#123;<span class="doctag">@code</span> LinkedBlockingQueue&#125; with a capacity of</span></div><div class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> Integer#MAX_VALUE&#125;.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedBlockingQueue</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(Integer.MAX_VALUE);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ‰€ä»¥å°±å¾ˆç®€å•çš„æ‰¾åˆ°äº†é—®é¢˜æ‰€åœ¨ï¼Œä¸è®¾ç½®LinkedBlockingQueueå®¹é‡å¤§å°çš„è¯å°±æ˜¯é»˜è®¤æ˜¯Integer.MAX_VALUEã€‚è€Œæœ€å¼€å§‹åˆ›å»ºnewFixedThreadPoolæ—¶å€™ï¼Œå¹¶æ²¡æœ‰å¯ä»¥æŒ‡å®šçš„å­—æ®µã€‚æ‰€ä»¥å‡ºç°OOMæ˜¯æ­£å¸¸çš„ï¼Œé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œä¸­ä¸å…è®¸ä½¿ç”¨ Executors å»åˆ›å»ºæ˜¯æ­£å¸¸çš„ã€‚ é‚£æˆ‘ä»¬æƒ³ä½¿ç”¨çº¿ç¨‹æ± æ€ä¹ˆå»åˆ›å»ºå‘¢ï¼Ÿ</p><h5 id="åˆ›å»ºçº¿ç¨‹æ± çš„æ­£ç¡®å§¿åŠ¿"><a href="#åˆ›å»ºçº¿ç¨‹æ± çš„æ­£ç¡®å§¿åŠ¿" class="headerlink" title="åˆ›å»ºçº¿ç¨‹æ± çš„æ­£ç¡®å§¿åŠ¿"></a>åˆ›å»ºçº¿ç¨‹æ± çš„æ­£ç¡®å§¿åŠ¿</h5><p>æˆ‘ä»¬ç»§ç»­å¾€å‰çœ‹newFixedThreadPoolæ˜¯æ€ä¹ˆå®ç°çš„é‚£æ®µæºç ï¼Œç»§ç»­æ•²ç¬¬ä¸‰ä¸ªå…³é”®è¯ï¼š<code>ThreadPoolExecutor</code>ï¼Œæ˜¯ç›´æ¥è¿”å›ThreadPoolExecutorå¯¹è±¡ï¼Œåˆ›å»ºåŒ…å«å„ä¸ªå­—æ®µä¿¡æ¯ï¼Œå…¶ä¸­å°±æœ‰LinkedBlockingQueueã€‚é‚£æˆ‘ä»¬èƒ½ä¸èƒ½ç›´æ¥è°ƒç”¨ThreadPoolExecutorçš„æ„é€ å‡½æ•°æ¥è‡ªå·±åˆ›å»ºçº¿ç¨‹æ± ï¼Œåœ¨åˆ›å»ºçš„åŒæ—¶ï¼Œç»™LinkedBlockingQueueæŒ‡å®šå®¹é‡å‘¢ï¼Ÿè¿™ä¸ªé—®ç­”å¿…é¡»æ˜¯Yesã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> ExecutorService executor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">200</span>, <span class="number">0L</span>, </div><div class="line">TimeUnit.MILLISECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">1024</span>));</div></pre></td></tr></table></figure><p>å¦‚ä¸Šä»£ç ç›´æ¥è°ƒç”¨ThreadPoolExecutoræ¥è‡ªå·±åˆ›å»ºçº¿ç¨‹æ± ã€‚æˆ‘ä»¬æ›¿æ¢æ‰å‰é¢å†™çš„Demoä¸­åˆ›å»ºçš„æ–¹å¼ï¼Œå¯åŠ¨è¿è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Exception in thread <span class="string">"main"</span> java.util.concurrent.RejectedExecutionException: Task org.pross.threadPool.subThreadPool@<span class="number">2e5</span>d6d97 rejected from java.util.concurrent.ThreadPoolExecutor@<span class="number">238e0</span>d81[Running, pool size = <span class="number">200</span>, active threads = <span class="number">200</span>, queued tasks = <span class="number">1024</span>, completed tasks = <span class="number">0</span>]</div><div class="line">at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:<span class="number">2063</span>)</div><div class="line">at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:<span class="number">830</span>)</div><div class="line">at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:<span class="number">1379</span>)</div><div class="line">at org.pross.threadPool.ThreadPoolExecutorDemo.main(ThreadPoolExecutorDemo.java:<span class="number">18</span>)</div></pre></td></tr></table></figure><p>ç»“æœè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå’Œä¸Šæ¬¡ä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡æ˜¯æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ï¼Œä½†æ˜¯å¼‚å¸¸ï¼ˆExceptionï¼‰æ€»æ¯”å‘ç”Ÿé”™è¯¯ï¼ˆErrorï¼‰è¦å¥½ï¼Œæ•²é»‘æ¿åˆ’ä¸€ä¸‹ç¬¬å››ä¸ªå…³é”®è¯ï¼š<code>ThreadPoolExecutor$AbortPolicy.rejectedExecution</code>ã€‚è¿™ä¸ªå…³é”®è¯ä»£è¡¨çš„ä¿¡æ¯å¾ˆç®€å•ï¼Œæ˜¯å› ä¸ºå½“å‰çº¿ç¨‹æ± ä½¿ç”¨çš„é˜Ÿåˆ—æ˜¯æœ‰è¾¹ç•Œé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å·²ç»æ»¡äº†ä¾¿æ— æ³•ç»§ç»­å¤„ç†æ–°çš„è¯·æ±‚ï¼Œæ‰€ä»¥å°±ä¼šæŠ›å‡ºrejectedExecutionï¼Œæ‰€ä»¥è¿™æ¬¡æ‰“å°è¾“å‡ºåªåˆ°<code>Thread countï¼š1224</code>ï¼Œ1224å³é˜Ÿåˆ—æœ€å¤§æ•°åŠ ä¸Šæœ€å¤§çº¿ç¨‹æ± æ•°ä¹‹å’Œã€‚</p><h4 id="çº¿ç¨‹æ± çš„å‰å› "><a href="#çº¿ç¨‹æ± çš„å‰å› " class="headerlink" title="çº¿ç¨‹æ± çš„å‰å› "></a>çº¿ç¨‹æ± çš„å‰å› </h4><p>å¦‚æœåªçœ‹ç»“æœå’Œä½¿ç”¨ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œå°±ç»“æŸäº†ã€‚å¦‚æœæˆ‘ä»¬æ·±å…¥æ€è€ƒä¸€æ­¥ï¼Œå‘ç°è¿™ä¸ªBlockingQueueé˜Ÿåˆ—ä¼¼ä¹æœ€å¼€å§‹å°±é»˜è®¤éœ€è¦äº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆéœ€è¦é˜Ÿåˆ—ï¼ŒHave you thought about itï¼Ÿè¿™ä¸ªå°±è¦é“é“çº¿ç¨‹æ± çš„å·¥ä½œåŸç†ã€‚</p><h5 id="æˆ‘ä»¬éœ€è¦äº†è§£çš„Javaçº¿ç¨‹æ± å·¥ä½œåŸç†"><a href="#æˆ‘ä»¬éœ€è¦äº†è§£çš„Javaçº¿ç¨‹æ± å·¥ä½œåŸç†" class="headerlink" title="æˆ‘ä»¬éœ€è¦äº†è§£çš„Javaçº¿ç¨‹æ± å·¥ä½œåŸç†"></a>æˆ‘ä»¬éœ€è¦äº†è§£çš„Javaçº¿ç¨‹æ± å·¥ä½œåŸç†</h5><p>çº¿ç¨‹æ± å†…çš„çº¿ç¨‹æ•°çš„å¤§å°ç›¸å…³çš„æ¦‚å¿µæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ ¸å¿ƒæ± å¤§å°ï¼ˆcorePoolSizeï¼‰ï¼Œè¿˜æœ‰æœ€å¤§çº¿ç¨‹æ± å¤§å°ï¼ˆmaximumPoolSizeï¼‰ã€‚å¦‚æœå½“å‰çš„çº¿ç¨‹ä¸ªæ•°æ¯”æ ¸å¿ƒæ± ä¸ªæ•°å°ï¼Œå½“çº¿ç¨‹ä»»åŠ¡åˆ°æ¥ï¼Œä¼šä¼˜å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å¹¶æ‰§è¡Œä»»åŠ¡ã€‚å½“å·²ç»åˆ°è¾¾æ ¸å¿ƒæ± å¤§å°ï¼Œåˆ™æŠŠä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œä¸ºäº†èµ„æºä¸è¢«è€—å°½ï¼Œé˜Ÿåˆ—çš„æœ€å¤§å®¹é‡å¯èƒ½ä¹Ÿæ˜¯æœ‰ä¸Šé™çš„ï¼Œå¦‚æœè¾¾åˆ°é˜Ÿåˆ—ä¸Šé™åˆ™è€ƒè™‘ç»§ç»­åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœæ­¤åˆ»çº¿ç¨‹çš„ä¸ªæ•°å·²ç»åˆ°è¾¾æœ€å¤§çº¿ç¨‹æ± çš„ä¸Šé™è¯ï¼Œåˆ™è€ƒè™‘æŠŠä»»åŠ¡ä¸¢å¼ƒã€‚</p><p>ç„¶åæˆ‘ä»ç½‘ä¸Šéšä¾¿æ‰¾äº†å¼ å›¾ï¼Œæ”¾åˆ°è¿™æ–¹ä¾¿ç†è§£ã€‚</p><p><img src="/archives/2018/12/22/ThreadPool.png" alt=""></p><p>æ‰€ä»¥è¿™å°±æ¯”è¾ƒæ–¹ä¾¿ç†è§£ä¸Šé¢è°ƒç”¨ThreadPoolExecutoræ¥è‡ªå·±åˆ›å»ºçº¿ç¨‹æ± ä¸­çš„ä¸€äº›å‚æ•°äº†ã€‚å½“ç„¶ï¼ŒThreadPoolExecutorçš„æ„é€ å‡½æ•°æœ‰å››ç§ï¼Œæˆ‘é€‰å–ä¸€ä¸ªå‚æ•°æœ€å®Œæ•´çš„æ„é€ æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></div><div class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> maximumPoolSize,</span></span></div><div class="line"><span class="function"><span class="params">                              <span class="keyword">long</span> keepAliveTime,</span></span></div><div class="line"><span class="function"><span class="params">                              TimeUnit unit,</span></span></div><div class="line"><span class="function"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span></div><div class="line"><span class="function"><span class="params">                              ThreadFactory threadFactory,</span></span></div><div class="line"><span class="function"><span class="params">                              RejectedExecutionHandler handler)</span></span></div></pre></td></tr></table></figure><p>é‚£ä¸€èµ·æ¥çœ‹ä¸€ä¸‹è¿™äº›å‚æ•°çš„å…·ä½“æ„æ€ã€‚</p><p><strong>corePoolSize</strong>ï¼šæ ¸å¿ƒæ± å¤§å°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨åˆåˆ›å»ºçº¿ç¨‹æ± æ—¶çº¿ç¨‹ä¸ä¼šç«‹å³å¯åŠ¨ï¼Œç›´åˆ°æœ‰ä»»åŠ¡æäº¤æ‰å¼€å§‹å¯åŠ¨çº¿ç¨‹å¹¶é€æ¸æ—¶çº¿ç¨‹æ•°ç›®è¾¾åˆ°corePoolSizeã€‚è‹¥æƒ³ä¸€å¼€å§‹å°±åˆ›å»ºæ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹éœ€è°ƒç”¨<code>prestartAllCoreThreads</code>æ–¹æ³•ã€‚</p><p><strong>maximumPoolSize</strong>ï¼šæ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å½“æ ¸å¿ƒçº¿ç¨‹æ»¡ä¸”é˜»å¡é˜Ÿåˆ—ä¹Ÿæ»¡æ—¶æ‰ä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¹¶å†³å®šæ˜¯å¦åˆ›å»ºæ–°çº¿ç¨‹ã€‚</p><p><strong>keepAliveTime</strong>ï¼šå½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒæ—¶ï¼Œå¤šäºçš„ç©ºé—²çº¿ç¨‹æœ€å¤šå­˜æ´»æ—¶é—´ã€‚</p><p><strong>unit</strong> ï¼škeepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚</p><p><strong>workQueue</strong> ï¼šå½“çº¿ç¨‹æ•°ç›®è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ç”¨äºä¿å­˜ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚ä¸»è¦æœ‰3ç§ç±»å‹çš„BlockingQueueå¯ä¾›é€‰æ‹©ï¼šæ— ç•Œé˜Ÿåˆ—ï¼Œæœ‰ç•Œé˜Ÿåˆ—å’ŒåŒæ­¥ç§»äº¤ã€‚ï¼ˆé‡è¦ï¼‰</p><p><strong>threadFactory</strong> ï¼šæ‰§è¡Œç¨‹åºåˆ›å»ºæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚ã€‚</p><p><strong>handler</strong> ï¼šé˜»å¡é˜Ÿåˆ—å·²æ»¡ä¸”çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§å€¼æ—¶æ‰€é‡‡å–çš„é¥±å’Œç­–ç•¥ã€‚javaé»˜è®¤æä¾›äº†4ç§é¥±å’Œç­–ç•¥çš„å®ç°æ–¹å¼ï¼šä¸­æ­¢ã€æŠ›å¼ƒã€æŠ›å¼ƒæœ€æ—§çš„ã€è°ƒç”¨è€…è¿è¡Œã€‚å°†åœ¨ä¸‹æ–‡ä¸­è¯¦ç»†é˜è¿°ã€‚ï¼ˆé‡è¦ï¼‰</p><p>æˆ‘ä»¬é€‰å–æ¯”è¾ƒå¤æ‚å’Œé‡è¦çš„ä¸¤ä¸ªå‚æ•°æ¥ä»‹ç»ä¸€ä¸‹ã€‚ï¼ˆæˆ‘ä¹Ÿæ˜¯ç¿»é˜…çš„èµ„æ–™ï¼‰</p><h5 id="é˜»å¡é˜Ÿåˆ—BlockingQueue"><a href="#é˜»å¡é˜Ÿåˆ—BlockingQueue" class="headerlink" title="é˜»å¡é˜Ÿåˆ—BlockingQueue"></a>é˜»å¡é˜Ÿåˆ—BlockingQueue</h5><p>å¦‚æœè¿è¡Œçš„çº¿ç¨‹å°‘äºcorePoolSizeï¼Œåˆ™Executorä¼šé¦–å…ˆæ·»åŠ æ–°çš„çº¿ç¨‹ç›´æ¥å»è¿è¡Œï¼Œä¸ä¼šè¿›å…¥BlockingQueueæ’é˜Ÿç­‰å€™ï¼›å¦‚æœè¿è¡Œçš„çº¿ç¨‹å¤§äºç­‰äºcorePoolSizeï¼Œåˆ™Executorå°±ä¼šå°†æ–°ä»»åŠ¡è¯·æ±‚åŠ å…¥BlockingQueueæ’é˜Ÿç­‰å€™ã€‚è€ŒBlockingQueueä¸»è¦æœ‰ä¸‰ç§ç±»å‹ï¼š<code>æ— ç•Œé˜Ÿåˆ—</code>ï¼Œ<code>æœ‰ç•Œé˜Ÿåˆ—</code>ï¼Œ<code>åŒæ­¥ç§»äº¤é˜Ÿåˆ—</code>ã€‚</p><p><strong>æ— ç•Œé˜Ÿåˆ—</strong></p><p>é˜Ÿåˆ—çš„å¤§å°æ— é™åˆ¶ï¼Œå°±æ˜¯å‰é¢æåˆ°è¿‡ä¸æŒ‡å®šå®¹é‡é»˜è®¤ä½¿ç”¨çš„LinkedBlockingQueueï¼Œå¦‚æœä¸æŒ‡å®šå®¹é‡å¤§å°çš„è¯ï¼Œå½“ä»»åŠ¡çº¿ç¨‹æ± ä¸­è€—æ—¶è¾ƒé•¿å°±ä¼šå¯¼è‡´å¤§é‡æ–°ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­å †ç§¯å¯¼è‡´OOMã€‚</p><p><strong>æœ‰ç•Œé˜Ÿåˆ—</strong></p><p>æœ‰ç•Œé˜Ÿåˆ—ä¹Ÿå­˜åœ¨ä¸¤ç±»ï¼šéµå¾ªFIFOåŸåˆ™çš„é˜Ÿåˆ—ï¼ˆArrayBlockingQueueï¼ŒLinkedBlockingQueueï¼‰å’Œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆPriorityBlockingQueueï¼‰ï¼Œä¼˜å…ˆçº§ç”±ä»»åŠ¡çš„Comparatorå†³å®šã€‚ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—æ—¶é˜Ÿåˆ—å¤§å°éœ€è¦å’Œçº¿ç¨‹æ± å¤§å°ç›¸é…åˆï¼Œçº¿ç¨‹æ± è¾ƒå°ï¼Œæœ‰ç•Œé˜Ÿåˆ—è¾ƒå¤§æ—¶å¯ä»¥å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œé™ä½CPUä½¿ç”¨ç‡ï¼Œä½†æ˜¯ä¼šé™åˆ¶QPSã€‚</p><p><strong>åŒæ­¥ç§»äº¤é˜Ÿåˆ—</strong></p><p>å¦‚æœä¸å¸Œæœ›ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…è€Œæ˜¯å¸Œæœ›å°†ä»»åŠ¡ç›´æ¥ç§»äº¤ç»™å·¥ä½œçº¿ç¨‹ï¼Œå¯ä½¿ç”¨<code>SynchronousQueue</code>ä½œä¸ºç­‰å¾…é˜Ÿåˆ—ã€‚SynchronousQueueä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯ä¸€ç§çº¿ç¨‹ä¹‹é—´ç§»äº¤çš„æœºåˆ¶ã€‚è¦å°†ä¸€ä¸ªå…ƒç´ æ”¾å…¥SynchronousQueueä¸­ï¼Œå¿…é¡»æœ‰å¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…æ¥æ”¶è¿™ä¸ªå…ƒç´ ã€‚åªæœ‰åœ¨ä½¿ç”¨æ— ç•Œçº¿ç¨‹æ± æˆ–è€…æœ‰é¥±å’Œç­–ç•¥æ—¶æ‰å»ºè®®ä½¿ç”¨è¯¥é˜Ÿåˆ—ã€‚</p><h5 id="é¥±å’Œç­–ç•¥RejectedExecutionHandler"><a href="#é¥±å’Œç­–ç•¥RejectedExecutionHandler" class="headerlink" title="é¥±å’Œç­–ç•¥RejectedExecutionHandler"></a>é¥±å’Œç­–ç•¥RejectedExecutionHandler</h5><p>JDKæä¾›å››ç§é¥±å’Œç­–ç•¥ï¼Œéƒ½ä½œä¸ºé™æ€å†…éƒ¨ç±»åœ¨ThreadPoolExcutorä¸­è¿›è¡Œå®ç°ã€‚</p><p><strong>AbortPolicyç»ˆæ­¢ç­–ç•¥</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AbortPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="title">AbortPolicy</span><span class="params">()</span> </span>&#123; &#125;</div><div class="line">     <span class="comment">/**</span></div><div class="line"><span class="comment">      * Always throws RejectedExecutionException.</span></div><div class="line"><span class="comment">      *</span></div><div class="line"><span class="comment">      * <span class="doctag">@param</span> r the runnable task requested to be executed</span></div><div class="line"><span class="comment">      * <span class="doctag">@param</span> e the executor attempting to execute this task</span></div><div class="line"><span class="comment">      * <span class="doctag">@throws</span> RejectedExecutionException always</span></div><div class="line"><span class="comment">      */</span></div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> RejectedExecutionException(<span class="string">"Task "</span> + r.toString() +</div><div class="line">                                              <span class="string">" rejected from "</span> +</div><div class="line">                                              e.toString());</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure><p>é€šè¿‡ä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¯¥ç­–ç•¥æ˜¯é»˜è®¤é¥±å’Œç­–ç•¥ã€‚ä½¿ç”¨è¯¥ç­–ç•¥æ—¶åœ¨é¥±å’Œæ—¶ä¼šæŠ›å‡ºRejectedExecutionExceptionï¼ˆç»§æ‰¿è‡ªRuntimeExceptionï¼‰ï¼Œè°ƒç”¨è€…å¯æ•è·è¯¥å¼‚å¸¸è‡ªè¡Œå¤„ç†ã€‚</p><p><strong>DiscardPolicyæŠ›å¼ƒç­–ç•¥</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DiscardPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DiscardPolicy</span><span class="params">()</span> </span>&#123; &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Does nothing, which has the effect of discarding task r.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> r the runnable task requested to be executed</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> e the executor attempting to execute this task</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä¸ä½œä»»ä½•å¤„ç†ï¼Œç›¸å½“äºç›´æ¥æŠ›å¼ƒä»»åŠ¡ã€‚</p><p><strong>DiscardOldestPolicyæŠ›å¼ƒæ—§ä»»åŠ¡ç­–ç•¥</strong></p><p>å¦‚ä»£ç ï¼Œå…ˆå°†é˜»å¡é˜Ÿåˆ—ä¸­çš„å¤´å…ƒç´ å‡ºé˜ŸæŠ›å¼ƒï¼ˆpollï¼‰ï¼Œå†å°è¯•æäº¤ä»»åŠ¡ï¼ˆexecuteï¼‰ã€‚å¦‚æœæ­¤æ—¶é˜»å¡é˜Ÿåˆ—ä½¿ç”¨PriorityBlockingQueueä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå°†ä¼šå¯¼è‡´ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡è¢«æŠ›å¼ƒï¼Œå› æ­¤ä¸å»ºè®®å°†è¯¥ç§ç­–ç•¥é…åˆä¼˜å…ˆçº§é˜Ÿåˆ—ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DiscardOldestPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DiscardOldestPolicy</span><span class="params">()</span> </span>&#123; &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Obtains and ignores the next task that the executor</span></div><div class="line"><span class="comment">     * would otherwise execute, if one is immediately available,</span></div><div class="line"><span class="comment">     * and then retries execution of task r, unless the executor</span></div><div class="line"><span class="comment">     * is shut down, in which case task r is instead discarded.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> r the runnable task requested to be executed</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> e the executor attempting to execute this task</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!e.isShutdown()) &#123;</div><div class="line">            e.getQueue().poll();</div><div class="line">            e.execute(r);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>CallerRunsPolicyè°ƒç”¨è€…è¿è¡Œç­–ç•¥</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CallerRunsPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CallerRunsPolicy</span><span class="params">()</span> </span>&#123; &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Executes task r in the caller's thread, unless the executor</span></div><div class="line"><span class="comment">     * has been shut down, in which case the task is discarded.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> r the runnable task requested to be executed</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> e the executor attempting to execute this task</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!e.isShutdown()) &#123;</div><div class="line">            r.run();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ—¢ä¸æŠ›å¼ƒä»»åŠ¡ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥è¿è¡Œä»»åŠ¡çš„runæ–¹æ³•ï¼Œæ¢è¨€ä¹‹å°†ä»»åŠ¡å›é€€ç»™è°ƒç”¨è€…æ¥ç›´æ¥è¿è¡Œã€‚ä½¿ç”¨è¯¥ç­–ç•¥æ—¶çº¿ç¨‹æ± é¥±å’Œåå°†ç”±è°ƒç”¨çº¿ç¨‹æ± çš„ä¸»çº¿ç¨‹è‡ªå·±æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå› æ­¤åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿™æ®µæ—¶é—´é‡Œä¸»çº¿ç¨‹æ— æ³•å†æäº¤æ–°ä»»åŠ¡ï¼Œä»è€Œä½¿çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹æœ‰æ—¶é—´å°†æ­£åœ¨å¤„ç†çš„ä»»åŠ¡å¤„ç†å®Œæˆã€‚</p><p>Javaçº¿ç¨‹æ± å°±ä»‹ç»åˆ°è¿™é‡Œã€‚</p><p>å®Œã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;è™½ç„¶ä¹‹å‰å­¦ä¹ äº†ä¸å°‘ç›¸å…³çŸ¥è¯†ï¼Œä½†æ˜¯åªæœ‰åœ¨å®è·µä¸­è¸©å‘æ‰èƒ½å°è±¡æ·±åˆ»ã€‚ä»Šå¤©çœ‹äº†åŠå¤©çš„javaå¯¹çº¿ç¨‹æ± çš„å¤„ç†ï¼Œé¢å¤–å…´è‡´æ¥ï¼Œå‘¨äº”æ€»ç»“ä¸€ä»½javaçº¿ç¨‹æ± ç›¸å…³ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Java" scheme="https://pross.space/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>å¤§Oè¡¨ç¤ºæ³•</title>
    <link href="https://pross.space/archives/2018/12/16/"/>
    <id>https://pross.space/archives/2018/12/16/</id>
    <published>2018-12-16T14:44:52.000Z</published>
    <updated>2019-07-10T16:29:16.004Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>å‰é¢æœ‰ä¸¤ç¯‡æ€»ç»“äº†æ’åºç®—æ³•ï¼Œæœ€è¿‘åˆšå¥½åœ¨çœ‹ã€Šç®—æ³•å›¾è§£ã€‹ï¼Œæƒ³ç”±è¡¨åŠé‡Œæ•´ç†ä¸€ä»½ç®—æ³•ç³»åˆ—ã€‚æ¯æ¬¡ä»‹ç»ç®—æ³•æ—¶ï¼Œéƒ½ä¼šè®¨è®ºå…¶è¿è¡Œæ—¶é—´ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œåº”é€‰æ‹©æ•ˆç‡æœ€é«˜çš„ç®—æ³•ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘è¿è¡Œæ—¶é—´æˆ–å ç”¨ç©ºé—´ã€‚é‚£æ€ä¹ˆè¡¨ç¤ºç®—æ³•çš„é€Ÿåº¦å‘¢ï¼Œä»Šå¤©æ¥äº†è§£ä¸€ä¸‹ï¼šå¤§Oè¡¨ç¤ºæ³•ã€‚</p><a id="more"></a><h5 id="ç†è§£å¤§Oè¡¨ç¤ºæ³•"><a href="#ç†è§£å¤§Oè¡¨ç¤ºæ³•" class="headerlink" title="ç†è§£å¤§Oè¡¨ç¤ºæ³•"></a>ç†è§£å¤§Oè¡¨ç¤ºæ³•</h5><p>å¤§Oè¡¨ç¤ºæ³•æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¡¨ç¤ºæ³•ï¼ŒæŒ‡å‡ºäº†ç®—æ³•çš„é€Ÿåº¦æœ‰å¤šå¿«ã€‚æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾åˆ—è¡¨åŒ…å«nä¸ªå…ƒç´ ï¼Œç®€å•çš„æŸ¥è¯¢éœ€è¦æ£€æŸ¥æ¯ä¸ªå…ƒç´ ï¼Œå› æ­¤éœ€è¦æ‰§è¡Œnæ¬¡æ“ä½œã€‚ä½¿ç”¨å¤§Oè¡¨ç¤ºæ³•ï¼Œè¿™ä¸ªè¿è¡Œæ—¶é—´ä¸ºï¼šO(n)ã€‚å•ä½ï¼Ÿæ²¡æœ‰ï¼Œå¤§Oè¡¨ç¤ºæ³•æŒ‡çš„æ˜¯ç®—æ³•è¿è¡Œæ—¶é—´çš„å¢é€Ÿï¼Œä¸éœ€è¦å•ä½æ¥æè¿°ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼šä¸ºæ£€æŸ¥é•¿åº¦ä¸ºnçš„åˆ—è¡¨å…ƒç´ ï¼Œæˆ‘ä»¬æ¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œéœ€è¦æ‰§è¡Œ(log n)æ¬¡æ“ä½œã€‚é‚£ä¹ˆä½¿ç”¨å¤§Oè¡¨ç¤ºæ³•ï¼Œè¿™ä¸ªè¿è¡Œæ—¶é—´ä¸ºï¼šO(log n)ï¼Œè¿™æŒ‡å‡ºäº†ç®—æ³•éœ€è¦æ‰§è¡Œçš„æ“ä½œæ•°ã€‚</p><h5 id="å¤§Oè¡¨ç¤ºæ³•æŒ‡å‡ºæœ€ç³Ÿç³•æƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´"><a href="#å¤§Oè¡¨ç¤ºæ³•æŒ‡å‡ºæœ€ç³Ÿç³•æƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´" class="headerlink" title="å¤§Oè¡¨ç¤ºæ³•æŒ‡å‡ºæœ€ç³Ÿç³•æƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´"></a>å¤§Oè¡¨ç¤ºæ³•æŒ‡å‡ºæœ€ç³Ÿç³•æƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´</h5><p>åˆä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚ä½¿ç”¨ç®€å•æŸ¥æ‰¾çš„æ–¹æ³•ï¼Œä¸Šé¢è¯´è¿‡ï¼Œç®€å•æŸ¥æ‰¾çš„è¿è¡Œæ—¶é—´ä¸ºO(n)ï¼Œè¿™æ„å‘³ç€åœ¨æœ€ç³Ÿçš„æƒ…å†µä¸‹ï¼Œå¿…é¡»æŸ¥çœ‹æ¯ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæˆ‘ä»¬è¦æ‰¾åˆ°1024è¿™ä¸ªæ•°å­—ï¼Œåˆšå¥½ç¬¬ä¸€ä¸ªæ•°å­—å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼Œé‚£è¿™ç§ç®—æ³•çš„è¿è¡Œæ—¶é—´æ˜¯O(n)è¿˜æ˜¯O(1)å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼Œç®€å•æŸ¥æ‰¾çš„è¿è¡Œæ—¶é—´æ€»æ˜¯ä¸ºO(n)ï¼ŒæŸ¥æ‰¾1024å…ƒç´ æ—¶ï¼Œä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œè¿™æ˜¯æœ€ä½³çš„æƒ…å†µï¼Œä½†å¤§Oè¡¨ç¤ºæ³•è¡¨ç¤ºçš„æ˜¯æœ€ç³Ÿçš„æƒ…å½¢ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·è¯´ï¼šç®€å•æŸ¥æ‰¾çš„è¿è¡Œæ—¶é—´ä¸å¯èƒ½è¶…è¿‡O(n)ã€‚</p><blockquote><p>é™¤äº†æœ€ç³Ÿçš„æƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´ï¼Œæˆ‘ä»¬è¿˜å¾—è€ƒè™‘å¹³å‡æƒ…å†µçš„è¿è¡Œæ—¶é—´ã€‚</p></blockquote><h4 id="ä¸€äº›å¸¸è§çš„å¤§Oçš„è¿è¡Œæ—¶é—´"><a href="#ä¸€äº›å¸¸è§çš„å¤§Oçš„è¿è¡Œæ—¶é—´" class="headerlink" title="ä¸€äº›å¸¸è§çš„å¤§Oçš„è¿è¡Œæ—¶é—´"></a>ä¸€äº›å¸¸è§çš„å¤§Oçš„è¿è¡Œæ—¶é—´</h4><ul><li>O(log n)ï¼Œä¹Ÿå«<code>å¯¹æ•°æ—¶é—´</code>ï¼Œè¿™æ ·çš„ç®—æ³•åŒ…æ‹¬äºŒåˆ†æŸ¥æ‰¾ã€‚</li><li>O(n)ï¼Œä¹Ÿå«<code>çº¿æ€§æ—¶é—´</code>ï¼Œè¿™æ ·çš„ç®—æ³•åŒ…æ‹¬ç®€å•æŸ¥æ‰¾ã€‚</li><li>O(n * log n)ï¼Œè¿™æ ·çš„ç®—æ³•åŒ…æ‹¬å¿«é€Ÿæ’åºã€‚</li><li>O(n^2)ï¼Œè¿™æ ·çš„ç®—æ³•åŒ…æ‹¬é€‰æ‹©æ’åºã€‚</li><li>O(n!)ï¼Œè¿™æ ·çš„ç®—æ³•åŒ…æ‹¬æ—…è¡Œå•†é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯æˆ‘å³å°†å­¦ä¹ çš„ã€‚</li><li>â€¦â€¦</li></ul><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>å½“ç„¶äº†ï¼Œæˆ‘ä»¬åœ¨å‰é¢æ˜¯å°†å¤§Oè¿è¡Œæ—¶é—´è¡¨ç¤ºè½¬æ¢ä¸ºæ“ä½œæ•°æ¥ç†è§£ï¼Œæˆ‘ä»¬å°ç»“ä¸€ä¸‹ï¼š</p><ul><li>ç®—æ³•çš„é€Ÿåº¦æŒ‡çš„å¹¶éæ—¶é—´ï¼Œè€Œæ˜¯æ“ä½œæ•°çš„å¢é€Ÿã€‚</li><li>è°ˆè®ºç®—æ³•çš„é€Ÿåº¦æ—¶ï¼Œæˆ‘ä»¬è¯´çš„æ˜¯éšç€è¾“å…¥çš„å¢åŠ ï¼Œå…¶è¿è¡Œæ—¶é—´å°†ä»¥ä»€ä¹ˆæ ·çš„é€Ÿåº¦å¢åŠ ã€‚</li><li>ç®—æ³•çš„è¿è¡Œæ—¶é—´ç”¨æ³•å¤§Oè¡¨ç¤ºæ³•è¡¨ç¤ºã€‚</li></ul><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;å‰é¢æœ‰ä¸¤ç¯‡æ€»ç»“äº†æ’åºç®—æ³•ï¼Œæœ€è¿‘åˆšå¥½åœ¨çœ‹ã€Šç®—æ³•å›¾è§£ã€‹ï¼Œæƒ³ç”±è¡¨åŠé‡Œæ•´ç†ä¸€ä»½ç®—æ³•ç³»åˆ—ã€‚æ¯æ¬¡ä»‹ç»ç®—æ³•æ—¶ï¼Œéƒ½ä¼šè®¨è®ºå…¶è¿è¡Œæ—¶é—´ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œåº”é€‰æ‹©æ•ˆç‡æœ€é«˜çš„ç®—æ³•ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘è¿è¡Œæ—¶é—´æˆ–å ç”¨ç©ºé—´ã€‚é‚£æ€ä¹ˆè¡¨ç¤ºç®—æ³•çš„é€Ÿåº¦å‘¢ï¼Œä»Šå¤©æ¥äº†è§£ä¸€ä¸‹ï¼šå¤§Oè¡¨ç¤ºæ³•ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æ•°æ®ç»“æ„" scheme="https://pross.space/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>ä½ æ‰€å¿½è§†çš„æ’åºç®—æ³•ï¼ˆä¸‹ï¼‰</title>
    <link href="https://pross.space/archives/2018/11/11/"/>
    <id>https://pross.space/archives/2018/11/11/</id>
    <published>2018-11-11T10:13:16.000Z</published>
    <updated>2019-07-10T16:29:24.236Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>ä½ æ‰€ä¸çŸ¥é“çš„æ’åºç®—æ³•ä¸‹ç¯‡æ›´æ–°å•¦ï¼Œç›¸æ¯”äºä¸Šç¯‡ä»‹ç»çš„ï¼Œä¸‹ç¯‡çš„å‡ ç§æ’åºç®—æ³•ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå°‘è§ã€‚æœ€è¿‘ä¹ŸèŠ±äº†ä¸€ç‚¹æ—¶é—´æ¥ç†è§£ã€‚è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬è¿›å…¥æ­£æ–‡ã€‚</p><p>ä»Šå¤©å‡ºåœºçš„æ˜¯ï¼šå¿«é€Ÿæ’åºï¼Œå †æ’åºï¼Œè®¡æ•°æ’åºï¼Œæ¡¶æ’åºã€‚</p><a id="more"></a><h4 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h4><p>å¿«é€Ÿæ’åºï¼ˆQuicksortï¼‰ï¼Œåˆç§°åˆ’åˆ†äº¤æ¢æ’åºï¼ˆpartition-exchange sortï¼‰ï¼Œç®€ç§°<strong>å¿«æ’</strong>ã€‚æœ€æ—©æ˜¯ç”±ä¸œå°¼Â·éœå°”æå‡ºæ¥ã€‚å¿«é€Ÿæ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ä½¿ç”¨<a href="https://zh.wikipedia.org/wiki/%E5%88%86%E6%B2%BB%E6%B3%95" target="_blank" rel="external">åˆ†æ²»æ³•</a>ï¼ˆDivide and conquerï¼‰ç­–ç•¥æ¥æŠŠä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E5%BA%8F%E5%88%97" target="_blank" rel="external">åºåˆ—</a>ï¼ˆlistï¼‰åˆ†ä¸ºä¸¤ä¸ªå­åºåˆ—ï¼ˆsub-listsï¼‰ã€‚å…¶ä¸­ä¸€ä¸ªåºåˆ—å…³é”®å­—å‡æ¯”å¦ä¸€ä¸ªåºåˆ—å…³é”®å­—å°ï¼Œåˆ™å¯åˆ†åˆ«å¯¹è¿™ä¸¤ä¸ªå­åºåˆ—ç»§ç»­è¿›è¡Œæ’åºï¼Œå·²è¾¾åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚</p><h5 id="é€»è¾‘æè¿°"><a href="#é€»è¾‘æè¿°" class="headerlink" title="é€»è¾‘æè¿°"></a>é€»è¾‘æè¿°</h5><ul><li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸ºâ€œåŸºå‡†â€ï¼ˆpivotï¼‰</li><li>é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰æ¯”åŸºå‡†å€¼å°çš„å…ƒç´ æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰æ¯”åŸºå‡†å€¼å¤§çš„å…ƒç´ æ‘†åœ¨åŸºå‡†åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä½•ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†å‰²ç»“æŸä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸º<strong>åˆ†å‰²ï¼ˆpartitionï¼‰</strong>æ“ä½œã€‚</li><li><a href="https://zh.wikipedia.org/wiki/%E9%80%92%E5%BD%92" target="_blank" rel="external">é€’å½’</a>åœ°ï¼ˆrecursivelyï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åº</li></ul><p>é€’å½’åˆ°æœ€åº•éƒ¨æ—¶ï¼Œæ•°åˆ—çš„å¤§å°æ˜¯é›¶æˆ–ä¸€ï¼Œä¹Ÿå°±æ˜¯å·²ç»æ’åºå¥½äº†ã€‚è¿™ä¸ªç®—æ³•ä¸€å®šä¼šç»“æŸï¼Œå› ä¸ºåœ¨æ¯æ¬¡çš„è¿­ä»£ï¼ˆiterationï¼‰ä¸­ï¼Œå®ƒè‡³å°‘ä¼šæŠŠä¸€ä¸ªå…ƒç´ æ‘†åˆ°å®ƒæœ€åçš„ä½ç½®å»ã€‚</p><h5 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> head, <span class="keyword">int</span> tail)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (head &gt;= tail || arr == <span class="keyword">null</span> || arr.length &lt;= <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> i = head, j = tail;</div><div class="line">    <span class="keyword">int</span> pivot = arr[(head + tail) / <span class="number">2</span>];</div><div class="line">        <span class="keyword">while</span> (i &lt;= j) &#123;</div><div class="line">            <span class="keyword">while</span> (arr[i] &lt; pivot) &#123;</div><div class="line">                ++i;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">while</span> (arr[j] &gt; pivot) &#123;</div><div class="line">                --j;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (i &lt; j) &#123;</div><div class="line">                <span class="keyword">int</span> t = arr[i];</div><div class="line">                arr[i] = arr[j];</div><div class="line">                arr[j] = t;</div><div class="line">                ++i;</div><div class="line">                --j;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == j) &#123;</div><div class="line">                ++i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        quickSort(arr, head, j);</div><div class="line">        quickSort(arr, i, tail);</div><div class="line">    &#125;</div></pre></td></tr></table></figure><h4 id="ç®—æ³•åˆ†æ"><a href="#ç®—æ³•åˆ†æ" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h4><p>å¿«é€Ÿæ’åºæ˜¯<a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91" target="_blank" rel="external">äºŒå‰æŸ¥æ‰¾æ ‘</a>ï¼ˆäºŒå‰æœç´¢æ ‘ï¼‰çš„ä¸€ä¸ªç©ºé—´æœ€ä¼˜åŒ–ç‰ˆæœ¬ã€‚ä¸æ˜¯å¾ªåºåœ°æŠŠæ•°æ®é¡¹æ’å…¥åˆ°ä¸€ä¸ªæ˜ç¡®çš„æ ‘ä¸­ï¼Œè€Œæ˜¯ç”±å¿«é€Ÿæ’åºç»„ç»‡è¿™äº›æ•°æ®é¡¹åˆ°ä¸€ä¸ªç”±é€’å½’è°ƒç”¨æ‰€éšå«çš„æ ‘ä¸­ã€‚å¿«é€Ÿæ’åºçš„æœ€ç›´æ¥ç«äº‰è€…æ˜¯<a href="https://zh.wikipedia.org/wiki/%E5%A0%86%E6%8E%92%E5%BA%8F" target="_blank" rel="external">å †æ’åº</a>ï¼ˆHeapsortï¼‰ã€‚å †æ’åºæ¯”å¿«é€Ÿæ’åºç¨å¾®æ…¢ï¼Œä½†æ˜¯æœ€åæƒ…å†µçš„è¿è¡Œæ—¶é—´æ€»æ˜¯<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/9d2320768fb54880ca4356e61f60eb02a3f9d9f1" alt="{\displaystyle O(n\log n)}"></p><h4 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h4><p>å †æ’åºï¼ˆHeapsortï¼‰æ˜¯æŒ‡åˆ©ç”¨<a href="https://zh.wikipedia.org/wiki/%E5%A0%86_(%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" target="_blank" rel="external">å †</a>)è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †æ˜¯ä¸€ä¸ªè¿‘ä¼¼<a href="https://zh.wikipedia.org/wiki/%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91" target="_blank" rel="external">å®Œå…¨äºŒå‰æ ‘</a>çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­èŠ‚ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚</p><p>è¿™é‡Œå¤šä¸€å¥å˜´æ¥å¸®åŠ©ç†è§£ä¸€ä¸‹å †æœ‰å…³çš„æ“ä½œã€‚</p><p>å †èŠ‚ç‚¹çš„è®¿é—®ï¼šé€šå¸¸å †æ˜¯é€šè¿‡ä¸€ç»´æ•°ç»„æ¥å®ç°çš„ï¼Œåœ¨æ•°ç»„èµ·å§‹ä½ç½®ä¸º0çš„æƒ…å†µä¸‹ï¼š</p><ul><li>çˆ¶èŠ‚ç‚¹içš„å·¦å­èŠ‚ç‚¹åœ¨ä½ç½®2i+1ï¼›</li><li>çˆ¶èŠ‚ç‚¹içš„å³å­èŠ‚ç‚¹åœ¨ä½ç½®2i+2ï¼›</li><li>å­èŠ‚ç‚¹içš„çˆ¶èŠ‚ç‚¹åœ¨ä½ç½®floor((i-1)/2)ï¼›</li></ul><p>å †çš„æ“ä½œï¼šåœ¨å †çš„æ•°æ®ç»“æ„ä¸­ï¼Œå †ä¸­çš„æœ€å¤§å€¼æ€»æ˜¯ä½äºæ ¹èŠ‚ç‚¹ï¼ˆåœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­ä½¿ç”¨å †çš„è¯ï¼Œé˜Ÿä¸­çš„æœ€å°å€¼ä½äºæ ¹èŠ‚ç‚¹ï¼‰ã€‚å †ä¸­å®šä¹‰ä¸€ä¸‹å‡ ç§æ“ä½œï¼š</p><ul><li>æœ€å¤§å †è°ƒæ•´ï¼ˆMax Heapifyï¼‰ï¼šå°†å †çš„æœ«ç«¯å­èŠ‚ç‚¹ä½œè°ƒæ•´ï¼Œä½¿å¾—å­èŠ‚ç‚¹æ°¸è¿œå°äºçˆ¶èŠ‚ç‚¹</li><li>åˆ›å»ºæœ€å¤§å †ï¼ˆBuild Max Heapï¼‰ï¼šå°†å †ä¸­çš„æ‰€æœ‰æ•°æ®é‡æ–°æ’åº</li><li>å †æ’åºï¼ˆHeap Sortï¼‰ï¼šç§»é™¤ä½åœ¨ç¬¬ä¸€ä¸ªæ•°æ®çš„æ ¹èŠ‚ç‚¹ï¼Œå¹¶åšæœ€å¤§å †è°ƒæ•´çš„é€’å½’è¿ç®—</li></ul><h5 id="é€»è¾‘æè¿°-1"><a href="#é€»è¾‘æè¿°-1" class="headerlink" title="é€»è¾‘æè¿°"></a>é€»è¾‘æè¿°</h5><ul><li>å°†åˆå§‹å¾…æ’åºå…³é”®å­—åºåˆ—(R1,R2â€¦.Rn)æ„å»ºæˆå¤§é¡¶å †ï¼Œæ­¤å †ä¸ºåˆå§‹çš„æ— åºåŒº</li><li>å°†å †é¡¶å…ƒç´ R[1]ä¸æœ€åä¸€ä¸ªå…ƒç´ R[n]äº¤æ¢ï¼Œæ­¤æ—¶å¾—åˆ°æ–°çš„æ— åºåŒº(R1,R2,â€¦â€¦Rn-1)å’Œæ–°çš„æœ‰åºåŒº(Rn),ä¸”æ»¡è¶³R[1,2â€¦n-1]&lt;=r[n]</li><li>ç”±äºäº¤æ¢åæ–°çš„å †é¡¶R[1]å¯èƒ½è¿åå †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦å¯¹å½“å‰æ— åºåŒº(R1,R2,â€¦â€¦Rn-1)è°ƒæ•´ä¸ºæ–°å †ï¼Œç„¶åå†æ¬¡å°†R[1]ä¸æ— åºåŒºæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œå¾—åˆ°æ–°çš„æ— åºåŒº(R1,R2â€¦.Rn-2)å’Œæ–°çš„æœ‰åºåŒº(Rn-1,Rn)ã€‚ä¸æ–­é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°æœ‰åºåŒºçš„å…ƒç´ ä¸ªæ•°ä¸ºn-1ï¼Œåˆ™æ•´ä¸ªæ’åºè¿‡ç¨‹å®Œæˆ</li></ul><h5 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.pross.sort;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Arrays;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Author: shawn pross</span></div><div class="line"><span class="comment"> * Date: 2018/11/9</span></div><div class="line"><span class="comment"> * Description: å †æ’åº</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSort</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span>[] arr;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">HeapSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span></span>&#123;</div><div class="line">            <span class="keyword">this</span>.arr = arr;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span></span>&#123;</div><div class="line">            <span class="comment">/**</span></div><div class="line"><span class="comment">             *  ç¬¬ä¸€æ­¥ï¼šå°†æ•°ç»„å †åŒ–</span></div><div class="line"><span class="comment">             *  beginIndex = ç¬¬ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ã€‚</span></div><div class="line"><span class="comment">             *  ä»ç¬¬ä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹å³å¯ã€‚æ— éœ€ä»æœ€åä¸€ä¸ªå¶å­èŠ‚ç‚¹å¼€å§‹ã€‚</span></div><div class="line"><span class="comment">             *  å¶å­èŠ‚ç‚¹å¯ä»¥çœ‹ä½œå·²ç¬¦åˆå †è¦æ±‚çš„èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹å°±æ˜¯å®ƒè‡ªå·±ä¸”è‡ªå·±ä»¥ä¸‹å€¼ä¸ºæœ€å¤§ã€‚</span></div><div class="line"><span class="comment">             */</span></div><div class="line">            <span class="keyword">int</span> len = arr.length - <span class="number">1</span>;</div><div class="line">            <span class="keyword">int</span> beginIndex = (len - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = beginIndex; i &gt;= <span class="number">0</span>; i--)&#123;</div><div class="line">                maxHeapify(i, len);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">/**</span></div><div class="line"><span class="comment">             * ç¬¬äºŒæ­¥ï¼šå¯¹å †åŒ–æ•°æ®æ’åº</span></div><div class="line"><span class="comment">             * æ¯æ¬¡éƒ½æ˜¯ç§»å‡ºæœ€é¡¶å±‚çš„æ ¹èŠ‚ç‚¹A[0]ï¼Œä¸æœ€å°¾éƒ¨èŠ‚ç‚¹ä½ç½®è°ƒæ¢ï¼ŒåŒæ—¶éå†é•¿åº¦ - 1ã€‚</span></div><div class="line"><span class="comment">             * ç„¶åä»æ–°æ•´ç†è¢«æ¢åˆ°æ ¹èŠ‚ç‚¹çš„æœ«å°¾å…ƒç´ ï¼Œä½¿å…¶ç¬¦åˆå †çš„ç‰¹æ€§ã€‚</span></div><div class="line"><span class="comment">             * ç›´è‡³æœªæ’åºçš„å †é•¿åº¦ä¸º 0ã€‚</span></div><div class="line"><span class="comment">             */</span></div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = len; i &gt; <span class="number">0</span>; i--)&#123;</div><div class="line">                swap(<span class="number">0</span>, i);</div><div class="line">                maxHeapify(<span class="number">0</span>, i - <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</div><div class="line">            <span class="keyword">int</span> temp = arr[i];</div><div class="line">            arr[i] = arr[j];</div><div class="line">            arr[j] = temp;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**å †è°ƒæ•´</span></div><div class="line"><span class="comment">         * è°ƒæ•´ç´¢å¼•ä¸º index å¤„çš„æ•°æ®ï¼Œä½¿å…¶ç¬¦åˆå †çš„ç‰¹æ€§ã€‚</span></div><div class="line"><span class="comment">         * <span class="doctag">@param</span> index éœ€è¦å †åŒ–å¤„ç†çš„æ•°æ®çš„ç´¢å¼•</span></div><div class="line"><span class="comment">         * <span class="doctag">@param</span> len æœªæ’åºçš„å †ï¼ˆæ•°ç»„ï¼‰çš„é•¿åº¦</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">maxHeapify</span><span class="params">(<span class="keyword">int</span> index,<span class="keyword">int</span> len)</span></span>&#123;</div><div class="line">            <span class="comment">// å·¦å­èŠ‚ç‚¹ç´¢å¼•</span></div><div class="line">            <span class="keyword">int</span> li = (index &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>;</div><div class="line">            <span class="comment">// å³å­èŠ‚ç‚¹ç´¢å¼•</span></div><div class="line">            <span class="keyword">int</span> ri = li + <span class="number">1</span>;</div><div class="line">            <span class="comment">// å­èŠ‚ç‚¹å€¼æœ€å¤§ç´¢å¼•ï¼Œé»˜è®¤å·¦å­èŠ‚ç‚¹ã€‚</span></div><div class="line">            <span class="keyword">int</span> cMax = li;</div><div class="line"></div><div class="line">            <span class="comment">// å·¦å­èŠ‚ç‚¹ç´¢å¼•è¶…å‡ºè®¡ç®—èŒƒå›´ï¼Œç›´æ¥è¿”å›ã€‚</span></div><div class="line">            <span class="keyword">if</span>(li &gt; len) <span class="keyword">return</span>;</div><div class="line">            <span class="comment">// å…ˆåˆ¤æ–­å·¦å³å­èŠ‚ç‚¹ï¼Œå“ªä¸ªè¾ƒå¤§ã€‚</span></div><div class="line">            <span class="keyword">if</span>(ri &lt;= len &amp;&amp; arr[ri] &gt; arr[li])</div><div class="line">                cMax = ri;</div><div class="line">            <span class="keyword">if</span>(arr[cMax] &gt; arr[index])&#123;</div><div class="line">                <span class="comment">// å¦‚æœçˆ¶èŠ‚ç‚¹è¢«å­èŠ‚ç‚¹è°ƒæ¢ï¼Œ</span></div><div class="line">                swap(cMax, index);</div><div class="line">                <span class="comment">// åˆ™éœ€è¦ç»§ç»­åˆ¤æ–­æ¢ä¸‹åçš„çˆ¶èŠ‚ç‚¹æ˜¯å¦ç¬¦åˆå †çš„ç‰¹æ€§ã€‚</span></div><div class="line">                maxHeapify(cMax, len);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">            <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">3</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">6</span>&#125;;</div><div class="line">            <span class="keyword">new</span> HeapSort(arr).sort();</div><div class="line">            System.out.println(Arrays.toString(arr));</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="è®¡æ•°æ’åº"><a href="#è®¡æ•°æ’åº" class="headerlink" title="è®¡æ•°æ’åº"></a>è®¡æ•°æ’åº</h4><p><strong>è®¡æ•°æ’åº</strong>ï¼ˆCountingSortï¼‰æ˜¯ä¸€ç§ç¨³å®šçš„<a href="https://zh.wikipedia.org/wiki/%E7%B7%9A%E6%80%A7%E6%99%82%E9%96%93" target="_blank" rel="external">çº¿æ€§æ—¶é—´</a><a href="https://zh.wikipedia.org/wiki/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95" target="_blank" rel="external">æ’åºç®—æ³•</a>ã€‚å…¶æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ï¼Œä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚</p><h5 id="é€»è¾‘æè¿°-2"><a href="#é€»è¾‘æè¿°-2" class="headerlink" title="é€»è¾‘æè¿°"></a>é€»è¾‘æè¿°</h5><ul><li>æ‰¾å‡ºå¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§å’Œæœ€å°çš„å…ƒç´ </li><li>ç»Ÿè®¡æ•°ç»„ä¸­æ¯ä¸ªå€¼ä¸ºiçš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥æ•°ç»„Cçš„ç¬¬ié¡¹</li><li>å¯¹æ‰€æœ‰çš„è®¡æ•°ç´¯åŠ ï¼ˆä»æ•°ç»„Cä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯ä¸€é¡¹å’Œå‰ä¸€é¡¹ç›¸åŠ ï¼‰</li><li>åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼šå°†æ¯ä¸ªå…ƒç´ iåœ¨æ–°æ•°ç»„çš„ç¬¬C(i)é¡¹ï¼Œæ¯æ”¾ä¸€ä¸ªå…ƒç´ å°±å°†C(i)å‡å»1</li></ul><h5 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.pross.sort;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Author: shawn pross</span></div><div class="line"><span class="comment"> * Date: 2018/11/9</span></div><div class="line"><span class="comment"> * Description: è®¡æ•°æ’åº</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountingSort</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] countingSort(<span class="keyword">int</span>[] A) &#123;</div><div class="line">        <span class="keyword">int</span>[] B = <span class="keyword">new</span> <span class="keyword">int</span>[A.length];</div><div class="line">        <span class="comment">// å‡è®¾Aä¸­çš„æ•°æ®a'æœ‰ï¼Œ0&lt;=a' &amp;&amp; a' &lt; kå¹¶ä¸”k=100</span></div><div class="line">        <span class="keyword">int</span> k = <span class="number">100</span>;</div><div class="line">        countingSort(A, B, k);</div><div class="line">        <span class="keyword">return</span> B;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">countingSort</span><span class="params">(<span class="keyword">int</span>[] A, <span class="keyword">int</span>[] B, <span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span>[] C = <span class="keyword">new</span> <span class="keyword">int</span>[k];</div><div class="line">        <span class="comment">// è®¡æ•°</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; A.length; j++) &#123;</div><div class="line">            <span class="keyword">int</span> a = A[j];</div><div class="line">            C[a] += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// æ±‚è®¡æ•°å’Œ</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; k; i++) &#123;</div><div class="line">            C[i] = C[i] + C[i - <span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// æ•´ç†</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = A.length - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</div><div class="line">            <span class="keyword">int</span> a = A[j];</div><div class="line">            B[C[a] - <span class="number">1</span>] = a;</div><div class="line">            C[a] -= <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span>[] A = CountingSort.countingSort(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">16</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">1</span>&#125;);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> digint : A) &#123;</div><div class="line">            System.out.print(digint + <span class="string">","</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h5 id="ç®—æ³•åˆ†æ-1"><a href="#ç®—æ³•åˆ†æ-1" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h5><p>è®¡æ•°æ’åºæ˜¯ä¸€ä¸ªç¨³å®šçš„æ’åºç®—æ³•ã€‚å½“è¾“å…¥çš„å…ƒç´ æ˜¯nä¸ª0åˆ°kä¹‹é—´çš„æ•´æ•°æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n+k)ï¼Œç©ºé—´å¤æ‚åº¦ä¹Ÿæ˜¯O(n+k)ï¼Œå…¶æ’åºé€Ÿåº¦å¿«äºä»»ä½•æ¯”è¾ƒæ’åºç®—æ³•ã€‚</p><h4 id="æ¡¶æ’åº"><a href="#æ¡¶æ’åº" class="headerlink" title="æ¡¶æ’åº"></a>æ¡¶æ’åº</h4><p><strong>æ¡¶æ’åº</strong>ï¼ˆBucket sortï¼‰æˆ–æ‰€è°“çš„<strong>ç®±æ’åº</strong>ï¼Œæ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚æ¡¶æ’åºçš„å·¥ä½œçš„åŸç†ï¼šå‡è®¾è¾“å…¥æ•°æ®æœä»å‡åŒ€åˆ†å¸ƒï¼Œå°†æ•°æ®åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶å†åˆ†åˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å½’æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’ï¼‰ã€‚</p><h5 id="é€»è¾‘æè¿°-3"><a href="#é€»è¾‘æè¿°-3" class="headerlink" title="é€»è¾‘æè¿°"></a>é€»è¾‘æè¿°</h5><ul><li>è®¾ç½®ä¸€ä¸ªå®šé‡çš„æ•°ç»„å½“ä½œç©ºæ¡¶</li><li>éå†è¾“å…¥æ•°æ®ï¼Œå¹¶ä¸”æŠŠæ•°æ®ä¸€ä¸ªä¸€ä¸ªæ”¾åˆ°å¯¹åº”çš„æ¡¶é‡Œå»</li><li>å¯¹æ¯ä¸ªä¸æ˜¯ç©ºçš„æ¡¶è¿›è¡Œæ’åº</li><li>ä»ä¸æ˜¯ç©ºçš„æ¡¶é‡ŒæŠŠæ’å¥½åºçš„æ•°æ®æ‹¼æ¥èµ·æ¥ã€‚</li></ul><h5 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.pross.sort;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Author: shawn pross</span></div><div class="line"><span class="comment"> * Date: 2018/11/10</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BucketSort</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> min, <span class="keyword">int</span> step)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (a - min) / step;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] bucketSort(<span class="keyword">int</span>[] array) &#123;</div><div class="line">        <span class="keyword">int</span> max = array[<span class="number">0</span>], min = array[<span class="number">0</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> a : array) &#123;</div><div class="line">            <span class="keyword">if</span> (max &lt; a)</div><div class="line">                max = a;</div><div class="line">            <span class="keyword">if</span> (min &gt; a)</div><div class="line">                min = a;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// bucketNumçš„å€¼å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©</span></div><div class="line">        <span class="keyword">int</span> bucketNum = max / <span class="number">10</span> - min / <span class="number">10</span> + <span class="number">1</span>;</div><div class="line">        List buckList = <span class="keyword">new</span> ArrayList&lt;List&lt;Integer&gt;&gt;();</div><div class="line">        <span class="comment">// create bucket</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= bucketNum; i++) &#123;</div><div class="line">            buckList.add(<span class="keyword">new</span> ArrayList&lt;Integer&gt;());</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// push into the bucket</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</div><div class="line">            <span class="keyword">int</span> index = indexFor(array[i], min, <span class="number">10</span>);</div><div class="line">            ((ArrayList&lt;Integer&gt;) buckList.get(index)).add(array[i]);</div><div class="line">        &#125;</div><div class="line">        ArrayList&lt;Integer&gt; bucket = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bucketNum; i++) &#123;</div><div class="line">            bucket = (ArrayList&lt;Integer&gt;) buckList.get(i);</div><div class="line">            insertSort(bucket);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k : bucket) &#123;</div><div class="line">                array[index++] = k;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> array;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// æŠŠæ¡¶å…§å…ƒç´ æ’å…¥æ’åº</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(List&lt;Integer&gt; bucket)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; bucket.size(); i++) &#123;</div><div class="line">            <span class="keyword">int</span> temp = bucket.get(i);</div><div class="line">            <span class="keyword">int</span> j = i - <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span> (; j &gt;= <span class="number">0</span> &amp;&amp; bucket.get(j) &gt; temp; j--) &#123;</div><div class="line">                bucket.set(j + <span class="number">1</span>, bucket.get(j));</div><div class="line">            &#125;</div><div class="line">            bucket.set(j + <span class="number">1</span>, temp);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span>[] array = &#123;<span class="number">100</span>, <span class="number">93</span>, <span class="number">97</span>, <span class="number">92</span>, <span class="number">96</span>, <span class="number">99</span>, <span class="number">92</span>, <span class="number">89</span>, <span class="number">93</span>, <span class="number">97</span>, <span class="number">90</span>, <span class="number">94</span>, <span class="number">92</span>, <span class="number">95</span>&#125;;</div><div class="line">        <span class="keyword">int</span>[] sort = bucketSort(array);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> digint:sort)&#123;</div><div class="line">            System.out.print(digint+<span class="string">","</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h5 id="ç®—æ³•åˆ†æ-2"><a href="#ç®—æ³•åˆ†æ-2" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h5><p>æ¡¶æ’åºæœ€å¥½æƒ…å†µä¸‹ä½¿ç”¨çº¿æ€§æ—¶é—´O(n)ï¼Œæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå–å†³ä¸å¯¹å„ä¸ªæ¡¶ä¹‹é—´æ•°æ®è¿›è¡Œæ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºå…¶å®ƒéƒ¨åˆ†çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(n)ã€‚å¾ˆæ˜¾ç„¶ï¼Œæ¡¶åˆ’åˆ†çš„è¶Šå°ï¼Œå„ä¸ªæ¡¶ä¹‹é—´çš„æ•°æ®è¶Šå°‘ï¼Œæ’åºæ‰€ç”¨çš„æ—¶é—´ä¹Ÿä¼šè¶Šå°‘ã€‚ä½†ç›¸åº”çš„ç©ºé—´æ¶ˆè€—å°±ä¼šå¢å¤§ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;ä½ æ‰€ä¸çŸ¥é“çš„æ’åºç®—æ³•ä¸‹ç¯‡æ›´æ–°å•¦ï¼Œç›¸æ¯”äºä¸Šç¯‡ä»‹ç»çš„ï¼Œä¸‹ç¯‡çš„å‡ ç§æ’åºç®—æ³•ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå°‘è§ã€‚æœ€è¿‘ä¹ŸèŠ±äº†ä¸€ç‚¹æ—¶é—´æ¥ç†è§£ã€‚è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬è¿›å…¥æ­£æ–‡ã€‚&lt;/p&gt;&lt;p&gt;ä»Šå¤©å‡ºåœºçš„æ˜¯ï¼šå¿«é€Ÿæ’åºï¼Œå †æ’åºï¼Œè®¡æ•°æ’åºï¼Œæ¡¶æ’åºã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç®—æ³•" scheme="https://pross.space/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ä½ æ‰€å¿½è§†çš„æ’åºç®—æ³•ï¼ˆä¸Šï¼‰</title>
    <link href="https://pross.space/archives/2018/10/27/"/>
    <id>https://pross.space/archives/2018/10/27/</id>
    <published>2018-10-27T15:12:58.000Z</published>
    <updated>2018-10-27T16:53:44.136Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><blockquote><p>ç®—æ³•ï¼ˆalgorithmï¼‰ï¼Œåœ¨æ•°å­¦ï¼ˆç®—å­¦ï¼‰å’Œè®¡ç®—æœºç§‘å­¦ä¹‹ä¸­ï¼Œä¸ºä»»ä½•è‰¯å®šä¹‰çš„å…·ä½“è®¡ç®—æ­¥éª¤çš„ä¸€ä¸ªåºåˆ—ï¼Œå¸¸ç”¨è¯­è®¡ç®—ï¼Œæ•°æ®å¤„ç†å’Œè‡ªåŠ¨æ¨ç†ã€‚ç²¾ç¡®è€Œè¨€ï¼Œç®—æ³•æ˜¯ä¸€ä¸ªè¡¨ç¤ºä¸ºæœ‰é™é•¿åˆ—è¡¨çš„æœ‰æ•ˆæ–¹æ³•ã€‚ç®—æ³•åº”åŒ…å«æ¸…æ™°å®šä¹‰çš„æŒ‡ä»¤ç”¨äºè®¡ç®—å‡½æ•°ã€‚</p><p>â€”â€”<a href="https://zh.wikipedia.org/wiki/%E7%AE%97%E6%B3%95" target="_blank" rel="external">ç»´åŸºç™¾ç§‘</a></p></blockquote><a id="more"></a><p>ç¨‹åºçŒ¿åœˆå­é‡Œä¼¼ä¹éƒ½é»˜ç„¶è¿™æ ·çš„ä¸€ä¸ªç­‰å¼ï¼šç¨‹åº=æ•°æ®ç»“æ„+ç®—æ³•ã€‚æ€è€ƒèµ·æ¥ï¼Œå°±æ„Ÿè§‰ç›¸å½“äºï¼šä½œæ–‡=è¯­æ³•+è¯è¯­ã€‚è¿™å¥è¯ç›¸å½“å‡ºåï¼Œå› ä¸ºè¿™æ˜¯1986å¹´å°¼å¤æ‹‰æ–¯èµµå››ï¼ˆé€ƒï¼‰åœ¨è·å¾—å›¾çµå¥–æ—¶è¯´çš„ä¸€å¥è¯ï¼Œç°åœ¨å¬èµ·æ¥ï¼Œä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆä¸æ­£ç¡®çš„ã€‚å½“ç„¶ï¼Œè¿™å°±å¥½æ¯”å½“å¹´ç‰›é¡¿åœ¨1687å¹´æå‡ºä¸‡æœ‰å¼•åŠ›ä¸€æ ·ï¼Œç°åœ¨çœ‹èµ·æ¥æ˜¯åºŸè¯ä¸€æ ·ï¼Œä½†æ˜¯å½“æ—¶è¿™å¥è¯ç¡®å®šå¥ å®šäº†ç¨‹åºçš„åŸºç¡€æ¦‚å¿µã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±æ¥è®²è®²ç®—æ³•ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ˜¯ç®—æ³•å‘¢ï¼Ÿå–ï¼Œå¼€å¤´å·²ç»å¼•ç”¨äº†ç»´åŸºç™¾ç§‘çš„å¯¹ç®—æ³•çš„å®šä¹‰ï¼Œä¸‹é¢æ¥è€Œæ¥äº†ä¸€æ®µè§£é‡Šï¼š</p><blockquote><p>ç®—æ³•ä¸­çš„æŒ‡ä»¤æè¿°çš„æ˜¯ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E8%A8%88%E7%AE%97" target="_blank" rel="external">è®¡ç®—</a>ï¼Œå½“å…¶è¿è¡Œæ—¶èƒ½ä»ä¸€ä¸ªåˆå§‹çŠ¶æ€å’Œåˆå§‹è¾“å…¥ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰å¼€å§‹ï¼Œç»è¿‡ä¸€ç³»åˆ—<strong>æœ‰é™</strong>è€Œæ¸…æ™°å®šä¹‰çš„çŠ¶æ€æœ€ç»ˆäº§ç”Ÿ<strong>è¾“å‡º</strong>å¹¶<strong>åœæ­¢</strong>äºä¸€ä¸ªç»ˆæ€ã€‚ä¸€ä¸ªçŠ¶æ€åˆ°å¦ä¸€ä¸ªçŠ¶æ€çš„è½¬ç§»ä¸ä¸€å®šæ˜¯ç¡®å®šçš„ã€‚éšæœºåŒ–ç®—æ³•åœ¨å†…çš„ä¸€äº›ç®—æ³•ï¼ŒåŒ…å«äº†ä¸€äº›éšæœºè¾“å…¥ã€‚</p></blockquote><p>çœ‹æ‡‚äº†å—ï¼Ÿåˆ«æ€¥åˆ«æ€¥ï¼Œæ²¡çœ‹æ‡‚æ²¡å…³ç³»ï¼Œæˆ‘ä¹Ÿä¸æ˜¯å¾ˆç†è§£ï¼›ä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ç”¨ä¸€å¥é€šä¿—çš„è¯æ¥é˜é‡Šä¸€ä¸‹ï¼š<strong>ç®—æ³•ï¼ˆAlgorithmï¼‰å°±æ˜¯è§£å†³é—®é¢˜çš„æ–¹æ³•</strong>ã€‚æ‰€ä»¥æˆ‘ä»¬å°±è¿™æ ·æ¥ç†è§£å°±å¥½äº†ã€‚</p><p>åœ¨InfoQä¸Šæœ‰ä¸€ç¯‡æ–‡ç« ã€Šè®¡ç®—æœºç§‘å­¦æœ€é‡è¦çš„32ä¸ªç®—æ³•ã€‹ï¼Œä»‹ç»äº†äºŒåˆ†æŸ¥æ‰¾æ³•ï¼ˆBinary Searchï¼‰ï¼Œå¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFast Fourier transformï¼ŒFFTï¼‰ï¼Œå“ˆå¸Œç®—æ³•ï¼ˆHashingï¼‰ï¼Œå †æ’åºï¼ˆHeapsï¼‰ç­‰ç­‰ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹ã€‚å½“ç„¶ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨å­¦ä¹ ä¸­ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« æ˜¯ç®—æ³•ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼Œæˆ‘ä»¬å…ˆä»æ’åºç®—æ³•ï¼ˆSortï¼‰å¼€å§‹ã€‚</p><p>è®¡åˆ’æ˜¯æ¥ä»‹ç»åå¤§å¸¸è§çš„æ’åºç®—æ³•ï¼Œä¸ºäº†æ§åˆ¶æ–‡ç« ç¯‡å¹…ï¼Œåˆ†ä¸Šä¸‹ä¸¤ç¯‡æ¥ä»‹ç»ï¼Œä¸€äº›ç®—æ³•å®šä¹‰è§£é‡Šå’ŒåŠ¨æ€å›¾è¿‡ç¨‹åˆ†æå±•ç¤ºå¤§å¤šæ¥è‡ªäºè‡ªç”±å…¨é¢çš„ç»´åŸºç™¾ç§‘ã€‚æ­¤æ–‡ä¸ºä¸Šç¯‡ï¼Œä»‹ç»ç®—æ³•å¼•å…¥æ’åºä»¥åŠä»‹ç»éƒ¨åˆ†ç®€å•çš„æ’åºç®—æ³•ã€‚ä¸‹ç¯‡ä»‹ç»å‰©ä½™çš„æ’åºç®—æ³•å’Œä¸‹ä¸€ç« é¢„å‘Šã€‚</p><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><p>æ’åºç®—æ³•å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>éçº¿æ€§æ—¶é—´æ¯”è¾ƒç±»æ’åºå’Œçº¿æ€§æ—¶é—´éæ¯”è¾ƒç±»</strong>ã€‚å‰è€…æ˜¯é€šè¿‡æ¯”è¾ƒæ¥å†³å®šå…ƒç´ é—´çš„æ¬¡åºï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸èƒ½çªç ´Oï¼ˆnlognï¼‰ï¼›åè€…ä¸é€šè¿‡æ¯”è¾ƒæ¥å†³å®šå…ƒç´ é—´çš„æ¬¡åºï¼Œä½†æ˜¯å¯ä»¥çªç ´åŸºäºæ¯”è¾ƒæ’åºçš„æ—¶é—´ä¸‹ç•Œï¼Œä»¥çº¿æ€§æ—¶é—´è¿è¡Œã€‚æœ‰ç‚¹æ•°å­¦åŸºç¡€çš„å„ä½çœ‹å®˜å¾ˆå¥½ç†è§£çº¿æ€§å’Œéçº¿æ€§çš„åŒºåˆ«ï¼Œä»¥åŠè¿‡ç¨‹ä¸­ä¼šæåˆ°å¤æ‚åº¦ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°ï¼Œä»¥åæœ‰æœºä¼šå•å¼€ä¸€ç¯‡ä»‹ç»ã€‚</p><h4 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h4><p>å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰æ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ï¼Œå¸¸ä½œä¸ºç¨‹åºè®¾è®¡å…¥é—¨ç®—æ³•ä»‹ç»ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœä»–ä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠä»–ä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ã€‚</p><p><strong>é€»è¾‘æè¿°</strong></p><ul><li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚</li><li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚è¿™æ­¥åšå®Œåï¼Œæœ€åçš„å…ƒç´ ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚</li><li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚</li><li>æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚</li></ul><p><strong>ä»£ç å®ç°</strong></p><p>æ¯”è¾ƒå¸¸è§çš„ç®—æ³•ï¼Œä»£ç ç•¥ã€‚</p><h4 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h4><p>é€‰æ‹©æ’åºï¼ˆSelection sortï¼‰æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†å¦‚ä¸‹ã€‚é¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œç„¶åï¼Œå†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚</p><p><strong>é€»è¾‘æè¿°</strong></p><p>Nä¸ªè®°å½•çš„ç›´æ¥é€‰æ‹©æ’åºå¯ç»è¿‡N-1è¶Ÿç›´æ¥é€‰æ‹©æ’åºå¾—åˆ°æœ‰åºç»“æœã€‚</p><ul><li>åˆå§‹çŠ¶æ€ï¼šæ— åºåŒºä¸ºR[1â€¦n]ï¼Œæœ‰åºåŒºä¸ºç©º</li><li>ç¬¬iè¶Ÿæ’åº(i=1,2,3â€¦n-1)å¼€å§‹æ—¶ï¼Œå½“å‰æœ‰åºåŒºå’Œæ— åºåŒºåˆ†åˆ«ä¸ºR[1..i-1]å’ŒR[i..n]ã€‚è¯¥è¶Ÿæ’åºä»å½“å‰æ— åºåŒºä¸­é€‰å‡ºå…³é”®å­—æœ€å°çš„è®°å½• R[k]ï¼Œå°†å®ƒä¸æ— åºåŒºçš„ç¬¬1ä¸ªè®°å½•Räº¤æ¢ï¼Œä½¿R[1..i]å’ŒR[i+1..n)åˆ†åˆ«å˜ä¸ºè®°å½•ä¸ªæ•°å¢åŠ 1ä¸ªçš„æ–°æœ‰åºåŒºå’Œè®°å½•ä¸ªæ•°å‡å°‘1ä¸ªçš„æ–°æ— åºåŒº</li><li>n-1è¶Ÿç»“æŸï¼Œæ•°ç»„æœ‰åºåŒ–äº†</li></ul><p><strong>ä»£ç å®ç°</strong></p><p>æ¯”è¾ƒå¸¸è§çš„ç®—æ³•ï¼Œä»£ç ç•¥ã€‚</p><h4 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h4><p><strong>æ’å…¥æ’åº</strong>ï¼ˆInsertion Sortï¼‰æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚</p><p><strong>é€»è¾‘æè¿°</strong></p><p>æ’å…¥æ’åºåœ¨å®ç°ä¸Šï¼Œé€šå¸¸é‡‡ç”¨in-placeæ’åºï¼ˆå³åªéœ€ç”¨åˆ°<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/e66384bc40452c5452f33563fe0e27e803b0cc21" alt="{\displaystyle O(1)}">çš„é¢å¤–ç©ºé—´çš„æ’åºï¼‰ï¼Œå› è€Œåœ¨ä»åå‘å‰æ‰«æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åå¤æŠŠå·²æ’åºå…ƒç´ é€æ­¥å‘åæŒªä½ï¼Œä¸ºæœ€æ–°å…ƒç´ æä¾›æ’å…¥ç©ºé—´ã€‚</p><ol><li>ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åº</li><li>å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æ</li><li>å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®</li><li>é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®</li><li>å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®å</li><li>é‡å¤æ­¥éª¤2~5</li></ol><p><strong>ä»£ç å®ç°</strong></p><p>æ¯”è¾ƒå¸¸è§çš„ç®—æ³•ï¼Œä»£ç ç•¥ã€‚</p><h4 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h4><p>å¸Œå°”æ’åºï¼ˆShell Sortï¼‰ï¼Œä¹Ÿç§°é€’å‡å¢é‡æ’åºç®—æ³•ï¼Œæ˜¯æ’å…¥æ’åºçš„ä¸€ç§æ›´é«˜æ•ˆçš„æ”¹è¿›ç‰ˆæœ¬ã€‚</p><p><strong>é€»è¾‘æè¿°</strong></p><p>å…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå…·ä½“ç®—æ³•æè¿°ï¼š</p><ul><li>é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ—t1ï¼Œt2ï¼Œâ€¦ï¼Œtkï¼Œå…¶ä¸­ti&gt;tjï¼Œtk=1</li><li>æŒ‰å¢é‡åºåˆ—ä¸ªæ•°kï¼Œå¯¹åºåˆ—è¿›è¡Œkè¶Ÿæ’åº</li><li>æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡tiï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸ºm çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦</li></ul><p><strong>ä»£ç å®ç°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.pross.sort;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span>:å½­çˆ½pross</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/10/27</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShellSort</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] shellSort(<span class="keyword">int</span>[] array) &#123;</div><div class="line"><span class="keyword">int</span> i;</div><div class="line"><span class="keyword">int</span> j;</div><div class="line"><span class="keyword">int</span> temp;</div><div class="line"><span class="comment">//è‡ªå®šä¹‰é—´éš”åºåˆ—</span></div><div class="line"><span class="keyword">int</span> number = array.length / <span class="number">2</span>;</div><div class="line"><span class="keyword">while</span> (number &gt;= <span class="number">1</span>) &#123;</div><div class="line"><span class="keyword">for</span> (i = number; i &lt; array.length; i++) &#123;</div><div class="line">temp = array[i];</div><div class="line">j = i - number;</div><div class="line"><span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; array[j] &lt; temp) &#123;</div><div class="line">array[j + number] = array[j];</div><div class="line">j = j - number;</div><div class="line">&#125;</div><div class="line">array[j + number] = temp;</div><div class="line">&#125;</div><div class="line">number = number / <span class="number">2</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">return</span> array;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>ç®—æ³•åˆ†æ</strong></p><p>å¸Œå°”æ’åºæ˜¯åŸºäºæ’å…¥æ’åºçš„ä»¥ä¸‹ä¸¤ç‚¹æ€§è´¨è€Œæå‡ºæ”¹è¿›æ–¹æ³•çš„ï¼š1.æ’å…¥æ’åºåœ¨å¯¹å‡ ä¹å·²ç»æ’å¥½åºçš„æ•°æ®æ“ä½œæ—¶ï¼Œæ•ˆç‡é«˜ï¼Œå³å¯ä»¥è¾¾åˆ°çº¿æ€§æ’åºçš„æ•ˆç‡ï¼›2.ä½†æ’å…¥æ’åºä¸€èˆ¬æ¥è¯´æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºæ’å…¥æ’åºæ¯æ¬¡åªèƒ½å°†æ•°æ®ç§»åŠ¨ä¸€ä½ã€‚</p><p>å¸Œå°”æ’åºçš„æ ¸å¿ƒåœ¨äºé—´éš”åºåˆ—çš„è®¾å®šã€‚æ—¢å¯ä»¥æå‰è®¾å®šå¥½é—´éš”åºåˆ—ï¼Œä¹Ÿå¯ä»¥åŠ¨æ€çš„å®šä¹‰é—´éš”åºåˆ—ã€‚åŠ¨æ€å®šä¹‰é—´éš”åºåˆ—çš„ç®—æ³•æ˜¯ã€Šç®—æ³•ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹çš„åˆè‘—è€…Robert Sedgewickæå‡ºçš„ã€‚</p><h4 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h4><p>å½’å¹¶æ’åºï¼ˆMerge sortï¼Œæˆ–mergesortï¼‰æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸º2-è·¯å½’å¹¶ã€‚</p><p><strong>é€»è¾‘æè¿°</strong></p><ol><li>å°†åºåˆ—æ¯ç›¸é‚»ä¸¤ä¸ªæ•°å­—è¿›è¡Œå½’å¹¶æ“ä½œï¼Œå½¢æˆ<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/284284713ad8f1ba13458b896c87efc4b9b7df9c" alt="{\displaystyle ceil(n/2)}">ä¸ªåºåˆ—ï¼Œæ’åºåæ¯ä¸ªåºåˆ—åŒ…å«ä¸¤/ä¸€ä¸ªå…ƒç´ </li><li>è‹¥æ­¤æ—¶åºåˆ—æ•°ä¸æ˜¯ä¸€ä¸ªåˆ™å°†ä¸Šè¿°åºåˆ—å†æ¬¡å½’å¹¶ï¼Œå½¢æˆ<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/0f7b6be8e0c402e981a78d573dc3072c3d24a3c4" alt="{\displaystyle ceil(n/4)}">ä¸ªåºåˆ—ï¼Œæ¯ä¸ªåºåˆ—åŒ…å«å››/ä¸‰ä¸ªå…ƒç´ </li><li>é‡å¤ç¬¬2æ­¥æ“ä½œï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ æ’åºå®Œæ¯•ï¼Œå³åºåˆ—æ•°ä¸º1</li></ol><p><strong>ä»£ç å®ç°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.pross.sort;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@describe</span>: å½’å¹¶æ’åº</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span>:å½­çˆ½pross</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/10/27</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSort</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] mergeSort(<span class="keyword">int</span>[] arr) &#123;</div><div class="line"><span class="keyword">int</span>[] orderedArr = <span class="keyword">new</span> <span class="keyword">int</span>[arr.length];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; arr.length * <span class="number">2</span>; i *= <span class="number">2</span>) &#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; (arr.length + i - <span class="number">1</span>) / i; j++) &#123;</div><div class="line"><span class="keyword">int</span> left = i * j;</div><div class="line"><span class="keyword">int</span> mid = left + i / <span class="number">2</span> &gt;= arr.length ? (arr.length - <span class="number">1</span>) : (left + i / <span class="number">2</span>);</div><div class="line"><span class="keyword">int</span> right = i * (j + <span class="number">1</span>) - <span class="number">1</span> &gt;= arr.length ? (arr.length - <span class="number">1</span>) : (i * (j + <span class="number">1</span>) - <span class="number">1</span>);</div><div class="line"><span class="keyword">int</span> start = left, l = left, m = mid;</div><div class="line"><span class="keyword">while</span> (l &lt; mid &amp;&amp; m &lt;= right) &#123;</div><div class="line"><span class="keyword">if</span> (arr[l] &lt; arr[m]) &#123;</div><div class="line">orderedArr[start++] = arr[l++];</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">orderedArr[start++] = arr[m++];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">while</span> (l &lt; mid)</div><div class="line">orderedArr[start++] = arr[l++];</div><div class="line"><span class="keyword">while</span> (m &lt;= right)</div><div class="line">orderedArr[start++] = arr[m++];</div><div class="line">System.arraycopy(orderedArr, left, arr, left, right - left + <span class="number">1</span>);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> orderedArr;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>ä¸Šç¯‡ä»‹ç»äº†ï¼Œå†’æ³¡æ’åºï¼Œé€‰æ‹©æ’åºï¼Œæ’å…¥æ’åºï¼Œå¸Œå°”æ’åºå’Œå½’å¹¶æ’åºã€‚</p><p>æ‰€æœ‰ä»£ç å¯ä»¥åœ¨<a href="https://github.com/prosscode/java-learning-case/tree/master/algorithm/src/main/java/org/pross/sort" target="_blank" rel="external">æˆ‘çš„Github</a>æŸ¥é˜…ã€‚</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;blockquote&gt;&lt;p&gt;ç®—æ³•ï¼ˆalgorithmï¼‰ï¼Œåœ¨æ•°å­¦ï¼ˆç®—å­¦ï¼‰å’Œè®¡ç®—æœºç§‘å­¦ä¹‹ä¸­ï¼Œä¸ºä»»ä½•è‰¯å®šä¹‰çš„å…·ä½“è®¡ç®—æ­¥éª¤çš„ä¸€ä¸ªåºåˆ—ï¼Œå¸¸ç”¨è¯­è®¡ç®—ï¼Œæ•°æ®å¤„ç†å’Œè‡ªåŠ¨æ¨ç†ã€‚ç²¾ç¡®è€Œè¨€ï¼Œç®—æ³•æ˜¯ä¸€ä¸ªè¡¨ç¤ºä¸ºæœ‰é™é•¿åˆ—è¡¨çš„æœ‰æ•ˆæ–¹æ³•ã€‚ç®—æ³•åº”åŒ…å«æ¸…æ™°å®šä¹‰çš„æŒ‡ä»¤ç”¨äºè®¡ç®—å‡½æ•°ã€‚&lt;/p&gt;&lt;p&gt;â€”â€”&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E7%AE%97%E6%B3%95&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ç»´åŸºç™¾ç§‘&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="ç®—æ³•" scheme="https://pross.space/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç›¸è§</title>
    <link href="https://pross.space/archives/2018/09/28/"/>
    <id>https://pross.space/archives/2018/09/28/</id>
    <published>2018-09-28T13:36:25.000Z</published>
    <updated>2019-07-10T16:29:47.340Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>åˆ†äº«å‡ ä¸ªç®€çŸ­çš„æ€è€ƒå’Œè§‚ç‚¹ã€‚</p><a id="more"></a><p><strong>å…³äºä»£ç </strong></p><blockquote><p>ã€Œä¸ºäº†ç†è§£ä¸€ä¸ªç®€å•å‡½æ•°çš„è¿è¡Œè¿‡ç¨‹ï¼Œä»Šå¤©çš„è½¯ä»¶å·¥ç¨‹å¸ˆå¯èƒ½éœ€è¦è¿½è¸ª25ä¸ªæ–‡ä»¶ã€‚å› ä¸ºæ¯ä¸ªæ–‡ä»¶éƒ½åŒ…å«ä¸€ä¸ª Java æ–¹æ³•ï¼Œå®ƒä¼šå‘å¦ä¸€ä¸ªæ–‡ä»¶çš„å¦ä¸€ä¸ªæ–¹æ³•å‘æ¶ˆæ¯ã€‚ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹20å±‚çš„å †æ ˆï¼Œäººä»¬å‘æ˜äº† Eclipse é‚£æ ·çš„å¤æ‚å·¥å…·ã€‚å®é™…åšäº‹çš„é‚£ä¸€è¡Œä»£ç ï¼ŒåŸ‹è—åœ¨æ•°ç™¾è¡Œèƒ¶æ°´ä»£ç ã€æ— æ•°ä¸ªæ¥å£å’Œå…¶ä»–å†—ä½™ä»£ç ä¹‹ä¸‹ã€‚ã€</p><p>â€“ <a href="http://blogs.harvard.edu/philg/2018/09/18/is-data-scientist-the-new-programmer/" target="_blank" rel="external">Philip Greenspun</a>ï¼Œéº»çœç†å·¥å­¦é™¢çš„è®¡ç®—æœºæ•™æˆ</p></blockquote><p>æ’å˜´ä¸€å¥ï¼Œç°åœ¨è¿˜æ˜¯ä¹ æƒ¯ä½¿ç”¨JetBrainså®¶çš„IDEAï¼Œé£æ ¼ç®€çº¦ï¼Œçˆ½å¿ƒæ‚¦ç›®ã€‚çœ‹åˆ°å¾ˆå¤šå…³äºé›†æˆå¼€å‘ç¯å¢ƒå·¥å…·å¥½åçš„äº‰è®ºï¼ŒEclipseä»€ä¹ˆä»€ä¹ˆä¸å¥½ï¼ŒIDEAå“ªé‡Œå“ªé‡Œç‰¹åˆ«æ–¹ä¾¿ï¼Œæ— èŠä¹‹è€…ï¼Œè¿˜ä¸å¦‚è€è€å®å®æŠŠBUGè§£å†³æ‰ï¼Œèµ¶å¿«å›å®¶ç¡è§‰ã€‚</p><p>ç”±Phillip Greenspunçš„ä¸€æ®µè¯å¼•å‡ºï¼Œåªæ˜¯éå¸¸å°è¯æœ€è¿‘çš„å·¥ä½œã€‚ä¸ºäº†ç†è§£è¿™ä¸ªæ–¹æ³•å‡½æ•°çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Œä¸åœçš„è¿½è¸ªå‘ç°ï¼Œä¸åœçš„å‘ä¸‹æŒ–æ˜ï¼Œåœ¨ç»å†å±‚å±‚å°é”ä¹‹åç»ˆäºæ‰¾åˆ°äº†çœŸç›¸ï¼Œå¿ƒé‡Œå¸¦ç€çªƒå–œï¼Œè¿˜æ˜¯è¦éª‚å’§å’§ä¸€å¥ï¼šåŸæ¥ä½ å°±åœ¨è¿™é‡Œï¼ŒåŸæ¥ä½ æ˜¯è¿™æ ·å®ç°çš„ï¼ŒåŸæ¥ä½ å¹²ç€è¿™æ ·çš„äº‹ã€‚ç„¶åå¸¦ç€äº›è®¸æ»¡è¶³æ„Ÿè¿”å›å»ï¼Œç»§ç»­ä¸‹ä¸€è¡Œä»£ç çš„æ¢ç´¢ä¸å‘ç°ã€‚</p><p><strong>å…³äºæ”¹å˜è§‚ç‚¹</strong></p><p>äºšé©¬é€Šçš„è€æ¿è´ä½æ–¯è¯´ï¼Œã€Œå¦‚æœä¸€ä¸ªäººç»å¸¸æ”¹å˜è‡ªå·±çš„çœ‹æ³•ï¼Œæ›´å¯èƒ½å¾—åˆ°æ­£ç¡®çš„è§‚ç‚¹ã€‚ã€ä»¥å‰æ²¡æœ‰ä»è¿™æ–¹é¢è§’åº¦æ€è€ƒè¿‡è¿™ä¸ªé—®é¢˜ï¼Œç»å¸¸æ”¹å˜è‡ªå·±çš„çœ‹æ³•å’Œè§‚ç‚¹ä¸æ˜¯ç«‹åœºä¸ç¡®å®šä¹ˆï¼Ÿä½ éƒ½ä¸ç¡®å®šè‡ªå·±çš„è§‚ç‚¹æ˜¯å¦ç¡®å®šæ€ä¹ˆå€¼å¾—åˆ«äººç›¸ä¿¡ä½ ï¼Ÿ</p><p>ä»”ç»†æ€è€ƒè´ä½æ–¯çš„è¯ï¼Œè¿˜æ˜¯æœ‰ä¸€ç‚¹é“ç†ã€‚å¦‚ä»Šä¸–ç•Œå˜åŒ–çš„å¤ªå¿«äº†ï¼Œèªæ˜çš„äººéƒ½ä¼šä¸æ–­çš„ä¿®æ”¹è‡ªå·±å¯¹ä¸–ç•Œçš„ç†è§£ï¼Œé‡æ–°è€ƒè™‘è‡ªå·±ä»¥å‰è€ƒè™‘çš„é—®é¢˜ï¼Œä¸æ–­çš„ç”¨æ±²å–çš„æ–°çš„çŸ¥è¯†ï¼Œæ–°çš„æ€ç»´æ–¹å¼æ¥å®Œå–„è‡ªå·±çš„è§‚ç‚¹å’Œçœ‹æ³•ï¼Œç„¶åå¾—å‡ºä¸ä¸€æ ·çš„ç»“è®ºã€‚è¿™æ ·è¯´æ¥ï¼Œä¸æ˜¯æ„å‘³ä¹‹å‰çš„è§‚ç‚¹å°±æ˜¯é”™è¯¯çš„ï¼Œè€Œåº”è¯¥è¯´è‡ªå·±çš„è§‚ç‚¹æ˜¯æš‚æ—¶çš„ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½åœ¨æˆé•¿ï¼Œä»Šå¤©çš„ä½ å’Œæ˜¨å¤©çš„ä½ éƒ½ä¼šä¸ä¸€æ ·ã€‚</p><p>è¿™æ ·ç†è§£è´ä½æ–¯çš„è¯å¯èƒ½æ›´æœ‰å»ºé€ æ€§ï¼Œã€Œå¦‚æœä¸€ä¸ªäººç»å¸¸æ”¹å˜è‡ªå·±è¿‡å»äº‹æƒ…çš„çœ‹æ³•ï¼Œæ›´å¯èƒ½å¾—åˆ°æ­£ç¡®çš„è§‚ç‚¹ã€‚ã€å¦å¤–ï¼Œå†™å®Œè¿™å¥è¯ï¼Œæˆ‘å¯¹è¿™ä¸ªè§‚ç‚¹çœ‹æ³•å·²ç»æ”¹å˜äº†ã€‚: )</p><p><strong>å…³äºè¯»ä¹¦</strong></p><p>æ± è€å¸ˆçš„<a href="https://book.douban.com/subject/26663519/" target="_blank" rel="external">MacTalkÂ·è·¨è¶Šè¾¹ç•Œ</a>ï¼Œå·²ç»æ–­æ–­ç»­ç»­åœ¨é€šå‹¤ä¹‹ä½™å·²ç»é˜…è¯»å®Œã€‚æ„Ÿå—è¿˜æ˜¯æœ‰ä¸€äº›ï¼Œå¦å¤–å¼€ç¯‡æ–‡ç« å†æ¥è¯´ä¸€è¯´ã€‚</p><p>æˆ‘è§‰å¾—è¯»ä¹¦æ˜¯ç”±ç‚¹åŠé¢çš„æˆé•¿ï¼Œç°åœ¨é˜…è¯»çš„è¿™æœ¬ä¹¦ä¸ºç‚¹ï¼Œä¹¦ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼Œä»‹ç»çš„äººç‰©ï¼Œä½œè€…é˜…è¯»ä¹¦ç±ä¸ºæ‰©å±•çš„é¢ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ªç¯è¾å°„å­¦ä¹ çš„è¿‡ç¨‹ã€‚æ¯”å¦‚æˆ‘è¯»å®Œè·¨è¶Šè¾¹ç•Œï¼Œå¯¹è½¯ä»¶é¡¹ç›®çš„æ€è€ƒï¼ŒæŒç»­å­¦ä¹ çš„è§‚ç‚¹ï¼Œæ—¶ä»£çš„æŠ€æœ¯å‘å±•ï¼ˆæ¯•ç«Ÿæ± è€å¸ˆæ˜¯70åç¨‹åºå‘˜ï¼‰éƒ½æœ‰ä¸€å®šçš„æ„Ÿæ‚Ÿå’Œè‡ªå·±çš„ç†è§£ï¼›å¯¹é«˜æ™“æ¾çš„ã€Šå¦‚ä¸§ã€‹ï¼Œã€Šé±¼ç¾Šé‡å²ã€‹ï¼Œå†¯å¤§è¾‰çš„åšå®¢æ–‡é›†ï¼Œä¸€ç”Ÿåªä¸ºæ¬¢ç¬‘çš„linusï¼Œä¼ å¥‡å·¥ç¨‹å¸ˆæ²ƒå…¹å¤§ç¥éƒ½æŠ±ç€æµ“åšçš„å…´è¶£ï¼Œè¿™æ ·å°±æ˜¯é¢çš„å±•å¼€ã€‚</p><p>è¯»ä¹¦å’Œå†™åšå®¢éƒ½å¼•ç”¨åŒä¸€å¥è¯ï¼Œã€Œè¯»ä¹¦ä¼šå¸¦æ¥å¾ˆå¤šå¥½å¤„ï¼Œå´æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åå¤„ã€‚ã€</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;åˆ†äº«å‡ ä¸ªç®€çŸ­çš„æ€è€ƒå’Œè§‚ç‚¹ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="éšç¬”æ‚è®°" scheme="https://pross.space/tags/%E9%9A%8F%E7%AC%94%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>ä½ éœ€è¦å¤šä¹…æ‰èƒ½å˜æˆä¸€ä¸ª&quot;å‚»ç“œ&quot;</title>
    <link href="https://pross.space/archives/2018/09/24/"/>
    <id>https://pross.space/archives/2018/09/24/</id>
    <published>2018-09-24T10:41:47.000Z</published>
    <updated>2019-07-10T16:29:56.636Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>é‡‘å‡ºæ­¦é›„ï¼ˆKanade Takeoï¼‰æ˜¯ç¾å›½å¡å†…åŸºÂ·æ¢…éš†å¤§å­¦ï¼ˆCMUï¼‰çš„æœºå™¨äººè§†è§‰ç ”ç©¶æ‰€æ‰€é•¿ï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€é‡è¦çš„è®¡ç®—æœºæ˜¯è§†è§‰ç ”ç©¶äººå‘˜ä¹‹ä¸€ã€‚</p><p><img src="/archives/2018/09/24/kanade_takeo_2014.jpg" alt=""></p><a id="more"></a><p>å¾®ä¿¡ä¹‹çˆ¶å¼ å°é¾™åœ¨ã€Šå¾®ä¿¡èƒŒåçš„äº§å“è§‚ã€‹ä¸€æ–‡ä¸­è®²åˆ°ï¼šâ€œäº§å“ç»ç†è¦æœ‰å‚»ç“œå¿ƒæ€ã€‚â€è¿™é‡Œçš„å‚»ç“œå¹¶ä¸æ˜¯çœŸæ­£çš„å‚»æ‰ï¼Œè€Œæ˜¯éœ€è¦æœ‰ä¸€ç§å¤–è¡Œçš„å¿ƒæ€ï¼Œä¿æŒâ€œstay foolishâ€ã€‚å¼ å°é¾™è¯´ï¼Œè‡ªå·±éœ€è¦ç»è¿‡5~10åˆ†é’Ÿçš„é…é…¿æ‰èƒ½è¾¾åˆ°å‚»ç“œçŠ¶æ€ï¼Œé©¬åŒ–è…¾éœ€è¦1åˆ†é’Ÿï¼ŒåŠŸåŠ›æœ€æ·±çš„ä¹”å¸ƒæ–¯å¯ä»¥åœ¨ä¸“å®¶å’Œå‚»ç“œä¹‹é—´éšæ„åˆ‡æ¢ï¼Œæ¥å»è‡ªå¦‚ã€‚</p><p>æœ€æ—©å¬åˆ°ç±»ä¼¼çš„è¯´æ³•æ˜¯é€šè¿‡æ± è€å¸ˆåœ¨åšå®¢ä¸­ä»‹ç»çš„é‡‘å‡ºæ­¦é›„æ•™æˆã€‚ä»–å‡ºç‰ˆäº†ä¸€æœ¬ä¹¦ï¼Œåå­—å«åšã€Šåƒå¤–è¡Œä¸€æ ·æ€è€ƒï¼Œåƒä¸“å®¶ä¸€æ ·å®è·µã€‹ï¼Œå…³äºè¿™æœ¬ä¹¦çš„åˆ›ä½œï¼Œé‡‘æ•™æˆå¦‚æ˜¯è¯´ï¼š</p><blockquote><p>å¬è¿‡æˆ‘çš„æ¼”è®²æˆ–è¨€è®ºä¹‹åï¼Œæœ‰å¾ˆå¤šäººè¡¨ç¤ºï¼šâ€œä½ çš„è¯ï¼Œç®€ç›´å°±æ˜¯è°è¯ï¼Œå‡ ä¹éƒ½æ˜¯è°è¯ã€æ˜¯ç©ç¬‘ã€åƒæ˜¯çœŸè¯ï¼Œæ˜¯çœŸè¯ï¼Œæ˜¯è‡ªå¹è‡ªæ“‚ã€è™½ç„¶å¾ˆæœ‰å»ºè®¾æ€§ä½†â€¦â€¦æ‚ä¸ƒæ‚å…«è¿˜æœ‰ç‚¹æ„æ€ã€‚â€äºæ˜¯æˆ‘æƒ³ï¼Œè¦ä¸è¦æŠŠè¿™äº›æ”¶é›†èµ·æ¥ï¼Œå†™ä¸€æœ¬ä¹¦å‘¢ï¼Ÿ</p></blockquote><p>äºæ˜¯è¿™æœ¬ä¹¦å°±è¯ç”Ÿäº†ï¼Œè¿™æ˜¯ä¸€ä¸ªå°æ’æ›²ã€‚è¿™æœ¬ä¹¦æ˜¯é‡‘æ•™æˆå¯¹å…¶æ—¥å¸¸ç ”ç©¶ã€ç”Ÿæ´»å’Œå­¦ä¹ çš„ç»éªŒè¿›è¡Œæ”¶é›†æ•´ç†è€Œæˆçš„ä¸€æœ¬å°å†Œå­ã€‚ä½†å…¶ä¸­çš„å†…å®¹è¿œä¸æ­¢è¿™äº›ï¼Œæ— è®ºæ˜¯å­¦æœ¯ã€æŠ€æœ¯ã€äº§å“ã€æ¼”è®²ã€å†™ä½œã€äº’è”ç½‘ã€æ•™è‚²ã€æ€è€ƒçš„æœ¬è´¨ç­‰ï¼Œä¹¦ä¸­éƒ½æœ‰æ‰€æ¶‰çŒï¼Œå¹¶ä¸”è§‚ç‚¹å¥‡ç‰¹ï¼Œæ€è·¯æ–°é¢–ï¼Œé€‚åˆå„ä¸ªåˆ›é€ æ€§é¢†åŸŸçš„äººç¾¤é˜…è¯»ã€‚</p><p><img src="/archives/2018/09/24/book.jpg" alt=""></p><p>è™½ç„¶ä»Šå¤©ä¸»é¢˜æ˜¯è¿™æœ¬ä¹¦ï¼Œæˆ‘è¿˜æ²¡æœ‰çœ‹å®Œè¿™æœ¬ä¹¦ï¼Œä½†æ˜¯æ± è€å¸ˆè¯»äº†ä¸€éå¹¶åœ¨<code>mactalkÂ·è·¨è¶Šè¾¹ç•Œ</code>ä¸Šæ€»ç»“äº†ï¼Œæˆ‘å°±ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼ŒæŒ‘å‡ ä¸ªæ€è€ƒæ€§çš„è§‚ç‚¹ï¼Œåšä¸€ä¸‹å­¦ä¹ æ€è€ƒçš„ç¬”è®°ã€‚</p><h4 id="Best-First"><a href="#Best-First" class="headerlink" title="Best First"></a>Best First</h4><p>é‡‘æ•™æˆæœ‰ä¸ªè§‚ç‚¹å«åšâ€Best Firstâ€œï¼Œæ„ä¸ºæœ€å¥½ä¸œè¥¿ä¸€å®šè¦æ”¾åœ¨æœ€å‰é¢ã€‚æ— è®ºæ˜¯æ¼”è®²è¿˜æ˜¯å†™ä¹¦ï¼Œé‡‘æ•™æˆéƒ½éµå¾ªè¿™ä¸ªè§„åˆ™ã€‚è§‚ä¼—æˆ–è¯»è€…éƒ½å¸Œæœ›å¼€å§‹çš„æ—¶å€™å°±çœ‹åˆ°æœ€å¥½çš„ä¸œè¥¿ï¼Œå¾ˆå¤šæ¼”è®²æˆ–å›¾ä¹¦éƒ½å–œæ¬¢åšä¸€äº›å†—é•¿çš„é“ºå«æ‰è¿›å…¥ä¸»é¢˜ï¼Œå²‚ä¸çŸ¥é‚£äº›é“ºå«å·²ç»è€—å°½äº†æˆ‘ä»¬è§‚ä¼—çš„è€å¿ƒã€‚</p><p>è¿™ä¸ªè§‚ç‚¹éå¸¸çš„æœ‰è¶£ï¼ŒåŸºäºæ­¤ï¼Œæˆ‘ä»¬å°±çŸ¥é“ï¼Œä¹¦ä¸­çš„æ ¸å¿ƒå†…å®¹æ¯«æ— ç–‘é—®å°±æ˜¯ç¬¬ä¸€ç« ï¼šåƒå¤–è¡Œä¸€æ ·æ€è€ƒï¼Œåƒä¸“å®¶ä¸€æ ·å®è·µã€‚</p><h4 id="å…³äºåå¯¹"><a href="#å…³äºåå¯¹" class="headerlink" title="å…³äºåå¯¹"></a>å…³äºåå¯¹</h4><blockquote><p>æ˜æ–¯åŸºæ•™æˆï¼Œæ‚¨æ€»æ˜¯èƒ½åœ¨å„ç§é¢†åŸŸä¸­æƒ³å‡ºå¾ˆå¤šåˆ›é€ æ€§çš„ï¼Œå¼•äººå…¥èƒœä¸”èƒ½å¤Ÿå¼•å¯¼æ–°æ–¹å‘çš„æ„æ€ã€‚è¯·é—®æ‚¨çš„è¯€çªæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä»–å›ç­”è¯´ï¼šè¿™ä¸ªå¾ˆç®€å•ï¼Œåªè¦åå¯¹å¤§å®¶çš„æ‰€è¯´çš„å°±å¯ä»¥äº†ã€‚å¤§å®¶éƒ½è®¤åŒçš„å¥½æƒ³æ³•åŸºæœ¬ä¸Šéƒ½ä¸å¤ªä»¤äººæ»¡æ„ã€‚</p></blockquote><h4 id="å…³äºè¿·èŒ«"><a href="#å…³äºè¿·èŒ«" class="headerlink" title="å…³äºè¿·èŒ«"></a>å…³äºè¿·èŒ«</h4><blockquote><p>é‡‘æ•™æˆè¯´ï¼šè¶Šèƒ½å¹²çš„äººè¶Šè¿·èŒ«ã€‚</p><p>å°±ç®—æ˜¯å¡å†…åŸºÂ·æ¢…éš†å¤§å­¦çš„è®¡ç®—æœºç§‘å­¦ç³»å’Œæœºå™¨äººç ”ç©¶æ‰€çš„åšå£«ç ”ç©¶ç”Ÿï¼Œä»–ä»¬å‡ºç±»æ‹”èƒæ— æ‰€ä¸èƒ½ï¼Œä¹Ÿé¿å…ä¸äº†è¿™ç§æ„Ÿè§‰ã€‚ä¸ï¼Œåº”è¯¥è¯´ï¼Œæ­£æ˜¯è¿™ç§äººï¼Œæ‰æ›´å®¹æ˜“é™·å…¥ä¸å®‰å’Œè¿·èŒ«ã€‚</p></blockquote><p>å¦‚æœä½ å·¥ä½œæ—¶ï¼Œç»å¸¸åœ¨â€èƒ½ä¸èƒ½è¡Œå‘¢ï¼Ÿâ€œçš„ä¸å®‰æ„Ÿå’Œâ€œå•Šï¼ŒæˆåŠŸäº†ï¼â€çš„æˆå°±æ„Ÿä¹‹é—´å¾€å¤è¡Œèµ°ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œç¦»æˆåŠŸå·²ç»æ²¡æœ‰å‡ å…¬é‡Œäº†ã€‚äº¤ç»‡ç€è¿™ä¸¤ç§æ„Ÿè§‰çš„ä½“éªŒå°†æˆä¸ºä½ æ™ºæ…§å’Œä½“åŠ›çš„å¼ºæœ‰åŠ›åŸºçŸ³ã€‚è¿™ä¹Ÿä»æŸç§ç¨‹åº¦ä¸Šè§£é‡Šäº†æˆ‘ä¸ºä»€ä¹ˆä¼šç»å¸¸å¤„äºä¸€ç§è¿·èŒ«çš„çŠ¶æ€ä¹ˆï¼Ÿ</p><h4 id="å…³äºè®°å¿†åŠ›"><a href="#å…³äºè®°å¿†åŠ›" class="headerlink" title="å…³äºè®°å¿†åŠ›"></a>å…³äºè®°å¿†åŠ›</h4><blockquote><p>æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œå¯¹äºäººçš„çŸ¥è§‰ã€æ€è€ƒã€è¡ŒåŠ¨ç­‰ï¼Œè¿½æœ¬æº¯æºï¼Œæœ€ç»ˆéƒ½ä¼šè½åœ¨è®°å¿†ä¸Šï¼Œå¦‚æœå¤´è„‘ä¸­æ²¡æœ‰çŸ¥è¯†å’Œä¿¡æ¯ä½œä¸ºå·¥å…·ã€ææ–™ï¼Œæ˜¯ä¸å¯èƒ½å‘æŒ¥è§„åˆ’èƒ½åŠ›å’Œåˆ›é€ èƒ½åŠ›çš„ã€‚æ„æ€å°±æ˜¯é€šè¿‡é‡ç»„è„‘æµ·ä¸­çš„è®°å¿†è€Œäº§ç”Ÿçš„ã€‚å¦‚æœæ²¡æœ‰è‰¯å¥½è€Œå¹¿åšçš„è®°å¿†å†…å®¹åšåŸºç¡€ï¼Œæ ¹æœ¬äº§ç”Ÿä¸äº†ä»€ä¹ˆå¥½çš„æ„æ€ã€‚å› æ­¤ï¼Œæœ€æœ‰æ•ˆçš„å­¦ä¹ æ–¹æ³•å°±æ˜¯è®°å¿†ã€‚æŠŠä»–äººé•¿æ—¶é—´æ€è€ƒæ€»ç»“å‡ºæ¥çš„æˆæœè®°å¿†ä¸‹æ¥ï¼Œä¸ä»…é«˜æ•ˆå¿«æ·ï¼Œä¹Ÿèƒ½ä¸ºè‡ªèº«çš„æ€è€ƒæ‰©å±•åŸºç¡€ã€‚å½“ç„¶ï¼Œè¿™é‡Œæ‰€è°“çš„è®°å¿†ï¼Œæ˜¯æŒ‡â€ç»è¿‡ç†è§£çš„è®°å¿†â€ï¼Œè¿™ä¸€ç‚¹æ— éœ€å¤šè¨€ã€‚</p></blockquote><h4 id="å…³äºé¢ è¦†"><a href="#å…³äºé¢ è¦†" class="headerlink" title="å…³äºé¢ è¦†"></a>å…³äºé¢ è¦†</h4><blockquote><p>è®¡ç®—æœºçš„å‘å±•æ—¥æ–°æœˆå¼‚ã€‚20ä¸–çºª60å¹´ä»£ï¼Œè®¡ç®—æœºåƒç«èµ›ä¸€æ ·æŒ‡æ•°å‘å±•ï¼Œä½†åˆ°äº†20ä¸–çºª80å¹´ä»£ï¼Œå‘å±•é€Ÿåº¦å‡ç¼“ï¼Œç”šè‡³æœ‰äººè¯´è®¡ç®—æœºä¸ä¼šå†è¿›æ­¥äº†ï¼Œè¿˜ä¸¾äº†å¾ˆå¤šä¾‹å­ï¼šç¡…æ™¶ä½“ä¸Šä¸èƒ½ç”»å†ç»†çš„çº¿äº†ï¼Œä¸èƒ½åˆ¶é€ å‡ºæ›´å°çš„æ™¶ä½“ç®¡äº†ï¼Œç¡¬ç›˜çš„å­˜å‚¨å¯†åº¦ä¸èƒ½å†å¢å¤§äº†ï¼Œç­‰ç­‰ã€‚æ ¹æ®è¿™äº›è¯´æ³•ä»–ä»¬å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼šå‘å±•ç“¶é¢ˆç»ˆå°†åˆ°æ¥ã€‚</p></blockquote><p>ç§‘å­¦çš„è¿›æ­¥å°±æ˜¯ä¸æ–­çªç ´æé™å’Œå¼€è¾Ÿæ–°çš„é¢†åŸŸï¼Œæ¯ä¸ªäººçš„å¥‹æ–—å°±æ˜¯çªç ´è‡ªå·±ã€‚</p><h4 id="å…³äºä¸å¯èƒ½åŸåˆ™"><a href="#å…³äºä¸å¯èƒ½åŸåˆ™" class="headerlink" title="å…³äºä¸å¯èƒ½åŸåˆ™"></a>å…³äºä¸å¯èƒ½åŸåˆ™</h4><blockquote><p>ç¬¬ä¸€æ¡ï¼šç§‘å­¦å·¥ä½œè€…å£°æ˜æŸä»¶äº‹æƒ…æ˜¯å¯è¡Œçš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šä»–ä¸ä¼šé”™ã€‚ä½†å½“ä»–è¯´ä¸å¯èƒ½çš„æ—¶å€™ï¼Œä»–å¾ˆå¯èƒ½é”™äº†ã€‚ç¬¬äºŒæ¡ï¼šå‘ç°æé™åœ¨å“ªé‡Œçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯è¶…è¶Šæé™ï¼Œå°è¯•å‘ç¨å¾®è¶…è¶Šè¿™ä¸ªæé™çš„é¢†åŸŸè¿ˆè¿›ã€å†’é™©ã€‚ç¬¬ä¸‰æ¡ï¼šæ— è®ºæ˜¯å“ªç§æŠ€æœ¯ï¼Œåªè¦å®ƒæ˜¯éå¸¸å…ˆè¿›çš„ï¼Œé‚£çœ‹èµ·æ¥éƒ½è·Ÿé­”æœ¯æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</p></blockquote><p>å¦‚æœå‡ºç°ä¸€ä¸ªæƒ³æ³•å’Œåˆ›æ„ï¼Œçœ‹èµ·æ¥ä¸å¯èƒ½å®ç°ï¼Œå®é™…ä¸Šä½ å¯èƒ½é”™äº†ã€‚å¦‚æœå‘ç°è‡ªå·±çš„æ‰€åšçš„äº‹æƒ…å·²ç»åšåˆ°äº†æé™ï¼Œå¯ä»¥è¯•è¯•è¶…è¶Šæé™è¿ˆè¿›ä¸€æ­¥ã€‚</p><h4 id="å…³äºæ¼”è®²å’Œäº¤æµ"><a href="#å…³äºæ¼”è®²å’Œäº¤æµ" class="headerlink" title="å…³äºæ¼”è®²å’Œäº¤æµ"></a>å…³äºæ¼”è®²å’Œäº¤æµ</h4><blockquote><p>åœ¨ä¸ä»–äººäº¤æµçš„è¿‡ç¨‹ä¸­å®Œå–„è‡ªå·±çš„æƒ³æ³•ã€‚æ— è®ºä»€ä¹ˆæ ·çš„æ„æƒ³ï¼Œæœ€åˆå¤§éƒ½åªæ˜¯ä¸ªå¶ç„¶çš„æƒ³æ³•ã€‚é”¤ç‚¼æ„æƒ³çš„æ–¹æ³•å°±æ˜¯è·Ÿä»–äººäº¤æµï¼Œåœ¨äº¤è°ˆä¸­éªŒè¯æ˜¯ä¸æ˜¯ä¸€ä¸ªæœ‰ä»·å€¼çš„æƒ³æ³•ï¼Œå¹¶ä¸”è·å–ç›¸å…³çŸ¥è¯†ï¼Œä¿®æ­£ä¸å®Œå¤‡çš„åœ°æ–¹ã€‚å‡åæ„æƒ³çš„å…³é”®æ˜¯â€œäº¤æµâ€ï¼Œå› ä¸ºä»–äººæœ‰å¾ˆå¤šè‡ªå·±è§’åº¦çš„è®¤è¯†å’Œæƒ³æ³•ï¼Œå€Ÿé‰´è¿‡æ¥æ‰èƒ½å®Œå–„è‡ªå·±çš„æ„æƒ³ã€‚</p></blockquote><h4 id="åˆ›é€ çš„åŸºç¡€æ˜¯æ¨¡ä»¿"><a href="#åˆ›é€ çš„åŸºç¡€æ˜¯æ¨¡ä»¿" class="headerlink" title="åˆ›é€ çš„åŸºç¡€æ˜¯æ¨¡ä»¿"></a>åˆ›é€ çš„åŸºç¡€æ˜¯æ¨¡ä»¿</h4><blockquote><p>æ¨¡ä»¿ã€ç›¸ä¼¼ï¼Œè¿™æ ·ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿæœ€åˆçš„æƒ³æ³•çš„ç¡®æ˜¯ç›¸åŒçš„ï¼Œä½†åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šæ·»åŠ ä¸œè¥¿ã€ä½¿ä¹‹å‡åçš„æ°´å¹³é«˜ä½æ‰æ˜¯å†³å®šèƒœè´Ÿçš„å…³é”®ã€‚å› æ­¤ï¼Œå¤§éƒ¨åˆ†çš„åˆ›é€ éƒ½æ˜¯åœ¨æ¨¡ä»¿çš„åŸºç¡€ä¹‹ä¸Šå¢åŠ å…¶é™„åŠ ä»·å€¼çš„ä¸œè¥¿ã€‚ç‹¬åˆ›ã€åˆ›é€ ï¼Œä¸æ˜¯æ— ä¸­ç”Ÿæœ‰çš„é­”æœ¯ã€‚</p></blockquote><p>æœ‰ä¸€æ®µæ—¶é—´è‡ªå·±éå¸¸åŒæ¶<code>CVæˆ˜å£«</code>å¼çš„å·¥ä½œï¼Œæ€»æƒ³é€ ç‚¹æ–°çš„è½®å­æˆ–å·¥å…·ã€‚æƒ³è¦åˆ›é€ å‡ºçš„æ–°çš„ä¸œè¥¿ï¼Œé‚£ä¸€å®šæ˜¯åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šæˆ–æ€ç»´æ ¼å±€ä¸Šè¿›è¡Œæ–°çš„æ”¹é€ å’Œå‘ç°ã€‚</p><p>æœ€åç»“å°¾å¼•ç”¨æ± è€å¸ˆçš„æ€»ç»“ã€‚å›åˆ°æœ€åˆçš„é—®é¢˜ï¼Œå¦‚ä½•åœ¨ä¸“å®¶å’Œå‚»ç“œä¹‹é—´è¿›è¡Œè‡ªç”±çš„åˆ‡æ¢å‘¢ï¼Ÿå…¶å®é‡‘æ•™æˆå·²ç»å†™åœ¨ä¹¦é‡Œäº†ï¼š</p><p>æ€è€ƒçš„æ—¶å€™ï¼Œè¦åƒå¤–è¡Œä¸€æ ·å•çº¯ç›´æ¥ï¼Œå®è·µçš„æ—¶å€™åˆ™è¦åƒä¸“å®¶ä¸€æ ·ä¸¥å¯†ç»†è‡´ï¼Œå¹¶ä¸”è¦æœ‰ä»¥ä¸“ä¸šçŸ¥è¯†å’Œæ–¹æ³•æ­¦è£…èµ·æ¥çš„â€œæˆ‘åšå¾—åˆ°â€çš„ä¹è§‚ä¸»ä¹‰ç²¾ç¥ã€‚è¦è®°ä½ï¼Œç‹¬ç‰¹çš„ã€å¥½çš„åˆ›æ„å’Œå¥½çš„ç»“å°¾ï¼Œä¸ç®¡æ˜¯å¯¹ç ”ç©¶è€Œè¨€ï¼Œè¿˜æ˜¯å¯¹å•†ä¸šè¿è¥è€Œè¨€ï¼Œéƒ½ä¸æ˜¯è‡ªå·±çªç„¶å†’å‡ºæ¥çš„ä¸œè¥¿ï¼Œé‚£ä¸€å®šæ˜¯åˆ»è‹¦çš„åŠªåŠ›å’Œé•¿æœŸçš„æ€è€ƒå¸¦æ¥çš„ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;é‡‘å‡ºæ­¦é›„ï¼ˆKanade Takeoï¼‰æ˜¯ç¾å›½å¡å†…åŸºÂ·æ¢…éš†å¤§å­¦ï¼ˆCMUï¼‰çš„æœºå™¨äººè§†è§‰ç ”ç©¶æ‰€æ‰€é•¿ï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€é‡è¦çš„è®¡ç®—æœºæ˜¯è§†è§‰ç ”ç©¶äººå‘˜ä¹‹ä¸€ã€‚&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;/archives/2018/09/24/kanade_takeo_2014.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="éšç¬”æ‚è®°" scheme="https://pross.space/tags/%E9%9A%8F%E7%AC%94%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>SparkStreamingä¹‹è§£æmapWithState</title>
    <link href="https://pross.space/archives/2018/09/10/"/>
    <id>https://pross.space/archives/2018/09/10/</id>
    <published>2018-09-10T01:56:59.000Z</published>
    <updated>2018-09-16T12:45:01.485Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>æœ€è¿‘ç»å†æŒ«æŠ˜æ•™è‚²ï¼Œä»Šå¤©é—²å¾—æ—¶é—´ï¼Œæ•´ç†çŠ¶æ€ç®¡ç†ä¹‹è§£æmapWithStateã€‚ä»Šå¤©è¯´é“çš„mapWithStateæ˜¯ä»Spark1.6å¼€å§‹å¼•å…¥çš„ä¸€ç§æ–°çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œæ”¯æŒè¾“å‡ºå…¨é‡çš„çŠ¶æ€å’Œæ›´æ–°çš„çŠ¶æ€ï¼Œæ”¯æŒå¯¹çŠ¶æ€è¶…æ—¶çš„ç®¡ç†ï¼Œå’Œè‡ªä¸»é€‰æ‹©éœ€è¦çš„è¾“å‡ºã€‚</p><a id="more"></a><h3 id="ä¸¾ä¸ªä¾‹å­"><a href="#ä¸¾ä¸ªä¾‹å­" class="headerlink" title="ä¸¾ä¸ªä¾‹å­"></a>ä¸¾ä¸ªä¾‹å­</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> stateParse</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.spark.streaming._</div><div class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Author: shawn pross</span></div><div class="line"><span class="comment">* Date: 2018/09/10</span></div><div class="line"><span class="comment">* Description: </span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMapWithState</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</div><div class="line"><span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>()</div><div class="line">conf.setAppName(<span class="string">s"<span class="subst">$&#123;this.getClass.getSimpleName&#125;</span>"</span>)</div><div class="line">conf.setMaster(<span class="string">"local[2]"</span>)</div><div class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line"><span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(sc, <span class="type">Seconds</span>(<span class="number">3</span>))</div><div class="line">ssc.checkpoint(<span class="string">"/checkpoint/"</span>)</div><div class="line"></div><div class="line"><span class="keyword">val</span> line = ssc.socketTextStream(<span class="string">"127.0.0.1"</span>,<span class="number">9999</span>)</div><div class="line"><span class="keyword">val</span> wordDStream = line.flatMap(_.split(<span class="string">","</span>)).map(x=&gt;(x,<span class="number">1</span>))</div><div class="line"></div><div class="line"><span class="comment">//çŠ¶æ€æ›´æ–°å‡½æ•°ï¼Œoutputæ˜¯è¾“å‡ºï¼Œstateæ˜¯çŠ¶æ€</span></div><div class="line"><span class="keyword">val</span> mappingFunc = (userId:<span class="type">String</span>,value:<span class="type">Option</span>[<span class="type">Int</span>],state:<span class="type">State</span>[<span class="type">Int</span>])=&gt;&#123;</div><div class="line"><span class="keyword">val</span> sum= value.getOrElse(<span class="number">0</span>) + state.getOption().getOrElse(<span class="number">0</span>)</div><div class="line"><span class="keyword">val</span> output = (userId,sum)</div><div class="line">state.update(sum)</div><div class="line">output</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//é€šè¿‡mapWithStateæ›´æ–°çŠ¶æ€ï¼Œè®¾ç½®çŠ¶æ€è¶…æ—¶æ—¶é—´ä¸º1å°æ—¶</span></div><div class="line"><span class="keyword">val</span> stateDStream = wordDStream.mapWithState(<span class="type">StateSpec</span>.function(mappingFunc).timeout(<span class="type">Minutes</span>(<span class="number">60</span>))).print()</div><div class="line"></div><div class="line">ssc.start()</div><div class="line">ssc.awaitTermination()</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><code>mapWithState</code>æ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ª<code>StateSpec</code>å¯¹è±¡ï¼Œåœ¨StateSpecä¸­å°è£…äº†çŠ¶æ€ç®¡ç†çš„å‡½æ•°ã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªçŠ¶æ€æ›´æ–°å‡½æ•°<code>mappingFunc</code>ï¼Œè¯¥å‡½æ•°ä¼šæ›´æ–°æŒ‡å®šç”¨æˆ·çš„çŠ¶æ€ï¼ŒåŒæ—¶ä¼šè¿”å›æ›´æ–°åçš„çŠ¶æ€ï¼Œå°†è¯¥å‡½æ•°ä¼ ç»™<code>mapWithState</code>ï¼Œå¹¶è®¾ç½®çŠ¶æ€è¶…æ—¶æ—¶é—´ã€‚SparkStreamingé€šè¿‡æ ¹æ®æˆ‘ä»¬å®šä¹‰çš„æ›´æ–°å‡½æ•°ï¼Œåœ¨æ¯ä¸ªè®¡ç®—æ—¶é—´é—´éš”å†…æ›´æ–°å†…éƒ¨ç»´æŠ¤çš„çŠ¶æ€ï¼ŒåŒæ—¶è¿”å›ç»è¿‡<code>mappingFunc</code>å¤„ç†åçš„ç»“æœæ•°æ®æµã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å®ç°æ–¹å¼ã€‚</p><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>ä»£ç ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ˜¯åœ¨<code>StateSpec</code>ä¸­å°è£…çŠ¶æ€ç®¡ç†çš„å‡½æ•°ï¼Œæ·±å…¥ç ”ç©¶ï¼Œçœ‹çœ‹æ€ä¹ˆå®ç°çš„ã€‚æˆ‘ä»¬å‘ç°<code>mapWithState</code>å‡½æ•°ä¼šåˆ›å»ºäº†<code>MapWithStateDStreamImpl</code>å¯¹è±¡ï¼›ç»§ç»­å¾€ä¸‹å¯»æ‰¾ï¼Œå…¶å®<code>MapWithStateDStreamImp</code>æ˜¯ç»§æ‰¿äº†<code>MapWithStateDStream</code>ï¼Œè€Œ<code>MapWithStateDStream</code>çš„çˆ¶ç±»å®é™…ä¸Šæ˜¯<code>DStream</code>ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// mapWithStateå‡½æ•°ä¸­åˆ›å»ºäº†MapWithStateDStreamImplå¯¹è±¡</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">mapWithState</span></span>[<span class="type">StateType</span>: <span class="type">ClassTag</span>, <span class="type">MappedType</span>: <span class="type">ClassTag</span>](</div><div class="line">      spec: <span class="type">StateSpec</span>[<span class="type">K</span>, <span class="type">V</span>, <span class="type">StateType</span>, <span class="type">MappedType</span>]</div><div class="line">    ): <span class="type">MapWithStateDStream</span>[<span class="type">K</span>, <span class="type">V</span>, <span class="type">StateType</span>, <span class="type">MappedType</span>] = &#123;</div><div class="line">    <span class="keyword">new</span> <span class="type">MapWithStateDStreamImpl</span>[<span class="type">K</span>, <span class="type">V</span>, <span class="type">StateType</span>, <span class="type">MappedType</span>](</div><div class="line">      self,</div><div class="line">      spec.asInstanceOf[<span class="type">StateSpecImpl</span>[<span class="type">K</span>, <span class="type">V</span>, <span class="type">StateType</span>, <span class="type">MappedType</span>]]</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">  * MapWithStateDStreamImplç»§æ‰¿MapWithStateDStream</span></div><div class="line"><span class="comment">  * åˆ›å»ºInternalMapWithStateDStreamç±»å‹å¯¹è±¡çš„internalStream</span></div><div class="line"><span class="comment">  */</span></div><div class="line"><span class="keyword">private</span>[streaming] <span class="class"><span class="keyword">class</span> <span class="title">MapWithStateDStreamImpl</span>[</span></div><div class="line"><span class="class">    <span class="type">KeyType</span>: <span class="type">ClassTag</span>, <span class="type">ValueType</span>: <span class="type">ClassTag</span>, <span class="type">StateType</span>: <span class="type">ClassTag</span>, <span class="type">MappedType</span>: <span class="type">ClassTag</span>](<span class="params"></span></span></div><div class="line"><span class="class"><span class="params">    dataStream: <span class="type">DStream</span>[(<span class="type">KeyType</span>, <span class="type">ValueType</span></span>)],</span></div><div class="line"><span class="class">    <span class="title">spec</span></span>: <span class="type">StateSpecImpl</span>[<span class="type">KeyType</span>, <span class="type">ValueType</span>, <span class="type">StateType</span>, <span class="type">MappedType</span>])</div><div class="line">  <span class="keyword">extends</span> <span class="type">MapWithStateDStream</span>[<span class="type">KeyType</span>, <span class="type">ValueType</span>, <span class="type">StateType</span>, <span class="type">MappedType</span>](dataStream.context) &#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="keyword">val</span> internalStream =</div><div class="line">    <span class="keyword">new</span> <span class="type">InternalMapWithStateDStream</span>[<span class="type">KeyType</span>, <span class="type">ValueType</span>, <span class="type">StateType</span>, <span class="type">MappedType</span>](dataStream, spec)</div><div class="line">      </div><div class="line">  ...</div><div class="line"> </div><div class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">compute</span></span>(validTime: <span class="type">Time</span>): <span class="type">Option</span>[<span class="type">RDD</span>[<span class="type">MappedType</span>]] = &#123;</div><div class="line">    internalStream.getOrCompute(validTime).map &#123; _.flatMap[<span class="type">MappedType</span>] &#123; _.mappedData &#125; &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">      </div><div class="line"><span class="comment">//MapWithStateDStreamçš„çˆ¶ç±»å®é™…ä¸Šæ˜¯DStream</span></div><div class="line"><span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MapWithStateDStream</span>[<span class="type">KeyType</span>, <span class="type">ValueType</span>, <span class="type">StateType</span>, <span class="type">MappedType</span>: <span class="type">ClassTag</span>](<span class="params"></span></span></div><div class="line"><span class="class"><span class="params">    ssc: <span class="type">StreamingContext</span></span>) <span class="keyword">extends</span> <span class="title">DStream</span>[<span class="type">MappedType</span>](<span class="params">ssc</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">/** Return a pair DStream where each RDD is the snapshot of the state of all the keys. */</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">stateSnapshots</span></span>(): <span class="type">DStream</span>[(<span class="type">KeyType</span>, <span class="type">StateType</span>)]</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMapWithStateDStreamImpl ä¸­åˆ›å»ºäº†ä¸€ä¸ª<code>InternalMapWithStateDStream</code>ç±»å‹å¯¹è±¡<code>internalStream</code>ï¼Œåœ¨MapWithStateDStreamImplçš„<code>compute</code>æ–¹æ³•ä¸­è°ƒç”¨äº†internalStreamçš„<code>getOrCompute</code>æ–¹æ³•ã€‚</p><p>å®é™…ä¸Šï¼ŒInternalMapWithStateDStreamä¸­æ²¡æœ‰getOrComputeæ–¹æ³•ï¼Œæœ€ç»ˆæ˜¯è°ƒç”¨çˆ¶ç±» DStream çš„getOrCpmputeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­æœ€ç»ˆä¼šè°ƒç”¨InternalMapWithStateDStreamä¸­é‡å†™çš„Computeæ–¹æ³•ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/** Method that generates an RDD for the given time */</span></div><div class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">compute</span></span>(validTime: <span class="type">Time</span>): <span class="type">Option</span>[<span class="type">RDD</span>[<span class="type">MapWithStateRDDRecord</span>[<span class="type">K</span>, <span class="type">S</span>, <span class="type">E</span>]]] = &#123;</div><div class="line">    <span class="comment">// Get the previous state or create a new empty state RDD</span></div><div class="line">    <span class="keyword">val</span> prevStateRDD = getOrCompute(validTime - slideDuration) <span class="keyword">match</span> &#123;</div><div class="line">      <span class="keyword">case</span> <span class="type">Some</span>(rdd) =&gt;</div><div class="line">        <span class="keyword">if</span> (rdd.partitioner != <span class="type">Some</span>(partitioner)) &#123;</div><div class="line">          <span class="comment">// If the RDD is not partitioned the right way, let us repartition it using the</span></div><div class="line">          <span class="comment">// partition index as the key. This is to ensure that state RDD is always partitioned</span></div><div class="line">          <span class="comment">// before creating another state RDD using it</span></div><div class="line">          <span class="type">MapWithStateRDD</span>.createFromRDD[<span class="type">K</span>, <span class="type">V</span>, <span class="type">S</span>, <span class="type">E</span>](</div><div class="line">            rdd.flatMap &#123; _.stateMap.getAll() &#125;, partitioner, validTime)</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          rdd</div><div class="line">        &#125;</div><div class="line">      <span class="keyword">case</span> <span class="type">None</span> =&gt;</div><div class="line">        <span class="type">MapWithStateRDD</span>.createFromPairRDD[<span class="type">K</span>, <span class="type">V</span>, <span class="type">S</span>, <span class="type">E</span>](</div><div class="line">          spec.getInitialStateRDD().getOrElse(<span class="keyword">new</span> <span class="type">EmptyRDD</span>[(<span class="type">K</span>, <span class="type">S</span>)](ssc.sparkContext)),</div><div class="line">          partitioner,</div><div class="line">          validTime</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// Compute the new state RDD with previous state RDD and partitioned data RDD</span></div><div class="line">    <span class="comment">// Even if there is no data RDD, use an empty one to create a new state RDD</span></div><div class="line">    <span class="keyword">val</span> dataRDD = parent.getOrCompute(validTime).getOrElse &#123;</div><div class="line">      context.sparkContext.emptyRDD[(<span class="type">K</span>, <span class="type">V</span>)]</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">val</span> partitionedDataRDD = dataRDD.partitionBy(partitioner)</div><div class="line">    <span class="keyword">val</span> timeoutThresholdTime = spec.getTimeoutInterval().map &#123; interval =&gt;</div><div class="line">      (validTime - interval).milliseconds</div><div class="line">    &#125;</div><div class="line">    <span class="type">Some</span>(<span class="keyword">new</span> <span class="type">MapWithStateRDD</span>(</div><div class="line">      prevStateRDD, partitionedDataRDD, mappingFunction, validTime, timeoutThresholdTime))</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>InternalMapWithStateDStreamä¸­é‡å†™çš„Computeæ–¹æ³•æ˜¯å…³é”®ã€‚æ ¹æ®ç»™å®šçš„æ—¶é—´ç”Ÿæˆä¸€ä¸ª<code>MapWithStateRDD</code>ï¼Œé¦–å…ˆè·å–äº†å…ˆå‰çŠ¶æ€çš„RDDï¼špreStateRDDå’Œå½“å‰æ—¶é—´çš„RDDï¼šdataRDDï¼Œç„¶åå¯¹dataRDDåŸºäºå…ˆå‰çŠ¶æ€RDDçš„åˆ†åŒºå™¨è¿›è¡Œé‡æ–°åˆ†åŒºè·å–<code>partitionedDataRDD</code>ï¼Œæœ€åå°†<code>preStateRDD</code>ï¼Œ<code>partitionedDataRDD</code>ï¼Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°<code>mappingFunction</code>å’Œæ—¶é—´æˆ³ä¼ ç»™æ–°ç”Ÿæˆçš„<code>MapWithStateRDD</code>å¯¹è±¡ï¼Œå¾—å‡ºç»“æœå¹¶è¿”å›ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å…³é”®çš„MapWithStateRDDçš„<code>compute</code>æ–¹æ³•ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">compute</span></span>(</div><div class="line">      partition: <span class="type">Partition</span>, context: <span class="type">TaskContext</span>): <span class="type">Iterator</span>[<span class="type">MapWithStateRDDRecord</span>[<span class="type">K</span>, <span class="type">S</span>, <span class="type">E</span>]] = &#123;</div><div class="line"></div><div class="line">    <span class="keyword">val</span> stateRDDPartition = partition.asInstanceOf[<span class="type">MapWithStateRDDPartition</span>]</div><div class="line">    <span class="keyword">val</span> prevStateRDDIterator = prevStateRDD.iterator(</div><div class="line">      stateRDDPartition.previousSessionRDDPartition, context)</div><div class="line">    <span class="keyword">val</span> dataIterator = partitionedDataRDD.iterator(</div><div class="line">      stateRDDPartition.partitionedDataRDDPartition, context)</div><div class="line">    <span class="comment">//preRecordä»£è¡¨ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®</span></div><div class="line">    <span class="keyword">val</span> prevRecord = <span class="keyword">if</span> (prevStateRDDIterator.hasNext) <span class="type">Some</span>(prevStateRDDIterator.next()) <span class="keyword">else</span> <span class="type">None</span></div><div class="line">    <span class="keyword">val</span> newRecord = <span class="type">MapWithStateRDDRecord</span>.updateRecordWithData(</div><div class="line">      prevRecord,</div><div class="line">      dataIterator,</div><div class="line">      mappingFunction,</div><div class="line">      batchTime,</div><div class="line">      timeoutThresholdTime,</div><div class="line">      removeTimedoutData = doFullScan <span class="comment">// remove timed-out data only when full scan is enabled</span></div><div class="line">    )</div><div class="line">    <span class="type">Iterator</span>(newRecord)</div><div class="line">  &#125;</div></pre></td></tr></table></figure><p><code>MapWithStateRDDRecord</code> å¯¹åº”MapWithStateRDD çš„ä¸€ä¸ªåˆ†åŒºï¼Œ<code>StateMap</code>å­˜å‚¨äº†keyçš„çŠ¶æ€ï¼ŒmappedDataå­˜å‚¨äº†mappingFuncå‡½æ•°çš„è¿”å›å€¼ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span>[streaming] <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">MapWithStateRDDRecord</span>[<span class="type">K</span>, <span class="type">S</span>, <span class="type">E</span>](<span class="params"></span></span></div><div class="line"><span class="class"><span class="params">    var stateMap: <span class="type">StateMap</span>[<span class="type">K</span>, <span class="type">S</span>], var mappedData: <span class="type">Seq</span>[<span class="type">E</span>]</span>)</span></div></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹<code>MapWithStateRDDRecord.updateRecordWithData</code>æ–¹æ³•ï¼Œ<code>newStateMap</code>æ˜¯åˆ›å»ºä¸€ä¸ª<code>StateMap</code>ï¼Œä»è¿‡å»çš„Recordä¸­å¤åˆ¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™å°±åˆ›å»ºæ–°çš„StateMapå¯¹è±¡ã€‚æœ€ç»ˆè¿”å›<code>MapWithSateRDDRecord</code>å¯¹è±¡äº¤ç»™MapWithStateRDDçš„<code>compute</code>å‡½æ•°ï¼ŒMapWithStateRDDçš„computeå‡½æ•°å°†å…¶å°è£…æˆIteratorè¿”å›å‡ºå»ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">updateRecordWithData</span></span>[<span class="type">K</span>: <span class="type">ClassTag</span>, <span class="type">V</span>: <span class="type">ClassTag</span>, <span class="type">S</span>: <span class="type">ClassTag</span>, <span class="type">E</span>: <span class="type">ClassTag</span>](</div><div class="line">    prevRecord: <span class="type">Option</span>[<span class="type">MapWithStateRDDRecord</span>[<span class="type">K</span>, <span class="type">S</span>, <span class="type">E</span>]],</div><div class="line">    dataIterator: <span class="type">Iterator</span>[(<span class="type">K</span>, <span class="type">V</span>)],</div><div class="line">    mappingFunction: (<span class="type">Time</span>, <span class="type">K</span>, <span class="type">Option</span>[<span class="type">V</span>], <span class="type">State</span>[<span class="type">S</span>]) =&gt; <span class="type">Option</span>[<span class="type">E</span>],</div><div class="line">    batchTime: <span class="type">Time</span>,</div><div class="line">    timeoutThresholdTime: <span class="type">Option</span>[<span class="type">Long</span>],</div><div class="line">    removeTimedoutData: <span class="type">Boolean</span></div><div class="line">  ): <span class="type">MapWithStateRDDRecord</span>[<span class="type">K</span>, <span class="type">S</span>, <span class="type">E</span>] = &#123;</div><div class="line">    <span class="comment">// Create a new state map by cloning the previous one (if it exists) or by creating an empty one</span></div><div class="line">    <span class="keyword">val</span> newStateMap = prevRecord.map &#123; _.stateMap.copy() &#125;. getOrElse &#123; <span class="keyword">new</span> <span class="type">EmptyStateMap</span>[<span class="type">K</span>, <span class="type">S</span>]() &#125;</div><div class="line"></div><div class="line">    <span class="keyword">val</span> mappedData = <span class="keyword">new</span> <span class="type">ArrayBuffer</span>[<span class="type">E</span>]</div><div class="line">    <span class="keyword">val</span> wrappedState = <span class="keyword">new</span> <span class="type">StateImpl</span>[<span class="type">S</span>]()</div><div class="line"></div><div class="line">    <span class="comment">// Call the mapping function on each record in the data iterator, and accordingly</span></div><div class="line">    <span class="comment">// update the states touched, and collect the data returned by the mapping function</span></div><div class="line">    dataIterator.foreach &#123; <span class="keyword">case</span> (key, value) =&gt;</div><div class="line">        <span class="comment">// è·å–keyå¯¹åº”çš„çŠ¶æ€</span></div><div class="line">      wrappedState.wrap(newStateMap.get(key))</div><div class="line">        <span class="comment">// è°ƒç”¨mappingFuncè·å–è¿”å›å€¼</span></div><div class="line">      <span class="keyword">val</span> returned = mappingFunction(batchTime, key, <span class="type">Some</span>(value), wrappedState)</div><div class="line">        <span class="comment">//ç»´æŠ¤newStateMapçš„å€¼</span></div><div class="line">      <span class="keyword">if</span> (wrappedState.isRemoved) &#123;</div><div class="line">        newStateMap.remove(key)</div><div class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (wrappedState.isUpdated</div><div class="line">          || (wrappedState.exists &amp;&amp; timeoutThresholdTime.isDefined)) &#123;</div><div class="line">        newStateMap.put(key, wrappedState.get(), batchTime.milliseconds)</div><div class="line">      &#125;</div><div class="line">      mappedData ++= returned</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Get the timed out state records, call the mapping function on each and collect the</span></div><div class="line">    <span class="comment">// data returned</span></div><div class="line">    <span class="keyword">if</span> (removeTimedoutData &amp;&amp; timeoutThresholdTime.isDefined) &#123;</div><div class="line">      newStateMap.getByTime(timeoutThresholdTime.get).foreach &#123; <span class="keyword">case</span> (key, state, _) =&gt;</div><div class="line">        wrappedState.wrapTimingOutState(state)</div><div class="line">        <span class="keyword">val</span> returned = mappingFunction(batchTime, key, <span class="type">None</span>, wrappedState)</div><div class="line">        mappedData ++= returned</div><div class="line">        newStateMap.remove(key)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="type">MapWithStateRDDRecord</span>(newStateMap, mappedData)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒmapWithStateæ–¹æ³•æºç æ‰§è¡Œè¿‡ç¨‹æ°´è½çŸ³å‡ºã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;æœ€è¿‘ç»å†æŒ«æŠ˜æ•™è‚²ï¼Œä»Šå¤©é—²å¾—æ—¶é—´ï¼Œæ•´ç†çŠ¶æ€ç®¡ç†ä¹‹è§£æmapWithStateã€‚ä»Šå¤©è¯´é“çš„mapWithStateæ˜¯ä»Spark1.6å¼€å§‹å¼•å…¥çš„ä¸€ç§æ–°çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œæ”¯æŒè¾“å‡ºå…¨é‡çš„çŠ¶æ€å’Œæ›´æ–°çš„çŠ¶æ€ï¼Œæ”¯æŒå¯¹çŠ¶æ€è¶…æ—¶çš„ç®¡ç†ï¼Œå’Œè‡ªä¸»é€‰æ‹©éœ€è¦çš„è¾“å‡ºã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spark" scheme="https://pross.space/tags/Spark/"/>
    
  </entry>
  
  <entry>
    <title>æ— é¢˜</title>
    <link href="https://pross.space/archives/2018/08/25/"/>
    <id>https://pross.space/archives/2018/08/25/</id>
    <published>2018-08-25T14:36:25.000Z</published>
    <updated>2019-07-10T16:30:38.784Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>å²æœˆè¿˜åœ¨çœ¼çœ¸æ‰“åï¼Œä½ çš„å‡æœ›</p><p>ä¹Ÿè®¸åœ¨è‹¦ç­‰ï¼Œæœ‰ä¸æœ½çš„è¯—å¥</p><p>è¯´å®Œè¿™äº›è¯åæˆ‘çš„æ¢¦æƒ³å·²ç»æœ‰æ‹”èŠ‚ä¹‹å£°</p><p>æˆ‘èœ·ç¼©èµ·åŒè…¿</p><p>ä¼¼ä¹æ˜¯åœ¨ä¸ºæ¯ä¸€æ®µæ—¶å…‰è‡´æ•¬</p><a id="more"></a><p><img src="/archives/2018/08/25/Authony.jpg" alt=""></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;å²æœˆè¿˜åœ¨çœ¼çœ¸æ‰“åï¼Œä½ çš„å‡æœ›&lt;/p&gt;&lt;p&gt;ä¹Ÿè®¸åœ¨è‹¦ç­‰ï¼Œæœ‰ä¸æœ½çš„è¯—å¥&lt;/p&gt;&lt;p&gt;è¯´å®Œè¿™äº›è¯åæˆ‘çš„æ¢¦æƒ³å·²ç»æœ‰æ‹”èŠ‚ä¹‹å£°&lt;/p&gt;&lt;p&gt;æˆ‘èœ·ç¼©èµ·åŒè…¿&lt;/p&gt;&lt;p&gt;ä¼¼ä¹æ˜¯åœ¨ä¸ºæ¯ä¸€æ®µæ—¶å…‰è‡´æ•¬&lt;/p&gt;
    
    </summary>
    
    
      <category term="éšç¬”æ‚è®°" scheme="https://pross.space/tags/%E9%9A%8F%E7%AC%94%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>SparkStreamingä¹‹è§£æupdateStateByKey</title>
    <link href="https://pross.space/archives/2018/06/19/"/>
    <id>https://pross.space/archives/2018/06/19/</id>
    <published>2018-06-19T10:52:15.000Z</published>
    <updated>2019-07-10T16:30:49.632Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>è¯´åˆ°Spark Streamingçš„çŠ¶æ€ç®¡ç†ï¼Œå°±ä¼šæƒ³åˆ°updateStateByKeyï¼Œè¿˜æœ‰mapWithStateã€‚ä»Šå¤©æ•´ç†äº†ä¸€ä¸‹ï¼Œç€é‡äº†è§£ä¸€ä¸‹å‰è€…ã€‚</p><a id="more"></a><h4 id="çŠ¶æ€ç®¡ç†çš„éœ€æ±‚"><a href="#çŠ¶æ€ç®¡ç†çš„éœ€æ±‚" class="headerlink" title="çŠ¶æ€ç®¡ç†çš„éœ€æ±‚"></a>çŠ¶æ€ç®¡ç†çš„éœ€æ±‚</h4><p>ä¸¾ä¸€ä¸ªæœ€ç®€å•çš„éœ€æ±‚ä¾‹å­æ¥è§£é‡ŠçŠ¶æ€ï¼ˆstateï¼‰ç®¡ç†ï¼Œç°åœ¨æœ‰è¿™æ ·çš„ä¸€ä¸ªéœ€æ±‚ï¼šè®¡ç®—ä»æ•°æ®æµå¼€å§‹åˆ°ç›®å‰ä¸ºæ­¢å•è¯å‡ºç°çš„æ¬¡æ•°ã€‚æ˜¯ä¸æ˜¯çœ‹èµ·æ¥å¾ˆçœ¼ç†Ÿï¼Œè¿™å…¶å®å°±æ˜¯ä¸€ä¸ªå‡çº§ç‰ˆçš„wordcountï¼Œåªä¸è¿‡éœ€è¦åœ¨æ¯ä¸ªbatchIntervalè®¡ç®—å½“å‰batchçš„å•è¯è®¡æ•°ï¼Œç„¶åå¯¹å„ä¸ªæ‰¹æ¬¡çš„è®¡æ•°è¿›è¡Œç´¯åŠ ã€‚æ¯ä¸€ä¸ªæ‰¹æ¬¡çš„ç´¯ç§¯çš„è®¡æ•°å°±æ˜¯å½“å‰çš„ä¸€ä¸ªçŠ¶æ€å€¼ã€‚æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªçŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œå’Œåé¢æ‰¹æ¬¡å•è¯çš„è®¡æ•°ç»“æœæ¥è¿›è¡Œè®¡ç®—ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ä¸æ–­çš„åœ¨å†å²çš„åŸºç¡€ä¸Šè¿›è¡Œæ¬¡æ•°çš„æ›´æ–°ã€‚</p><p>SparkStreamingæä¾›äº†ä¸¤ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šupdateStateByKeyå’ŒmapWithStateã€‚mapWithStateæ˜¯1.6ç‰ˆæœ¬æ–°å¢çš„åŠŸèƒ½ï¼Œå®˜æ–¹è¯´æ€§èƒ½è¾ƒupdateStateByKeyæå‡10å€ã€‚</p><h4 id="updateStateByKeyæ¦‚è¿°"><a href="#updateStateByKeyæ¦‚è¿°" class="headerlink" title="updateStateByKeyæ¦‚è¿°"></a>updateStateByKeyæ¦‚è¿°</h4><p>updateStateByKeyï¼Œç»Ÿè®¡å…¨å±€çš„Keyçš„çŠ¶æ€ï¼Œå°±ç®—æ²¡æœ‰æ•°æ®è¾“å…¥ï¼Œä¹Ÿä¼šåœ¨æ¯ä¸€ä¸ªæ‰¹æ¬¡çš„æ—¶å€™è¿”å›ä¹‹å‰çš„keyçš„çŠ¶æ€ã€‚å‡è®¾5säº§ç”Ÿä¸€ä¸ªæ‰¹æ¬¡çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±æ˜¯5sçš„æ—¶å€™å°±æ›´æ–°ä¸€æ¬¡keyçš„å€¼ï¼Œç„¶åè¿”å›ã€‚å¦‚æœæ•°æ®é‡åˆæ¯”è¾ƒå¤§ï¼Œåˆéœ€è¦ä¸æ–­çš„æ›´æ–°æ¯ä¸ªKeyçš„stateï¼Œ é‚£ä¹ˆå°±ä¸€å®šä¼šæ¶‰åŠåˆ°çŠ¶æ€çš„ä¿å­˜å’Œå®¹é”™ã€‚æ‰€ä»¥ï¼Œè¦ä½¿ç”¨updateStateByKeyå°±éœ€è¦è®¾ç½®ä¸€ä¸ªcheckpointç›®å½•ï¼Œå¼€å¯checkpointæœºåˆ¶ã€‚å› ä¸ºkeyçš„Stateæ˜¯åœ¨å†…å­˜ä¸­ç»´æŠ¤çš„ï¼Œå¦‚æœå®•æœºï¼Œåˆ™é‡å¯ä¹‹åä¹‹å‰ç»´æŠ¤çš„çŠ¶æ€å°±æ²¡æœ‰äº†ï¼Œæ‰€ä»¥è¦é•¿æœŸä¿å­˜çš„è¯åˆ™éœ€è¦å¯ç”¨<code>checkpoint</code>ï¼Œä»¥ä¾¿äºæ¢å¤æ•°æ®ã€‚</p><h4 id="updateStateByKeyä»£ç ä¾‹å­"><a href="#updateStateByKeyä»£ç ä¾‹å­" class="headerlink" title="updateStateByKeyä»£ç ä¾‹å­"></a>updateStateByKeyä»£ç ä¾‹å­</h4><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆç”¨çš„ï¼Œé¦–å…ˆçœ‹ä¸€ä¸ªupdateStateByKeyä½¿ç”¨çš„ç®€å•ä¾‹å­ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.streaming.&#123;<span class="type">Seconds</span>, <span class="type">StreamingContext</span>&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">  * Author: shawn pross</span></div><div class="line"><span class="comment">  * Date: 2018/06/18</span></div><div class="line"><span class="comment">  * Description: test updateStateByKey op</span></div><div class="line"><span class="comment">  */</span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestUpdateStateByKey</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</div><div class="line"><span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>()</div><div class="line">conf.setAppName(<span class="string">s"<span class="subst">$&#123;this.getClass.getSimpleName&#125;</span>"</span>)</div><div class="line">conf.setMaster(<span class="string">"local[2]"</span>)</div><div class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">        * åˆ›å»ºcontext,3 second batch size</span></div><div class="line"><span class="comment">* åˆ›å»ºä¸€ä¸ªæ¥æ”¶å™¨(ReceiverInputDStream),æ¥æ”¶ä»æœºå™¨ä¸Šçš„ç«¯å£ï¼Œé€šè¿‡socketå‘è¿‡æ¥çš„æ•°æ®</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(sc, <span class="type">Seconds</span>(<span class="number">3</span>))</div><div class="line"><span class="keyword">val</span> bathLine = ssc.socketTextStream(<span class="string">"127.0.0.1"</span>, <span class="number">9999</span>)</div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* ä¼ å…¥updateStateByKeyçš„å‡½æ•°</span></div><div class="line"><span class="comment">*</span></div><div class="line"><span class="comment">* æºç å®šä¹‰ï¼š</span></div><div class="line"><span class="comment">* def updateStateByKey[S: ClassTag](</span></div><div class="line"><span class="comment">* updateFunc: (Seq[V], Option[S]) =&gt; Option[S]): DStream[(K, S)] = ssc.withScope &#123;</span></div><div class="line"><span class="comment">* updateStateByKey(updateFunc, defaultPartitioner())</span></div><div class="line"><span class="comment">* &#125;</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">val</span> updateFunc = (currValues: <span class="type">Seq</span>[<span class="type">Int</span>], prevValueState: <span class="type">Option</span>[<span class="type">Int</span>]) =&gt; &#123;</div><div class="line"><span class="comment">//é€šè¿‡Sparkå†…éƒ¨çš„reduceByKeyæŒ‰keyè§„çº¦ï¼Œç„¶åè¿™é‡Œä¼ å…¥æŸkeyå½“å‰æ‰¹æ¬¡çš„Seq/List,å†è®¡ç®—å½“å‰æ‰¹æ¬¡çš„æ€»å’Œ</span></div><div class="line"><span class="keyword">val</span> currentCount = currValues.sum</div><div class="line"><span class="comment">// å·²ç´¯åŠ çš„å€¼</span></div><div class="line"><span class="keyword">val</span> previousCount = prevValueState.getOrElse(<span class="number">0</span>)</div><div class="line"><span class="comment">// è¿”å›ç´¯åŠ åçš„ç»“æœï¼Œæ˜¯ä¸€ä¸ªOption[Int]ç±»å‹</span></div><div class="line"><span class="type">Some</span>(currentCount + previousCount)</div><div class="line">&#125;</div><div class="line"><span class="comment">//å…ˆèšåˆæˆé”®å€¼å¯¹çš„å½¢å¼</span></div><div class="line">bathLine.map(x=&gt;(x,<span class="number">1</span>)).updateStateByKey(updateFunc).print()</div><div class="line">        </div><div class="line">ssc.start()</div><div class="line">ssc.awaitTermination()</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä»£ç å¾ˆç®€å•ï¼Œæ³¨é‡Šä¹Ÿæ¯”è¾ƒè¯¦ç»†ã€‚å…¶ä¸­è¦è¯´æ˜çš„æ˜¯<code>updateStateByKey</code>çš„å‚æ•°è¿˜æœ‰å‡ ä¸ªå¯é€‰é¡¹ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">updateStateByKey</span></span>[<span class="type">S</span>: <span class="type">ClassTag</span>](</div><div class="line">    <span class="comment">//çŠ¶æ€æ›´æ–°åŠŸèƒ½</span></div><div class="line">    updateFunc: (<span class="type">Seq</span>[<span class="type">V</span>], <span class="type">Option</span>[<span class="type">S</span>]) =&gt; <span class="type">Option</span>[<span class="type">S</span>],</div><div class="line">    <span class="comment">//ç”¨äºæ§åˆ¶æ–°RDDä¸­æ¯ä¸ªRDDçš„åˆ†åŒºçš„åˆ†åŒºç¨‹åº</span></div><div class="line">    partitioner: <span class="type">Partitioner</span>,</div><div class="line">    <span class="comment">//æ˜¯å¦è®°ä½ç”Ÿæˆçš„RDDä¸­çš„åˆ†åŒºå¯¹è±¡</span></div><div class="line">    rememberPartitioner: <span class="type">Boolean</span>,  </div><div class="line">    <span class="comment">//æ¯ä¸ªé”®çš„åˆå§‹çŠ¶æ€å€¼</span></div><div class="line">    initialRDD: <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">S</span>)],</div><div class="line">  ): <span class="type">DStream</span>[(<span class="type">K</span>, <span class="type">S</span>)] = ssc.withScope &#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="updateStateByKeyæºç åˆ†æ"><a href="#updateStateByKeyæºç åˆ†æ" class="headerlink" title="updateStateByKeyæºç åˆ†æ"></a>updateStateByKeyæºç åˆ†æ</h4><p>é€šè¿‡ä¸Šé¢ç®€å•çš„å°ä¾‹å­å¯ä»¥çŸ¥é“ï¼Œä½¿ç”¨updateStateByKeyæ˜¯éœ€è¦å…ˆè½¬æ¢ä¸ºé”®å€¼å¯¹çš„å½¢å¼çš„ï¼Œè€Œmapè¿”å›çš„æ˜¯<code>MappedDStream</code>ï¼Œè€Œè¿›å…¥<code>MappedDStream</code>ä¸­ä¹Ÿæ²¡æœ‰updateStateByKeyæ–¹æ³•ï¼Œç„¶åå…¶çˆ¶ç±»DStreamä¸­ä¹Ÿæ²¡æœ‰ã€‚ä½†æ˜¯DStreamçš„åŠç”Ÿå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªéšå¼çš„è½¬æ¢å‡½æ•°<code>toPairDStreamFunctions</code>ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// mapå®ç°ï¼Œè¿”å›MappedDStream</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">map</span></span>[<span class="type">U</span>: <span class="type">ClassTag</span>](mapFunc: <span class="type">T</span> =&gt; <span class="type">U</span>): <span class="type">DStream</span>[<span class="type">U</span>] = ssc.withScope &#123;</div><div class="line">    <span class="keyword">new</span> <span class="type">MappedDStream</span>(<span class="keyword">this</span>, context.sparkContext.clean(mapFunc))</div><div class="line">  &#125;</div><div class="line"></div><div class="line"><span class="comment">// MappedDStreamçˆ¶ç±»æ˜¯DStream</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MappedDStream</span>[<span class="type">T</span>: <span class="type">ClassTag</span>, <span class="type">U</span>: <span class="type">ClassTag</span>] (<span class="params"></span></span></div><div class="line"><span class="class"><span class="params">    parent: <span class="type">DStream</span>[<span class="type">T</span>],</span></span></div><div class="line"><span class="class"><span class="params">    mapFunc: <span class="type">T</span> =&gt; <span class="type">U</span></span></span></div><div class="line"><span class="class"><span class="params">  </span>) <span class="keyword">extends</span> <span class="title">DStream</span>[<span class="type">U</span>](<span class="params">parent.ssc</span>) </span>&#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// DStreamä¸­éšå¼çš„è½¬æ¢å‡½æ•°</span></div><div class="line"><span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">toPairDStreamFunctions</span></span>[<span class="type">K</span>, <span class="type">V</span>](stream: <span class="type">DStream</span>[(<span class="type">K</span>, <span class="type">V</span>)])</div><div class="line">      (<span class="keyword">implicit</span> kt: <span class="type">ClassTag</span>[<span class="type">K</span>], vt: <span class="type">ClassTag</span>[<span class="type">V</span>], ord: <span class="type">Ordering</span>[<span class="type">K</span>] = <span class="literal">null</span>):</div><div class="line">    <span class="type">PairDStreamFunctions</span>[<span class="type">K</span>, <span class="type">V</span>] = &#123;</div><div class="line">    <span class="keyword">new</span> <span class="type">PairDStreamFunctions</span>[<span class="type">K</span>, <span class="type">V</span>](stream)</div><div class="line">  &#125;</div></pre></td></tr></table></figure><p>çœ‹åˆ°<code>new PairDStreamFunctions</code>å°±ä¸é™Œç”Ÿäº†ã€‚<code>PairDStreamFunctions</code>ä¸­å­˜åœ¨updateStateByKeyæ–¹æ³•ï¼ŒSeq[V]è¡¨ç¤ºå½“å‰keyå¯¹åº”çš„æ‰€æœ‰å€¼ï¼ŒOption[S] æ˜¯å½“å‰keyçš„å†å²çŠ¶æ€ï¼Œè¿”å›çš„æ˜¯æ–°çš„çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯ç»•äº†ä¸€ä¸ªåœˆå­åˆå›åˆ°åŸåœ°ã€‚æœ€åupdateStateByKeyæœ€ç»ˆä¼šåœ¨è¿™é‡Œé¢newå‡ºäº†ä¸€ä¸ª<code>StateDStream</code>å¯¹è±¡ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">updateStateByKey</span></span>[<span class="type">S</span>: <span class="type">ClassTag</span>](</div><div class="line">     updateFunc: (<span class="type">Iterator</span>[(<span class="type">K</span>, <span class="type">Seq</span>[<span class="type">V</span>], <span class="type">Option</span>[<span class="type">S</span>])]) =&gt; <span class="type">Iterator</span>[(<span class="type">K</span>, <span class="type">S</span>)],</div><div class="line">     partitioner: <span class="type">Partitioner</span>,</div><div class="line">     rememberPartitioner: <span class="type">Boolean</span>,</div><div class="line">     initialRDD: <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">S</span>)]): <span class="type">DStream</span>[(<span class="type">K</span>, <span class="type">S</span>)] = ssc.withScope &#123;</div><div class="line">   <span class="keyword">val</span> cleanedFunc = ssc.sc.clean(updateFunc)</div><div class="line">   <span class="keyword">val</span> newUpdateFunc = (_: <span class="type">Time</span>, it: <span class="type">Iterator</span>[(<span class="type">K</span>, <span class="type">Seq</span>[<span class="type">V</span>], <span class="type">Option</span>[<span class="type">S</span>])]) =&gt; &#123;</div><div class="line">     cleanedFunc(it)</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">new</span> <span class="type">StateDStream</span>(self, newUpdateFunc, partitioner, rememberPartitioner, <span class="type">Some</span>(initialRDD))</div><div class="line"> &#125;</div></pre></td></tr></table></figure><p>ç»§ç»­è¿›å»<code>StateDStream</code>çœ‹çœ‹ï¼Œåœ¨å…¶<code>compute</code>æ–¹æ³•ä¸­ï¼Œä¼šå…ˆè·å–ä¸Šä¸€ä¸ªbatchè®¡ç®—å‡ºçš„RDDï¼ˆåŒ…å«äº†è‡³ç¨‹åºå¼€å§‹åˆ°ä¸Šä¸€ä¸ªbatchå•è¯çš„ç´¯è®¡è®¡æ•°ï¼‰ï¼Œç„¶ååœ¨è·å–æœ¬æ¬¡batchä¸­<code>StateDStream</code>çš„çˆ¶ç±»è®¡ç®—å‡ºçš„RDDï¼ˆæœ¬æ¬¡batchçš„å•è¯è®¡æ•°ï¼‰åˆ†åˆ«æ˜¯<code>prevStateRDD</code>å’Œ<code>parentRDD</code>ï¼Œç„¶ååœ¨è°ƒç”¨ <code>computeUsingPreviousRDD</code> æ–¹æ³•ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> [<span class="keyword">this</span>] <span class="function"><span class="keyword">def</span> <span class="title">computeUsingPreviousRDD</span></span>(</div><div class="line">    batchTime: <span class="type">Time</span>,</div><div class="line">    parentRDD: <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">V</span>)],</div><div class="line">    prevStateRDD: <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">S</span>)]) = &#123;</div><div class="line">  <span class="comment">// Define the function for the mapPartition operation on cogrouped RDD;</span></div><div class="line">  <span class="comment">// first map the cogrouped tuple to tuples of required type,</span></div><div class="line">  <span class="comment">// and then apply the update function</span></div><div class="line">  <span class="keyword">val</span> updateFuncLocal = updateFunc</div><div class="line">  <span class="keyword">val</span> finalFunc = (iterator: <span class="type">Iterator</span>[(<span class="type">K</span>, (<span class="type">Iterable</span>[<span class="type">V</span>], <span class="type">Iterable</span>[<span class="type">S</span>]))]) =&gt; &#123;</div><div class="line">    <span class="keyword">val</span> i = iterator.map &#123; t =&gt;</div><div class="line">      <span class="keyword">val</span> itr = t._2._2.iterator</div><div class="line">      <span class="keyword">val</span> headOption = <span class="keyword">if</span> (itr.hasNext) <span class="type">Some</span>(itr.next()) <span class="keyword">else</span> <span class="type">None</span></div><div class="line">      (t._1, t._2._1.toSeq, headOption)</div><div class="line">    &#125;</div><div class="line">    updateFuncLocal(batchTime, i)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">val</span> cogroupedRDD = parentRDD.cogroup(prevStateRDD, partitioner)</div><div class="line">  <span class="keyword">val</span> stateRDD = cogroupedRDD.mapPartitions(finalFunc, preservePartitioning)</div><div class="line">  <span class="type">Some</span>(stateRDD)</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æœ€åè¿”å›<code>stateRDD</code>ç»“æœã€‚è‡³æ­¤ï¼ŒupdateStateByKeyæ–¹æ³•æºç æ‰§è¡Œè¿‡ç¨‹æ°´è½çŸ³å‡ºã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;è¯´åˆ°Spark Streamingçš„çŠ¶æ€ç®¡ç†ï¼Œå°±ä¼šæƒ³åˆ°updateStateByKeyï¼Œè¿˜æœ‰mapWithStateã€‚ä»Šå¤©æ•´ç†äº†ä¸€ä¸‹ï¼Œç€é‡äº†è§£ä¸€ä¸‹å‰è€…ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spark" scheme="https://pross.space/tags/Spark/"/>
    
  </entry>
  
  <entry>
    <title>ç†è§£Sparkæ ¸å¿ƒä¹‹RDD</title>
    <link href="https://pross.space/archives/2018/05/29/"/>
    <id>https://pross.space/archives/2018/05/29/</id>
    <published>2018-05-29T09:04:41.000Z</published>
    <updated>2018-08-31T16:30:19.437Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>Sparkæ˜¯å›´ç»•RDDçš„æ¦‚å¿µå±•å¼€çš„ï¼ŒRDDæ˜¯å¯ä»¥å¹¶è¡Œæ“ä½œçš„å®¹é”™å…ƒç´ é›†åˆã€‚RDDå…¨ç§°æ˜¯Resilient Distributed Datasetsï¼ˆå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼‰</p><a id="more"></a><h4 id="ç†è§£RDD"><a href="#ç†è§£RDD" class="headerlink" title="ç†è§£RDD"></a>ç†è§£RDD</h4><p>å¦‚æœä½ åœ¨Sparké›†ç¾¤ä¸­åŠ è½½äº†ä¸€ä¸ªå¾ˆå¤§çš„æ–‡æœ¬æ•°æ®ï¼ŒSparkå°±ä¼šå°†è¯¥æ–‡æœ¬æŠ½è±¡ä¸ºä¸€ä¸ªRDDï¼Œè¿™ä¸ªRDDæ ¹æ®ä½ å®šä¹‰çš„åˆ†åŒºç­–ç•¥ï¼ˆæ¯”å¦‚HashKeyï¼‰å¯ä»¥åˆ†ä¸ºæ•°ä¸ªPartitionï¼Œè¿™æ ·å°±å¯ä»¥å¯¹å„ä¸ªåˆ†åŒºè¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p><p>RDDæ˜¯ä¸€ä¸ªå®¹é”™çš„ï¼Œå¹¶è¡Œçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥è®©ç”¨æˆ·æ˜¾ç¤ºåœ°å°†æ•°æ®å­˜å‚¨åˆ°ç£ç›˜å’Œå†…å­˜ä¸­ï¼Œå¹¶èƒ½æ§åˆ¶æ•°æ®çš„åˆ†åŒºã€‚åŒæ—¶ï¼ŒRDDè¿˜æä¾›äº†ä¸€ç»„ä¸°å¯Œçš„æ“ä½œæ¥æ“ä½œè¿™äº›æ•°æ®ã€‚åœ¨è¿™äº›æ“ä½œä¸­ï¼Œæ¯”å¦‚Mapã€flatMapã€filterç­‰è½¬æ¢æ“ä½œå®ç°äº†monadæ¨¡å¼ï¼ˆMonadæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œè¡¨ç¤ºå°†ä¸€ä¸ªè¿ç®—è¿‡ç¨‹ï¼Œé€šè¿‡å‡½æ•°æ‹†è§£æˆäº’ç›¸è¿æ¥çš„å¤šä¸ªæ­¥éª¤ï¼›ä½ åªè¦æä¾›ä¸‹ä¸€æ­¥è¿ç®—æ‰€éœ€çš„å‡½æ•°ï¼Œæ•´ä¸ªè¿ç®—å°±ä¼šè‡ªåŠ¨è¿›è¡Œä¸‹å»ã€‚ï¼‰ï¼Œå¾ˆå¥½çš„åˆ‡åˆäº†Scalaçš„é›†åˆæ“ä½œã€‚å¦å¤–ï¼ŒRDDè¿˜æä¾›äº†æ¯”å¦‚joinï¼ŒgroupByï¼ŒreduceByKeyï¼ˆactionæ“ä½œï¼‰ç­‰æ›´ä¸ºæ–¹ä¾¿çš„æ“ä½œï¼Œç”¨æ¥æ”¯æŒå¸¸è§çš„æ•°æ®è¿ç®—ã€‚</p><p>RDDæ˜¯ä¸€ç³»åˆ—åªè¯»åˆ†åŒºçš„é›†åˆï¼Œå®ƒåªèƒ½ä»æ–‡ä»¶ä¸­è¯»å–å¹¶åˆ›å»ºï¼Œæˆ–è€…ä»æ—§çš„RDDç”Ÿæˆæ–°çš„RDDã€‚RDDçš„æ¯ä¸€æ¬¡å˜æ¢æ“ä½œéƒ½ä¼šç”Ÿæˆæ–°çš„RDDï¼Œè€Œä¸æ˜¯åœ¨åŸæ¥çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œè¿™ç§ç²—ç²’åº¦çš„æ•°æ®æ“ä½œæ–¹å¼ä¸ºRDDå¸¦æ¥äº†å®¹é”™å’Œæ•°æ®å…±äº«æ–¹é¢çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯åœ¨é¢å¯¹å¤§æ•°æ®é›†ä¸­é¢‘ç¹çš„å°æ“ä½œçš„æ—¶å€™ï¼Œæ˜¾å¾—æ•ˆç‡æ¯”è¾ƒä½ä¸‹ã€‚</p><h4 id="RDDåŸç†"><a href="#RDDåŸç†" class="headerlink" title="RDDåŸç†"></a>RDDåŸç†</h4><p>RDDå®é™…ä¸Šæ˜¯ä¸€ä¸ªç±»ï¼ˆsc.textFile()æ–¹æ³•è¿”å›ä¸€ä¸ªRDDå¯¹è±¡ï¼Œç„¶åç”¨lineæ¥æ”¶è¿™ä¸ªå¯¹è±¡ï¼‰ï¼Œè€Œè¿™ä¸ªRDDç±»ä¸­ä¹Ÿå®šä¹‰äº†ä¸€ç³»åˆ—çš„ç”¨äºæ“ä½œçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸€äº›ç®—å­æ“ä½œã€‚</p><p>è¿™ä¸ªç±»ä¸ºäº†å®ç°å¯¹æ•°æ®çš„æ“ä½œï¼Œé‡Œé¢æœ‰åˆ†åŒºä¿¡æ¯ï¼Œç”¨äºè®°å½•ç‰¹å®šRDDçš„åˆ†åŒºæƒ…å†µï¼›ä¾èµ–å…³ç³»ï¼ŒæŒ‡å‘å…¶çˆ¶RDDï¼›ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè®°å½•çˆ¶RDDåˆ°è‡ªå·±çš„è½¬æ¢æ“ä½œï¼›åˆ’åˆ†ç­–ç•¥å’Œæ•°æ®ä½ç½®çš„å…ƒæ•°æ®ã€‚åœ¨DAGä¸­è¿™æ ·çš„RDDå°±å¯ä»¥çœ‹æˆä¸€ä¸ªä¸ªèŠ‚ç‚¹ï¼ŒRDDä¸­çš„å­˜å‚¨çš„ä¾èµ–å…³ç³»å°±æ˜¯DAGçš„è¾¹ã€‚åœ¨Sparkä¸­ï¼Œæ•°æ®åœ¨ç‰©ç†ä¸Šè¢«åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„blockï¼Œè¿™äº›blockç”±blockmanagerç»Ÿä¸€ç®¡ç†çš„ã€‚</p><p>åœ¨è®¾è®¡RDDä¹‹é—´çš„ä¾èµ–å…³ç³»æ—¶ï¼Œè®¾è®¡è€…å°†RDDä¹‹é—´çš„ä¾èµ–å…³ç³»åˆ†ä¸ºä¸¤ç±»ï¼šçª„ä¾èµ–å’Œå®½ä¾èµ–ã€‚RDDä½œä¸ºæ•°æ®ç»“æ„ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåªè¯»çš„åˆ†åŒºè®°å½•é›†åˆã€‚ä¸€ä¸ªRDDå¯ä»¥åŒ…å«å¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå°±æ˜¯ä¸€ä¸ªDataSetç‰‡æ®µã€‚RDDå¯ä»¥ç›¸äº’ä¾èµ–ï¼Œå¦‚æœRDDçš„æ¯ä¸ªåˆ†åŒºæœ€å¤šåªèƒ½è¢«ä¸€ä¸ªChild RDDçš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨ï¼Œåˆ™ç§°ä¹‹ä½narrow dependencyï¼ˆçª„ä¾èµ–ï¼‰ï¼›è‹¥å¤šä¸ªChild RDDåˆ†åŒºéƒ½å¯ä»¥ä¾èµ–ï¼Œåˆ™ç§°ä¸ºwide dependencyï¼ˆå®½ä¾èµ–ï¼‰ï¼Œè€Œjoinæ“ä½œåˆ™ä¼šäº§ç”Ÿwide dependencyã€‚</p><p><img src="/archives/2018/05/29/narrowAndwide.jpg" alt="narrowå’Œwide"></p><p><img src="/archives/2018/05/29/rdd-dependencies.png" alt="narrowå’Œwideçš„åŒºåˆ«"></p><blockquote><p>Sparkä¹‹æ‰€ä»¥å°†ä¾èµ–åˆ†ä¸ºnarrowä¸wideï¼ŒåŸºäºä»¥ä¸‹ä¸¤ç‚¹åŸå› ï¼š</p><p>narrow dependecieså¯ä»¥æ”¯æŒåœ¨åŒä¸€ä¸ªcluster nodeä¸Šï¼Œå¹¶ä¸”ä»¥ç®¡é“å½¢å¼æ‰§è¡Œå¤šè¡Œå‘½ä»¤ï¼Œä¾‹å¦‚åœ¨æ‰§è¡Œäº†mapæ“ä½œåï¼Œç´§æ¥ç€æ‰§è¡Œfilterã€‚ç›¸åï¼Œwide dependencieséœ€è¦æ‰€æœ‰çš„çˆ¶åˆ†åŒºéƒ½æ˜¯å¯ç”¨çš„ï¼Œå¯èƒ½è¿˜éœ€è¦è°ƒç”¨ç±»ä¼¼MapReduceä¹‹ç±»çš„æ“ä½œè¿›è¡Œè·¨èŠ‚ç‚¹ä¼ é€’ã€‚</p><p>å…¶æ¬¡ä»å¤±è´¥æ¢å¤çš„è§’åº¦è€ƒè™‘ï¼Œnarrow dependenciesçš„å¤±è´¥æ¢å¤æ›´æœ‰æ•ˆï¼Œå› ä¸ºå®ƒåªéœ€è¦é‡æ–°è®¡ç®—ä¸¢å¤±çš„parent partitionå³å¯ï¼Œè€Œä¸”å¯ä»¥å¹¶è¡Œçš„åœ¨ä¸åŒèŠ‚ç‚¹è¿›è¡Œé‡è®¡ç®—ã€‚è€Œwide dependenciesç‰µæ¶‰åˆ°RDDå„çº§çš„å¤šä¸ªparent partitionsã€‚</p></blockquote><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>RDDæ˜¯Sparkçš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æ•´ä¸ªSparkæ¶æ„çš„åŸºç¡€ï¼Œç‰¹æ€§æ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li>ä¸å˜çš„æ•°æ®ç»“æ„å­˜å‚¨</li><li>æ”¯æŒè·¨é›†ç¾¤çš„åˆ†å¸ƒå¼æ•°æ®ç»“æ„</li><li>å¯ä»¥æ ¹æ®æ•°æ®è®°å½•çš„Keyå¯¹ç»“æ„è¿›è¡Œåˆ†åŒº</li><li>æä¾›äº†ç²—ç²’åº¦çš„æ“ä½œï¼Œä¸”è¿™äº›æ“ä½œæ”¯æŒåˆ†åŒº</li><li>å®ƒå°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä»è€Œæä¾›äº†ä½å»¶è¿Ÿæ€§</li></ul><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;Sparkæ˜¯å›´ç»•RDDçš„æ¦‚å¿µå±•å¼€çš„ï¼ŒRDDæ˜¯å¯ä»¥å¹¶è¡Œæ“ä½œçš„å®¹é”™å…ƒç´ é›†åˆã€‚RDDå…¨ç§°æ˜¯Resilient Distributed Datasetsï¼ˆå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼‰&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spark" scheme="https://pross.space/tags/Spark/"/>
    
  </entry>
  
  <entry>
    <title>Sparkçš„è¿è¡Œæ¨¡å¼</title>
    <link href="https://pross.space/archives/2018/05/15/"/>
    <id>https://pross.space/archives/2018/05/15/</id>
    <published>2018-05-15T12:56:12.000Z</published>
    <updated>2018-08-31T16:18:36.785Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>Sparkæ˜¯æ–°ä¸€ä»£åŸºäºå†…å­˜çš„è®¡ç®—æ¡†æ¶ï¼Œæ˜¯ç”¨äºå¤§è§„æ¨¡æ•°æ®å¤„ç†çš„åŒæ„åˆ†æå¼•æ“ã€‚ç›¸æ¯”äºHadoop MapReduceè®¡ç®—æ¡†æ¶ï¼ŒSparkå°†ä¸­é—´è®¡ç®—ç»“æœä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦æå‡10~100å€ï¼›åŒæ—¶é‡‡ç”¨å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆRDDï¼‰å®ç°è¿­ä»£è®¡ç®—ï¼Œæ›´å¥½çš„é€‚ç”¨äºæ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ ï¼Œæå¤§çš„æå‡å¼€å‘æ•ˆç‡ã€‚</p><p>Sparkçš„è¿è¡Œæ¨¡å¼ï¼Œå®ƒä¸ä»…æ”¯æŒå•æœºæ¨¡å¼ï¼ŒåŒæ—¶æ”¯æŒé›†ç¾¤æ¨¡å¼è¿è¡Œï¼›è¿™é‡Œå…·ä½“çš„æ€»ç»“ä¸€ä¸‹Sparkçš„å„ç§è¿è¡Œæ¨¡å¼çš„åŒºåˆ†ã€‚</p><a id="more"></a><h4 id="Localæ¨¡å¼"><a href="#Localæ¨¡å¼" class="headerlink" title="Localæ¨¡å¼"></a>Localæ¨¡å¼</h4><p>Localæ¨¡å¼åˆç§°æœ¬åœ°æ¨¡å¼ï¼Œé€šè¿‡Localæ¨¡å¼è¿è¡Œéå¸¸ç®€å•ï¼Œåªéœ€è¦æŠŠSparkçš„å®‰è£…åŒ…è§£å‹åï¼Œæ”¹ä¸€äº›å¸¸ç”¨çš„é…ç½®å³å¯ä½¿ç”¨ï¼Œè€Œä¸ç”¨å¯åŠ¨Sparkçš„Masterã€Workerè¿›ç¨‹ï¼ˆåªæœ‰é›†ç¾¤çš„Standaloneæ¨¡å¼è¿è¡Œæ—¶ï¼Œæ‰éœ€è¦è¿™ä¸¤ä¸ªè§’è‰²ï¼‰ï¼Œä¹Ÿä¸ç”¨å¯åŠ¨Hadoopçš„æœåŠ¡ï¼Œé™¤éä½ éœ€è¦ç”¨åˆ°HDFSã€‚</p><p><strong>è¿è¡Œå®ä¾‹</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">./bin/spark-submit \</div><div class="line">--class org.apache.spark.examples.SparkPi \</div><div class="line">--master local[2] \</div><div class="line">lib/spark-examples-1.0.0-hadoop2.2.0.jar  \</div><div class="line">100</div><div class="line"></div><div class="line"># 1ï¼‰--master local å°±å¯ä»¥ç¡®å®šæ˜¯å•æœºçš„localæ¨¡å¼äº†ï¼Œ[2]æ„æ€æ˜¯åˆ†é…2ä¸ªcoresè¿è¡Œ</div><div class="line"># 2ï¼‰--lib/spark-examples-1.0.0-hadoop2.2.0.jarï¼šjaråŒ…çš„è·¯å¾„ï¼ˆapplication-jarï¼‰</div><div class="line"># 3ï¼‰--100ï¼šä¼ é€’ç»™ä¸»ç±»çš„ä¸»è¦æ–¹æ³•çš„å¯é€‰å‚æ•°ï¼ˆapplication-argumentsï¼‰</div></pre></td></tr></table></figure><p>è¿™é‡Œçš„spark-submitè¿›ç¨‹æ—¢æ˜¯å®¢æˆ·ç«¯æäº¤ä»»åŠ¡çš„Clientè¿›ç¨‹ï¼Œåˆæ˜¯Sparkçš„Driverç¨‹åºï¼Œè¿˜å……å½“ç€Sparkæ‰§è¡ŒTaskçš„Executorè§’è‰²ã€‚æ‰€æœ‰çš„ç¨‹åºéƒ½è¿è¡Œåœ¨ä¸€ä¸ªJVMä¸­ï¼Œä¸»è¦ç”¨äºå¼€å‘æ—¶æµ‹è¯•ã€‚</p><h4 id="æœ¬åœ°ä¼ªé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼ˆå•æœºæ¨¡æ‹Ÿé›†ç¾¤ï¼‰"><a href="#æœ¬åœ°ä¼ªé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼ˆå•æœºæ¨¡æ‹Ÿé›†ç¾¤ï¼‰" class="headerlink" title="æœ¬åœ°ä¼ªé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼ˆå•æœºæ¨¡æ‹Ÿé›†ç¾¤ï¼‰"></a>æœ¬åœ°ä¼ªé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼ˆå•æœºæ¨¡æ‹Ÿé›†ç¾¤ï¼‰</h4><p>è¿™ç§æ¨¡å¼ï¼Œå’ŒLocal[N]å¾ˆåƒï¼Œä¸åŒçš„æ˜¯å®ƒä¼šåœ¨å•æœºçš„ç¯å¢ƒä¸‹å¯åŠ¨å¤šä¸ªè¿›ç¨‹æ¥æ¨¡æ‹Ÿé›†ç¾¤ä¸‹çš„åˆ†å¸ƒå¼åœºæ™¯ï¼Œè€Œä¸åƒLocal[N]è¿™ç§å¤šä¸ªçº¿ç¨‹åªèƒ½åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸‹å§”æ›²æ±‚å…¨çš„å…±äº«èµ„æºã€‚é€šå¸¸ä¹Ÿæ˜¯ç”¨æ¥éªŒè¯å¼€å‘å‡ºæ¥çš„åº”ç”¨ç¨‹åºé€»è¾‘ä¸Šæœ‰æ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œæˆ–è€…æƒ³ä½¿ç”¨Sparkè®¡ç®—æ¡†æ¶è€Œæ²¡æœ‰å¤ªå¤šèµ„æºçš„æƒ…å†µä¸‹ã€‚</p><p><strong>è¿è¡Œå®ä¾‹</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">./bin/spark-submit \</div><div class="line">--master local-cluster[2,3,1024]</div><div class="line"></div><div class="line"># --master local-cluster[2,3,1024]ï¼šåœ¨æœ¬åœ°æ¨¡æ‹Ÿé›†ç¾¤ä¸‹ä½¿ç”¨2ä¸ªExecutorè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹åˆ†é…3ä¸ªcoreså’Œ1024Mçš„å†…å­˜æ¥è¿è¡Œç¨‹åº</div></pre></td></tr></table></figure><p>è¿™é‡Œçš„spark-submitä¾ç„¶å……å½“å…¨èƒ½è§’è‰²ï¼Œåˆæ˜¯Clientè¿›ç¨‹ï¼Œåˆæ˜¯Driverç¨‹åºï¼Œä¹Ÿè´Ÿè´£èµ„æºç®¡ç†ã€‚è¿è¡Œè¯¥æ¨¡å¼å¾ˆç®€å•ï¼Œåªéœ€è¦æŠŠSparkå®‰è£…åŒ…è§£å‹åï¼Œä¿®æ”¹ä¸€äº›å¸¸ç”¨çš„é…ç½®ï¼Œä¸ç”¨å¯åŠ¨Sparkçš„Masterã€Workerå®ˆæŠ¤è¿›ç¨‹ï¼Œä¹Ÿä¸ç”¨å¯åŠ¨Hadoopçš„æœåŠ¡ï¼Œé™¤éä½ æ˜¯éœ€è¦ç”¨åˆ°HDFSã€‚</p><h4 id="Standaloneæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰"><a href="#Standaloneæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰" class="headerlink" title="Standaloneæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰"></a>Standaloneæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰</h4><p>Standaloneæ˜¯é›†ç¾¤æ¨¡å¼ï¼Œè¿™é‡Œå°±éœ€è¦åœ¨æ‰§è¡Œåº”ç”¨ç¨‹åºå‰ï¼Œå…ˆå¯åŠ¨Sparkçš„Masterå’ŒWorkerå®ˆæŠ¤è¿›ç¨‹ï¼Œä¸ç”¨å¯åŠ¨Hadoopçš„æœåŠ¡ï¼Œé™¤éä½ éœ€è¦ä½¿ç”¨HDFSã€‚</p><p><strong>è¿è¡Œå®ä¾‹</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">./bin/spark-submit \</div><div class="line">  --class org.apache.spark.examples.SparkPi \</div><div class="line">  --master spark://207.184.161.138:7077 \</div><div class="line">  --executor-memory 8G \</div><div class="line">  --total-executor-cores 10 \</div><div class="line">  /path/to/examples.jar \</div><div class="line">  1000</div><div class="line"></div><div class="line"># 1) --master spark://207.184.161.138:7077:é‡‡ç”¨Standaloneæ¨¡å¼è¿è¡Œï¼Œåé¢æ˜¯é›†ç¾¤åœ°å€å’Œç«¯å£</div><div class="line"># 2) --executor-memory 20G:é…ç½®executorè¿›ç¨‹å†…å­˜ä¸º8G</div><div class="line"># 3ï¼‰--total-executor-cores 100ï¼šé…ç½®coresæ•°ä¸º10ä¸ª</div></pre></td></tr></table></figure><p>Masterè¿›ç¨‹ä½œä¸ºcluster managerï¼Œç”¨æ¥å¯¹åº”ç”¨ç¨‹åºç”³è¯·çš„èµ„æºè¿›è¡Œç®¡ç†ï¼›spark-submitåšä¸ºClientç«¯å’Œè¿è¡ŒDriverç¨‹åºã€‚Standaloneæ¨¡å¼æ˜¯Sparkå®ç°çš„èµ„æºè°ƒåº¦æ¡†æ¶ï¼Œå…¶ä¸»è¦çš„èŠ‚ç‚¹æœ‰ClientèŠ‚ç‚¹ï¼ŒMasterèŠ‚ç‚¹å’ŒWorkerèŠ‚ç‚¹ã€‚å…¶ä¸­Driveræ—¢å¯ä»¥è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨æœ¬åœ°çš„Clientç«¯ã€‚</p><p>å½“ç”¨spark-shelläº¤äº’å¼å·¥å…·æäº¤Sparkçš„Jobæ—¶ï¼ŒDriveråœ¨MasterèŠ‚ç‚¹ä¸Šè¿è¡Œï¼›å½“ä½¿ç”¨spark-submitå·¥å…·æäº¤Jobæˆ–è€…åœ¨Eclipseã€IDEAç­‰å¼€å‘å¹³å°ä¸Šä½¿ç”¨<code>new SparkConf.setManager(&quot;spark://master:7077&quot;)</code>æ–¹å¼è¿è¡ŒSparkä»»åŠ¡æ—¶ï¼ŒDriveræ˜¯è¿è¡Œåœ¨æœ¬åœ°Clientç«¯ä¸Šçš„ã€‚</p><p><strong>è¿è¡Œæµç¨‹</strong></p><ul><li>SparkContextè¿æ¥åˆ°Masterï¼Œå‘Masteræ³¨å†Œå¹¶ç”³è¯·èµ„æºï¼ˆCPU Coreå’ŒMemoryï¼‰</li><li>Masteræ ¹æ®SparkContextçš„èµ„æºç”³è¯·è¦æ±‚å’ŒWorkerå¿ƒè·³å‘¨æœŸå†…æŠ¥å‘Šçš„ä¿¡æ¯å†³å®šåœ¨å“ªä¸ªWorkerä¸Šåˆ†é…èµ„æºï¼Œç„¶ååœ¨è¯¥Workerä¸Šè·å–èµ„æºï¼Œç„¶åå¯åŠ¨StandaloneExecutorBackend</li><li>StandaloneExecutorBackendå‘SparkContextæ³¨å†Œ</li><li>SparkContextå°†Applicationä»£ç å‘ç»™StandaloneExecutorBackendï¼›å¹¶ä¸”SparkContextè§£æApplicationä»£ç ï¼Œæ„å»ºDAGå›¾ï¼Œæäº¤ç»™DAG Scheduleråˆ†è§£æˆStageï¼ˆå½“ç¢°åˆ°Actionæ“ä½œæ—¶ï¼Œå°±ä¼šäº§ç”ŸJobï¼›æ¯ä¸ªJobä¸­å«æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªStageï¼ŒStageä¸€èˆ¬åœ¨è·å–å¤–éƒ¨æ•°æ®å’Œshuffleä¹‹å‰äº§ç”Ÿï¼‰ï¼Œç„¶åStageï¼ˆåˆç§°ä¸ºTaskSetï¼‰æäº¤Task Schedulerï¼Œè´Ÿè´£å°†Taskåˆ†é…åˆ°ç›¸åº”çš„Workerï¼Œæœ€åæäº¤ç»™StandaloneExecutorBackendæ‰§è¡Œ</li><li>StandaloneExecutorBackendä¼šæ„å»ºExecutorçº¿ç¨‹æ± ï¼Œå¼€å§‹æ‰§è¡ŒTaskï¼Œå¹¶å‘SparkContextæŠ¥å‘Šï¼Œç›´è‡³Taskå®Œæˆ</li><li>æ‰€æœ‰Taskå®Œæˆåï¼ŒSparkContextå‘Masteræ³¨é”€ï¼Œé‡Šæ”¾èµ„æº</li></ul><h4 id="on-yarn-clientæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰"><a href="#on-yarn-clientæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰" class="headerlink" title="on yarn clientæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰"></a>on yarn clientæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰</h4><p>è¶Šæ¥è¶Šå¤šçš„åœºæ™¯ï¼Œéƒ½æ˜¯Sparkè·‘åœ¨Hadoopé›†ç¾¤ä¸­ï¼Œæ‰€ä»¥ä¸ºäº†åšåˆ°èµ„æºèƒ½å¤Ÿå‡è¡¡è°ƒåº¦ï¼Œä¼šä½¿ç”¨YARNæ¥åšä¸ºSparkçš„Cluster Managerï¼Œæ¥ä¸ºSparkçš„åº”ç”¨ç¨‹åºåˆ†é…èµ„æºã€‚</p><p><strong>è¿è¡Œå®ä¾‹</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">./bin/spark-submit \</div><div class="line">--class org.apache.spark.examples.SparkPi \</div><div class="line">--master yarn \</div><div class="line">--deploy-mode client \</div><div class="line">lib/spark-examples-1.0.0-hadoop2.2.0.jar </div><div class="line"></div><div class="line"># 1) --master yarnï¼šé‡‡ç”¨yarnè¿›è¡Œèµ„æºè°ƒåº¦</div><div class="line"># 2) --deploy-mode clientï¼šclientç¯å¢ƒè¿è¡Œ</div></pre></td></tr></table></figure><p>åœ¨æ‰§è¡ŒSparkåº”ç”¨ç¨‹åºå‰ï¼Œè¦å¯åŠ¨Hadoopçš„å„ç§æœåŠ¡ï¼Œç”±äºå·²ç»æœ‰äº†èµ„æºç®¡ç†å™¨ï¼Œæ‰€ä»¥ä¸éœ€è¦å¯åŠ¨Sparkçš„Masterï¼ŒWorkerå®ˆæŠ¤è¿›ç¨‹ã€‚</p><p><strong>è¿è¡Œæµç¨‹</strong></p><ul><li>Spark Yarn Clientå‘Yarnçš„ResourceManagerç”³è¯·å¯åŠ¨Application Masterï¼ŒåŒæ—¶åœ¨SparkContextåˆå§‹åŒ–ä¸­åˆ›å»ºDAG Schedulerå’ŒTask Schedulerï¼Œç”±äºæˆ‘ä»¬é€‰æ‹©æ˜¯Yarn Clientæ¨¡å¼ï¼Œç¨‹åºä¼šé€‰æ‹©å¯åŠ¨YarnClientClusterSchedulerå’ŒYarnClientSchedulerBackend</li><li>ResourceManageræ”¶åˆ°è¯·æ±‚åï¼Œåœ¨é›†ç¾¤ä¸­é€‰æ‹©ä¸€ä¸ªNodeManagerï¼Œä¸ºè¯¥åº”ç”¨ç¨‹åºåˆ†é…ç¬¬ä¸€ä¸ªContainerï¼Œè¦æ±‚å®ƒåœ¨è¿™ä¸ªContainerä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„ApplicationMasterï¼›ä¸YarnClusteråŒºåˆ«æ˜¯åœ¨è¯¥ApplicationMasterä¸­ä¸è¿è¡ŒSparkContextï¼Œåªä¸SparkContextè¿›è¡Œè”ç³»è¿›è¡Œèµ„æºçš„åˆ†é…</li><li>Clientä¸­çš„SparkContextåˆå§‹åŒ–å®Œæˆåï¼Œä¸ApplicationMasterå»ºç«‹é€šè®¯ï¼Œå‘ResourceManageræ³¨å†Œï¼Œæ ¹æ®ä»»åŠ¡ä¿¡æ¯å‘ResourceManagerç”³è¯·èµ„æºï¼ˆContainerï¼‰</li><li>ä¸€æ—¦ApplicationMasterç”³è¯·åˆ°èµ„æºï¼ˆä¹Ÿå°±æ˜¯Containerï¼‰åï¼Œä¾¿äºå¯¹åº”çš„NodeManageré€šä¿¡ï¼Œè¦æ±‚å®ƒåœ¨è·å¾—çš„Containerä¸­å¼€å§‹å‘SparkContextæ³¨å†Œå¹¶ç”³è¯·æ‰§è¡ŒTaskä»»åŠ¡</li><li>Clientä¸­çš„SparkContextåˆ†é…ç»™Containerçš„Taskå¼€å§‹æ‰§è¡Œï¼Œå¹¶å‘Driveræ±‡æŠ¥è¿è¡Œçš„çŠ¶æ€å’Œè¿›åº¦ï¼Œè®©Clientéšæ—¶æŒæ¡å„ä¸ªä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œä»è€Œå¯ä»¥åœ¨ä»»åŠ¡å¤±è´¥æ—¶é‡å¯ä»»åŠ¡</li><li>åº”ç”¨ç¨‹åºå®Œæˆåï¼ŒClientçš„SparkContextå‘ResourceManagerç”³è¯·æ³¨é”€å¹¶å…³é—­è‡ªå·±</li></ul><h4 id="on-yarn-clusteræ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰"><a href="#on-yarn-clusteræ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰" class="headerlink" title="on yarn clusteræ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰"></a>on yarn clusteræ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰</h4><p><strong>è¿è¡Œå®ä¾‹</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">./bin/spark-submit --class org.apache.spark.examples.SparkPi \</div><div class="line">--master yarn \</div><div class="line">--deploy-mode cluster \</div><div class="line">--driver-memory 4g \</div><div class="line">--executor-memory 2g \</div><div class="line">--executor-cores 1 \</div><div class="line">examples/jars/spark-examples*.jar \</div><div class="line">10</div><div class="line"></div><div class="line"># --driver-memory 4gï¼šé›†ç¾¤æ¨¡å¼ä¸‹Yarn Application Masterçš„å†…å­˜å¤§å°</div></pre></td></tr></table></figure><p><strong>è¿è¡Œæµç¨‹</strong></p><ul><li>SparkYarnClientå‘YARNä¸­ResourceManageræäº¤åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬ApplicationMasterç¨‹åºã€å¯åŠ¨ApplicationMasterçš„å‘½ä»¤ã€éœ€è¦åœ¨Executorä¸­è¿è¡Œçš„ç¨‹åº</li><li>ResourceManageræ”¶åˆ°è¯·æ±‚åï¼Œåœ¨é›†ç¾¤ä¸­é€‰æ‹©ä¸€ä¸ªNodeManagerï¼Œä¸ºè¯¥åº”ç”¨ç¨‹åºåˆ†é…ç¬¬ä¸€ä¸ªContainerï¼Œè¦æ±‚å®ƒåœ¨è¿™ä¸ªContainerä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„ApplicationMasterï¼Œå…¶ä¸­ApplicationMasterä¸­è¿›è¡ŒSparkContextçš„åˆå§‹åŒ–</li><li>ApplicationMasterå‘ResourceManageræ³¨å†Œï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡ResourceManageæŸ¥çœ‹åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œç„¶åå®ƒå°†é‡‡ç”¨è½®è¯¢çš„æ–¹å¼é€šè¿‡RPCåè®®ä¸ºå„ä¸ªä»»åŠ¡ç”³è¯·èµ„æºï¼Œå¹¶ç›‘æ§å®ƒä»¬çš„è¿è¡ŒçŠ¶æ€ç›´åˆ°è¿è¡Œç»“æŸ</li><li>ä¸€æ—¦ApplicationMasterç”³è¯·åˆ°èµ„æºï¼ˆä¹Ÿå°±æ˜¯Containerï¼‰åï¼Œä¾¿äºå¯¹åº”çš„NodeManageré€šä¿¡ï¼Œè¦æ±‚å®ƒåœ¨è·å¾—çš„Containerä¸­å¼€å§‹å‘SparkContextæ³¨å†Œå¹¶ç”³è¯·æ‰§è¡ŒTaskä»»åŠ¡</li><li>SparkContextåˆ†é…ç»™Containerçš„Taskå¼€å§‹æ‰§è¡Œï¼Œå¹¶å‘Driveræ±‡æŠ¥è¿è¡Œçš„çŠ¶æ€å’Œè¿›åº¦ï¼Œè®©Clientéšæ—¶æŒæ¡å„ä¸ªä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œä»è€Œå¯ä»¥åœ¨ä»»åŠ¡å¤±è´¥æ—¶é‡å¯ä»»åŠ¡</li><li>åº”ç”¨ç¨‹åºè¿è¡Œå®Œæˆåï¼ŒApplicationMasterå‘ResourceManagerç”³è¯·æ³¨é”€å¹¶å…³é—­è‡ªå·±</li></ul><h4 id="Mesosæ¨¡å¼"><a href="#Mesosæ¨¡å¼" class="headerlink" title="Mesosæ¨¡å¼"></a>Mesosæ¨¡å¼</h4><p>Mesosæ˜¯Apacheä¸‹çš„å¼€æºåˆ†å¸ƒå¼èµ„æºç®¡ç†æ¡†æ¶ï¼Œå®ƒè¢«ç§°ä¸ºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„å†…æ ¸ã€‚Mesosæœ€åˆæ˜¯ç”±åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„AMPLabå¼€å‘çš„ï¼Œååœ¨Twitterå¾—åˆ°å¹¿æ³›ä½¿ç”¨ã€‚Apache Mesosæ˜¯ä¸€ä¸ªé€šç”¨çš„é›†ç¾¤ç®¡ç†å™¨ï¼Œèµ·æºäº Google çš„æ•°æ®ä¸­å¿ƒèµ„æºç®¡ç†ç³»ç»ŸBorgã€‚</p><p>Mesosæ¨¡å¼æ¥è§¦è¾ƒå°‘ï¼Œè¿™é‡Œä¸ä½œä¸ºå±•å¼€ã€‚</p><h4 id="Kubernetesæ¨¡å¼ï¼ˆK8Sï¼‰"><a href="#Kubernetesæ¨¡å¼ï¼ˆK8Sï¼‰" class="headerlink" title="Kubernetesæ¨¡å¼ï¼ˆK8Sï¼‰"></a>Kubernetesæ¨¡å¼ï¼ˆK8Sï¼‰</h4><p>Kubernetesè°ƒåº¦å™¨ç›®å‰æ˜¯å®éªŒæ€§çš„ã€‚åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°é…ç½®ï¼Œå®¹å™¨å›¾åƒå’Œå…¥å£ç‚¹çš„è¡Œä¸ºå˜åŒ–ã€‚ ï¼ˆSpark2.3.0ï¼‰</p><p>Kubernetesæ¨¡å¼æ¥è§¦è¾ƒå°‘ï¼Œè¿™é‡Œä¸ä½œä¸ºå±•å¼€ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;Sparkæ˜¯æ–°ä¸€ä»£åŸºäºå†…å­˜çš„è®¡ç®—æ¡†æ¶ï¼Œæ˜¯ç”¨äºå¤§è§„æ¨¡æ•°æ®å¤„ç†çš„åŒæ„åˆ†æå¼•æ“ã€‚ç›¸æ¯”äºHadoop MapReduceè®¡ç®—æ¡†æ¶ï¼ŒSparkå°†ä¸­é—´è®¡ç®—ç»“æœä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦æå‡10~100å€ï¼›åŒæ—¶é‡‡ç”¨å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆRDDï¼‰å®ç°è¿­ä»£è®¡ç®—ï¼Œæ›´å¥½çš„é€‚ç”¨äºæ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ ï¼Œæå¤§çš„æå‡å¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;&lt;p&gt;Sparkçš„è¿è¡Œæ¨¡å¼ï¼Œå®ƒä¸ä»…æ”¯æŒå•æœºæ¨¡å¼ï¼ŒåŒæ—¶æ”¯æŒé›†ç¾¤æ¨¡å¼è¿è¡Œï¼›è¿™é‡Œå…·ä½“çš„æ€»ç»“ä¸€ä¸‹Sparkçš„å„ç§è¿è¡Œæ¨¡å¼çš„åŒºåˆ†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spark" scheme="https://pross.space/tags/Spark/"/>
    
  </entry>
  
  <entry>
    <title>HDFS NameNodeå†…å­˜å…¨æ™¯</title>
    <link href="https://pross.space/archives/2018/05/07/"/>
    <id>https://pross.space/archives/2018/05/07/</id>
    <published>2018-05-07T00:37:22.000Z</published>
    <updated>2019-07-10T16:35:09.693Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:08 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><blockquote><p>åœ¨HDFSç³»ç»Ÿæ¶æ„ä¸­ï¼ŒNameNodeç®¡ç†ç€æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ï¼Œç»´æŠ¤æ•´ä¸ªé›†ç¾¤çš„æœºæ¶æ„ŸçŸ¥ä¿¡æ¯å’ŒDataNodeå’ŒBlockçš„ä¿¡æ¯ï¼ŒLeaseç®¡ç†ä»¥åŠé›†ä¸­å¼ç¼“å­˜å¼•å…¥çš„ç¼“å­˜ç®¡ç†ç­‰ç­‰ã€‚ä»æ•´ä¸ªHDFSç³»ç»Ÿæ¶æ„ä¸Šæ¥çœ‹ï¼ŒNameNodeæ˜¯æœ€é‡è¦ã€æœ€å¤æ‚ä¹Ÿæ˜¯æœ€å®¹æ˜“å‡ºç°é—®é¢˜çš„åœ°æ–¹ã€‚</p></blockquote><a id="more"></a><h4 id="NameNodeæ¦‚è¿°"><a href="#NameNodeæ¦‚è¿°" class="headerlink" title="NameNodeæ¦‚è¿°"></a>NameNodeæ¦‚è¿°</h4><p>NameNodeç®¡ç†çš„HDFSæ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®åˆ†ä¸ºä¸¤ä¸ªå±‚æ¬¡ï¼šNameSpaceç®¡ç†å±‚ï¼Œè´Ÿè´£ç®¡ç†æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ ‘çŠ¶ç›®å½•ç»“æ„ä»¥åŠæ–‡ä»¶ä¸æ•°æ®å—ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼›å—ç®¡ç†å±‚ï¼Œè´Ÿè´£ç®¡ç†æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶çš„ç‰©ç†å—ä¸å®é™…å­˜å‚¨ä½ç½®çš„æ˜ å°„å…³ç³»ï¼ˆBlockMapï¼‰ã€‚</p><p>NameSpaceç®¡ç†çš„å…ƒæ•°æ®é™¤å†…å­˜å¸¸é©»å¤–ï¼Œä¹Ÿä¼šå‘¨æœŸFlushåˆ°æŒä¹…åŒ–è®¾å¤‡fsimageæ–‡ä»¶ä¸Šï¼ˆcore-site.xmlä¸­é…ç½®<code>hadoop.tmp.dir</code>ç›®å½•ä¸‹çš„dfs/name/currentä¸­ï¼‰ï¼›BlockMapå…ƒæ•°æ®åªå­˜åœ¨äºå†…å­˜ä¸­ï¼›å½“NameNodeå‘ç”Ÿé‡å¯ï¼Œé¦–å…ˆä»æŒä¹…åŒ–è®¾å¤‡ä¸­è¯»å–fsimageï¼Œæ„å»ºNameSpaceçš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¹‹åæ ¹æ®DataNodeçš„æ±‡æŠ¥ä¿¡æ¯é‡æ–°æ„é€ BlockMapï¼Œè¿™ä¸¤éƒ¨åˆ†æ•°æ®æ˜¯å æ®NamNodeå¤§éƒ¨åˆ†JVM Heapç©ºé—´ã€‚</p><h4 id="NameNodeå†…å­˜ç»“æ„"><a href="#NameNodeå†…å­˜ç»“æ„" class="headerlink" title="NameNodeå†…å­˜ç»“æ„"></a>NameNodeå†…å­˜ç»“æ„</h4><p><img src="/archives/2018/05/07/namenode.png" alt="namenode"></p><p>NameNodeå¸¸é©»å†…å­˜ä¸»è¦è¢«NameSpaceå’ŒBlockManagerä½¿ç”¨ï¼ŒäºŒè€…ä½¿ç”¨å æ¯”åˆ†åˆ«æ¥è¿‘50%ã€‚å…¶å®ƒéƒ¨åˆ†å†…å­˜å¼€é”€è¾ƒå°ä¸”ç›¸å¯¹å›ºå®šï¼Œä¸NameSpaceå’ŒBlockManagerç›¸æ¯”åŸºæœ¬å¯ä»¥å¿½ç•¥ã€‚</p><h4 id="NameNodeå†…å­˜åˆ†æ"><a href="#NameNodeå†…å­˜åˆ†æ" class="headerlink" title="NameNodeå†…å­˜åˆ†æ"></a>NameNodeå†…å­˜åˆ†æ</h4><h5 id="NameSpace"><a href="#NameSpace" class="headerlink" title="NameSpace"></a>NameSpace</h5><p><img src="/archives/2018/05/07/namespace.png" alt="namespace"></p><p>HDFSæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„ä¹Ÿæ˜¯æŒ‰ç…§æ ‘çŠ¶ç»“æ„ç»´æŠ¤ï¼ŒNameSpaceä¿å­˜äº†ç›®å½•æ ‘ä»¥åŠæ¯ä¸ªç›®å½•/æ–‡ä»¶èŠ‚ç‚¹çš„å±æ€§ã€‚åœ¨æ•´ä¸ªNameSpaceç›®å½•æ ‘ä¸­å­˜åœ¨ä¸¤ç§ä¸åŒç±»å‹çš„INodeæ•°æ®ç»“æ„ï¼š<code>INodeDirectory</code>å’Œ<code>INodeFile</code>ã€‚å…¶ä¸­INodeDirectoryè¡¨ç¤ºçš„æ˜¯ç›®å½•æ ‘ä¸­çš„ç›®å½•ï¼ŒINodeFileè¡¨ç¤ºçš„æ˜¯ç›®å½•æ ‘ä¸­çš„æ–‡ä»¶ã€‚<br><img src="/archives/2018/05/07/inode.png" alt="inode"></p><p>INodeDirectoryå’ŒINodeFileå‡ç»§æ‰¿è‡ªINodeï¼Œæ‰€ä»¥å…·å¤‡å¤§éƒ¨åˆ†ç›¸åŒçš„å…¬å…±ä¿¡æ¯INodeWithAddititionalFieldsï¼Œé™¤å¸¸ç”¨åŸºç¡€å±æ€§å¤–ï¼Œå…¶ä¸­è¿˜æä¾›äº†æ‰©å±•å±æ€§featuresï¼ˆå¦‚Quotaï¼ŒSnapshotç­‰ï¼‰ï¼Œå¦‚æœä»¥åå‡ºç°æ–°å±æ€§ä¹Ÿå¯ä»¥é€šè¿‡featureæ‰©å±•ã€‚ä¸åŒçš„æ˜¯ï¼ŒINodeFileç‰¹æœ‰çš„æ ‡è¯†å‰¯æœ¬æ•°å’Œæ•°æ®å—å¤§å°ç»„åˆçš„<code>header</code>ï¼ˆ2.61ä¹‹åæ–°å¢äº†æ ‡è¯†å­˜å‚¨ç­–ç•¥IDçš„ä¿¡æ¯ï¼‰ä»¥åŠè¯¥æ–‡ä»¶åŒ…å«çš„æœ‰åºBlockçš„æ•°ç»„ï¼›INodeDirectoryç‰¹æœ‰çš„æ˜¯åˆ—è¡¨<code>children</code>ï¼Œchildrené»˜è®¤æ˜¯å¤§å°ä¸º5çš„ArrayListç±»å‹ï¼ŒæŒ‰ç…§å­èŠ‚ç‚¹nameæœ‰åºå­˜å‚¨ï¼Œåœ¨æ’å…¥æ—¶ä¼šæŸå¤±ä¸€éƒ¨åˆ†å†™å…¥çš„æ€§èƒ½ï¼Œä½†æ˜¯å¯ä»¥æ–¹ä¾¿åç»­å¿«é€ŸäºŒåˆ†æŸ¥æ‰¾æé«˜è¯»çš„æ€§èƒ½ï¼Œå¯¹äºä¸€èˆ¬çš„å­˜å‚¨ç³»ç»Ÿï¼Œè¯»æ“ä½œæ¯”å†™æ“ä½œå æ¯”è¦é«˜ã€‚</p><h5 id="BlockManager"><a href="#BlockManager" class="headerlink" title="BlockManager"></a>BlockManager</h5><p>NameNodeæ¦‚è¿°ä¸­ä»‹ç»çš„è´Ÿè´£ç®¡ç†æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶çš„ç‰©ç†å—ä¸å®é™…å­˜å‚¨ä½ç½®çš„æ˜ å°„å…³ç³»ï¼ˆBlockMapï¼‰å°±æ˜¯ç”±BlockManageræ¥ç»Ÿä¸€ç®¡ç†ã€‚NameSpaceå’ŒBlockMapä¹‹é—´é€šè¿‡å‰é¢æåˆ°çš„INodeFileæœ‰åºBlocksæ•°ç»„å…³è”åˆ°ä¸€èµ·ã€‚<br><img src="/archives/2018/05/07/blockinfo.png" alt="blockinfo"></p><p>æ¯ä¸€ä¸ªINodeFileéƒ½ä¼šåŒ…å«æ•°é‡ä¸ç­‰çš„Blockï¼Œå…·ä½“æ•°é‡ç”±æ–‡ä»¶å¤§å°åŠæ¯ä¸€ä¸ªBlockçš„å¤§å°æ¯”å€¼å†³å®šï¼Œè¿™äº›BlockæŒ‰ç…§æ‰€åœ¨çš„æ–‡ä»¶çš„å…ˆåé¡ºåºç»„æˆBlockInfoæ•°ç»„ï¼ŒBlockInfoç»´æŠ¤çš„æ˜¯Blockçš„å…ƒæ•°æ®ï¼Œæ•°æ®æœ¬èº«æ˜¯ç”±DataNodeç®¡ç†ï¼Œæ‰€ä»¥BlockInfoéœ€è¦åŒ…å«å®é™…æ•°æ®ä¸”ç”±DataNodeç®¡ç†çš„ä¿¡æ¯æ˜¯åä¸ºtripletsçš„Objectæ•°ç»„ï¼Œå¤§å°ä¸º3*replicasï¼ˆreplicasæ˜¯Blockå‰¯æœ¬æ•°é‡ï¼Œé»˜è®¤ä¸º3ï¼‰ï¼Œä»å›¾ä¸­å¯ä»¥çŸ¥é“ï¼ŒBlockInfoåŒ…å«äº†å“ªäº›Blockï¼Œè¿™äº›Blockåˆ†åˆ«å­˜å‚¨åœ¨å“ªäº›DataNodeä¸Šã€‚</p><p>å¦‚ä½•å¿«é€Ÿçš„é€šè¿‡BlockIdå¿«é€Ÿå®šä½åˆ°Blockï¼Œè¿™é‡Œè¿˜éœ€è¦BlocksMapã€‚</p><p>BlocksMapåº•å±‚é€šè¿‡LightWeightGSetå®ç°ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªé“¾å¼è§£å†³å†²çªçš„Hashè¡¨ã€‚äº‹å®ä¸Šï¼ŒBlocksMapé‡Œæ‰€æœ‰çš„BlockInfoå°±æ˜¯INodeFileä¸­å¯¹åº”BlockInfoçš„å¼•ç”¨ï¼Œé€šè¿‡BlockæŸ¥æ‰¾å¯¹åº”BlockInfoæ—¶ï¼Œä¹Ÿæ˜¯å…ˆå¯¹Blockè®¡ç®—HashCodeï¼Œæ ¹æ®ç»“æœå¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„BlockInfoä¿¡æ¯ã€‚</p><p><img src="/archives/2018/05/07/blocksMap.png" alt="blocksMap"></p><p>è¿™é‡Œè¿˜æ¶‰åŠåˆ°å‡ ä¸ªæ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼šexcessReplicateMapï¼ˆå¤šä½™çš„å‰¯æœ¬å­˜æ”¾ï¼‰ ï¼ŒneededReplicationsï¼ˆéœ€è¦è¡¥å……Blockçš„å‰¯æœ¬å­˜æ”¾å¤„ï¼Œæ˜¯ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œç¼ºå°‘å‰¯æœ¬æ•°è¶Šå¤šçš„Blockä¼šä¼˜å…ˆå¤„ç†ï¼‰ï¼ŒinvalidateBlocksï¼ˆåˆ é™¤çš„å‰¯æœ¬å­˜æ”¾å¤„ï¼‰ ï¼ŒcorruptReplicasï¼ˆæŸäº›Blockä¸å¯ç”¨æš‚å­˜å¤„ï¼‰ç­‰ã€‚</p><p>ç›¸æ¯”Namespaceï¼ŒBlockManagerç®¡ç†çš„æ•°æ®è¦å¤æ‚çš„å¤šã€‚</p><h5 id="NetworkTopology"><a href="#NetworkTopology" class="headerlink" title="NetworkTopology"></a>NetworkTopology</h5><p>Hadoopåœ¨è®¾è®¡è€ƒè™‘åˆ°æ•°æ®çš„å®‰å…¨å’Œé«˜æ•ˆï¼Œé»˜è®¤å­˜æ”¾ä¸‰ä»½å‰¯æœ¬ã€‚å­˜å‚¨ç­–ç•¥æ˜¯æœ¬åœ°ä¸€ä»½ï¼ŒåŒæœºæ¶å†…å…¶ä»–æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¸€ä»½ï¼Œä¸åŒæœºæ¶çš„æŸä¸€èŠ‚ç‚¹ä¸Šä¸€ä»½ï¼Œè¿™æ ·å¦‚æœæœ¬åœ°æ•°æ®æŸåäº†ï¼ŒèŠ‚ç‚¹å¯ä»¥ä»åŒä¸€æœºæ¶å†…çš„ç›¸é‚»èŠ‚ç‚¹æ‹¿åˆ°æ•°æ®ï¼Œé€Ÿåº¦è‚¯å®šæ¯”ä»è·¨æœºæ¶èŠ‚ç‚¹ä¸Šæ‹¿åˆ°çš„æ•°æ®è¦å¿«ï¼›ä¸ºäº†é™ä½æ•´ä½“çš„å¸¦å®½æ¶ˆè€—å’Œè¯»å–å»¶æ—¶æ—¶é—´ï¼ŒHDFSä¼šå°½å¿«è®©è¯»å–ç¨‹åºè¯»å–ç¦»å®ƒæœ€è¿‘çš„å‰¯æœ¬ã€‚é‚£ä¹ˆHadoopç¡®å®šä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯ä½äºåŒä¸€æœºæ¶è¿˜æ˜¯ä¸åŒçš„æœºæ¶å‘¢ï¼Ÿè¿™å°±éœ€è¦æœºæ¶æ‹“æ‰‘NetworkTopologyï¼Œä¹Ÿå«ä½œæœºæ¶æ„ŸçŸ¥ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNameNodeå¯åŠ¨æ—¶æ—¥å¿—ä¿¡æ¯æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2018-05-09 19:27:26,423 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node:  /default-rack/ 192.168.123.102:50010</div></pre></td></tr></table></figure><p>æ¯ä¸ªIPå¯¹åº”çš„æœºæ¶IDéƒ½æ˜¯/default-rackï¼Œè¯´æ˜Hadoopçš„æœºæ¶æ„ŸçŸ¥æ²¡æœ‰è¢«å¯ç”¨ã€‚<br><strong>é…ç½®æœºæ¶æ„ŸçŸ¥</strong><br>é…ç½®æœºæ¶æ„ŸçŸ¥ä¹Ÿå¾ˆç®€å•ï¼ŒNameNodeæ‰€åœ¨çš„èŠ‚ç‚¹ä¸­ï¼Œåœ¨<code>core-site.xml</code>æ–‡ä»¶ä¸­é…ç½®<code>topology.script.name</code>ï¼Œvalueé€šå¸¸æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œè¯¥è„šæœ¬æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¾“å‡ºä¸€ä¸ªå€¼ã€‚æ¥å—çš„å‚æ•°é€šå¸¸ä¸ºæŸå°DataNodeçš„IPåœ°å€ï¼Œè€Œè¾“å‡ºçš„å€¼é€šå¸¸ä¸ºè¯¥IPåœ°å€å¯¹åº”çš„DataNodeæ‰€åœ¨çš„rackã€‚<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span>  </div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>topology.script.file.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/apps/hadoop-2.6.5/etc/hadoop/topology.sh<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure><p></p><p><code>topology.sh</code><br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span>!/bin/bash  </div><div class="line">HADOOP_CONF=/home/bigdata/apps/hadoop/etc/hadoop  </div><div class="line">while [ $# -gt 0 ] ; do  </div><div class="line">  nodeArg=$1  </div><div class="line">  exec&lt;$&#123;HADOOP_CONF&#125;/topology.data</div><div class="line">  result=""  </div><div class="line">  while read line ; do  </div><div class="line">    ar=( $line )  </div><div class="line">    if [ "$&#123;ar[0]&#125;" = "$nodeArg" ]||[ "$&#123;ar[1]&#125;" = "$nodeArg" ]; then  </div><div class="line">      result="$&#123;ar[2]&#125;"  </div><div class="line">    fi  </div><div class="line">  done  </div><div class="line">  shift  </div><div class="line">  if [ -z "$result" ] ; then  </div><div class="line">    echo -n "/default-rack"  </div><div class="line">  else  </div><div class="line">    echo -n "$result"  </div><div class="line">  fi  </div><div class="line">  done</div></pre></td></tr></table></figure><p></p><p><code>topology.data</code>æ ¼å¼ä¸ºï¼šèŠ‚ç‚¹ï¼ˆIPæˆ–ä¸»æœºåï¼‰ /äº¤æ¢æœºxx/æœºæ¶xx<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">192.168.123.102 hadoop02 /switch/rack2</div><div class="line">...</div></pre></td></tr></table></figure><p></p><p>é…ç½®åï¼ŒNameNodeå¯åŠ¨æ—¶æ—¥å¿—ä¿¡æ¯æ˜¯è¿™æ ·çš„ï¼š<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2018-05-09 19:27:26,423 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node:  /switch/rack2/ 192.168.123.102:50010</div></pre></td></tr></table></figure><p></p><p>è¯´æ˜Hadoopçš„æœºæ¶æ„ŸçŸ¥å·²ç»è¢«å¯ç”¨äº†ã€‚æŸ¥çœ‹Hadoopæœºæ¶ä¿¡æ¯çš„å‘½ä»¤<code>hadoop dfsadmin -printTopology</code></p><h5 id="LeaseManager"><a href="#LeaseManager" class="headerlink" title="LeaseManager"></a>LeaseManager</h5><p>Lease æœºåˆ¶æ˜¯é‡è¦çš„åˆ†å¸ƒå¼åè®®ï¼Œå¹¿æ³›åº”ç”¨äºå„ç§å®é™…çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚HDFSæ”¯æŒWrite-Once-Read-Manyï¼Œå¯¹æ–‡ä»¶å†™æ“ä½œçš„äº’æ–¥åŒæ­¥é Leaseå®ç°ã€‚<br>Leaseå®é™…ä¸Šæ˜¯æ—¶é—´çº¦æŸé”ï¼Œå…¶ä¸»è¦ç‰¹ç‚¹æ˜¯æ’ä»–æ€§ã€‚å®¢æˆ·ç«¯å†™æ–‡ä»¶æ—¶éœ€è¦å…ˆç”³è¯·ä¸€ä¸ªLeaseï¼Œä¸€æ—¦æœ‰å®¢æˆ·ç«¯æŒæœ‰äº†æŸä¸ªæ–‡ä»¶çš„Leaseï¼Œå…¶å®ƒå®¢æˆ·ç«¯å°±ä¸å¯èƒ½å†ç”³è¯·åˆ°è¯¥æ–‡ä»¶çš„Leaseï¼Œè¿™å°±ä¿è¯äº†åŒä¸€æ—¶åˆ»å¯¹ä¸€ä¸ªæ–‡ä»¶çš„å†™æ“ä½œåªèƒ½å‘ç”Ÿåœ¨ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚<br>NameNodeçš„LeaseManageræ˜¯Leaseæœºåˆ¶çš„æ ¸å¿ƒï¼Œç»´æŠ¤äº†æ–‡ä»¶ä¸Leaseã€å®¢æˆ·ç«¯ä¸Leaseçš„å¯¹åº”å…³ç³»ï¼Œè¿™ç±»ä¿¡æ¯ä¼šéšå†™æ•°æ®çš„å˜åŒ–å®æ—¶å‘ç”Ÿå¯¹åº”æ”¹å˜ã€‚</p><blockquote><p>æœ¬æ–‡æ˜¯æ ¹æ®<a href="https://tech.meituan.com/namenode.html?_blank" target="_blank" rel="external">ç¾å›¢ç‚¹è¯„æŠ€æœ¯å›¢é˜Ÿä¸­ã€ŠHDFS NameNodeå†…å­˜å…¨æ™¯ã€‹</a>æ•´ç†æ€»ç»“</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:08 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;blockquote&gt;&lt;p&gt;åœ¨HDFSç³»ç»Ÿæ¶æ„ä¸­ï¼ŒNameNodeç®¡ç†ç€æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ï¼Œç»´æŠ¤æ•´ä¸ªé›†ç¾¤çš„æœºæ¶æ„ŸçŸ¥ä¿¡æ¯å’ŒDataNodeå’ŒBlockçš„ä¿¡æ¯ï¼ŒLeaseç®¡ç†ä»¥åŠé›†ä¸­å¼ç¼“å­˜å¼•å…¥çš„ç¼“å­˜ç®¡ç†ç­‰ç­‰ã€‚ä»æ•´ä¸ªHDFSç³»ç»Ÿæ¶æ„ä¸Šæ¥çœ‹ï¼ŒNameNodeæ˜¯æœ€é‡è¦ã€æœ€å¤æ‚ä¹Ÿæ˜¯æœ€å®¹æ˜“å‡ºç°é—®é¢˜çš„åœ°æ–¹ã€‚&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="HDFS" scheme="https://pross.space/tags/HDFS/"/>
    
  </entry>
  
  <entry>
    <title>Hadoop HAé›†ç¾¤æ­å»º</title>
    <link href="https://pross.space/archives/2018/04/25/"/>
    <id>https://pross.space/archives/2018/04/25/</id>
    <published>2018-04-25T00:58:34.000Z</published>
    <updated>2019-07-10T16:31:39.836Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:08 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>HAï¼šHigh Availableï¼Œé«˜å¯ç”¨ã€‚ä¸ºä»€ä¹ˆéœ€è¦HAæœºåˆ¶ï¼Ÿæ€ä¹ˆé…ç½®HAï¼Ÿ</p><a id="more"></a><h3 id="ä¸ºä»€ä¹ˆä¼šæœ‰Hadoop-HAæœºåˆ¶"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰Hadoop-HAæœºåˆ¶" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰Hadoop HAæœºåˆ¶"></a>ä¸ºä»€ä¹ˆä¼šæœ‰Hadoop HAæœºåˆ¶</h3><p>åœ¨HDFSé›†ç¾¤ä¸­NameNodeä¼šå­˜åœ¨å•ç‚¹æ•…éšœï¼ˆSPOFï¼šA Single Point of Failureï¼‰é—®é¢˜ï¼šå¯¹äºåªæœ‰ä¸€ä¸ªNameNodeçš„é›†ç¾¤ï¼Œå¦‚æœå”¯ä¸€çš„NameNodeæœºå™¨å‡ºç°æ•…éšœï¼Œæ¯”å¦‚å®•æœºã€è½¯ä»¶ç¡¬ä»¶å‡çº§ç­‰ã€‚é‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°†æ— æ³•ä½¿ç”¨ï¼Œç›´åˆ°NameNodeé‡æ–°å¯åŠ¨æ‰ä¼šæ¢å¤ã€‚</p><p>æ‰€ä»¥åœ¨hadoop2.0ä¹‹å‰ï¼Œå‡ºç°è¿™ç§å•èŠ‚ç‚¹æ•…éšœé—®é¢˜æ˜¯æ— æ³•è§£å†³çš„ï¼›ä½†æ˜¯Hadoop HAæœºåˆ¶çš„å‡ºç°å°±å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ä¸€ä¸ªå…¸å‹çš„Hadoop HAé›†ç¾¤ä¸­ï¼Œä½¿ç”¨ä¸¤å°å•ç‹¬çš„æœºå™¨é…ç½®ä¸ºNameNodesèŠ‚ç‚¹ã€‚åœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼Œç¡®ä¿NameNodesä¸­åªæœ‰ä¸€ä¸ªå¤„äºActiveçŠ¶æ€ï¼Œå¦ä¸€ä¸ªå¤„åœ¨StandbyçŠ¶æ€ã€‚å…¶ä¸­ActiveNameNodeè´Ÿè´£é›†ç¾¤ä¸­æ‰€æœ‰çš„å®¢æˆ·ç«¯çš„æ“ä½œï¼ŒStandbyNameNodeä»…ä»…å……å½“å¤‡æœºï¼Œä¿è¯ä¸€æ—¦ActiveNameNodeå‡ºç°é—®é¢˜èƒ½å¤Ÿå¿«é€Ÿåˆ‡æ¢ã€‚</p><p>å‡†å¤‡ä¸¤å°NameNodeè§£å†³å•èŠ‚ç‚¹æ•…éšœé—®é¢˜æ˜¯å®Œå…¨å¯è¡Œï¼Œä½†æ˜¯åˆå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šActiveå’ŒStandbyä¸¤ä¸ª NameNodesçš„å…ƒæ•°æ®ä¿¡æ¯(editlog)å¦‚ä½•åŒæ­¥æ‰èƒ½è®©StandbyèŠ‚ç‚¹åˆ‡æ¢åâ€æ— ç¼å¯¹æ¥å·¥ä½œâ€ï¼Ÿé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªå…±äº«å­˜å‚¨ç³»ç»Ÿï¼Œè¿™ä¸ªç³»ç»Ÿå°±æ˜¯Zookeeperï¼ŒActive NameNodeä¼šå°†æ•°æ®å†™å…¥å…±äº«å­˜å‚¨ç³»ç»Ÿï¼Œè€ŒStandbyä¾¿å¯ä»¥å¿«é€Ÿåˆ‡ä¸ºActive NameNodeæ¥æ›¿å…¶å·¥ä½œã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼ŒDataNodeéœ€è¦é…ç½®NameNodesçš„ä½ç½®ï¼Œå¹¶åŒæ—¶ç»™ä»–ä»¬å‘é€æ–‡ä»¶å—ä¿¡æ¯ä»¥åŠå¿ƒè·³æ£€æµ‹ã€‚</p><p><img src="/archives/2018/04/25/zookeeper.jpg" alt=""></p><h3 id="é›†ç¾¤è§„åˆ’å’Œå‡†å¤‡"><a href="#é›†ç¾¤è§„åˆ’å’Œå‡†å¤‡" class="headerlink" title="é›†ç¾¤è§„åˆ’å’Œå‡†å¤‡"></a>é›†ç¾¤è§„åˆ’å’Œå‡†å¤‡</h3><p>åŸºäºHadoopé›†ç¾¤ç¯å¢ƒæ­å»ºçš„å‡†å¤‡æ¡ä»¶ï¼Œé›†ç¾¤è§„åˆ’ï¼š</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">hadoop02</th><th style="text-align:center">hadoop03</th><th style="text-align:center">hadoop04</th><th style="text-align:center">hadoop05</th></tr></thead><tbody><tr><td style="text-align:center">namenode</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">datanode</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td></tr><tr><td style="text-align:center">resourcemanager</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td></tr><tr><td style="text-align:center">nodemanager</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td></tr><tr><td style="text-align:center">zookeeper</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">journalnode</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">zkfc</td><td style="text-align:center">âœ”</td><td style="text-align:center">âœ”</td><td style="text-align:center"></td></tr></tbody></table><h3 id="é›†ç¾¤é…ç½®"><a href="#é›†ç¾¤é…ç½®" class="headerlink" title="é›†ç¾¤é…ç½®"></a>é›†ç¾¤é…ç½®</h3><p><code>hadoop-env.sh</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME= /usr/local/jdk1.8.0_73</div></pre></td></tr></table></figure><p><code>core-site.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®š hdfs çš„ nameservice ä¸º myha01 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://myha01/<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®š hadoop å·¥ä½œç›®å½• --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/data/hadoopdata/<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®š zookeeper é›†ç¾¤è®¿é—®åœ°å€ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop02:2181,hadoop03:2181,hadoop04:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure><p><code>hdfs-site.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®šå‰¯æœ¬æ•° --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--æŒ‡å®š hdfs çš„ nameservice ä¸º myha01ï¼Œéœ€è¦å’Œ core-site.xml ä¸­ä¿æŒä¸€è‡´--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>myha01<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- myha01 ä¸‹é¢æœ‰ä¸¤ä¸ª NameNodeï¼Œåˆ†åˆ«æ˜¯ nn1ï¼Œnn2 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.namenodes.myha01<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>nn1,nn2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- nn1 çš„ RPC é€šä¿¡åœ°å€ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.myha01.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop02:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- nn1 çš„ http é€šä¿¡åœ°å€ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.myha01.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop02:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- nn2 çš„ RPC é€šä¿¡åœ°å€ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.myha01.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop03:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- nn2 çš„ http é€šä¿¡åœ°å€ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.myha01.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop03:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®š NameNode çš„ edits å…ƒæ•°æ®åœ¨ JournalNode ä¸Šçš„å­˜æ”¾ä½ç½® --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>qjournal://hadoop02:8485;hadoop03:8485;hadoop04:8485/myha01<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®š JournalNode åœ¨æœ¬åœ°ç£ç›˜å­˜æ”¾æ•°æ®çš„ä½ç½® --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/data/journaldata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- å¼€å¯ NameNode å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- é…ç½®å¤±è´¥è‡ªåŠ¨åˆ‡æ¢å®ç°æ–¹å¼ valueå€¼ä¸è¦æ¢è¡Œ--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.failover.proxy.provider.myha01<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- é…ç½®éš”ç¦»æœºåˆ¶æ–¹æ³•ï¼Œå¤šä¸ªæœºåˆ¶ç”¨æ¢è¡Œåˆ†å‰²ï¼Œå³æ¯ä¸ªæœºåˆ¶æš‚ç”¨ä¸€è¡Œ--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span></div><div class="line">          sshfence</div><div class="line">          shell(/bin/true)</div><div class="line">      <span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- ä½¿ç”¨ sshfence éš”ç¦»æœºåˆ¶æ—¶éœ€è¦ ssh å…ç™»é™† --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/.ssh/id_rsa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- é…ç½® sshfence éš”ç¦»æœºåˆ¶è¶…æ—¶æ—¶é—´ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.connect-timeout<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>30000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure><p><code>mapred-site.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®š mr æ¡†æ¶ä¸º yarn æ–¹å¼ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- è®¾ç½® mapreduce çš„å†å²æœåŠ¡å™¨åœ°å€å’Œç«¯å£å· --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop02:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- mapreduce å†å²æœåŠ¡å™¨çš„ web è®¿é—®åœ°å€ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop02:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure><p><code>yarn-site.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- å¼€å¯ RM é«˜å¯ç”¨ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®š RM çš„ cluster id --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.cluster-id<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>yrc<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®š RM çš„åå­— --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.rm-ids<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>rm1,rm2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- åˆ†åˆ«æŒ‡å®š RM çš„åœ°å€ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop04<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop05<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- æŒ‡å®š zk é›†ç¾¤åœ°å€ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.zk-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop02:2181,hadoop03:2181,hadoop04:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- è¦è¿è¡Œ MapReduce ç¨‹åºå¿…é¡»é…ç½®çš„é™„å±æœåŠ¡ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- å¼€å¯ YARN é›†ç¾¤çš„æ—¥å¿—èšåˆåŠŸèƒ½ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- YARN é›†ç¾¤çš„èšåˆæ—¥å¿—æœ€é•¿ä¿ç•™æ—¶é•¿ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>86400<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- å¯ç”¨è‡ªåŠ¨æ¢å¤ --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.recovery.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- åˆ¶å®š resourcemanager çš„çŠ¶æ€ä¿¡æ¯å­˜å‚¨åœ¨ zookeeper é›†ç¾¤ä¸Š--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.store.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure><p><code>slaves</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hadoop02</div><div class="line">hadoop03</div><div class="line">hadoop04</div><div class="line">hadoop05</div></pre></td></tr></table></figure><p><strong>é…ç½®ç¯å¢ƒå˜é‡å’Œåˆ†å‘å®‰è£…åŒ…</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">vim ~/.bashrc  #å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå…ˆæ‰§è¡Œ ll -a ~/</div><div class="line">æ·»åŠ ä¸¤è¡Œï¼š</div><div class="line">export HADOOP_HOME=/home/hadoop/apps/hadoop-2.7.5</div><div class="line">export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</div><div class="line"></div><div class="line">åˆ†å‘å®‰è£…åŒ…å’Œç¯å¢ƒå˜é‡ï¼š</div><div class="line">scp -r ~/apps/hadoop-2.7.5 hadoop@hadoop03:~/apps/</div><div class="line">...</div><div class="line">scp ~/.bashrc hadoop@hadoop03:~/</div><div class="line">...</div></pre></td></tr></table></figure><h3 id="é›†ç¾¤åˆå§‹åŒ–å’Œå¯åŠ¨"><a href="#é›†ç¾¤åˆå§‹åŒ–å’Œå¯åŠ¨" class="headerlink" title="é›†ç¾¤åˆå§‹åŒ–å’Œå¯åŠ¨"></a>é›†ç¾¤åˆå§‹åŒ–å’Œå¯åŠ¨</h3><p>HAé›†ç¾¤çš„å¯åŠ¨æ˜¯æœ‰ä¸€å®šçš„é¡ºåºçš„ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤:</p><p><strong>å¯åŠ¨zookeeperé›†ç¾¤</strong></p><p>é…ç½®zookeeperé›†ç¾¤çš„èŠ‚ç‚¹éƒ½éœ€è¦å¯åŠ¨</p><p>å¯åŠ¨å‘½ä»¤ï¼š<code>zkServer.sh start</code></p><p>æŸ¥çœ‹çŠ¶æ€ï¼š<code>zkServer.sh status</code></p><p><strong>å¯åŠ¨journalnodeè¿›ç¨‹ï¼š</strong></p><p>é…ç½®journalnodeé›†ç¾¤çš„èŠ‚ç‚¹éƒ½éœ€è¦å¯åŠ¨</p><p>å¯åŠ¨å‘½ä»¤ï¼š<code>hadoop-daemon.sh start journalnode</code></p><p><strong>æ ¼å¼åŒ–NameNodeï¼š</strong></p><p>åœ¨hadoop02ä¸»èŠ‚ç‚¹ä¸Šæ ¼å¼åŒ–æ“ä½œ</p><p>å‘½ä»¤ï¼š<code>hadoop namenode -format</code></p><p>åœ¨<code>~/data/hadoopdata/</code>ä¸­ä¼šç”Ÿæˆé›†ç¾¤ä¿¡æ¯ï¼ŒæŠŠhadoopdataæ–‡ä»¶å‘é€åˆ°hadoop03ä¸Š</p><p><code>scp -r ~/data/hadoopdata/ hadoop@hadoop03:~/data/</code></p><p><strong>æ ¼å¼åŒ–ZKFC</strong></p><p>åœ¨ç¬¬ä¸€å°æœºå™¨ä¸Šæ“ä½œå³å¯</p><p>å‘½ä»¤ï¼š<code>hdfs zkfc -formatZK</code></p><p><strong>å¯åŠ¨HDFSå’ŒYARNé›†ç¾¤</strong></p><p>å‘½ä»¤ï¼š<code>start-dfs.sh</code> <code>start-yarn.sh</code></p><p><strong>æŸ¥çœ‹è¿›ç¨‹æƒ…å†µ</strong></p><p>å‘½ä»¤ï¼š<code>jps</code></p><h3 id="éªŒè¯å’Œæµ‹è¯•"><a href="#éªŒè¯å’Œæµ‹è¯•" class="headerlink" title="éªŒè¯å’Œæµ‹è¯•"></a>éªŒè¯å’Œæµ‹è¯•</h3><p><strong>éªŒè¯</strong></p><p>è®¿é—®HDFSWebé¡µé¢ï¼š<code>http://hadoop02:50070</code> ã€<code>http://hadoop03:50070</code></p><p>hadoop02æ˜¯ActiceçŠ¶æ€ï¼Œhadoop03æ˜¯standbyçŠ¶æ€</p><p>è®¿é—®YARNwebé¡µé¢ï¼š<code>http://hadoop04:8088</code> ã€<code>http://hadoop05:8088</code></p><p>è®¿é—®hadoop05 æ˜¯ standby resourcemanagerï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ° hadoop04</p><p><strong>æµ‹è¯•</strong></p><p>å¹²æ‰active namenodeçš„è¿›ç¨‹ï¼Œçœ‹çœ‹é›†ç¾¤å˜åŒ–</p><p>åœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™å¹²æ‰ active namenodeï¼Œ çœ‹çœ‹é›†ç¾¤æœ‰ä»€ä¹ˆå˜åŒ–</p><p>å¹²æ‰ active resourcemanagerï¼Œ çœ‹çœ‹é›†ç¾¤æœ‰ä»€ä¹ˆå˜åŒ–</p><p>åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™å¹²æ‰ active resourcemanagerï¼Œçœ‹çœ‹é›†ç¾¤æœ‰ä»€ä¹ˆå˜åŒ–</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:08 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;HAï¼šHigh Availableï¼Œé«˜å¯ç”¨ã€‚ä¸ºä»€ä¹ˆéœ€è¦HAæœºåˆ¶ï¼Ÿæ€ä¹ˆé…ç½®HAï¼Ÿ&lt;/p&gt;
    
    </summary>
    
    
      <category term="Hadoop" scheme="https://pross.space/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Decorator Patternï¼ˆè£…é¥°è€…æ¨¡å¼ï¼‰</title>
    <link href="https://pross.space/archives/2018/04/16/"/>
    <id>https://pross.space/archives/2018/04/16/</id>
    <published>2018-04-16T14:59:59.000Z</published>
    <updated>2018-08-31T16:20:50.919Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>æ‰€ä¸ºâ€è®¾è®¡æ¨¡å¼â€ï¼Œå…¨ç§°æ˜¯â€é¢å¯¹å¯¹è±¡è®¾è®¡æ¨¡å¼â€çš„ç®€ç§°ã€‚å…¶æ¬¡éœ€è¦æ˜ç™½ï¼Œè®¾è®¡æ¨¡å¼æ˜¯ä¸è¯­è¨€æ— å…³ï¼Œæ„æ€å°±æ˜¯è¯´å®ƒå¹¶ä¸æ˜¯å±äºæŸç§ç¼–ç¨‹è¯­è¨€ã€‚æœ€åï¼Œå› ä¸ºJavaå¯¹é¢å‘å¯¹è±¡æ”¯æŒçš„æ¯”è¾ƒå¥½ï¼Œå¹¶ä¸”åœ¨JDKå½“ä¸­æœ‰å¾ˆå¤šå®ç°å°±æ˜¯ä¾é è£…é¥°è€…æ¨¡å¼ï¼Œæ‰€ä»¥ä¸‹é¢ä¸¾ä¾‹é‡‡ç”¨Javaä»£ç æ¥è¯´æ˜ã€‚</p><a id="more"></a><h4 id="è£…é¥°è€…æ¨¡å¼"><a href="#è£…é¥°è€…æ¨¡å¼" class="headerlink" title="è£…é¥°è€…æ¨¡å¼"></a>è£…é¥°è€…æ¨¡å¼</h4><p>è£…é¥°è€…æ¨¡å¼æ˜¯åœ¨ä¸æ”¹å˜åŸç±»æ–‡ä»¶å’Œä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€çš„æ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ã€‚å®ƒæ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è£…é¥°æ¥åŒ…è£¹çœŸå®çš„å¯¹è±¡ã€‚å…¶ç›®çš„æ˜¯ï¼šå¯¹åŸç±»çš„åŠŸèƒ½å¢å¼ºã€‚</p><p>åœ¨è£…é¥°æ¨¡å¼ä¸­çš„å„ä¸ªè§’è‰²æœ‰ï¼š</p><p>æŠ½è±¡æ„ä»¶ï¼ˆComponentï¼‰ï¼šç»™å‡ºä¸€ä¸ªæŠ½è±¡æ¥å£ï¼Œä»¥è§„èŒƒå‡†å¤‡æ¥æ”¶é™„åŠ è´£ä»»çš„å¯¹è±¡ã€‚</p><p>å…·ä½“æ„ä»¶ï¼ˆConcrete Componentï¼‰ï¼šå®šä¹‰ä¸€ä¸ªå°†è¦æ¥æ”¶é™„åŠ è´£ä»»çš„ç±»</p><p>è£…é¥°ï¼ˆDecoratorï¼‰è§’è‰²ï¼šæŒæœ‰ä¸€ä¸ªæ„å»ºå¯¹è±¡çš„å®ä¾‹ï¼Œå¹¶å®ç°ä¸€ä¸ªä¸æŠ½è±¡æ„ä»¶æ¥å£ä¸€è‡´çš„æ¥å£</p><p>å…·ä½“è£…é¥°ï¼ˆConcrete Decoratorï¼‰ï¼šè´Ÿè´£ç»™æ„ä»¶å¯¹è±¡æ·»åŠ ä¸Šé™„åŠ çš„è´£ä»»</p><h4 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>éœ€æ±‚ï¼šå®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè®©å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œå¤§å°å†™è½¬æ¢ã€‚</p><p>åˆ†æï¼šå­—ç¬¦ä¸²æ•°ç»„ä¸­æ˜¯æ²¡æœ‰ç›´æ¥å¯ä»¥å®ç°å¤§å°å†™è½¬æ¢çš„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œå­—ç¬¦ä¸²æ•°ç»„éå†å‡ºæ¥è½¬åŒ–ä¸ºå•ä¸ªå­—ç¬¦è¿›è¡Œå¤§å°å†™çš„è½¬æ¢æ˜¯å¯ä»¥ï¼Œä½†æ˜¯ç”¨è¿™æ ·çš„å†™æ³•å°±å’Œè£…é¥°è€…æ¨¡å¼æ²¡å•¥äº‹äº†ã€‚è¿”å›ä¹‹å‰ï¼Œå› ä¸ºæ²¡æœ‰ç›´æ¥è½¬æ¢æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦å¯¹å…¶è¿›è¡ŒåŠŸèƒ½å¢å¼ºã€‚</p><p>ä»£ç ä¸€ç°ï¼Œå…¶ä¹‰è‡ªè§ï¼š</p><p><code>ListTest.java</code></p><p><img src="/archives/2018/04/16/ListTest.png" alt=""></p><p><code>MyList.java</code></p><p><img src="/archives/2018/04/16/MyList.png" alt=""></p><p><code>Operator.java</code></p><p><img src="/archives/2018/04/16/Operator.png" alt=""></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;p&gt;æ‰€ä¸ºâ€è®¾è®¡æ¨¡å¼â€ï¼Œå…¨ç§°æ˜¯â€é¢å¯¹å¯¹è±¡è®¾è®¡æ¨¡å¼â€çš„ç®€ç§°ã€‚å…¶æ¬¡éœ€è¦æ˜ç™½ï¼Œè®¾è®¡æ¨¡å¼æ˜¯ä¸è¯­è¨€æ— å…³ï¼Œæ„æ€å°±æ˜¯è¯´å®ƒå¹¶ä¸æ˜¯å±äºæŸç§ç¼–ç¨‹è¯­è¨€ã€‚æœ€åï¼Œå› ä¸ºJavaå¯¹é¢å‘å¯¹è±¡æ”¯æŒçš„æ¯”è¾ƒå¥½ï¼Œå¹¶ä¸”åœ¨JDKå½“ä¸­æœ‰å¾ˆå¤šå®ç°å°±æ˜¯ä¾é è£…é¥°è€…æ¨¡å¼ï¼Œæ‰€ä»¥ä¸‹é¢ä¸¾ä¾‹é‡‡ç”¨Javaä»£ç æ¥è¯´æ˜ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://pross.space/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>MapReduceç¼–ç¨‹æ¡ˆä¾‹ï¼ˆä¸‹ï¼‰</title>
    <link href="https://pross.space/archives/2018/04/05/"/>
    <id>https://pross.space/archives/2018/04/05/</id>
    <published>2018-04-05T14:18:53.000Z</published>
    <updated>2019-07-10T16:33:39.204Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><ul><li>Versionså˜åŠ¨ç‰ˆæœ¬è®°å½•</li><li>æ•°å€¼ç´¯åŠ </li></ul><a id="more"></a><h4 id="Versionå˜åŠ¨ç‰ˆæœ¬è®°å½•"><a href="#Versionå˜åŠ¨ç‰ˆæœ¬è®°å½•" class="headerlink" title="Versionå˜åŠ¨ç‰ˆæœ¬è®°å½•"></a>Versionå˜åŠ¨ç‰ˆæœ¬è®°å½•</h4><p>åœ¨æ‰€æœ‰æœ‰ç‰ˆæœ¬å˜åŠ¨çš„è®°å½•åé¢è¿½åŠ ä¸€æ¡å­—æ®µä¿¡æ¯ï¼šè¯¥ä¿¡æ¯å°±æ˜¯ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ç‰ˆæœ¬å·ï¼Œåªé™åŒç”¨æˆ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">æ•°æ®æ ¼å¼ï¼š</div><div class="line"><span class="number">20170308</span>,é»„æ¸¤,å…‰ç¯æ–—åœ°ä¸»,<span class="number">8</span>,<span class="number">360</span>æ‰‹æœºåŠ©æ‰‹,<span class="number">0.1</span>ç‰ˆæœ¬,åŒ—äº¬</div><div class="line"><span class="number">20170308</span>,é»„æ¸¤,å…‰ç¯æ–—åœ°ä¸»,<span class="number">22</span>,<span class="number">360</span>æ‰‹æœºåŠ©æ‰‹,<span class="number">0.2</span>ç‰ˆæœ¬,åŒ—äº¬</div><div class="line"><span class="number">20170308</span>,é»„æ¸¤,å…‰ç¯æ–—åœ°ä¸»,<span class="number">14</span>,<span class="number">360</span>æ‰‹æœºåŠ©æ‰‹,<span class="number">0.3</span>ç‰ˆæœ¬,åŒ—äº¬</div><div class="line">...</div><div class="line">å­—æ®µä¿¡æ¯ï¼š</div><div class="line">ç”¨æˆ·IDï¼Œç”¨æˆ·åï¼Œæ¸¸æˆåï¼Œå°æ—¶ï¼Œæ•°æ®æ¥æºï¼Œæ¸¸æˆç‰ˆæœ¬ï¼Œç”¨æˆ·æ‰€åœ¨åœ°</div><div class="line">id, name, game, hour, source, version, city</div></pre></td></tr></table></figure><p>æ€è·¯ï¼šæŠŠidã€nameã€gameã€hoursã€sourceã€versionã€cityå°è£…æˆ<code>Version</code>å¯¹è±¡ï¼Œå®ç°<code>WritableComparable</code>æ¥å£ï¼Œå¹¶æ ¹æ®idã€nameã€versionå…ˆåæ’åºã€‚æ’åºååˆ¤æ–­ç›¸é‚»çš„æ•°æ®ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´æ¥è¿›è¡Œç‰ˆæœ¬å·çš„æ·»åŠ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.pross.version;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.DataInput;</div><div class="line"><span class="keyword">import</span> java.io.DataOutput;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.WritableComparable;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> pross shawn</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * create timeï¼š2018å¹´3æœˆ19æ—¥</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * contentï¼šVersionå®ä½“ç±»</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Version</span> <span class="keyword">implements</span> <span class="title">WritableComparable</span>&lt;<span class="title">Version</span>&gt;</span>&#123;</div><div class="line"><span class="keyword">private</span> String id;</div><div class="line"><span class="keyword">private</span> String name;</div><div class="line"><span class="keyword">private</span> String game;</div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> hour;</div><div class="line"><span class="keyword">private</span> String source;</div><div class="line"><span class="keyword">private</span> String version;</div><div class="line"><span class="keyword">private</span> String city;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> id;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.id = id;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> name;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.name = name;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getGame</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> game;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGame</span><span class="params">(String game)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.game = game;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHour</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> hour;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHour</span><span class="params">(<span class="keyword">int</span> hour)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.hour = hour;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getSource</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> source;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSource</span><span class="params">(String source)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.source = source;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getVersion</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> version;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVersion</span><span class="params">(String version)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.version = version;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> city;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String city)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.city = city;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Version</span><span class="params">(String id, String name, String game, <span class="keyword">int</span> hour, String source, String version, String city)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>();</div><div class="line"><span class="keyword">this</span>.id = id;</div><div class="line"><span class="keyword">this</span>.name = name;</div><div class="line"><span class="keyword">this</span>.game = game;</div><div class="line"><span class="keyword">this</span>.hour = hour;</div><div class="line"><span class="keyword">this</span>.source = source;</div><div class="line"><span class="keyword">this</span>.version = version;</div><div class="line"><span class="keyword">this</span>.city = city;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Version</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> id + <span class="string">","</span> + name + <span class="string">","</span> + game + <span class="string">","</span> + hour + <span class="string">","</span> + source+ <span class="string">","</span> + version + <span class="string">","</span> + city;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput out)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">out.writeUTF(id);</div><div class="line">out.writeUTF(name);</div><div class="line">out.writeUTF(game);</div><div class="line">        out.writeInt(hour);  </div><div class="line">        out.writeUTF(source);  </div><div class="line">        out.writeUTF(version);  </div><div class="line">        out.writeUTF(city);  </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput in)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line"><span class="keyword">this</span>.id = in.readUTF();</div><div class="line"><span class="keyword">this</span>.name = in.readUTF();</div><div class="line"><span class="keyword">this</span>.game = in.readUTF();</div><div class="line"><span class="keyword">this</span>.hour = in.readInt();</div><div class="line"><span class="keyword">this</span>.source = in.readUTF();</div><div class="line"><span class="keyword">this</span>.version = in.readUTF();</div><div class="line"><span class="keyword">this</span>.city = in.readUTF();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * æ¯”è¾ƒå™¨ æ’åº</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Version version)</span> </span>&#123;</div><div class="line"><span class="keyword">int</span> resultID=<span class="keyword">this</span>.id.compareTo(version.getId());</div><div class="line"><span class="keyword">if</span>(resultID==<span class="number">0</span>)&#123;</div><div class="line"><span class="keyword">int</span> resultName=<span class="keyword">this</span>.name.compareTo(version.getName());</div><div class="line"><span class="keyword">if</span>(resultName==<span class="number">0</span>)&#123;</div><div class="line"><span class="keyword">return</span> <span class="keyword">this</span>.version.compareTo(version.getVersion());</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line"><span class="keyword">return</span> resultName;</div><div class="line">&#125;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line"><span class="keyword">return</span> resultID;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>åœ¨MRç¨‹åºä¸­ï¼Œmapé˜¶æ®µæ‹†åˆ†æ•°æ®åæŠŠæ•°æ®å°è£…åˆ°<code>Version</code>å¯¹è±¡ä¸­ï¼Œåœ¨reduceé˜¶æ®µè¿›è¡Œæ•°æ®è¿­ä»£ï¼Œåˆ¤æ–­ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå½“idå’Œnameä¸ä¸€è‡´ï¼Œè¯æ˜ä¸æ˜¯ä¸¤ä¸ªä¸åŒçš„ç”¨æˆ·ï¼›å¦‚æœä¸€è‡´ï¼Œåˆ™è¿›è¡Œç‰ˆæœ¬å·çš„æ‹¼æ¥ï¼Œæ”¾å…¥Keyä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.pross.version;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configured;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.util.Tool;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.util.ToolRunner;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> pross shawn</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * create timeï¼š2018å¹´3æœˆ19æ—¥</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * contentï¼šåœ¨æ‰€æœ‰æœ‰ç‰ˆæœ¬å˜åŠ¨çš„è®°å½•åé¢è¿½åŠ ä¸€æ¡å­—æ®µä¿¡æ¯ï¼šè¯¥ä¿¡æ¯å°±æ˜¯ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ç‰ˆæœ¬å·ï¼Œåªé™åŒç”¨æˆ·</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * æ–‡ä»¶è·¯å¾„ï¼šE:\BigData\7_Hadoop\hadoop-mapreduce-day5\data\input_version</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VersionMR</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span></span>&#123;</div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"><span class="keyword">int</span> run=ToolRunner.run(<span class="keyword">new</span> VersionMR(), args);</div><div class="line">System.exit(run);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"><span class="comment">//æŒ‡å®šHDFSç›¸å…³å‚æ•°</span></div><div class="line">Configuration conf=<span class="keyword">new</span> Configuration();</div><div class="line">FileSystem fs=FileSystem.get(conf);</div><div class="line"> </div><div class="line">Job job=Job.getInstance(conf);</div><div class="line">job.setJarByClass(VersionMR.class);</div><div class="line"></div><div class="line"><span class="comment">//æŒ‡å®šmapperç±»å’Œreduceç±»</span></div><div class="line">job.setMapperClass(VersionMRMapper.class);</div><div class="line">job.setReducerClass(VersionMRReduce.class);</div><div class="line"></div><div class="line"><span class="comment">//æŒ‡å®šè¾“å‡ºç±»å‹</span></div><div class="line">        job.setMapOutputKeyClass(Version.class);  </div><div class="line">        job.setMapOutputValueClass(NullWritable.class);  </div><div class="line">        job.setOutputKeyClass(Text.class);  </div><div class="line">        job.setOutputValueClass(NullWritable.class); </div><div class="line">        </div><div class="line">        <span class="comment">//æŒ‡å®šè·¯å¾„</span></div><div class="line">        Path inputPath = <span class="keyword">new</span> Path(<span class="string">"E:\\BigData\\7_Hadoop\\hadoop-mapreduce-day5\\data\\input_version"</span>);  </div><div class="line">        Path outputPath = <span class="keyword">new</span> Path(<span class="string">"E:\\BigData\\7_Hadoop\\hadoop-mapreduce-day5\\data\\output_version"</span>); </div><div class="line">        <span class="comment">//å¦‚æœè¾“å‡ºè·¯å¾„å­˜åœ¨åˆ™åˆ é™¤</span></div><div class="line">       <span class="keyword">if</span>(fs.exists(outputPath))&#123;</div><div class="line">       fs.delete(outputPath,<span class="keyword">true</span>);</div><div class="line">       &#125;</div><div class="line">       FileInputFormat.setInputPaths(job, inputPath);</div><div class="line">       FileOutputFormat.setOutputPath(job, outputPath);</div><div class="line">       </div><div class="line">       <span class="comment">//æäº¤ä»»åŠ¡</span></div><div class="line">       <span class="keyword">boolean</span> bool = job.waitForCompletion(<span class="keyword">true</span>);</div><div class="line">       <span class="keyword">return</span> bool? <span class="number">0</span> : <span class="number">1</span> ;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * mapç»„ä»¶</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">VersionMRMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Version</span>, <span class="title">NullWritable</span>&gt;</span>&#123;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * æ•°æ®æ ¼å¼ï¼š</span></div><div class="line"><span class="comment"> * 20170308,é»„æ¸¤,å…‰ç¯æ–—åœ°ä¸»,8,360æ‰‹æœºåŠ©æ‰‹,0.1ç‰ˆæœ¬,åŒ—äº¬</span></div><div class="line"><span class="comment"> * 20170308,é»„æ¸¤,å…‰ç¯æ–—åœ°ä¸»,5,360æ‰‹æœºåŠ©æ‰‹,0.1ç‰ˆæœ¬,åŒ—äº¬</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * å­—æ®µä¿¡æ¯ï¼š</span></div><div class="line"><span class="comment"> * ç”¨æˆ·IDï¼Œç”¨æˆ·åï¼Œæ¸¸æˆåï¼Œå°æ—¶ï¼Œæ•°æ®æ¥æºï¼Œæ¸¸æˆç‰ˆæœ¬ï¼Œç”¨æˆ·æ‰€åœ¨åœ°</span></div><div class="line"><span class="comment"> * id, name, game, hour, source, version, city </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException ,InterruptedException </span>&#123;</div><div class="line"><span class="comment">//æ‹†åˆ†æ•°æ®</span></div><div class="line">String[] split = value.toString().split(<span class="string">","</span>);</div><div class="line"><span class="comment">//æŠŠæ•°æ®å°è£…åˆ°å¯¹è±¡ä¸­</span></div><div class="line">Version version = <span class="keyword">new</span> Version(split[<span class="number">0</span>], split[<span class="number">1</span>],split[<span class="number">2</span>],Integer.parseInt(split[<span class="number">3</span>]), split[<span class="number">4</span>], split[<span class="number">5</span>], split[<span class="number">6</span>]);</div><div class="line">context.write(version, NullWritable.get());</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * reduceç»„ä»¶</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">VersionMRReduce</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Version</span>, <span class="title">NullWritable</span>, <span class="title">Text</span>, <span class="title">NullWritable</span>&gt;</span>&#123;</div><div class="line"></div><div class="line">String lastID=<span class="keyword">null</span>;</div><div class="line">String lastName=<span class="keyword">null</span>;</div><div class="line">String lastVersion=<span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Version key, Iterable&lt;NullWritable&gt; values,Context context)</span><span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line">            <span class="keyword">for</span>(NullWritable nvl:values)&#123;</div><div class="line"><span class="keyword">if</span>(lastVersion==<span class="keyword">null</span>)&#123;</div><div class="line"><span class="comment">//ç¬¬ä¸€æ¬¡è¿›å…¥ç¨‹åºï¼ŒlastVersionä¸ºç©ºï¼Œç›´æ¥æ‰“å°ï¼Œå› ä¸ºç›¸å½“äºæ²¡æœ‰ä¸Šä¸€æ¡æ•°æ®</span></div><div class="line">context.write(<span class="keyword">new</span> Text(key.toString()), NullWritable.get());</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line"><span class="comment">//å½“IDå’ŒNameä¸€è‡´æ—¶</span></div><div class="line"><span class="keyword">if</span>(lastID.equals(key.getId()) &amp;&amp; lastName.equals(key.getName()))&#123;</div><div class="line"><span class="comment">//åˆ¤æ–­ä¸Šä¸ªç‰ˆæœ¬å·å’Œå½“å‰ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´</span></div><div class="line"><span class="keyword">if</span>(!lastVersion.equals(key.getVersion()))&#123;</div><div class="line">context.write(<span class="keyword">new</span> Text(key.toString()+<span class="string">"-"</span>+lastVersion), NullWritable.get());</div><div class="line">&#125;</div><div class="line"><span class="comment">//å½“IDå’ŒNameæœ‰ä¸€ä¸ªä¸ä¸€è‡´æ—¶ï¼Œè¯æ˜æ˜¯ä¸¤ä¸ªä¸åŒçš„ç”¨æˆ·</span></div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">context.write(<span class="keyword">new</span> Text(key.toString()), NullWritable.get());</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//è¿›è¡Œæ•°æ®è¿­ä»£å¤„ç†ï¼Œæ–¹ä¾¿æœ¬æ¬¡å’Œä¸‹æ¬¡çš„æ•°æ®è¿›è¡Œå¯¹æ¯”</span></div><div class="line">lastID=key.getId();</div><div class="line">lastName=key.getName();</div><div class="line">lastVersion=key.getVersion();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="æ•°å€¼ç´¯åŠ "><a href="#æ•°å€¼ç´¯åŠ " class="headerlink" title="æ•°å€¼ç´¯åŠ "></a>æ•°å€¼ç´¯åŠ </h4><p>æ±‚æ‰€æœ‰æ•°å¯¹åº”ä½ç½®çš„å åŠ å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">ä¸¾ä¾‹ï¼š</div><div class="line"><span class="number">0001</span>.txtæ–‡ä»¶æœ‰æ•°æ®ï¼š</div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line">...</div><div class="line"><span class="number">10</span></div><div class="line"><span class="number">0002</span>.txtæ–‡ä»¶æœ‰æ•°æ®ï¼š</div><div class="line"><span class="number">10</span></div><div class="line"><span class="number">10</span></div><div class="line"><span class="number">10</span></div><div class="line"><span class="number">10</span></div><div class="line">...</div><div class="line">è¿”å›ç»“æœæ˜¯ï¼š</div><div class="line"><span class="number">1</span><span class="number">1</span></div><div class="line"><span class="number">2</span><span class="number">3</span></div><div class="line"><span class="number">3</span><span class="number">6</span></div><div class="line"><span class="number">4</span><span class="number">10</span></div><div class="line">...</div><div class="line"><span class="number">10</span><span class="number">55</span></div><div class="line">ä¹Ÿå°±æ˜¯ï¼Œæ¯ä¸€è¡Œæ•°å­—åé¢éƒ½è¿½åŠ ä¸€ä¸ªç´¯åŠ åˆ°è¯¥æ•°å­—çš„å’Œå€¼</div></pre></td></tr></table></figure><p>æ€è·¯ï¼šå…ˆæ±‚å‡ºæ¯ä¸ªæ–‡ä»¶çš„æ€»å’Œï¼Œç„¶åæŒ‰ç…§æ–‡ä»¶çš„é¡ºåºè¿›è¡Œå åŠ </p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Mon Aug 19 2019 23:01:09 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --&gt;&lt;ul&gt;&lt;li&gt;Versionså˜åŠ¨ç‰ˆæœ¬è®°å½•&lt;/li&gt;&lt;li&gt;æ•°å€¼ç´¯åŠ &lt;/li&gt;&lt;/ul&gt;
    
    </summary>
    
    
      <category term="MapReduce" scheme="https://pross.space/tags/MapReduce/"/>
    
  </entry>
  
</feed>
